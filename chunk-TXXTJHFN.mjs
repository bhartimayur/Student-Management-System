import './polyfills.server.mjs';
import{$ as xw,A as Z,B as en,Ba as ou,C as vt,Ca as qa,D as pr,E as bw,F as Aw,G as Iw,H as Dw,I as Rw,J as Hs,K as bp,L as Ap,M as et,N as ge,O as Nw,P as Ba,Q as Br,R as Ki,S as Bt,T as Ip,U as kw,V as H,W as K,X as ru,Y as Mw,Z as Ow,_ as Pe,a as js,aa as Y,b as vw,ba as Va,c as Xc,ca as iu,d as _w,da as Dp,e as Gi,ea as Pw,f as Gs,g as Fn,h as Lr,i as ut,j as Sw,k as ww,ka as Rp,l as La,m as Ew,ma as Fw,n as Tw,na as Np,o as Jc,p as Zc,pa as Lw,q as Tp,qa as su,r as eu,ra as Bw,s as Hi,sa as Vw,t as Cp,u as Cw,v as tu,va as qw,w as nu,x as vn,y as yt,z as xe,za as Uw}from"./chunk-7ZOKYJUZ.mjs";import{a as zw,b as kp,c as jw,d as au,e as Gw,f as lu,g as Hw,h as Kw,i as Re,j as Wi,k as Ln,l as cu,m as Ua,n as Ww,o as $w,p as Vr,q as Vt}from"./chunk-V33DDLTH.mjs";import{a as Zt,b as fr,c as de,e as w,g as yw,h as Ep,i as g}from"./chunk-LK223424.mjs";var le=w(nn=>{"use strict";Object.defineProperty(nn,"__esModule",{value:!0});nn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=nn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=nn.Propagate=nn.LogVerbosity=nn.Status=void 0;var eC=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n}(eC||(nn.Status=eC={})),tC=function(n){return n[n.DEBUG=0]="DEBUG",n[n.INFO=1]="INFO",n[n.ERROR=2]="ERROR",n[n.NONE=3]="NONE",n}(tC||(nn.LogVerbosity=tC={})),nC=function(n){return n[n.DEADLINE=1]="DEADLINE",n[n.CENSUS_STATS_CONTEXT=2]="CENSUS_STATS_CONTEXT",n[n.CENSUS_TRACING_CONTEXT=4]="CENSUS_TRACING_CONTEXT",n[n.CANCELLATION=8]="CANCELLATION",n[n.DEFAULTS=65535]="DEFAULTS",n}(nC||(nn.Propagate=nC={}));nn.DEFAULT_MAX_SEND_MESSAGE_LENGTH=-1;nn.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH=4*1024*1024});var Vg=w((JH,lx)=>{lx.exports={name:"@grpc/grpc-js",version:"1.9.13",description:"gRPC Library for Node - pure JS implementation",homepage:"https://grpc.io/",repository:"https://github.com/grpc/grpc-node/tree/master/packages/grpc-js",main:"build/src/index.js",engines:{node:"^8.13.0 || >=10.10.0"},keywords:[],author:{name:"Google Inc."},types:"build/src/index.d.ts",license:"Apache-2.0",devDependencies:{"@types/gulp":"^4.0.6","@types/gulp-mocha":"0.0.32","@types/lodash":"^4.14.186","@types/mocha":"^5.2.6","@types/ncp":"^2.0.1","@types/pify":"^3.0.2","@types/semver":"^7.3.9","@typescript-eslint/eslint-plugin":"^5.59.11","@typescript-eslint/parser":"^5.59.11","@typescript-eslint/typescript-estree":"^5.59.11","clang-format":"^1.0.55",eslint:"^8.42.0","eslint-config-prettier":"^8.8.0","eslint-plugin-node":"^11.1.0","eslint-plugin-prettier":"^4.2.1",execa:"^2.0.3",gulp:"^4.0.2","gulp-mocha":"^6.0.0",lodash:"^4.17.4",madge:"^5.0.1","mocha-jenkins-reporter":"^0.4.1",ncp:"^2.0.0",pify:"^4.0.1",prettier:"^2.8.8",rimraf:"^3.0.2",semver:"^7.3.5","ts-node":"^10.9.1",typescript:"^5.1.3"},contributors:[{name:"Google Inc."}],scripts:{build:"npm run compile",clean:"rimraf ./build",compile:"tsc -p .",format:'clang-format -i -style="{Language: JavaScript, BasedOnStyle: Google, ColumnLimit: 80}" src/*.ts test/*.ts',lint:"eslint src/*.ts test/*.ts",prepare:"npm run generate-types && npm run compile",test:"gulp test",check:"npm run lint",fix:"eslint --fix src/*.ts test/*.ts",pretest:"npm run generate-types && npm run generate-test-types && npm run compile",posttest:"npm run check && madge -c ./build/src","generate-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --includeDirs proto/ --include-dirs test/fixtures/ -O src/generated/ --grpcLib ../index channelz.proto","generate-test-types":"proto-loader-gen-types --keepCase --longs String --enums String --defaults --oneofs --includeComments --include-dirs test/fixtures/ -O test/generated/ --grpcLib ../../src/index test_service.proto"},dependencies:{"@grpc/proto-loader":"^0.7.8","@types/node":">=12.12.47"},files:["src/**/*.ts","build/src/**/*.{js,d.ts,js.map}","proto/*.proto","LICENSE","deps/envoy-api/envoy/api/v2/**/*.proto","deps/envoy-api/envoy/config/**/*.proto","deps/envoy-api/envoy/service/**/*.proto","deps/envoy-api/envoy/type/**/*.proto","deps/udpa/udpa/**/*.proto","deps/googleapis/google/api/*.proto","deps/googleapis/google/rpc/*.proto","deps/protoc-gen-validate/validate/**/*.proto"]}});var Le=w(kt=>{"use strict";var qg,Ug,zg,jg;Object.defineProperty(kt,"__esModule",{value:!0});kt.isTracerEnabled=kt.trace=kt.log=kt.setLoggerVerbosity=kt.setLogger=kt.getLogger=void 0;var Wr=le(),cx=de("process"),ux=Vg().version,dx={error:(n,...e)=>{console.error("E "+n,...e)},info:(n,...e)=>{console.error("I "+n,...e)},debug:(n,...e)=>{console.error("D "+n,...e)}},es=dx,ro=Wr.LogVerbosity.ERROR,hx=(Ug=(qg=process.env.GRPC_NODE_VERBOSITY)!==null&&qg!==void 0?qg:process.env.GRPC_VERBOSITY)!==null&&Ug!==void 0?Ug:"";switch(hx.toUpperCase()){case"DEBUG":ro=Wr.LogVerbosity.DEBUG;break;case"INFO":ro=Wr.LogVerbosity.INFO;break;case"ERROR":ro=Wr.LogVerbosity.ERROR;break;case"NONE":ro=Wr.LogVerbosity.NONE;break;default:}var fx=()=>es;kt.getLogger=fx;var px=n=>{es=n};kt.setLogger=px;var gx=n=>{ro=n};kt.setLoggerVerbosity=gx;var mx=(n,...e)=>{let t;if(n>=ro){switch(n){case Wr.LogVerbosity.DEBUG:t=es.debug;break;case Wr.LogVerbosity.INFO:t=es.info;break;case Wr.LogVerbosity.ERROR:t=es.error;break}t||(t=es.error),t&&t.bind(es)(...e)}};kt.log=mx;var yx=(jg=(zg=process.env.GRPC_NODE_TRACE)!==null&&zg!==void 0?zg:process.env.GRPC_TRACE)!==null&&jg!==void 0?jg:"",Gg=new Set,rC=new Set;for(let n of yx.split(","))n.startsWith("-")?rC.add(n.substring(1)):Gg.add(n);var vx=Gg.has("all");function _x(n,e,t){iC(e)&&(0,kt.log)(n,new Date().toISOString()+" | v"+ux+" "+cx.pid+" | "+e+" | "+t)}kt.trace=_x;function iC(n){return!rC.has(n)&&(vx||Gg.has(n))}kt.isTracerEnabled=iC});var ed=w(io=>{"use strict";Object.defineProperty(io,"__esModule",{value:!0});io.getErrorCode=io.getErrorMessage=void 0;function Sx(n){return n instanceof Error?n.message:String(n)}io.getErrorMessage=Sx;function wx(n){return typeof n=="object"&&n!==null&&"code"in n&&typeof n.code=="number"?n.code:null}io.getErrorCode=wx});var Mt=w(nd=>{"use strict";Object.defineProperty(nd,"__esModule",{value:!0});nd.Metadata=void 0;var Ex=Le(),Tx=le(),Cx=ed(),bx=/^[0-9a-z_.-]+$/,Ax=/^[ -~]*$/;function Ix(n){return bx.test(n)}function Dx(n){return Ax.test(n)}function oC(n){return n.endsWith("-bin")}function Rx(n){return!n.startsWith("grpc-")}function td(n){return n.toLowerCase()}function sC(n,e){if(!Ix(n))throw new Error('Metadata key "'+n+'" contains illegal characters');if(e!=null)if(oC(n)){if(!Buffer.isBuffer(e))throw new Error("keys that end with '-bin' must have Buffer values")}else{if(Buffer.isBuffer(e))throw new Error("keys that don't end with '-bin' must have String values");if(!Dx(e))throw new Error('Metadata string value "'+e+'" contains illegal characters')}}var Hg=class n{constructor(e={}){this.internalRepr=new Map,this.options=e}set(e,t){e=td(e),sC(e,t),this.internalRepr.set(e,[t])}add(e,t){e=td(e),sC(e,t);let r=this.internalRepr.get(e);r===void 0?this.internalRepr.set(e,[t]):r.push(t)}remove(e){e=td(e),this.internalRepr.delete(e)}get(e){return e=td(e),this.internalRepr.get(e)||[]}getMap(){let e={};for(let[t,r]of this.internalRepr)if(r.length>0){let i=r[0];e[t]=Buffer.isBuffer(i)?Buffer.from(i):i}return e}clone(){let e=new n(this.options),t=e.internalRepr;for(let[r,i]of this.internalRepr){let s=i.map(o=>Buffer.isBuffer(o)?Buffer.from(o):o);t.set(r,s)}return e}merge(e){for(let[t,r]of e.internalRepr){let i=(this.internalRepr.get(t)||[]).concat(r);this.internalRepr.set(t,i)}}setOptions(e){this.options=e}getOptions(){return this.options}toHttp2Headers(){let e={};for(let[t,r]of this.internalRepr)e[t]=r.map(Nx);return e}toJSON(){let e={};for(let[t,r]of this.internalRepr)e[t]=r;return e}static fromHttp2Headers(e){let t=new n;for(let r of Object.keys(e)){if(r.charAt(0)===":")continue;let i=e[r];try{oC(r)?Array.isArray(i)?i.forEach(s=>{t.add(r,Buffer.from(s,"base64"))}):i!==void 0&&(Rx(r)?i.split(",").forEach(s=>{t.add(r,Buffer.from(s.trim(),"base64"))}):t.add(r,Buffer.from(i,"base64"))):Array.isArray(i)?i.forEach(s=>{t.add(r,s)}):i!==void 0&&t.add(r,i)}catch(s){let o=`Failed to add metadata entry ${r}: ${i}. ${(0,Cx.getErrorMessage)(s)}. For more information see https://github.com/grpc/grpc-node/issues/1173`;(0,Ex.log)(Tx.LogVerbosity.ERROR,o)}}return t}};nd.Metadata=Hg;var Nx=n=>Buffer.isBuffer(n)?n.toString("base64"):n});var Yg=w(rd=>{"use strict";Object.defineProperty(rd,"__esModule",{value:!0});rd.CallCredentials=void 0;var Qg=Mt();function kx(n){return"getRequestHeaders"in n&&typeof n.getRequestHeaders=="function"}var so=class n{static createFromMetadataGenerator(e){return new Wg(e)}static createFromGoogleCredential(e){return n.createFromMetadataGenerator((t,r)=>{let i;kx(e)?i=e.getRequestHeaders(t.service_url):i=new Promise((s,o)=>{e.getRequestMetadata(t.service_url,(a,l)=>{if(a){o(a);return}if(!l){o(new Error("Headers not set by metadata plugin"));return}s(l)})}),i.then(s=>{let o=new Qg.Metadata;for(let a of Object.keys(s))o.add(a,s[a]);r(null,o)},s=>{r(s)})})}static createEmpty(){return new $g}};rd.CallCredentials=so;var Kg=class n extends so{constructor(e){super(),this.creds=e}generateMetadata(e){return g(this,null,function*(){let t=new Qg.Metadata,r=yield Promise.all(this.creds.map(i=>i.generateMetadata(e)));for(let i of r)t.merge(i);return t})}compose(e){return new n(this.creds.concat([e]))}_equals(e){return this===e?!0:e instanceof n?this.creds.every((t,r)=>t._equals(e.creds[r])):!1}},Wg=class n extends so{constructor(e){super(),this.metadataGenerator=e}generateMetadata(e){return new Promise((t,r)=>{this.metadataGenerator(e,(i,s)=>{s!==void 0?t(s):r(i)})})}compose(e){return new Kg([this,e])}_equals(e){return this===e?!0:e instanceof n?this.metadataGenerator===e.metadataGenerator:!1}},$g=class n extends so{generateMetadata(e){return Promise.resolve(new Qg.Metadata)}compose(e){return e}_equals(e){return e instanceof n}}});var Jg=w(oo=>{"use strict";Object.defineProperty(oo,"__esModule",{value:!0});oo.getDefaultRootsData=oo.CIPHER_SUITES=void 0;var Mx=de("fs");oo.CIPHER_SUITES=process.env.GRPC_SSL_CIPHER_SUITES;var aC=process.env.GRPC_DEFAULT_SSL_ROOTS_FILE_PATH,Xg=null;function Ox(){return aC?(Xg===null&&(Xg=Mx.readFileSync(aC)),Xg):null}oo.getDefaultRootsData=Ox});var od=w(sd=>{"use strict";Object.defineProperty(sd,"__esModule",{value:!0});sd.ChannelCredentials=void 0;var xx=de("tls"),Px=Yg(),lC=Jg();function Zg(n,e){if(n&&!(n instanceof Buffer))throw new TypeError(`${e}, if provided, must be a Buffer.`)}var ao=class{constructor(e){this.callCredentials=e||Px.CallCredentials.createEmpty()}_getCallCredentials(){return this.callCredentials}static createSsl(e,t,r,i){var s;if(Zg(e,"Root certificate"),Zg(t,"Private key"),Zg(r,"Certificate chain"),t&&!r)throw new Error("Private key must be given with accompanying certificate chain");if(!t&&r)throw new Error("Certificate chain must be given with accompanying private key");let o=(0,xx.createSecureContext)({ca:(s=e??(0,lC.getDefaultRootsData)())!==null&&s!==void 0?s:void 0,key:t??void 0,cert:r??void 0,ciphers:lC.CIPHER_SUITES});return new id(o,i??{})}static createFromSecureContext(e,t){return new id(e,t??{})}static createInsecure(){return new em}};sd.ChannelCredentials=ao;var em=class n extends ao{constructor(e){super(e)}compose(e){throw new Error("Cannot compose insecure credentials")}_getConnectionOptions(){return null}_isSecure(){return!1}_equals(e){return e instanceof n}},id=class n extends ao{constructor(e,t){super(),this.secureContext=e,this.verifyOptions=t,this.connectionOptions={secureContext:e},t?.checkServerIdentity&&(this.connectionOptions.checkServerIdentity=t.checkServerIdentity)}compose(e){let t=this.callCredentials.compose(e);return new tm(this,t)}_getConnectionOptions(){return Object.assign({},this.connectionOptions)}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.secureContext===e.secureContext&&this.verifyOptions.checkServerIdentity===e.verifyOptions.checkServerIdentity:!1}},tm=class n extends ao{constructor(e,t){super(t),this.channelCredentials=e}compose(e){let t=this.callCredentials.compose(e);return new n(this.channelCredentials,t)}_getConnectionOptions(){return this.channelCredentials._getConnectionOptions()}_isSecure(){return!0}_equals(e){return this===e?!0:e instanceof n?this.channelCredentials._equals(e.channelCredentials)&&this.callCredentials._equals(e.callCredentials):!1}}});var Qr=w(wt=>{"use strict";Object.defineProperty(wt,"__esModule",{value:!0});wt.validateLoadBalancingConfig=wt.getFirstUsableConfig=wt.isLoadBalancerNameRegistered=wt.createLoadBalancer=wt.registerDefaultLoadBalancerType=wt.registerLoadBalancerType=wt.createChildChannelControlHelper=void 0;function Fx(n,e){var t,r,i,s,o,a,l,c,u,d;return{createSubchannel:(r=(t=e.createSubchannel)===null||t===void 0?void 0:t.bind(e))!==null&&r!==void 0?r:n.createSubchannel.bind(n),updateState:(s=(i=e.updateState)===null||i===void 0?void 0:i.bind(e))!==null&&s!==void 0?s:n.updateState.bind(n),requestReresolution:(a=(o=e.requestReresolution)===null||o===void 0?void 0:o.bind(e))!==null&&a!==void 0?a:n.requestReresolution.bind(n),addChannelzChild:(c=(l=e.addChannelzChild)===null||l===void 0?void 0:l.bind(e))!==null&&c!==void 0?c:n.addChannelzChild.bind(n),removeChannelzChild:(d=(u=e.removeChannelzChild)===null||u===void 0?void 0:u.bind(e))!==null&&d!==void 0?d:n.removeChannelzChild.bind(n)}}wt.createChildChannelControlHelper=Fx;var $r={},nm=null;function Lx(n,e,t){$r[n]={LoadBalancer:e,LoadBalancingConfig:t}}wt.registerLoadBalancerType=Lx;function Bx(n){nm=n}wt.registerDefaultLoadBalancerType=Bx;function Vx(n,e){let t=n.getLoadBalancerName();return t in $r?new $r[t].LoadBalancer(e):null}wt.createLoadBalancer=Vx;function qx(n){return n in $r}wt.isLoadBalancerNameRegistered=qx;function Ux(n,e=!1){for(let t of n)if(t.getLoadBalancerName()in $r)return t;return e&&nm?new $r[nm].LoadBalancingConfig:null}wt.getFirstUsableConfig=Ux;function zx(n){if(!(n!==null&&typeof n=="object"))throw new Error("Load balancing config must be an object");let e=Object.keys(n);if(e.length!==1)throw new Error("Provided load balancing config has multiple conflicting entries");let t=e[0];if(t in $r)return $r[t].LoadBalancingConfig.createFromJson(n[t]);throw new Error(`Unrecognized load balancing config name ${t}`)}wt.validateLoadBalancingConfig=zx});var rm=w(Yr=>{"use strict";Object.defineProperty(Yr,"__esModule",{value:!0});Yr.extractAndSelectServiceConfig=Yr.validateServiceConfig=Yr.validateRetryThrottling=void 0;var jx=de("os"),ad=le(),Gx=Qr(),ld=/^\d+(\.\d{1,9})?s$/,Hx="node";function Kx(n){if("service"in n&&n.service!==""){if(typeof n.service!="string")throw new Error(`Invalid method config name: invalid service: expected type string, got ${typeof n.service}`);if("method"in n&&n.method!==""){if(typeof n.method!="string")throw new Error(`Invalid method config name: invalid method: expected type string, got ${typeof n.service}`);return{service:n.service,method:n.method}}else return{service:n.service}}else{if("method"in n&&n.method!==void 0)throw new Error("Invalid method config name: method set with empty or unset service");return{}}}function Wx(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config retry policy: maxAttempts must be an integer at least 2");if(!("initialBackoff"in n)||typeof n.initialBackoff!="string"||!ld.test(n.initialBackoff))throw new Error("Invalid method config retry policy: initialBackoff must be a string consisting of a positive integer followed by s");if(!("maxBackoff"in n)||typeof n.maxBackoff!="string"||!ld.test(n.maxBackoff))throw new Error("Invalid method config retry policy: maxBackoff must be a string consisting of a positive integer followed by s");if(!("backoffMultiplier"in n)||typeof n.backoffMultiplier!="number"||n.backoffMultiplier<=0)throw new Error("Invalid method config retry policy: backoffMultiplier must be a number greater than 0");if(!("retryableStatusCodes"in n&&Array.isArray(n.retryableStatusCodes)))throw new Error("Invalid method config retry policy: retryableStatusCodes is required");if(n.retryableStatusCodes.length===0)throw new Error("Invalid method config retry policy: retryableStatusCodes must be non-empty");for(let e of n.retryableStatusCodes)if(typeof e=="number"){if(!Object.values(ad.Status).includes(e))throw new Error("Invalid method config retry policy: retryableStatusCodes value not in status code range")}else if(typeof e=="string"){if(!Object.values(ad.Status).includes(e.toUpperCase()))throw new Error("Invalid method config retry policy: retryableStatusCodes value not a status code name")}else throw new Error("Invalid method config retry policy: retryableStatusCodes value must be a string or number");return{maxAttempts:n.maxAttempts,initialBackoff:n.initialBackoff,maxBackoff:n.maxBackoff,backoffMultiplier:n.backoffMultiplier,retryableStatusCodes:n.retryableStatusCodes}}function $x(n){if(!("maxAttempts"in n)||!Number.isInteger(n.maxAttempts)||n.maxAttempts<2)throw new Error("Invalid method config hedging policy: maxAttempts must be an integer at least 2");if("hedgingDelay"in n&&(typeof n.hedgingDelay!="string"||!ld.test(n.hedgingDelay)))throw new Error("Invalid method config hedging policy: hedgingDelay must be a string consisting of a positive integer followed by s");if("nonFatalStatusCodes"in n&&Array.isArray(n.nonFatalStatusCodes))for(let t of n.nonFatalStatusCodes)if(typeof t=="number"){if(!Object.values(ad.Status).includes(t))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not in status code range")}else if(typeof t=="string"){if(!Object.values(ad.Status).includes(t.toUpperCase()))throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value not a status code name")}else throw new Error("Invlid method config hedging policy: nonFatalStatusCodes value must be a string or number");let e={maxAttempts:n.maxAttempts};return n.hedgingDelay&&(e.hedgingDelay=n.hedgingDelay),n.nonFatalStatusCodes&&(e.nonFatalStatusCodes=n.nonFatalStatusCodes),e}function Qx(n){var e;let t={name:[]};if(!("name"in n)||!Array.isArray(n.name))throw new Error("Invalid method config: invalid name array");for(let r of n.name)t.name.push(Kx(r));if("waitForReady"in n){if(typeof n.waitForReady!="boolean")throw new Error("Invalid method config: invalid waitForReady");t.waitForReady=n.waitForReady}if("timeout"in n)if(typeof n.timeout=="object"){if(!("seconds"in n.timeout)||typeof n.timeout.seconds!="number")throw new Error("Invalid method config: invalid timeout.seconds");if(!("nanos"in n.timeout)||typeof n.timeout.nanos!="number")throw new Error("Invalid method config: invalid timeout.nanos");t.timeout=n.timeout}else if(typeof n.timeout=="string"&&ld.test(n.timeout)){let r=n.timeout.substring(0,n.timeout.length-1).split(".");t.timeout={seconds:r[0]|0,nanos:((e=r[1])!==null&&e!==void 0?e:0)|0}}else throw new Error("Invalid method config: invalid timeout");if("maxRequestBytes"in n){if(typeof n.maxRequestBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxRequestBytes=n.maxRequestBytes}if("maxResponseBytes"in n){if(typeof n.maxResponseBytes!="number")throw new Error("Invalid method config: invalid maxRequestBytes");t.maxResponseBytes=n.maxResponseBytes}if("retryPolicy"in n){if("hedgingPolicy"in n)throw new Error("Invalid method config: retryPolicy and hedgingPolicy cannot both be specified");t.retryPolicy=Wx(n.retryPolicy)}else"hedgingPolicy"in n&&(t.hedgingPolicy=$x(n.hedgingPolicy));return t}function cC(n){if(!("maxTokens"in n)||typeof n.maxTokens!="number"||n.maxTokens<=0||n.maxTokens>1e3)throw new Error("Invalid retryThrottling: maxTokens must be a number in (0, 1000]");if(!("tokenRatio"in n)||typeof n.tokenRatio!="number"||n.tokenRatio<=0)throw new Error("Invalid retryThrottling: tokenRatio must be a number greater than 0");return{maxTokens:+n.maxTokens.toFixed(3),tokenRatio:+n.tokenRatio.toFixed(3)}}Yr.validateRetryThrottling=cC;function uC(n){let e={loadBalancingConfig:[],methodConfig:[]};if("loadBalancingPolicy"in n)if(typeof n.loadBalancingPolicy=="string")e.loadBalancingPolicy=n.loadBalancingPolicy;else throw new Error("Invalid service config: invalid loadBalancingPolicy");if("loadBalancingConfig"in n)if(Array.isArray(n.loadBalancingConfig))for(let r of n.loadBalancingConfig)e.loadBalancingConfig.push((0,Gx.validateLoadBalancingConfig)(r));else throw new Error("Invalid service config: invalid loadBalancingConfig");if("methodConfig"in n&&Array.isArray(n.methodConfig))for(let r of n.methodConfig)e.methodConfig.push(Qx(r));"retryThrottling"in n&&(e.retryThrottling=cC(n.retryThrottling));let t=[];for(let r of e.methodConfig)for(let i of r.name){for(let s of t)if(i.service===s.service&&i.method===s.method)throw new Error(`Invalid service config: duplicate name ${i.service}/${i.method}`);t.push(i)}return e}Yr.validateServiceConfig=uC;function Yx(n){if(!("serviceConfig"in n))throw new Error("Invalid service config choice: missing service config");let e={serviceConfig:uC(n.serviceConfig)};if("clientLanguage"in n)if(Array.isArray(n.clientLanguage)){e.clientLanguage=[];for(let r of n.clientLanguage)if(typeof r=="string")e.clientLanguage.push(r);else throw new Error("Invalid service config choice: invalid clientLanguage")}else throw new Error("Invalid service config choice: invalid clientLanguage");if("clientHostname"in n)if(Array.isArray(n.clientHostname)){e.clientHostname=[];for(let r of n.clientHostname)if(typeof r=="string")e.clientHostname.push(r);else throw new Error("Invalid service config choice: invalid clientHostname")}else throw new Error("Invalid service config choice: invalid clientHostname");if("percentage"in n)if(typeof n.percentage=="number"&&0<=n.percentage&&n.percentage<=100)e.percentage=n.percentage;else throw new Error("Invalid service config choice: invalid percentage");let t=["clientLanguage","percentage","clientHostname","serviceConfig"];for(let r in n)if(!t.includes(r))throw new Error(`Invalid service config choice: unexpected field ${r}`);return e}function Xx(n,e){if(!Array.isArray(n))throw new Error("Invalid service config list");for(let t of n){let r=Yx(t);if(!(typeof r.percentage=="number"&&e>r.percentage)){if(Array.isArray(r.clientHostname)){let i=!1;for(let s of r.clientHostname)s===jx.hostname()&&(i=!0);if(!i)continue}if(Array.isArray(r.clientLanguage)){let i=!1;for(let s of r.clientLanguage)s===Hx&&(i=!0);if(!i)continue}return r.serviceConfig}}throw new Error("No matching service config found")}function Jx(n,e){for(let t of n)if(t.length>0&&t[0].startsWith("grpc_config=")){let r=t.join("").substring(12),i=JSON.parse(r);return Xx(i,e)}return null}Yr.extractAndSelectServiceConfig=Jx});var rn=w(cd=>{"use strict";Object.defineProperty(cd,"__esModule",{value:!0});cd.ConnectivityState=void 0;var dC=function(n){return n[n.IDLE=0]="IDLE",n[n.CONNECTING=1]="CONNECTING",n[n.READY=2]="READY",n[n.TRANSIENT_FAILURE=3]="TRANSIENT_FAILURE",n[n.SHUTDOWN=4]="SHUTDOWN",n}(dC||(cd.ConnectivityState=dC={}))});var Wt=w(Xr=>{"use strict";Object.defineProperty(Xr,"__esModule",{value:!0});Xr.uriToString=Xr.splitHostPort=Xr.parseUri=void 0;var Zx=/^(?:([A-Za-z0-9+.-]+):)?(?:\/\/([^/]*)\/)?(.+)$/;function eP(n){let e=Zx.exec(n);return e===null?null:{scheme:e[1],authority:e[2],path:e[3]}}Xr.parseUri=eP;var hC=/^\d+$/;function tP(n){if(n.startsWith("[")){let e=n.indexOf("]");if(e===-1)return null;let t=n.substring(1,e);if(t.indexOf(":")===-1)return null;if(n.length>e+1)if(n[e+1]===":"){let r=n.substring(e+2);return hC.test(r)?{host:t,port:+r}:null}else return null;else return{host:t}}else{let e=n.split(":");return e.length===2?hC.test(e[1])?{host:e[0],port:+e[1]}:null:{host:n}}}Xr.splitHostPort=tP;function nP(n){let e="";return n.scheme!==void 0&&(e+=n.scheme+":"),n.authority!==void 0&&(e+="//"+n.authority+"/"),e+=n.path,e}Xr.uriToString=nP});var zn=w(sn=>{"use strict";Object.defineProperty(sn,"__esModule",{value:!0});sn.mapUriDefaultScheme=sn.getDefaultAuthority=sn.createResolver=sn.registerDefaultScheme=sn.registerResolver=void 0;var sm=Wt(),lo={},im=null;function rP(n,e){lo[n]=e}sn.registerResolver=rP;function iP(n){im=n}sn.registerDefaultScheme=iP;function sP(n,e,t){if(n.scheme!==void 0&&n.scheme in lo)return new lo[n.scheme](n,e,t);throw new Error(`No resolver could be created for target ${(0,sm.uriToString)(n)}`)}sn.createResolver=sP;function oP(n){if(n.scheme!==void 0&&n.scheme in lo)return lo[n.scheme].getDefaultAuthority(n);throw new Error(`Invalid target ${(0,sm.uriToString)(n)}`)}sn.getDefaultAuthority=oP;function aP(n){return n.scheme===void 0||!(n.scheme in lo)?im!==null?{scheme:im,authority:void 0,path:(0,sm.uriToString)(n)}:null:n}sn.mapUriDefaultScheme=aP});var Zr=w(Jr=>{"use strict";Object.defineProperty(Jr,"__esModule",{value:!0});Jr.QueuePicker=Jr.UnavailablePicker=Jr.PickResultType=void 0;var lP=Mt(),cP=le(),ud=function(n){return n[n.COMPLETE=0]="COMPLETE",n[n.QUEUE=1]="QUEUE",n[n.TRANSIENT_FAILURE=2]="TRANSIENT_FAILURE",n[n.DROP=3]="DROP",n}(ud||(Jr.PickResultType=ud={})),om=class{constructor(e){this.status=Object.assign({code:cP.Status.UNAVAILABLE,details:"No connection established",metadata:new lP.Metadata},e)}pick(e){return{pickResultType:ud.TRANSIENT_FAILURE,subchannel:null,status:this.status,onCallStarted:null,onCallEnded:null}}};Jr.UnavailablePicker=om;var am=class{constructor(e){this.loadBalancer=e,this.calledExitIdle=!1}pick(e){return this.calledExitIdle||(process.nextTick(()=>{this.loadBalancer.exitIdle()}),this.calledExitIdle=!0),{pickResultType:ud.QUEUE,subchannel:null,status:null,onCallStarted:null,onCallEnded:null}}};Jr.QueuePicker=am});var yl=w(dd=>{"use strict";Object.defineProperty(dd,"__esModule",{value:!0});dd.BackoffTimeout=void 0;var uP=1e3,dP=1.6,hP=12e4,fP=.2;function pP(n,e){return Math.random()*(e-n)+n}var lm=class{constructor(e,t){this.callback=e,this.initialDelay=uP,this.multiplier=dP,this.maxDelay=hP,this.jitter=fP,this.running=!1,this.hasRef=!0,this.startTime=new Date,this.endTime=new Date,t&&(t.initialDelay&&(this.initialDelay=t.initialDelay),t.multiplier&&(this.multiplier=t.multiplier),t.jitter&&(this.jitter=t.jitter),t.maxDelay&&(this.maxDelay=t.maxDelay)),this.nextDelay=this.initialDelay,this.timerId=setTimeout(()=>{},0),clearTimeout(this.timerId)}runTimer(e){var t,r;this.endTime=this.startTime,this.endTime.setMilliseconds(this.endTime.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),this.timerId=setTimeout(()=>{this.callback(),this.running=!1},e),this.hasRef||(r=(t=this.timerId).unref)===null||r===void 0||r.call(t)}runOnce(){this.running=!0,this.startTime=new Date,this.runTimer(this.nextDelay);let e=Math.min(this.nextDelay*this.multiplier,this.maxDelay),t=e*this.jitter;this.nextDelay=e+pP(-t,t)}stop(){clearTimeout(this.timerId),this.running=!1}reset(){if(this.nextDelay=this.initialDelay,this.running){let e=new Date,t=this.startTime;t.setMilliseconds(t.getMilliseconds()+this.nextDelay),clearTimeout(this.timerId),e<t?this.runTimer(t.getTime()-e.getTime()):this.running=!1}}isRunning(){return this.running}ref(){var e,t;this.hasRef=!0,(t=(e=this.timerId).ref)===null||t===void 0||t.call(e)}unref(){var e,t;this.hasRef=!1,(t=(e=this.timerId).unref)===null||t===void 0||t.call(e)}getEndTime(){return this.endTime}};dd.BackoffTimeout=lm});var fd=w(hd=>{"use strict";Object.defineProperty(hd,"__esModule",{value:!0});hd.ChildLoadBalancerHandler=void 0;var gP=Qr(),mP=rn(),yP="child_load_balancer_helper",cm=class{constructor(e){this.channelControlHelper=e,this.currentChild=null,this.pendingChild=null,this.latestConfig=null,this.ChildPolicyHelper=class{constructor(t){this.parent=t,this.child=null}createSubchannel(t,r){return this.parent.channelControlHelper.createSubchannel(t,r)}updateState(t,r){var i;if(this.calledByPendingChild()){if(t===mP.ConnectivityState.CONNECTING)return;(i=this.parent.currentChild)===null||i===void 0||i.destroy(),this.parent.currentChild=this.parent.pendingChild,this.parent.pendingChild=null}else if(!this.calledByCurrentChild())return;this.parent.channelControlHelper.updateState(t,r)}requestReresolution(){var t;let r=(t=this.parent.pendingChild)!==null&&t!==void 0?t:this.parent.currentChild;this.child===r&&this.parent.channelControlHelper.requestReresolution()}setChild(t){this.child=t}addChannelzChild(t){this.parent.channelControlHelper.addChannelzChild(t)}removeChannelzChild(t){this.parent.channelControlHelper.removeChannelzChild(t)}calledByPendingChild(){return this.child===this.parent.pendingChild}calledByCurrentChild(){return this.child===this.parent.currentChild}}}configUpdateRequiresNewPolicyInstance(e,t){return e.getLoadBalancerName()!==t.getLoadBalancerName()}updateAddressList(e,t,r){let i;if(this.currentChild===null||this.latestConfig===null||this.configUpdateRequiresNewPolicyInstance(this.latestConfig,t)){let s=new this.ChildPolicyHelper(this),o=(0,gP.createLoadBalancer)(t,s);s.setChild(o),this.currentChild===null?(this.currentChild=o,i=this.currentChild):(this.pendingChild&&this.pendingChild.destroy(),this.pendingChild=o,i=this.pendingChild)}else this.pendingChild===null?i=this.currentChild:i=this.pendingChild;this.latestConfig=t,i.updateAddressList(e,t,r)}exitIdle(){this.currentChild&&(this.currentChild.exitIdle(),this.pendingChild&&this.pendingChild.exitIdle())}resetBackoff(){this.currentChild&&(this.currentChild.resetBackoff(),this.pendingChild&&this.pendingChild.resetBackoff())}destroy(){this.currentChild&&(this.currentChild.destroy(),this.currentChild=null),this.pendingChild&&(this.pendingChild.destroy(),this.pendingChild=null)}getTypeName(){return yP}};hd.ChildLoadBalancerHandler=cm});var pC=w(pd=>{"use strict";Object.defineProperty(pd,"__esModule",{value:!0});pd.ResolvingLoadBalancer=void 0;var vP=Qr(),_P=rm(),Ut=rn(),SP=zn(),co=Zr(),wP=yl(),um=le(),EP=Mt(),TP=Le(),CP=le(),bP=Wt(),AP=fd(),IP="resolving_load_balancer";function fC(n){TP.trace(CP.LogVerbosity.DEBUG,IP,n)}var DP=["SERVICE_AND_METHOD","SERVICE","EMPTY"];function RP(n,e,t,r){for(let i of t.name)switch(r){case"EMPTY":if(!i.service&&!i.method)return!0;break;case"SERVICE":if(i.service===n&&!i.method)return!0;break;case"SERVICE_AND_METHOD":if(i.service===n&&i.method===e)return!0}return!1}function NP(n,e,t,r){for(let i of t)if(RP(n,e,i,r))return i;return null}function kP(n){return function(t,r){var i,s;let o=t.split("/").filter(c=>c.length>0),a=(i=o[0])!==null&&i!==void 0?i:"",l=(s=o[1])!==null&&s!==void 0?s:"";if(n&&n.methodConfig)for(let c of DP){let u=NP(a,l,n.methodConfig,c);if(u)return{methodConfig:u,pickInformation:{},status:um.Status.OK,dynamicFilterFactories:[]}}return{methodConfig:{name:[]},pickInformation:{},status:um.Status.OK,dynamicFilterFactories:[]}}}var dm=class{constructor(e,t,r,i,s){this.target=e,this.channelControlHelper=t,this.onSuccessfulResolution=i,this.onFailedResolution=s,this.latestChildState=Ut.ConnectivityState.IDLE,this.latestChildPicker=new co.QueuePicker(this),this.currentState=Ut.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1,r["grpc.service_config"]?this.defaultServiceConfig=(0,_P.validateServiceConfig)(JSON.parse(r["grpc.service_config"])):this.defaultServiceConfig={loadBalancingConfig:[],methodConfig:[]},this.updateState(Ut.ConnectivityState.IDLE,new co.QueuePicker(this)),this.childLoadBalancer=new AP.ChildLoadBalancerHandler({createSubchannel:t.createSubchannel.bind(t),requestReresolution:()=>{this.backoffTimeout.isRunning()?(fC("requestReresolution delayed by backoff timer until "+this.backoffTimeout.getEndTime().toISOString()),this.continueResolving=!0):this.updateResolution()},updateState:(a,l)=>{this.latestChildState=a,this.latestChildPicker=l,this.updateState(a,l)},addChannelzChild:t.addChannelzChild.bind(t),removeChannelzChild:t.removeChannelzChild.bind(t)}),this.innerResolver=(0,SP.createResolver)(e,{onSuccessfulResolution:(a,l,c,u,d)=>{var h;this.backoffTimeout.stop(),this.backoffTimeout.reset();let p=null;l===null?c===null?(this.previousServiceConfig=null,p=this.defaultServiceConfig):this.previousServiceConfig===null?this.handleResolutionFailure(c):p=this.previousServiceConfig:(p=l,this.previousServiceConfig=l);let y=(h=p?.loadBalancingConfig)!==null&&h!==void 0?h:[],_=(0,vP.getFirstUsableConfig)(y,!0);if(_===null){this.handleResolutionFailure({code:um.Status.UNAVAILABLE,details:"All load balancer options in service config are not compatible",metadata:new EP.Metadata});return}this.childLoadBalancer.updateAddressList(a,_,d);let S=p??this.defaultServiceConfig;this.onSuccessfulResolution(S,u??kP(S))},onError:a=>{this.handleResolutionFailure(a)}},r);let o={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new wP.BackoffTimeout(()=>{this.continueResolving?(this.updateResolution(),this.continueResolving=!1):this.updateState(this.latestChildState,this.latestChildPicker)},o),this.backoffTimeout.unref()}updateResolution(){this.innerResolver.updateResolution(),this.currentState===Ut.ConnectivityState.IDLE&&this.updateState(Ut.ConnectivityState.CONNECTING,new co.QueuePicker(this)),this.backoffTimeout.runOnce()}updateState(e,t){fC((0,bP.uriToString)(this.target)+" "+Ut.ConnectivityState[this.currentState]+" -> "+Ut.ConnectivityState[e]),e===Ut.ConnectivityState.IDLE&&(t=new co.QueuePicker(this)),this.currentState=e,this.channelControlHelper.updateState(e,t)}handleResolutionFailure(e){this.latestChildState===Ut.ConnectivityState.IDLE&&(this.updateState(Ut.ConnectivityState.TRANSIENT_FAILURE,new co.UnavailablePicker(e)),this.onFailedResolution(e))}exitIdle(){(this.currentState===Ut.ConnectivityState.IDLE||this.currentState===Ut.ConnectivityState.TRANSIENT_FAILURE)&&(this.backoffTimeout.isRunning()?this.continueResolving=!0:this.updateResolution()),this.childLoadBalancer.exitIdle()}updateAddressList(e,t){throw new Error("updateAddressList not supported on ResolvingLoadBalancer")}resetBackoff(){this.backoffTimeout.reset(),this.childLoadBalancer.resetBackoff()}destroy(){this.childLoadBalancer.destroy(),this.innerResolver.destroy(),this.backoffTimeout.reset(),this.backoffTimeout.stop(),this.latestChildState=Ut.ConnectivityState.IDLE,this.latestChildPicker=new co.QueuePicker(this),this.currentState=Ut.ConnectivityState.IDLE,this.previousServiceConfig=null,this.continueResolving=!1}getTypeName(){return"resolving_load_balancer"}};pd.ResolvingLoadBalancer=dm});var gC=w(uo=>{"use strict";Object.defineProperty(uo,"__esModule",{value:!0});uo.channelOptionsEqual=uo.recognizedOptions=void 0;uo.recognizedOptions={"grpc.ssl_target_name_override":!0,"grpc.primary_user_agent":!0,"grpc.secondary_user_agent":!0,"grpc.default_authority":!0,"grpc.keepalive_time_ms":!0,"grpc.keepalive_timeout_ms":!0,"grpc.keepalive_permit_without_calls":!0,"grpc.service_config":!0,"grpc.max_concurrent_streams":!0,"grpc.initial_reconnect_backoff_ms":!0,"grpc.max_reconnect_backoff_ms":!0,"grpc.use_local_subchannel_pool":!0,"grpc.max_send_message_length":!0,"grpc.max_receive_message_length":!0,"grpc.enable_http_proxy":!0,"grpc.enable_channelz":!0,"grpc.dns_min_time_between_resolutions_ms":!0,"grpc.enable_retries":!0,"grpc.per_rpc_retry_buffer_size":!0,"grpc.retry_buffer_size":!0,"grpc.max_connection_age_ms":!0,"grpc.max_connection_age_grace_ms":!0,"grpc-node.max_session_memory":!0,"grpc.service_config_disable_resolution":!0,"grpc.client_idle_timeout_ms":!0,"grpc-node.tls_enable_trace":!0};function MP(n,e){let t=Object.keys(n).sort(),r=Object.keys(e).sort();if(t.length!==r.length)return!1;for(let i=0;i<t.length;i+=1)if(t[i]!==r[i]||n[t[i]]!==e[r[i]])return!1;return!0}uo.channelOptionsEqual=MP});var Gn=w(jn=>{"use strict";Object.defineProperty(jn,"__esModule",{value:!0});jn.stringToSubchannelAddress=jn.subchannelAddressToString=jn.subchannelAddressEqual=jn.isTcpSubchannelAddress=void 0;var OP=de("net");function vl(n){return"port"in n}jn.isTcpSubchannelAddress=vl;function xP(n,e){return!n&&!e?!0:!n||!e?!1:vl(n)?vl(e)&&n.host===e.host&&n.port===e.port:!vl(e)&&n.path===e.path}jn.subchannelAddressEqual=xP;function PP(n){return vl(n)?n.host+":"+n.port:n.path}jn.subchannelAddressToString=PP;var FP=443;function LP(n,e){return(0,OP.isIP)(n)?{host:n,port:e??FP}:{path:n}}jn.stringToSubchannelAddress=LP});var gd=w(ho=>{"use strict";Object.defineProperty(ho,"__esModule",{value:!0});ho.addAdminServicesToServer=ho.registerAdminService=void 0;var mC=[];function BP(n,e){mC.push({getServiceDefinition:n,getHandlers:e})}ho.registerAdminService=BP;function VP(n){for(let{getServiceDefinition:e,getHandlers:t}of mC)n.addService(e(),t())}ho.addAdminServicesToServer=VP});var yC=w(on=>{"use strict";Object.defineProperty(on,"__esModule",{value:!0});on.ClientDuplexStreamImpl=on.ClientWritableStreamImpl=on.ClientReadableStreamImpl=on.ClientUnaryCallImpl=on.callErrorFromStatus=void 0;var qP=de("events"),mm=de("stream"),_l=le();function UP(n,e){let t=`${n.code} ${_l.Status[n.code]}: ${n.details}`,i=`${new Error(t).stack}
for call at
${e}`;return Object.assign(new Error(t),n,{stack:i})}on.callErrorFromStatus=UP;var hm=class extends qP.EventEmitter{constructor(){super()}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(_l.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}};on.ClientUnaryCallImpl=hm;var fm=class extends mm.Readable{constructor(e){super({objectMode:!0}),this.deserialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(_l.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}};on.ClientReadableStreamImpl=fm;var pm=class extends mm.Writable{constructor(e){super({objectMode:!0}),this.serialize=e}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(_l.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};on.ClientWritableStreamImpl=pm;var gm=class extends mm.Duplex{constructor(e,t){super({objectMode:!0}),this.serialize=e,this.deserialize=t}cancel(){var e;(e=this.call)===null||e===void 0||e.cancelWithStatus(_l.Status.CANCELLED,"Cancelled on client")}getPeer(){var e,t;return(t=(e=this.call)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:"unknown"}_read(e){var t;(t=this.call)===null||t===void 0||t.startRead()}_write(e,t,r){var i;let s={callback:r},o=Number(t);Number.isNaN(o)||(s.flags=o),(i=this.call)===null||i===void 0||i.sendMessageWithContext(s,e)}_final(e){var t;(t=this.call)===null||t===void 0||t.halfClose(),e()}};on.ClientDuplexStreamImpl=gm});var vC=w(fo=>{"use strict";Object.defineProperty(fo,"__esModule",{value:!0});fo.InterceptingListenerImpl=fo.isInterceptingListener=void 0;function zP(n){return n.onReceiveMetadata!==void 0&&n.onReceiveMetadata.length===1}fo.isInterceptingListener=zP;var ym=class{constructor(e,t){this.listener=e,this.nextListener=t,this.processingMetadata=!1,this.hasPendingMessage=!1,this.processingMessage=!1,this.pendingStatus=null}processPendingMessage(){this.hasPendingMessage&&(this.nextListener.onReceiveMessage(this.pendingMessage),this.pendingMessage=null,this.hasPendingMessage=!1)}processPendingStatus(){this.pendingStatus&&this.nextListener.onReceiveStatus(this.pendingStatus)}onReceiveMetadata(e){this.processingMetadata=!0,this.listener.onReceiveMetadata(e,t=>{this.processingMetadata=!1,this.nextListener.onReceiveMetadata(t),this.processPendingMessage(),this.processPendingStatus()})}onReceiveMessage(e){this.processingMessage=!0,this.listener.onReceiveMessage(e,t=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessage=t,this.hasPendingMessage=!0):(this.nextListener.onReceiveMessage(t),this.processPendingStatus())})}onReceiveStatus(e){this.listener.onReceiveStatus(e,t=>{this.processingMetadata||this.processingMessage?this.pendingStatus=t:this.nextListener.onReceiveStatus(t)})}};fo.InterceptingListenerImpl=ym});var Cm=w(an=>{"use strict";Object.defineProperty(an,"__esModule",{value:!0});an.getInterceptingCall=an.InterceptingCall=an.RequesterBuilder=an.ListenerBuilder=an.InterceptorConfigurationError=void 0;var jP=Mt(),_C=vC(),SC=le(),wC=ed(),wl=class n extends Error{constructor(e){super(e),this.name="InterceptorConfigurationError",Error.captureStackTrace(this,n)}};an.InterceptorConfigurationError=wl;var _m=class{constructor(){this.metadata=void 0,this.message=void 0,this.status=void 0}withOnReceiveMetadata(e){return this.metadata=e,this}withOnReceiveMessage(e){return this.message=e,this}withOnReceiveStatus(e){return this.status=e,this}build(){return{onReceiveMetadata:this.metadata,onReceiveMessage:this.message,onReceiveStatus:this.status}}};an.ListenerBuilder=_m;var Sm=class{constructor(){this.start=void 0,this.message=void 0,this.halfClose=void 0,this.cancel=void 0}withStart(e){return this.start=e,this}withSendMessage(e){return this.message=e,this}withHalfClose(e){return this.halfClose=e,this}withCancel(e){return this.cancel=e,this}build(){return{start:this.start,sendMessage:this.message,halfClose:this.halfClose,cancel:this.cancel}}};an.RequesterBuilder=Sm;var vm={onReceiveMetadata:(n,e)=>{e(n)},onReceiveMessage:(n,e)=>{e(n)},onReceiveStatus:(n,e)=>{e(n)}},Sl={start:(n,e,t)=>{t(n,e)},sendMessage:(n,e)=>{e(n)},halfClose:n=>{n()},cancel:n=>{n()}},wm=class{constructor(e,t){var r,i,s,o;this.nextCall=e,this.processingMetadata=!1,this.pendingMessageContext=null,this.processingMessage=!1,this.pendingHalfClose=!1,t?this.requester={start:(r=t.start)!==null&&r!==void 0?r:Sl.start,sendMessage:(i=t.sendMessage)!==null&&i!==void 0?i:Sl.sendMessage,halfClose:(s=t.halfClose)!==null&&s!==void 0?s:Sl.halfClose,cancel:(o=t.cancel)!==null&&o!==void 0?o:Sl.cancel}:this.requester=Sl}cancelWithStatus(e,t){this.requester.cancel(()=>{this.nextCall.cancelWithStatus(e,t)})}getPeer(){return this.nextCall.getPeer()}processPendingMessage(){this.pendingMessageContext&&(this.nextCall.sendMessageWithContext(this.pendingMessageContext,this.pendingMessage),this.pendingMessageContext=null,this.pendingMessage=null)}processPendingHalfClose(){this.pendingHalfClose&&this.nextCall.halfClose()}start(e,t){var r,i,s,o,a,l;let c={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:u=>{},onReceiveMessage:(o=(s=t?.onReceiveMessage)===null||s===void 0?void 0:s.bind(t))!==null&&o!==void 0?o:u=>{},onReceiveStatus:(l=(a=t?.onReceiveStatus)===null||a===void 0?void 0:a.bind(t))!==null&&l!==void 0?l:u=>{}};this.processingMetadata=!0,this.requester.start(e,c,(u,d)=>{var h,p,y;this.processingMetadata=!1;let _;if((0,_C.isInterceptingListener)(d))_=d;else{let S={onReceiveMetadata:(h=d.onReceiveMetadata)!==null&&h!==void 0?h:vm.onReceiveMetadata,onReceiveMessage:(p=d.onReceiveMessage)!==null&&p!==void 0?p:vm.onReceiveMessage,onReceiveStatus:(y=d.onReceiveStatus)!==null&&y!==void 0?y:vm.onReceiveStatus};_=new _C.InterceptingListenerImpl(S,c)}this.nextCall.start(u,_),this.processPendingMessage(),this.processPendingHalfClose()})}sendMessageWithContext(e,t){this.processingMessage=!0,this.requester.sendMessage(t,r=>{this.processingMessage=!1,this.processingMetadata?(this.pendingMessageContext=e,this.pendingMessage=t):(this.nextCall.sendMessageWithContext(e,r),this.processPendingHalfClose())})}sendMessage(e){this.sendMessageWithContext({},e)}startRead(){this.nextCall.startRead()}halfClose(){this.requester.halfClose(()=>{this.processingMetadata||this.processingMessage?this.pendingHalfClose=!0:this.nextCall.halfClose()})}};an.InterceptingCall=wm;function GP(n,e,t){var r,i;let s=(r=t.deadline)!==null&&r!==void 0?r:1/0,o=t.host,a=(i=t.parent)!==null&&i!==void 0?i:null,l=t.propagate_flags,c=t.credentials,u=n.createCall(e,s,o,a,l);return c&&u.setCredentials(c),u}var md=class{constructor(e,t){this.call=e,this.methodDefinition=t}cancelWithStatus(e,t){this.call.cancelWithStatus(e,t)}getPeer(){return this.call.getPeer()}sendMessageWithContext(e,t){let r;try{r=this.methodDefinition.requestSerialize(t)}catch(i){this.call.cancelWithStatus(SC.Status.INTERNAL,`Request message serialization failure: ${(0,wC.getErrorMessage)(i)}`);return}this.call.sendMessageWithContext(e,r)}sendMessage(e){this.sendMessageWithContext({},e)}start(e,t){let r=null;this.call.start(e,{onReceiveMetadata:i=>{var s;(s=t?.onReceiveMetadata)===null||s===void 0||s.call(t,i)},onReceiveMessage:i=>{var s;let o;try{o=this.methodDefinition.responseDeserialize(i)}catch(a){r={code:SC.Status.INTERNAL,details:`Response message parsing error: ${(0,wC.getErrorMessage)(a)}`,metadata:new jP.Metadata},this.call.cancelWithStatus(r.code,r.details);return}(s=t?.onReceiveMessage)===null||s===void 0||s.call(t,o)},onReceiveStatus:i=>{var s,o;r?(s=t?.onReceiveStatus)===null||s===void 0||s.call(t,r):(o=t?.onReceiveStatus)===null||o===void 0||o.call(t,i)}})}startRead(){this.call.startRead()}halfClose(){this.call.halfClose()}},Em=class extends md{constructor(e,t){super(e,t)}start(e,t){var r,i;let s=!1,o={onReceiveMetadata:(i=(r=t?.onReceiveMetadata)===null||r===void 0?void 0:r.bind(t))!==null&&i!==void 0?i:a=>{},onReceiveMessage:a=>{var l;s=!0,(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,a)},onReceiveStatus:a=>{var l,c;s||(l=t?.onReceiveMessage)===null||l===void 0||l.call(t,null),(c=t?.onReceiveStatus)===null||c===void 0||c.call(t,a)}};super.start(e,o),this.call.startRead()}},Tm=class extends md{};function HP(n,e,t){let r=GP(n,t.path,e);return t.responseStream?new Tm(r,t):new Em(r,t)}function KP(n,e,t,r){if(n.clientInterceptors.length>0&&n.clientInterceptorProviders.length>0)throw new wl("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(n.callInterceptors.length>0&&n.callInterceptorProviders.length>0)throw new wl("Both interceptors and interceptor_providers were passed as call options. Only one of these is allowed.");let i=[];n.callInterceptors.length>0||n.callInterceptorProviders.length>0?i=[].concat(n.callInterceptors,n.callInterceptorProviders.map(a=>a(e))).filter(a=>a):i=[].concat(n.clientInterceptors,n.clientInterceptorProviders.map(a=>a(e))).filter(a=>a);let s=Object.assign({},t,{method_definition:e});return i.reduceRight((a,l)=>c=>l(c,a),a=>HP(r,a,e))(s)}an.getInterceptingCall=KP});var Im=w(vd=>{"use strict";Object.defineProperty(vd,"__esModule",{value:!0});vd.Client=void 0;var Hn=yC(),WP=Dm(),$P=rn(),ei=le(),po=Mt(),yd=Cm(),En=Symbol(),go=Symbol(),mo=Symbol(),_r=Symbol();function bm(n){return typeof n=="function"}function yo(n){return n.stack.split(`
`).slice(1).join(`
`)}var Am=class{constructor(e,t,r={}){var i,s;if(r=Object.assign({},r),this[go]=(i=r.interceptors)!==null&&i!==void 0?i:[],delete r.interceptors,this[mo]=(s=r.interceptor_providers)!==null&&s!==void 0?s:[],delete r.interceptor_providers,this[go].length>0&&this[mo].length>0)throw new Error("Both interceptors and interceptor_providers were passed as options to the client constructor. Only one of these is allowed.");if(this[_r]=r.callInvocationTransformer,delete r.callInvocationTransformer,r.channelOverride)this[En]=r.channelOverride;else if(r.channelFactoryOverride){let o=r.channelFactoryOverride;delete r.channelFactoryOverride,this[En]=o(e,t,r)}else this[En]=new WP.ChannelImplementation(e,t,r)}close(){this[En].close()}getChannel(){return this[En]}waitForReady(e,t){let r=i=>{if(i){t(new Error("Failed to connect before the deadline"));return}let s;try{s=this[En].getConnectivityState(!0)}catch{t(new Error("The channel has been closed"));return}if(s===$P.ConnectivityState.READY)t();else try{this[En].watchConnectivityState(s,e,r)}catch{t(new Error("The channel has been closed"))}};setImmediate(r)}checkOptionalUnaryResponseArguments(e,t,r){if(bm(e))return{metadata:new po.Metadata,options:{},callback:e};if(bm(t))return e instanceof po.Metadata?{metadata:e,options:{},callback:t}:{metadata:new po.Metadata,options:e,callback:t};if(!(e instanceof po.Metadata&&t instanceof Object&&bm(r)))throw new Error("Incorrect arguments passed");return{metadata:e,options:t,callback:r}}makeUnaryRequest(e,t,r,i,s,o,a){var l,c;let u=this.checkOptionalUnaryResponseArguments(s,o,a),d={path:e,requestStream:!1,responseStream:!1,requestSerialize:t,responseDeserialize:r},h={argument:i,metadata:u.metadata,call:new Hn.ClientUnaryCallImpl,channel:this[En],methodDefinition:d,callOptions:u.options,callback:u.callback};this[_r]&&(h=this[_r](h));let p=h.call,y={clientInterceptors:this[go],clientInterceptorProviders:this[mo],callInterceptors:(l=h.callOptions.interceptors)!==null&&l!==void 0?l:[],callInterceptorProviders:(c=h.callOptions.interceptor_providers)!==null&&c!==void 0?c:[]},_=(0,yd.getInterceptingCall)(y,h.methodDefinition,h.callOptions,h.channel);p.call=_;let S=null,R=!1,E=new Error;return _.start(h.metadata,{onReceiveMetadata:N=>{p.emit("metadata",N)},onReceiveMessage(N){S!==null&&_.cancelWithStatus(ei.Status.INTERNAL,"Too many responses received"),S=N},onReceiveStatus(N){if(!R){if(R=!0,N.code===ei.Status.OK)if(S===null){let k=yo(E);h.callback((0,Hn.callErrorFromStatus)({code:ei.Status.INTERNAL,details:"No message received",metadata:N.metadata},k))}else h.callback(null,S);else{let k=yo(E);h.callback((0,Hn.callErrorFromStatus)(N,k))}E=null,p.emit("status",N)}}}),_.sendMessage(i),_.halfClose(),p}makeClientStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkOptionalUnaryResponseArguments(i,s,o),u={path:e,requestStream:!0,responseStream:!1,requestSerialize:t,responseDeserialize:r},d={metadata:c.metadata,call:new Hn.ClientWritableStreamImpl(t),channel:this[En],methodDefinition:u,callOptions:c.options,callback:c.callback};this[_r]&&(d=this[_r](d));let h=d.call,p={clientInterceptors:this[go],clientInterceptorProviders:this[mo],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,yd.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=y;let _=null,S=!1,R=new Error;return y.start(d.metadata,{onReceiveMetadata:E=>{h.emit("metadata",E)},onReceiveMessage(E){_!==null&&y.cancelWithStatus(ei.Status.INTERNAL,"Too many responses received"),_=E},onReceiveStatus(E){if(!S){if(S=!0,E.code===ei.Status.OK)if(_===null){let N=yo(R);d.callback((0,Hn.callErrorFromStatus)({code:ei.Status.INTERNAL,details:"No message received",metadata:E.metadata},N))}else d.callback(null,_);else{let N=yo(R);d.callback((0,Hn.callErrorFromStatus)(E,N))}R=null,h.emit("status",E)}}}),h}checkMetadataAndOptions(e,t){let r,i;return e instanceof po.Metadata?(r=e,t?i=t:i={}):(e?i=e:i={},r=new po.Metadata),{metadata:r,options:i}}makeServerStreamRequest(e,t,r,i,s,o){var a,l;let c=this.checkMetadataAndOptions(s,o),u={path:e,requestStream:!1,responseStream:!0,requestSerialize:t,responseDeserialize:r},d={argument:i,metadata:c.metadata,call:new Hn.ClientReadableStreamImpl(r),channel:this[En],methodDefinition:u,callOptions:c.options};this[_r]&&(d=this[_r](d));let h=d.call,p={clientInterceptors:this[go],clientInterceptorProviders:this[mo],callInterceptors:(a=d.callOptions.interceptors)!==null&&a!==void 0?a:[],callInterceptorProviders:(l=d.callOptions.interceptor_providers)!==null&&l!==void 0?l:[]},y=(0,yd.getInterceptingCall)(p,d.methodDefinition,d.callOptions,d.channel);h.call=y;let _=!1,S=new Error;return y.start(d.metadata,{onReceiveMetadata(R){h.emit("metadata",R)},onReceiveMessage(R){h.push(R)},onReceiveStatus(R){if(!_){if(_=!0,h.push(null),R.code!==ei.Status.OK){let E=yo(S);h.emit("error",(0,Hn.callErrorFromStatus)(R,E))}S=null,h.emit("status",R)}}}),y.sendMessage(i),y.halfClose(),h}makeBidiStreamRequest(e,t,r,i,s){var o,a;let l=this.checkMetadataAndOptions(i,s),c={path:e,requestStream:!0,responseStream:!0,requestSerialize:t,responseDeserialize:r},u={metadata:l.metadata,call:new Hn.ClientDuplexStreamImpl(t,r),channel:this[En],methodDefinition:c,callOptions:l.options};this[_r]&&(u=this[_r](u));let d=u.call,h={clientInterceptors:this[go],clientInterceptorProviders:this[mo],callInterceptors:(o=u.callOptions.interceptors)!==null&&o!==void 0?o:[],callInterceptorProviders:(a=u.callOptions.interceptor_providers)!==null&&a!==void 0?a:[]},p=(0,yd.getInterceptingCall)(h,u.methodDefinition,u.callOptions,u.channel);d.call=p;let y=!1,_=new Error;return p.start(u.metadata,{onReceiveMetadata(S){d.emit("metadata",S)},onReceiveMessage(S){d.push(S)},onReceiveStatus(S){if(!y){if(y=!0,d.push(null),S.code!==ei.Status.OK){let R=yo(_);d.emit("error",(0,Hn.callErrorFromStatus)(S,R))}_=null,d.emit("status",S)}}}),d}};vd.Client=Am});var Nm=w(vo=>{"use strict";Object.defineProperty(vo,"__esModule",{value:!0});vo.loadPackageDefinition=vo.makeClientConstructor=void 0;var El=Im(),QP={unary:El.Client.prototype.makeUnaryRequest,server_stream:El.Client.prototype.makeServerStreamRequest,client_stream:El.Client.prototype.makeClientStreamRequest,bidi:El.Client.prototype.makeBidiStreamRequest};function Rm(n){return["__proto__","prototype","constructor"].includes(n)}function EC(n,e,t){t||(t={});class r extends El.Client{}return Object.keys(n).forEach(i=>{if(Rm(i))return;let s=n[i],o;if(typeof i=="string"&&i.charAt(0)==="$")throw new Error("Method names cannot start with $");s.requestStream?s.responseStream?o="bidi":o="client_stream":s.responseStream?o="server_stream":o="unary";let a=s.requestSerialize,l=s.responseDeserialize,c=YP(QP[o],s.path,a,l);r.prototype[i]=c,Object.assign(r.prototype[i],s),s.originalName&&!Rm(s.originalName)&&(r.prototype[s.originalName]=r.prototype[i])}),r.service=n,r.serviceName=e,r}vo.makeClientConstructor=EC;function YP(n,e,t,r){return function(...i){return n.call(this,e,t,r,...i)}}function XP(n){return"format"in n}function JP(n){let e={};for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let r=n[t],i=t.split(".");if(i.some(a=>Rm(a)))continue;let s=i[i.length-1],o=e;for(let a of i.slice(0,-1))o[a]||(o[a]={}),o=o[a];XP(r)?o[s]=r:o[s]=EC(r,s,{})}return e}vo.loadPackageDefinition=JP});var WC=w((CK,KC)=>{"use strict";var ZP=1/0,eF="[object Symbol]",tF=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,nF=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Sd="\\ud800-\\udfff",NC="\\u0300-\\u036f\\ufe20-\\ufe23",kC="\\u20d0-\\u20f0",MC="\\u2700-\\u27bf",OC="a-z\\xdf-\\xf6\\xf8-\\xff",rF="\\xac\\xb1\\xd7\\xf7",iF="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",sF="\\u2000-\\u206f",oF=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",xC="A-Z\\xc0-\\xd6\\xd8-\\xde",PC="\\ufe0e\\ufe0f",FC=rF+iF+sF+oF,Mm="['\u2019]",aF="["+Sd+"]",TC="["+FC+"]",_d="["+NC+kC+"]",LC="\\d+",lF="["+MC+"]",BC="["+OC+"]",VC="[^"+Sd+FC+LC+MC+OC+xC+"]",km="\\ud83c[\\udffb-\\udfff]",cF="(?:"+_d+"|"+km+")",qC="[^"+Sd+"]",Om="(?:\\ud83c[\\udde6-\\uddff]){2}",xm="[\\ud800-\\udbff][\\udc00-\\udfff]",_o="["+xC+"]",UC="\\u200d",CC="(?:"+BC+"|"+VC+")",uF="(?:"+_o+"|"+VC+")",bC="(?:"+Mm+"(?:d|ll|m|re|s|t|ve))?",AC="(?:"+Mm+"(?:D|LL|M|RE|S|T|VE))?",zC=cF+"?",jC="["+PC+"]?",dF="(?:"+UC+"(?:"+[qC,Om,xm].join("|")+")"+jC+zC+")*",GC=jC+zC+dF,hF="(?:"+[lF,Om,xm].join("|")+")"+GC,fF="(?:"+[qC+_d+"?",_d,Om,xm,aF].join("|")+")",pF=RegExp(Mm,"g"),gF=RegExp(_d,"g"),mF=RegExp(km+"(?="+km+")|"+fF+GC,"g"),yF=RegExp([_o+"?"+BC+"+"+bC+"(?="+[TC,_o,"$"].join("|")+")",uF+"+"+AC+"(?="+[TC,_o+CC,"$"].join("|")+")",_o+"?"+CC+"+"+bC,_o+"+"+AC,LC,hF].join("|"),"g"),vF=RegExp("["+UC+Sd+NC+kC+PC+"]"),_F=/[a-z][A-Z]|[A-Z]{2,}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,SF={\u00C0:"A",\u00C1:"A",\u00C2:"A",\u00C3:"A",\u00C4:"A",\u00C5:"A",\u00E0:"a",\u00E1:"a",\u00E2:"a",\u00E3:"a",\u00E4:"a",\u00E5:"a",\u00C7:"C",\u00E7:"c",\u00D0:"D",\u00F0:"d",\u00C8:"E",\u00C9:"E",\u00CA:"E",\u00CB:"E",\u00E8:"e",\u00E9:"e",\u00EA:"e",\u00EB:"e",\u00CC:"I",\u00CD:"I",\u00CE:"I",\u00CF:"I",\u00EC:"i",\u00ED:"i",\u00EE:"i",\u00EF:"i",\u00D1:"N",\u00F1:"n",\u00D2:"O",\u00D3:"O",\u00D4:"O",\u00D5:"O",\u00D6:"O",\u00D8:"O",\u00F2:"o",\u00F3:"o",\u00F4:"o",\u00F5:"o",\u00F6:"o",\u00F8:"o",\u00D9:"U",\u00DA:"U",\u00DB:"U",\u00DC:"U",\u00F9:"u",\u00FA:"u",\u00FB:"u",\u00FC:"u",\u00DD:"Y",\u00FD:"y",\u00FF:"y",\u00C6:"Ae",\u00E6:"ae",\u00DE:"Th",\u00FE:"th",\u00DF:"ss",\u0100:"A",\u0102:"A",\u0104:"A",\u0101:"a",\u0103:"a",\u0105:"a",\u0106:"C",\u0108:"C",\u010A:"C",\u010C:"C",\u0107:"c",\u0109:"c",\u010B:"c",\u010D:"c",\u010E:"D",\u0110:"D",\u010F:"d",\u0111:"d",\u0112:"E",\u0114:"E",\u0116:"E",\u0118:"E",\u011A:"E",\u0113:"e",\u0115:"e",\u0117:"e",\u0119:"e",\u011B:"e",\u011C:"G",\u011E:"G",\u0120:"G",\u0122:"G",\u011D:"g",\u011F:"g",\u0121:"g",\u0123:"g",\u0124:"H",\u0126:"H",\u0125:"h",\u0127:"h",\u0128:"I",\u012A:"I",\u012C:"I",\u012E:"I",\u0130:"I",\u0129:"i",\u012B:"i",\u012D:"i",\u012F:"i",\u0131:"i",\u0134:"J",\u0135:"j",\u0136:"K",\u0137:"k",\u0138:"k",\u0139:"L",\u013B:"L",\u013D:"L",\u013F:"L",\u0141:"L",\u013A:"l",\u013C:"l",\u013E:"l",\u0140:"l",\u0142:"l",\u0143:"N",\u0145:"N",\u0147:"N",\u014A:"N",\u0144:"n",\u0146:"n",\u0148:"n",\u014B:"n",\u014C:"O",\u014E:"O",\u0150:"O",\u014D:"o",\u014F:"o",\u0151:"o",\u0154:"R",\u0156:"R",\u0158:"R",\u0155:"r",\u0157:"r",\u0159:"r",\u015A:"S",\u015C:"S",\u015E:"S",\u0160:"S",\u015B:"s",\u015D:"s",\u015F:"s",\u0161:"s",\u0162:"T",\u0164:"T",\u0166:"T",\u0163:"t",\u0165:"t",\u0167:"t",\u0168:"U",\u016A:"U",\u016C:"U",\u016E:"U",\u0170:"U",\u0172:"U",\u0169:"u",\u016B:"u",\u016D:"u",\u016F:"u",\u0171:"u",\u0173:"u",\u0174:"W",\u0175:"w",\u0176:"Y",\u0177:"y",\u0178:"Y",\u0179:"Z",\u017B:"Z",\u017D:"Z",\u017A:"z",\u017C:"z",\u017E:"z",\u0132:"IJ",\u0133:"ij",\u0152:"Oe",\u0153:"oe",\u0149:"'n",\u017F:"ss"},wF=typeof global=="object"&&global&&global.Object===Object&&global,EF=typeof self=="object"&&self&&self.Object===Object&&self,TF=wF||EF||Function("return this")();function CF(n,e,t,r){var i=-1,s=n?n.length:0;for(r&&s&&(t=n[++i]);++i<s;)t=e(t,n[i],i,n);return t}function bF(n){return n.split("")}function AF(n){return n.match(tF)||[]}function IF(n){return function(e){return n?.[e]}}var DF=IF(SF);function HC(n){return vF.test(n)}function RF(n){return _F.test(n)}function NF(n){return HC(n)?kF(n):bF(n)}function kF(n){return n.match(mF)||[]}function MF(n){return n.match(yF)||[]}var OF=Object.prototype,xF=OF.toString,IC=TF.Symbol,DC=IC?IC.prototype:void 0,RC=DC?DC.toString:void 0;function PF(n,e,t){var r=-1,i=n.length;e<0&&(e=-e>i?0:i+e),t=t>i?i:t,t<0&&(t+=i),i=e>t?0:t-e>>>0,e>>>=0;for(var s=Array(i);++r<i;)s[r]=n[r+e];return s}function FF(n){if(typeof n=="string")return n;if(UF(n))return RC?RC.call(n):"";var e=n+"";return e=="0"&&1/n==-ZP?"-0":e}function LF(n,e,t){var r=n.length;return t=t===void 0?r:t,!e&&t>=r?n:PF(n,e,t)}function BF(n){return function(e){e=wd(e);var t=HC(e)?NF(e):void 0,r=t?t[0]:e.charAt(0),i=t?LF(t,1).join(""):e.slice(1);return r[n]()+i}}function VF(n){return function(e){return CF(KF(GF(e).replace(pF,"")),n,"")}}function qF(n){return!!n&&typeof n=="object"}function UF(n){return typeof n=="symbol"||qF(n)&&xF.call(n)==eF}function wd(n){return n==null?"":FF(n)}var zF=VF(function(n,e,t){return e=e.toLowerCase(),n+(t?jF(e):e)});function jF(n){return HF(wd(n).toLowerCase())}function GF(n){return n=wd(n),n&&n.replace(nF,DF).replace(gF,"")}var HF=BF("toUpperCase");function KF(n,e,t){return n=wd(n),e=t?void 0:e,e===void 0?RF(n)?MF(n):AF(n):n.match(e)||[]}KC.exports=zF});var Pm=w((bK,$C)=>{"use strict";$C.exports=WF;function WF(n,e){for(var t=new Array(arguments.length-1),r=0,i=2,s=!0;i<arguments.length;)t[r++]=arguments[i++];return new Promise(function(a,l){t[r]=function(u){if(s)if(s=!1,u)l(u);else{for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h++]=arguments[h];a.apply(null,d)}};try{n.apply(e||null,t)}catch(c){s&&(s=!1,l(c))}})}});var JC=w(XC=>{"use strict";var Ed=XC;Ed.length=function(e){var t=e.length;if(!t)return 0;for(var r=0;--t%4>1&&e.charAt(t)==="=";)++r;return Math.ceil(e.length*3)/4-r};var So=new Array(64),YC=new Array(123);for(Tn=0;Tn<64;)YC[So[Tn]=Tn<26?Tn+65:Tn<52?Tn+71:Tn<62?Tn-4:Tn-59|43]=Tn++;var Tn;Ed.encode=function(e,t,r){for(var i=null,s=[],o=0,a=0,l;t<r;){var c=e[t++];switch(a){case 0:s[o++]=So[c>>2],l=(c&3)<<4,a=1;break;case 1:s[o++]=So[l|c>>4],l=(c&15)<<2,a=2;break;case 2:s[o++]=So[l|c>>6],s[o++]=So[c&63],a=0;break}o>8191&&((i||(i=[])).push(String.fromCharCode.apply(String,s)),o=0)}return a&&(s[o++]=So[l],s[o++]=61,a===1&&(s[o++]=61)),i?(o&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))};var QC="invalid encoding";Ed.decode=function(e,t,r){for(var i=r,s=0,o,a=0;a<e.length;){var l=e.charCodeAt(a++);if(l===61&&s>1)break;if((l=YC[l])===void 0)throw Error(QC);switch(s){case 0:o=l,s=1;break;case 1:t[r++]=o<<2|(l&48)>>4,o=l,s=2;break;case 2:t[r++]=(o&15)<<4|(l&60)>>2,o=l,s=3;break;case 3:t[r++]=(o&3)<<6|l,s=0;break}}if(s===1)throw Error(QC);return r-i};Ed.test=function(e){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(e)}});var eb=w((IK,ZC)=>{"use strict";ZC.exports=Td;function Td(){this._listeners={}}Td.prototype.on=function(e,t,r){return(this._listeners[e]||(this._listeners[e]=[])).push({fn:t,ctx:r||this}),this};Td.prototype.off=function(e,t){if(e===void 0)this._listeners={};else if(t===void 0)this._listeners[e]=[];else for(var r=this._listeners[e],i=0;i<r.length;)r[i].fn===t?r.splice(i,1):++i;return this};Td.prototype.emit=function(e){var t=this._listeners[e];if(t){for(var r=[],i=1;i<arguments.length;)r.push(arguments[i++]);for(i=0;i<t.length;)t[i].fn.apply(t[i++].ctx,r)}return this}});var ab=w((DK,ob)=>{"use strict";ob.exports=tb(tb);function tb(n){return typeof Float32Array<"u"?function(){var e=new Float32Array([-0]),t=new Uint8Array(e.buffer),r=t[3]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3]}function s(l,c,u){e[0]=l,c[u]=t[3],c[u+1]=t[2],c[u+2]=t[1],c[u+3]=t[0]}n.writeFloatLE=r?i:s,n.writeFloatBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],e[0]}function a(l,c){return t[3]=l[c],t[2]=l[c+1],t[1]=l[c+2],t[0]=l[c+3],e[0]}n.readFloatLE=r?o:a,n.readFloatBE=r?a:o}():function(){function e(r,i,s,o){var a=i<0?1:0;if(a&&(i=-i),i===0)r(1/i>0?0:2147483648,s,o);else if(isNaN(i))r(2143289344,s,o);else if(i>34028234663852886e22)r((a<<31|2139095040)>>>0,s,o);else if(i<11754943508222875e-54)r((a<<31|Math.round(i/1401298464324817e-60))>>>0,s,o);else{var l=Math.floor(Math.log(i)/Math.LN2),c=Math.round(i*Math.pow(2,-l)*8388608)&8388607;r((a<<31|l+127<<23|c)>>>0,s,o)}}n.writeFloatLE=e.bind(null,nb),n.writeFloatBE=e.bind(null,rb);function t(r,i,s){var o=r(i,s),a=(o>>31)*2+1,l=o>>>23&255,c=o&8388607;return l===255?c?NaN:a*(1/0):l===0?a*1401298464324817e-60*c:a*Math.pow(2,l-150)*(c+8388608)}n.readFloatLE=t.bind(null,ib),n.readFloatBE=t.bind(null,sb)}(),typeof Float64Array<"u"?function(){var e=new Float64Array([-0]),t=new Uint8Array(e.buffer),r=t[7]===128;function i(l,c,u){e[0]=l,c[u]=t[0],c[u+1]=t[1],c[u+2]=t[2],c[u+3]=t[3],c[u+4]=t[4],c[u+5]=t[5],c[u+6]=t[6],c[u+7]=t[7]}function s(l,c,u){e[0]=l,c[u]=t[7],c[u+1]=t[6],c[u+2]=t[5],c[u+3]=t[4],c[u+4]=t[3],c[u+5]=t[2],c[u+6]=t[1],c[u+7]=t[0]}n.writeDoubleLE=r?i:s,n.writeDoubleBE=r?s:i;function o(l,c){return t[0]=l[c],t[1]=l[c+1],t[2]=l[c+2],t[3]=l[c+3],t[4]=l[c+4],t[5]=l[c+5],t[6]=l[c+6],t[7]=l[c+7],e[0]}function a(l,c){return t[7]=l[c],t[6]=l[c+1],t[5]=l[c+2],t[4]=l[c+3],t[3]=l[c+4],t[2]=l[c+5],t[1]=l[c+6],t[0]=l[c+7],e[0]}n.readDoubleLE=r?o:a,n.readDoubleBE=r?a:o}():function(){function e(r,i,s,o,a,l){var c=o<0?1:0;if(c&&(o=-o),o===0)r(0,a,l+i),r(1/o>0?0:2147483648,a,l+s);else if(isNaN(o))r(0,a,l+i),r(2146959360,a,l+s);else if(o>17976931348623157e292)r(0,a,l+i),r((c<<31|2146435072)>>>0,a,l+s);else{var u;if(o<22250738585072014e-324)u=o/5e-324,r(u>>>0,a,l+i),r((c<<31|u/4294967296)>>>0,a,l+s);else{var d=Math.floor(Math.log(o)/Math.LN2);d===1024&&(d=1023),u=o*Math.pow(2,-d),r(u*4503599627370496>>>0,a,l+i),r((c<<31|d+1023<<20|u*1048576&1048575)>>>0,a,l+s)}}}n.writeDoubleLE=e.bind(null,nb,0,4),n.writeDoubleBE=e.bind(null,rb,4,0);function t(r,i,s,o,a){var l=r(o,a+i),c=r(o,a+s),u=(c>>31)*2+1,d=c>>>20&2047,h=4294967296*(c&1048575)+l;return d===2047?h?NaN:u*(1/0):d===0?u*5e-324*h:u*Math.pow(2,d-1075)*(h+4503599627370496)}n.readDoubleLE=t.bind(null,ib,0,4),n.readDoubleBE=t.bind(null,sb,4,0)}(),n}function nb(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}function rb(n,e,t){e[t]=n>>>24,e[t+1]=n>>>16&255,e[t+2]=n>>>8&255,e[t+3]=n&255}function ib(n,e){return(n[e]|n[e+1]<<8|n[e+2]<<16|n[e+3]<<24)>>>0}function sb(n,e){return(n[e]<<24|n[e+1]<<16|n[e+2]<<8|n[e+3])>>>0}});var Fm=w((exports,module)=>{"use strict";module.exports=inquire;function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(n){}return null}});var cb=w(lb=>{"use strict";var Lm=lb;Lm.length=function(e){for(var t=0,r=0,i=0;i<e.length;++i)r=e.charCodeAt(i),r<128?t+=1:r<2048?t+=2:(r&64512)===55296&&(e.charCodeAt(i+1)&64512)===56320?(++i,t+=4):t+=3;return t};Lm.read=function(e,t,r){var i=r-t;if(i<1)return"";for(var s=null,o=[],a=0,l;t<r;)l=e[t++],l<128?o[a++]=l:l>191&&l<224?o[a++]=(l&31)<<6|e[t++]&63:l>239&&l<365?(l=((l&7)<<18|(e[t++]&63)<<12|(e[t++]&63)<<6|e[t++]&63)-65536,o[a++]=55296+(l>>10),o[a++]=56320+(l&1023)):o[a++]=(l&15)<<12|(e[t++]&63)<<6|e[t++]&63,a>8191&&((s||(s=[])).push(String.fromCharCode.apply(String,o)),a=0);return s?(a&&s.push(String.fromCharCode.apply(String,o.slice(0,a))),s.join("")):String.fromCharCode.apply(String,o.slice(0,a))};Lm.write=function(e,t,r){for(var i=r,s,o,a=0;a<e.length;++a)s=e.charCodeAt(a),s<128?t[r++]=s:s<2048?(t[r++]=s>>6|192,t[r++]=s&63|128):(s&64512)===55296&&((o=e.charCodeAt(a+1))&64512)===56320?(s=65536+((s&1023)<<10)+(o&1023),++a,t[r++]=s>>18|240,t[r++]=s>>12&63|128,t[r++]=s>>6&63|128,t[r++]=s&63|128):(t[r++]=s>>12|224,t[r++]=s>>6&63|128,t[r++]=s&63|128);return r-i}});var db=w((NK,ub)=>{"use strict";ub.exports=$F;function $F(n,e,t){var r=t||8192,i=r>>>1,s=null,o=r;return function(l){if(l<1||l>i)return n(l);o+l>r&&(s=n(r),o=0);var c=e.call(s,o,o+=l);return o&7&&(o=(o|7)+1),c}}});var fb=w((kK,hb)=>{"use strict";hb.exports=rt;var Tl=Kn();function rt(n,e){this.lo=n>>>0,this.hi=e>>>0}var ts=rt.zero=new rt(0,0);ts.toNumber=function(){return 0};ts.zzEncode=ts.zzDecode=function(){return this};ts.length=function(){return 1};var QF=rt.zeroHash="\0\0\0\0\0\0\0\0";rt.fromNumber=function(e){if(e===0)return ts;var t=e<0;t&&(e=-e);var r=e>>>0,i=(e-r)/4294967296>>>0;return t&&(i=~i>>>0,r=~r>>>0,++r>4294967295&&(r=0,++i>4294967295&&(i=0))),new rt(r,i)};rt.from=function(e){if(typeof e=="number")return rt.fromNumber(e);if(Tl.isString(e))if(Tl.Long)e=Tl.Long.fromString(e);else return rt.fromNumber(parseInt(e,10));return e.low||e.high?new rt(e.low>>>0,e.high>>>0):ts};rt.prototype.toNumber=function(e){if(!e&&this.hi>>>31){var t=~this.lo+1>>>0,r=~this.hi>>>0;return t||(r=r+1>>>0),-(t+r*4294967296)}return this.lo+this.hi*4294967296};rt.prototype.toLong=function(e){return Tl.Long?new Tl.Long(this.lo|0,this.hi|0,!!e):{low:this.lo|0,high:this.hi|0,unsigned:!!e}};var ti=String.prototype.charCodeAt;rt.fromHash=function(e){return e===QF?ts:new rt((ti.call(e,0)|ti.call(e,1)<<8|ti.call(e,2)<<16|ti.call(e,3)<<24)>>>0,(ti.call(e,4)|ti.call(e,5)<<8|ti.call(e,6)<<16|ti.call(e,7)<<24)>>>0)};rt.prototype.toHash=function(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};rt.prototype.zzEncode=function(){var e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this};rt.prototype.zzDecode=function(){var e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this};rt.prototype.length=function(){var e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,r=this.hi>>>24;return r===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:r<128?9:10}});var Kn=w(Bm=>{"use strict";var U=Bm;U.asPromise=Pm();U.base64=JC();U.EventEmitter=eb();U.float=ab();U.inquire=Fm();U.utf8=cb();U.pool=db();U.LongBits=fb();U.isNode=!!(typeof global<"u"&&global&&global.process&&global.process.versions&&global.process.versions.node);U.global=U.isNode&&global||typeof window<"u"&&window||typeof self<"u"&&self||Bm;U.emptyArray=Object.freeze?Object.freeze([]):[];U.emptyObject=Object.freeze?Object.freeze({}):{};U.isInteger=Number.isInteger||function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e};U.isString=function(e){return typeof e=="string"||e instanceof String};U.isObject=function(e){return e&&typeof e=="object"};U.isset=U.isSet=function(e,t){var r=e[t];return r!=null&&e.hasOwnProperty(t)?typeof r!="object"||(Array.isArray(r)?r.length:Object.keys(r).length)>0:!1};U.Buffer=function(){try{var n=U.inquire("buffer").Buffer;return n.prototype.utf8Write?n:null}catch{return null}}();U._Buffer_from=null;U._Buffer_allocUnsafe=null;U.newBuffer=function(e){return typeof e=="number"?U.Buffer?U._Buffer_allocUnsafe(e):new U.Array(e):U.Buffer?U._Buffer_from(e):typeof Uint8Array>"u"?e:new Uint8Array(e)};U.Array=typeof Uint8Array<"u"?Uint8Array:Array;U.Long=U.global.dcodeIO&&U.global.dcodeIO.Long||U.global.Long||U.inquire("long");U.key2Re=/^true|false|0|1$/;U.key32Re=/^-?(?:0|[1-9][0-9]*)$/;U.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;U.longToHash=function(e){return e?U.LongBits.from(e).toHash():U.LongBits.zeroHash};U.longFromHash=function(e,t){var r=U.LongBits.fromHash(e);return U.Long?U.Long.fromBits(r.lo,r.hi,t):r.toNumber(!!t)};function pb(n,e,t){for(var r=Object.keys(e),i=0;i<r.length;++i)(n[r[i]]===void 0||!t)&&(n[r[i]]=e[r[i]]);return n}U.merge=pb;U.lcFirst=function(e){return e.charAt(0).toLowerCase()+e.substring(1)};function gb(n){function e(t,r){if(!(this instanceof e))return new e(t,r);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:new Error().stack||""}),r&&pb(this,r)}return e.prototype=Object.create(Error.prototype,{constructor:{value:e,writable:!0,enumerable:!1,configurable:!0},name:{get:function(){return n},set:void 0,enumerable:!1,configurable:!0},toString:{value:function(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),e}U.newError=gb;U.ProtocolError=gb("ProtocolError");U.oneOfGetter=function(e){for(var t={},r=0;r<e.length;++r)t[e[r]]=1;return function(){for(var i=Object.keys(this),s=i.length-1;s>-1;--s)if(t[i[s]]===1&&this[i[s]]!==void 0&&this[i[s]]!==null)return i[s]}};U.oneOfSetter=function(e){return function(t){for(var r=0;r<e.length;++r)e[r]!==t&&delete this[e[r]]}};U.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};U._configure=function(){var n=U.Buffer;if(!n){U._Buffer_from=U._Buffer_allocUnsafe=null;return}U._Buffer_from=n.from!==Uint8Array.from&&n.from||function(t,r){return new n(t,r)},U._Buffer_allocUnsafe=n.allocUnsafe||function(t){return new n(t)}}});var bd=w((OK,_b)=>{"use strict";_b.exports=ae;var ln=Kn(),Vm,Cd=ln.LongBits,mb=ln.base64,yb=ln.utf8;function Cl(n,e,t){this.fn=n,this.len=e,this.next=void 0,this.val=t}function Um(){}function YF(n){this.head=n.head,this.tail=n.tail,this.len=n.len,this.next=n.states}function ae(){this.len=0,this.head=new Cl(Um,0,0),this.tail=this.head,this.states=null}var vb=function(){return ln.Buffer?function(){return(ae.create=function(){return new Vm})()}:function(){return new ae}};ae.create=vb();ae.alloc=function(e){return new ln.Array(e)};ln.Array!==Array&&(ae.alloc=ln.pool(ae.alloc,ln.Array.prototype.subarray));ae.prototype._push=function(e,t,r){return this.tail=this.tail.next=new Cl(e,t,r),this.len+=t,this};function zm(n,e,t){e[t]=n&255}function XF(n,e,t){for(;n>127;)e[t++]=n&127|128,n>>>=7;e[t]=n}function jm(n,e){this.len=n,this.next=void 0,this.val=e}jm.prototype=Object.create(Cl.prototype);jm.prototype.fn=XF;ae.prototype.uint32=function(e){return this.len+=(this.tail=this.tail.next=new jm((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this};ae.prototype.int32=function(e){return e<0?this._push(Gm,10,Cd.fromNumber(e)):this.uint32(e)};ae.prototype.sint32=function(e){return this.uint32((e<<1^e>>31)>>>0)};function Gm(n,e,t){for(;n.hi;)e[t++]=n.lo&127|128,n.lo=(n.lo>>>7|n.hi<<25)>>>0,n.hi>>>=7;for(;n.lo>127;)e[t++]=n.lo&127|128,n.lo=n.lo>>>7;e[t++]=n.lo}ae.prototype.uint64=function(e){var t=Cd.from(e);return this._push(Gm,t.length(),t)};ae.prototype.int64=ae.prototype.uint64;ae.prototype.sint64=function(e){var t=Cd.from(e).zzEncode();return this._push(Gm,t.length(),t)};ae.prototype.bool=function(e){return this._push(zm,1,e?1:0)};function qm(n,e,t){e[t]=n&255,e[t+1]=n>>>8&255,e[t+2]=n>>>16&255,e[t+3]=n>>>24}ae.prototype.fixed32=function(e){return this._push(qm,4,e>>>0)};ae.prototype.sfixed32=ae.prototype.fixed32;ae.prototype.fixed64=function(e){var t=Cd.from(e);return this._push(qm,4,t.lo)._push(qm,4,t.hi)};ae.prototype.sfixed64=ae.prototype.fixed64;ae.prototype.float=function(e){return this._push(ln.float.writeFloatLE,4,e)};ae.prototype.double=function(e){return this._push(ln.float.writeDoubleLE,8,e)};var JF=ln.Array.prototype.set?function(e,t,r){t.set(e,r)}:function(e,t,r){for(var i=0;i<e.length;++i)t[r+i]=e[i]};ae.prototype.bytes=function(e){var t=e.length>>>0;if(!t)return this._push(zm,1,0);if(ln.isString(e)){var r=ae.alloc(t=mb.length(e));mb.decode(e,r,0),e=r}return this.uint32(t)._push(JF,t,e)};ae.prototype.string=function(e){var t=yb.length(e);return t?this.uint32(t)._push(yb.write,t,e):this._push(zm,1,0)};ae.prototype.fork=function(){return this.states=new YF(this),this.head=this.tail=new Cl(Um,0,0),this.len=0,this};ae.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Cl(Um,0,0),this.len=0),this};ae.prototype.ldelim=function(){var e=this.head,t=this.tail,r=this.len;return this.reset().uint32(r),r&&(this.tail.next=e.next,this.tail=t,this.len+=r),this};ae.prototype.finish=function(){for(var e=this.head.next,t=this.constructor.alloc(this.len),r=0;e;)e.fn(e.val,t,r),r+=e.len,e=e.next;return t};ae._configure=function(n){Vm=n,ae.create=vb(),Vm._configure()}});var Eb=w((xK,wb)=>{"use strict";wb.exports=Wn;var Sb=bd();(Wn.prototype=Object.create(Sb.prototype)).constructor=Wn;var ni=Kn();function Wn(){Sb.call(this)}Wn._configure=function(){Wn.alloc=ni._Buffer_allocUnsafe,Wn.writeBytesBuffer=ni.Buffer&&ni.Buffer.prototype instanceof Uint8Array&&ni.Buffer.prototype.set.name==="set"?function(e,t,r){t.set(e,r)}:function(e,t,r){if(e.copy)e.copy(t,r,0,e.length);else for(var i=0;i<e.length;)t[r++]=e[i++]}};Wn.prototype.bytes=function(e){ni.isString(e)&&(e=ni._Buffer_from(e,"base64"));var t=e.length>>>0;return this.uint32(t),t&&this._push(Wn.writeBytesBuffer,t,e),this};function ZF(n,e,t){n.length<40?ni.utf8.write(n,e,t):e.utf8Write?e.utf8Write(n,t):e.write(n,t)}Wn.prototype.string=function(e){var t=ni.Buffer.byteLength(e);return this.uint32(t),t&&this._push(ZF,t,e),this};Wn._configure()});var Id=w((PK,Ib)=>{"use strict";Ib.exports=Ue;var Cn=Kn(),Km,bb=Cn.LongBits,eL=Cn.utf8;function bn(n,e){return RangeError("index out of range: "+n.pos+" + "+(e||1)+" > "+n.len)}function Ue(n){this.buf=n,this.pos=0,this.len=n.length}var Tb=typeof Uint8Array<"u"?function(e){if(e instanceof Uint8Array||Array.isArray(e))return new Ue(e);throw Error("illegal buffer")}:function(e){if(Array.isArray(e))return new Ue(e);throw Error("illegal buffer")},Ab=function(){return Cn.Buffer?function(t){return(Ue.create=function(i){return Cn.Buffer.isBuffer(i)?new Km(i):Tb(i)})(t)}:Tb};Ue.create=Ab();Ue.prototype._slice=Cn.Array.prototype.subarray||Cn.Array.prototype.slice;Ue.prototype.uint32=function(){var e=4294967295;return function(){if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,bn(this,10);return e}}();Ue.prototype.int32=function(){return this.uint32()|0};Ue.prototype.sint32=function(){var e=this.uint32();return e>>>1^-(e&1)|0};function Hm(){var n=new bb(0,0),e=0;if(this.len-this.pos>4){for(;e<4;++e)if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n;if(n.lo=(n.lo|(this.buf[this.pos]&127)<<28)>>>0,n.hi=(n.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return n;e=0}else{for(;e<3;++e){if(this.pos>=this.len)throw bn(this);if(n.lo=(n.lo|(this.buf[this.pos]&127)<<e*7)>>>0,this.buf[this.pos++]<128)return n}return n.lo=(n.lo|(this.buf[this.pos++]&127)<<e*7)>>>0,n}if(this.len-this.pos>4){for(;e<5;++e)if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}else for(;e<5;++e){if(this.pos>=this.len)throw bn(this);if(n.hi=(n.hi|(this.buf[this.pos]&127)<<e*7+3)>>>0,this.buf[this.pos++]<128)return n}throw Error("invalid varint encoding")}Ue.prototype.bool=function(){return this.uint32()!==0};function Ad(n,e){return(n[e-4]|n[e-3]<<8|n[e-2]<<16|n[e-1]<<24)>>>0}Ue.prototype.fixed32=function(){if(this.pos+4>this.len)throw bn(this,4);return Ad(this.buf,this.pos+=4)};Ue.prototype.sfixed32=function(){if(this.pos+4>this.len)throw bn(this,4);return Ad(this.buf,this.pos+=4)|0};function Cb(){if(this.pos+8>this.len)throw bn(this,8);return new bb(Ad(this.buf,this.pos+=4),Ad(this.buf,this.pos+=4))}Ue.prototype.float=function(){if(this.pos+4>this.len)throw bn(this,4);var e=Cn.float.readFloatLE(this.buf,this.pos);return this.pos+=4,e};Ue.prototype.double=function(){if(this.pos+8>this.len)throw bn(this,4);var e=Cn.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,e};Ue.prototype.bytes=function(){var e=this.uint32(),t=this.pos,r=this.pos+e;if(r>this.len)throw bn(this,e);if(this.pos+=e,Array.isArray(this.buf))return this.buf.slice(t,r);if(t===r){var i=Cn.Buffer;return i?i.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,t,r)};Ue.prototype.string=function(){var e=this.bytes();return eL.read(e,0,e.length)};Ue.prototype.skip=function(e){if(typeof e=="number"){if(this.pos+e>this.len)throw bn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw bn(this);while(this.buf[this.pos++]&128);return this};Ue.prototype.skipType=function(n){switch(n){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(n=this.uint32()&7)!==4;)this.skipType(n);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+n+" at offset "+this.pos)}return this};Ue._configure=function(n){Km=n,Ue.create=Ab(),Km._configure();var e=Cn.Long?"toLong":"toNumber";Cn.merge(Ue.prototype,{int64:function(){return Hm.call(this)[e](!1)},uint64:function(){return Hm.call(this)[e](!0)},sint64:function(){return Hm.call(this).zzDecode()[e](!1)},fixed64:function(){return Cb.call(this)[e](!0)},sfixed64:function(){return Cb.call(this)[e](!1)}})}});var kb=w((FK,Nb)=>{"use strict";Nb.exports=ns;var Rb=Id();(ns.prototype=Object.create(Rb.prototype)).constructor=ns;var Db=Kn();function ns(n){Rb.call(this,n)}ns._configure=function(){Db.Buffer&&(ns.prototype._slice=Db.Buffer.prototype.slice)};ns.prototype.string=function(){var e=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+e,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+e,this.len))};ns._configure()});var Ob=w((LK,Mb)=>{"use strict";Mb.exports=bl;var Wm=Kn();(bl.prototype=Object.create(Wm.EventEmitter.prototype)).constructor=bl;function bl(n,e,t){if(typeof n!="function")throw TypeError("rpcImpl must be a function");Wm.EventEmitter.call(this),this.rpcImpl=n,this.requestDelimited=!!e,this.responseDelimited=!!t}bl.prototype.rpcCall=function n(e,t,r,i,s){if(!i)throw TypeError("request must be specified");var o=this;if(!s)return Wm.asPromise(n,o,e,t,r,i);if(!o.rpcImpl){setTimeout(function(){s(Error("already ended"))},0);return}try{return o.rpcImpl(e,t[o.requestDelimited?"encodeDelimited":"encode"](i).finish(),function(l,c){if(l)return o.emit("error",l,e),s(l);if(c===null){o.end(!0);return}if(!(c instanceof r))try{c=r[o.responseDelimited?"decodeDelimited":"decode"](c)}catch(u){return o.emit("error",u,e),s(u)}return o.emit("data",c,e),s(null,c)})}catch(a){o.emit("error",a,e),setTimeout(function(){s(a)},0);return}};bl.prototype.end=function(e){return this.rpcImpl&&(e||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}});var $m=w(xb=>{"use strict";var tL=xb;tL.Service=Ob()});var Qm=w((VK,Pb)=>{"use strict";Pb.exports={}});var Bb=w(Lb=>{"use strict";var zt=Lb;zt.build="minimal";zt.Writer=bd();zt.BufferWriter=Eb();zt.Reader=Id();zt.BufferReader=kb();zt.util=Kn();zt.rpc=$m();zt.roots=Qm();zt.configure=Fb;function Fb(){zt.util._configure(),zt.Writer._configure(zt.BufferWriter),zt.Reader._configure(zt.BufferReader)}Fb()});var qb=w((UK,Vb)=>{"use strict";Vb.exports=Ym;function Ym(n,e){typeof n=="string"&&(e=n,n=void 0);var t=[];function r(s){if(typeof s!="string"){var o=i();if(Ym.verbose&&console.log("codegen: "+o),o="return "+o,s){for(var a=Object.keys(s),l=new Array(a.length+1),c=new Array(a.length),u=0;u<a.length;)l[u]=a[u],c[u]=s[a[u++]];return l[u]=o,Function.apply(null,l).apply(null,c)}return Function(o)()}for(var d=new Array(arguments.length-1),h=0;h<d.length;)d[h]=arguments[++h];if(h=0,s=s.replace(/%([%dfijs])/g,function(y,_){var S=d[h++];switch(_){case"d":case"f":return String(Number(S));case"i":return String(Math.floor(S));case"j":return JSON.stringify(S);case"s":return String(S)}return"%"}),h!==d.length)throw Error("parameter count mismatch");return t.push(s),r}function i(s){return"function "+(s||e||"")+"("+(n&&n.join(",")||"")+`){
  `+t.join(`
  `)+`
}`}return r.toString=i,r}Ym.verbose=!1});var zb=w((zK,Ub)=>{"use strict";Ub.exports=Al;var nL=Pm(),rL=Fm(),Xm=rL("fs");function Al(n,e,t){return typeof e=="function"?(t=e,e={}):e||(e={}),t?!e.xhr&&Xm&&Xm.readFile?Xm.readFile(n,function(i,s){return i&&typeof XMLHttpRequest<"u"?Al.xhr(n,e,t):i?t(i):t(null,e.binary?s:s.toString("utf8"))}):Al.xhr(n,e,t):nL(Al,this,n,e)}Al.xhr=function(e,t,r){var i=new XMLHttpRequest;i.onreadystatechange=function(){if(i.readyState===4){if(i.status!==0&&i.status!==200)return r(Error("status "+i.status));if(t.binary){var o=i.response;if(!o){o=[];for(var a=0;a<i.responseText.length;++a)o.push(i.responseText.charCodeAt(a)&255)}return r(null,typeof Uint8Array<"u"?new Uint8Array(o):o)}return r(null,i.responseText)}},t.binary&&("overrideMimeType"in i&&i.overrideMimeType("text/plain; charset=x-user-defined"),i.responseType="arraybuffer"),i.open("GET",e),i.send()}});var Hb=w(Gb=>{"use strict";var Zm=Gb,jb=Zm.isAbsolute=function(e){return/^(?:\/|\w+:)/.test(e)},Jm=Zm.normalize=function(e){e=e.replace(/\\/g,"/").replace(/\/{2,}/g,"/");var t=e.split("/"),r=jb(e),i="";r&&(i=t.shift()+"/");for(var s=0;s<t.length;)t[s]===".."?s>0&&t[s-1]!==".."?t.splice(--s,2):r?t.splice(s,1):++s:t[s]==="."?t.splice(s,1):++s;return i+t.join("/")};Zm.resolve=function(e,t,r){return r||(t=Jm(t)),jb(t)?t:(r||(e=Jm(e)),(e=e.replace(/(?:\/|^)[^/]+$/,"")).length?Jm(e+"/"+t):t)}});var rs=w(Kb=>{"use strict";var Il=Kb,iL=it(),sL=["double","float","int32","uint32","sint32","fixed32","sfixed32","int64","uint64","sint64","fixed64","sfixed64","bool","string","bytes"];function Dl(n,e){var t=0,r={};for(e|=0;t<n.length;)r[sL[t+e]]=n[t++];return r}Il.basic=Dl([1,5,0,0,0,5,5,0,0,0,1,1,0,2,2]);Il.defaults=Dl([0,0,0,0,0,0,0,0,0,0,0,0,!1,"",iL.emptyArray,null]);Il.long=Dl([0,0,0,1,1],7);Il.mapKey=Dl([0,0,0,5,5,0,0,0,1,1,0,2],2);Il.packed=Dl([1,5,0,0,0,5,5,0,0,0,1,1,0])});var ri=w((HK,Qb)=>{"use strict";Qb.exports=cn;var Dd=is();((cn.prototype=Object.create(Dd.prototype)).constructor=cn).className="Field";var Wb=An(),$b=rs(),$e=it(),ey,oL=/^required|optional|repeated$/;cn.fromJSON=function(e,t){return new cn(e,t.id,t.type,t.rule,t.extend,t.options,t.comment)};function cn(n,e,t,r,i,s,o){if($e.isObject(r)?(o=i,s=r,r=i=void 0):$e.isObject(i)&&(o=s,s=i,i=void 0),Dd.call(this,n,s),!$e.isInteger(e)||e<0)throw TypeError("id must be a non-negative integer");if(!$e.isString(t))throw TypeError("type must be a string");if(r!==void 0&&!oL.test(r=r.toString().toLowerCase()))throw TypeError("rule must be a string rule");if(i!==void 0&&!$e.isString(i))throw TypeError("extend must be a string");r==="proto3_optional"&&(r="optional"),this.rule=r&&r!=="optional"?r:void 0,this.type=t,this.id=e,this.extend=i||void 0,this.required=r==="required",this.optional=!this.required,this.repeated=r==="repeated",this.map=!1,this.message=null,this.partOf=null,this.typeDefault=null,this.defaultValue=null,this.long=$e.Long?$b.long[t]!==void 0:!1,this.bytes=t==="bytes",this.resolvedType=null,this.extensionField=null,this.declaringField=null,this._packed=null,this.comment=o}Object.defineProperty(cn.prototype,"packed",{get:function(){return this._packed===null&&(this._packed=this.getOption("packed")!==!1),this._packed}});cn.prototype.setOption=function(e,t,r){return e==="packed"&&(this._packed=null),Dd.prototype.setOption.call(this,e,t,r)};cn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return $e.toObject(["rule",this.rule!=="optional"&&this.rule||void 0,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};cn.prototype.resolve=function(){if(this.resolved)return this;if((this.typeDefault=$b.defaults[this.type])===void 0?(this.resolvedType=(this.declaringField?this.declaringField.parent:this.parent).lookupTypeOrEnum(this.type),this.resolvedType instanceof ey?this.typeDefault=null:this.typeDefault=this.resolvedType.values[Object.keys(this.resolvedType.values)[0]]):this.options&&this.options.proto3_optional&&(this.typeDefault=null),this.options&&this.options.default!=null&&(this.typeDefault=this.options.default,this.resolvedType instanceof Wb&&typeof this.typeDefault=="string"&&(this.typeDefault=this.resolvedType.values[this.typeDefault])),this.options&&((this.options.packed===!0||this.options.packed!==void 0&&this.resolvedType&&!(this.resolvedType instanceof Wb))&&delete this.options.packed,Object.keys(this.options).length||(this.options=void 0)),this.long)this.typeDefault=$e.Long.fromNumber(this.typeDefault,this.type.charAt(0)==="u"),Object.freeze&&Object.freeze(this.typeDefault);else if(this.bytes&&typeof this.typeDefault=="string"){var e;$e.base64.test(this.typeDefault)?$e.base64.decode(this.typeDefault,e=$e.newBuffer($e.base64.length(this.typeDefault)),0):$e.utf8.write(this.typeDefault,e=$e.newBuffer($e.utf8.length(this.typeDefault)),0),this.typeDefault=e}return this.map?this.defaultValue=$e.emptyObject:this.repeated?this.defaultValue=$e.emptyArray:this.defaultValue=this.typeDefault,this.parent instanceof ey&&(this.parent.ctor.prototype[this.name]=this.defaultValue),Dd.prototype.resolve.call(this)};cn.d=function(e,t,r,i){return typeof t=="function"?t=$e.decorateType(t).name:t&&typeof t=="object"&&(t=$e.decorateEnum(t).name),function(o,a){$e.decorateType(o.constructor).add(new cn(a,e,t,r,{default:i}))}};cn._configure=function(e){ey=e}});var wo=w((KK,Jb)=>{"use strict";Jb.exports=un;var Nd=is();((un.prototype=Object.create(Nd.prototype)).constructor=un).className="OneOf";var Yb=ri(),Rd=it();function un(n,e,t,r){if(Array.isArray(e)||(t=e,e=void 0),Nd.call(this,n,t),!(e===void 0||Array.isArray(e)))throw TypeError("fieldNames must be an Array");this.oneof=e||[],this.fieldsArray=[],this.comment=r}un.fromJSON=function(e,t){return new un(e,t.oneof,t.options,t.comment)};un.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Rd.toObject(["options",this.options,"oneof",this.oneof,"comment",t?this.comment:void 0])};function Xb(n){if(n.parent)for(var e=0;e<n.fieldsArray.length;++e)n.fieldsArray[e].parent||n.parent.add(n.fieldsArray[e])}un.prototype.add=function(e){if(!(e instanceof Yb))throw TypeError("field must be a Field");return e.parent&&e.parent!==this.parent&&e.parent.remove(e),this.oneof.push(e.name),this.fieldsArray.push(e),e.partOf=this,Xb(this),this};un.prototype.remove=function(e){if(!(e instanceof Yb))throw TypeError("field must be a Field");var t=this.fieldsArray.indexOf(e);if(t<0)throw Error(e+" is not a member of "+this);return this.fieldsArray.splice(t,1),t=this.oneof.indexOf(e.name),t>-1&&this.oneof.splice(t,1),e.partOf=null,this};un.prototype.onAdd=function(e){Nd.prototype.onAdd.call(this,e);for(var t=this,r=0;r<this.oneof.length;++r){var i=e.get(this.oneof[r]);i&&!i.partOf&&(i.partOf=t,t.fieldsArray.push(i))}Xb(this)};un.prototype.onRemove=function(e){for(var t=0,r;t<this.fieldsArray.length;++t)(r=this.fieldsArray[t]).parent&&r.parent.remove(r);Nd.prototype.onRemove.call(this,e)};un.d=function(){for(var e=new Array(arguments.length),t=0;t<arguments.length;)e[t]=arguments[t++];return function(i,s){Rd.decorateType(i.constructor).add(new un(s,e)),Object.defineProperty(i,s,{get:Rd.oneOfGetter(e),set:Rd.oneOfSetter(e)})}}});var Co=w((WK,nA)=>{"use strict";nA.exports=ce;var ty=is();((ce.prototype=Object.create(ty.prototype)).constructor=ce).className="Namespace";var Zb=ri(),kd=it(),aL=wo(),Eo,Rl,To;ce.fromJSON=function(e,t){return new ce(e,t.options).addJSON(t.nested)};function eA(n,e){if(n&&n.length){for(var t={},r=0;r<n.length;++r)t[n[r].name]=n[r].toJSON(e);return t}}ce.arrayToJSON=eA;ce.isReservedId=function(e,t){if(e){for(var r=0;r<e.length;++r)if(typeof e[r]!="string"&&e[r][0]<=t&&e[r][1]>t)return!0}return!1};ce.isReservedName=function(e,t){if(e){for(var r=0;r<e.length;++r)if(e[r]===t)return!0}return!1};function ce(n,e){ty.call(this,n,e),this.nested=void 0,this._nestedArray=null}function tA(n){return n._nestedArray=null,n}Object.defineProperty(ce.prototype,"nestedArray",{get:function(){return this._nestedArray||(this._nestedArray=kd.toArray(this.nested))}});ce.prototype.toJSON=function(e){return kd.toObject(["options",this.options,"nested",eA(this.nestedArray,e)])};ce.prototype.addJSON=function(e){var t=this;if(e)for(var r=Object.keys(e),i=0,s;i<r.length;++i)s=e[r[i]],t.add((s.fields!==void 0?Eo.fromJSON:s.values!==void 0?To.fromJSON:s.methods!==void 0?Rl.fromJSON:s.id!==void 0?Zb.fromJSON:ce.fromJSON)(r[i],s));return this};ce.prototype.get=function(e){return this.nested&&this.nested[e]||null};ce.prototype.getEnum=function(e){if(this.nested&&this.nested[e]instanceof To)return this.nested[e].values;throw Error("no such enum: "+e)};ce.prototype.add=function(e){if(!(e instanceof Zb&&e.extend!==void 0||e instanceof Eo||e instanceof aL||e instanceof To||e instanceof Rl||e instanceof ce))throw TypeError("object must be a valid nested object");if(!this.nested)this.nested={};else{var t=this.get(e.name);if(t)if(t instanceof ce&&e instanceof ce&&!(t instanceof Eo||t instanceof Rl)){for(var r=t.nestedArray,i=0;i<r.length;++i)e.add(r[i]);this.remove(t),this.nested||(this.nested={}),e.setOptions(t.options,!0)}else throw Error("duplicate name '"+e.name+"' in "+this)}return this.nested[e.name]=e,e.onAdd(this),tA(this)};ce.prototype.remove=function(e){if(!(e instanceof ty))throw TypeError("object must be a ReflectionObject");if(e.parent!==this)throw Error(e+" is not a member of "+this);return delete this.nested[e.name],Object.keys(this.nested).length||(this.nested=void 0),e.onRemove(this),tA(this)};ce.prototype.define=function(e,t){if(kd.isString(e))e=e.split(".");else if(!Array.isArray(e))throw TypeError("illegal path");if(e&&e.length&&e[0]==="")throw Error("path must be relative");for(var r=this;e.length>0;){var i=e.shift();if(r.nested&&r.nested[i]){if(r=r.nested[i],!(r instanceof ce))throw Error("path conflicts with non-namespace objects")}else r.add(r=new ce(i))}return t&&r.addJSON(t),r};ce.prototype.resolveAll=function(){for(var e=this.nestedArray,t=0;t<e.length;)e[t]instanceof ce?e[t++].resolveAll():e[t++].resolve();return this.resolve()};ce.prototype.lookup=function(e,t,r){if(typeof t=="boolean"?(r=t,t=void 0):t&&!Array.isArray(t)&&(t=[t]),kd.isString(e)&&e.length){if(e===".")return this.root;e=e.split(".")}else if(!e.length)return this;if(e[0]==="")return this.root.lookup(e.slice(1),t);var i=this.get(e[0]);if(i){if(e.length===1){if(!t||t.indexOf(i.constructor)>-1)return i}else if(i instanceof ce&&(i=i.lookup(e.slice(1),t,!0)))return i}else for(var s=0;s<this.nestedArray.length;++s)if(this._nestedArray[s]instanceof ce&&(i=this._nestedArray[s].lookup(e,t,!0)))return i;return this.parent===null||r?null:this.parent.lookup(e,t)};ce.prototype.lookupType=function(e){var t=this.lookup(e,[Eo]);if(!t)throw Error("no such type: "+e);return t};ce.prototype.lookupEnum=function(e){var t=this.lookup(e,[To]);if(!t)throw Error("no such Enum '"+e+"' in "+this);return t};ce.prototype.lookupTypeOrEnum=function(e){var t=this.lookup(e,[Eo,To]);if(!t)throw Error("no such Type or Enum '"+e+"' in "+this);return t};ce.prototype.lookupService=function(e){var t=this.lookup(e,[Rl]);if(!t)throw Error("no such Service '"+e+"' in "+this);return t};ce._configure=function(n,e,t){Eo=n,Rl=e,To=t}});var Md=w(($K,rA)=>{"use strict";rA.exports=Sr;var ny=ri();((Sr.prototype=Object.create(ny.prototype)).constructor=Sr).className="MapField";var lL=rs(),Nl=it();function Sr(n,e,t,r,i,s){if(ny.call(this,n,e,r,void 0,void 0,i,s),!Nl.isString(t))throw TypeError("keyType must be a string");this.keyType=t,this.resolvedKeyType=null,this.map=!0}Sr.fromJSON=function(e,t){return new Sr(e,t.id,t.keyType,t.type,t.options,t.comment)};Sr.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Nl.toObject(["keyType",this.keyType,"type",this.type,"id",this.id,"extend",this.extend,"options",this.options,"comment",t?this.comment:void 0])};Sr.prototype.resolve=function(){if(this.resolved)return this;if(lL.mapKey[this.keyType]===void 0)throw Error("invalid key type: "+this.keyType);return ny.prototype.resolve.call(this)};Sr.d=function(e,t,r){return typeof r=="function"?r=Nl.decorateType(r).name:r&&typeof r=="object"&&(r=Nl.decorateEnum(r).name),function(s,o){Nl.decorateType(s.constructor).add(new Sr(o,e,t,r))}}});var Od=w((QK,iA)=>{"use strict";iA.exports=ss;var ry=is();((ss.prototype=Object.create(ry.prototype)).constructor=ss).className="Method";var bo=it();function ss(n,e,t,r,i,s,o,a,l){if(bo.isObject(i)?(o=i,i=s=void 0):bo.isObject(s)&&(o=s,s=void 0),!(e===void 0||bo.isString(e)))throw TypeError("type must be a string");if(!bo.isString(t))throw TypeError("requestType must be a string");if(!bo.isString(r))throw TypeError("responseType must be a string");ry.call(this,n,o),this.type=e||"rpc",this.requestType=t,this.requestStream=i?!0:void 0,this.responseType=r,this.responseStream=s?!0:void 0,this.resolvedRequestType=null,this.resolvedResponseType=null,this.comment=a,this.parsedOptions=l}ss.fromJSON=function(e,t){return new ss(e,t.type,t.requestType,t.responseType,t.requestStream,t.responseStream,t.options,t.comment,t.parsedOptions)};ss.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return bo.toObject(["type",this.type!=="rpc"&&this.type||void 0,"requestType",this.requestType,"requestStream",this.requestStream,"responseType",this.responseType,"responseStream",this.responseStream,"options",this.options,"comment",t?this.comment:void 0,"parsedOptions",this.parsedOptions])};ss.prototype.resolve=function(){return this.resolved?this:(this.resolvedRequestType=this.parent.lookupType(this.requestType),this.resolvedResponseType=this.parent.lookupType(this.responseType),ry.prototype.resolve.call(this))}});var xd=w((YK,oA)=>{"use strict";oA.exports=dn;var ii=Co();((dn.prototype=Object.create(ii.prototype)).constructor=dn).className="Service";var iy=Od(),kl=it(),cL=$m();function dn(n,e){ii.call(this,n,e),this.methods={},this._methodsArray=null}dn.fromJSON=function(e,t){var r=new dn(e,t.options);if(t.methods)for(var i=Object.keys(t.methods),s=0;s<i.length;++s)r.add(iy.fromJSON(i[s],t.methods[i[s]]));return t.nested&&r.addJSON(t.nested),r.comment=t.comment,r};dn.prototype.toJSON=function(e){var t=ii.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return kl.toObject(["options",t&&t.options||void 0,"methods",ii.arrayToJSON(this.methodsArray,e)||{},"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};Object.defineProperty(dn.prototype,"methodsArray",{get:function(){return this._methodsArray||(this._methodsArray=kl.toArray(this.methods))}});function sA(n){return n._methodsArray=null,n}dn.prototype.get=function(e){return this.methods[e]||ii.prototype.get.call(this,e)};dn.prototype.resolveAll=function(){for(var e=this.methodsArray,t=0;t<e.length;++t)e[t].resolve();return ii.prototype.resolve.call(this)};dn.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);return e instanceof iy?(this.methods[e.name]=e,e.parent=this,sA(this)):ii.prototype.add.call(this,e)};dn.prototype.remove=function(e){if(e instanceof iy){if(this.methods[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.methods[e.name],e.parent=null,sA(this)}return ii.prototype.remove.call(this,e)};dn.prototype.create=function(e,t,r){for(var i=new cL.Service(e,t,r),s=0,o;s<this.methodsArray.length;++s){var a=kl.lcFirst((o=this._methodsArray[s]).resolve().name).replace(/[^$\w_]/g,"");i[a]=kl.codegen(["r","c"],kl.isReserved(a)?a+"_":a)("return this.rpcCall(m,q,s,r,c)")({m:o,q:o.resolvedRequestType.ctor,s:o.resolvedResponseType.ctor})}return i}});var Pd=w((XK,aA)=>{"use strict";aA.exports=$n;var uL=Kn();function $n(n){if(n)for(var e=Object.keys(n),t=0;t<e.length;++t)this[e[t]]=n[e[t]]}$n.create=function(e){return this.$type.create(e)};$n.encode=function(e,t){return this.$type.encode(e,t)};$n.encodeDelimited=function(e,t){return this.$type.encodeDelimited(e,t)};$n.decode=function(e){return this.$type.decode(e)};$n.decodeDelimited=function(e){return this.$type.decodeDelimited(e)};$n.verify=function(e){return this.$type.verify(e)};$n.fromObject=function(e){return this.$type.fromObject(e)};$n.toObject=function(e,t){return this.$type.toObject(e,t)};$n.prototype.toJSON=function(){return this.$type.toObject(this,uL.toJSONOptions)}});var sy=w((JK,cA)=>{"use strict";cA.exports=fL;var dL=An(),wr=rs(),lA=it();function hL(n){return"missing required '"+n.name+"'"}function fL(n){var e=lA.codegen(["r","l"],n.name+"$decode")("if(!(r instanceof Reader))")("r=Reader.create(r)")("var c=l===undefined?r.len:r.pos+l,m=new this.ctor"+(n.fieldsArray.filter(function(a){return a.map}).length?",k,value":""))("while(r.pos<c){")("var t=r.uint32()");n.group&&e("if((t&7)===4)")("break"),e("switch(t>>>3){");for(var t=0;t<n.fieldsArray.length;++t){var r=n._fieldsArray[t].resolve(),i=r.resolvedType instanceof dL?"int32":r.type,s="m"+lA.safeProp(r.name);e("case %i: {",r.id),r.map?(e("if(%s===util.emptyObject)",s)("%s={}",s)("var c2 = r.uint32()+r.pos"),wr.defaults[r.keyType]!==void 0?e("k=%j",wr.defaults[r.keyType]):e("k=null"),wr.defaults[i]!==void 0?e("value=%j",wr.defaults[i]):e("value=null"),e("while(r.pos<c2){")("var tag2=r.uint32()")("switch(tag2>>>3){")("case 1: k=r.%s(); break",r.keyType)("case 2:"),wr.basic[i]===void 0?e("value=types[%i].decode(r,r.uint32())",t):e("value=r.%s()",i),e("break")("default:")("r.skipType(tag2&7)")("break")("}")("}"),wr.long[r.keyType]!==void 0?e('%s[typeof k==="object"?util.longToHash(k):k]=value',s):e("%s[k]=value",s)):r.repeated?(e("if(!(%s&&%s.length))",s,s)("%s=[]",s),wr.packed[i]!==void 0&&e("if((t&7)===2){")("var c2=r.uint32()+r.pos")("while(r.pos<c2)")("%s.push(r.%s())",s,i)("}else"),wr.basic[i]===void 0?e(r.resolvedType.group?"%s.push(types[%i].decode(r))":"%s.push(types[%i].decode(r,r.uint32()))",s,t):e("%s.push(r.%s())",s,i)):wr.basic[i]===void 0?e(r.resolvedType.group?"%s=types[%i].decode(r)":"%s=types[%i].decode(r,r.uint32())",s,t):e("%s=r.%s()",s,i),e("break")("}")}for(e("default:")("r.skipType(t&7)")("break")("}")("}"),t=0;t<n._fieldsArray.length;++t){var o=n._fieldsArray[t];o.required&&e("if(!m.hasOwnProperty(%j))",o.name)("throw util.ProtocolError(%j,{instance:m})",hL(o))}return e("return m")}});var ly=w((ZK,uA)=>{"use strict";uA.exports=mL;var pL=An(),oy=it();function hn(n,e){return n.name+": "+e+(n.repeated&&e!=="array"?"[]":n.map&&e!=="object"?"{k:"+n.keyType+"}":"")+" expected"}function ay(n,e,t,r){if(e.resolvedType)if(e.resolvedType instanceof pL){n("switch(%s){",r)("default:")("return%j",hn(e,"enum value"));for(var i=Object.keys(e.resolvedType.values),s=0;s<i.length;++s)n("case %i:",e.resolvedType.values[i[s]]);n("break")("}")}else n("{")("var e=types[%i].verify(%s);",t,r)("if(e)")("return%j+e",e.name+".")("}");else switch(e.type){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.isInteger(%s))",r)("return%j",hn(e,"integer"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.isInteger(%s)&&!(%s&&util.isInteger(%s.low)&&util.isInteger(%s.high)))",r,r,r,r)("return%j",hn(e,"integer|Long"));break;case"float":case"double":n('if(typeof %s!=="number")',r)("return%j",hn(e,"number"));break;case"bool":n('if(typeof %s!=="boolean")',r)("return%j",hn(e,"boolean"));break;case"string":n("if(!util.isString(%s))",r)("return%j",hn(e,"string"));break;case"bytes":n('if(!(%s&&typeof %s.length==="number"||util.isString(%s)))',r,r,r)("return%j",hn(e,"buffer"));break}return n}function gL(n,e,t){switch(e.keyType){case"int32":case"uint32":case"sint32":case"fixed32":case"sfixed32":n("if(!util.key32Re.test(%s))",t)("return%j",hn(e,"integer key"));break;case"int64":case"uint64":case"sint64":case"fixed64":case"sfixed64":n("if(!util.key64Re.test(%s))",t)("return%j",hn(e,"integer|Long key"));break;case"bool":n("if(!util.key2Re.test(%s))",t)("return%j",hn(e,"boolean key"));break}return n}function mL(n){var e=oy.codegen(["m"],n.name+"$verify")('if(typeof m!=="object"||m===null)')("return%j","object expected"),t=n.oneofsArray,r={};t.length&&e("var p={}");for(var i=0;i<n.fieldsArray.length;++i){var s=n._fieldsArray[i].resolve(),o="m"+oy.safeProp(s.name);if(s.optional&&e("if(%s!=null&&m.hasOwnProperty(%j)){",o,s.name),s.map)e("if(!util.isObject(%s))",o)("return%j",hn(s,"object"))("var k=Object.keys(%s)",o)("for(var i=0;i<k.length;++i){"),gL(e,s,"k[i]"),ay(e,s,i,o+"[k[i]]")("}");else if(s.repeated)e("if(!Array.isArray(%s))",o)("return%j",hn(s,"array"))("for(var i=0;i<%s.length;++i){",o),ay(e,s,i,o+"[i]")("}");else{if(s.partOf){var a=oy.safeProp(s.partOf.name);r[s.partOf.name]===1&&e("if(p%s===1)",a)("return%j",s.partOf.name+": multiple values"),r[s.partOf.name]=1,e("p%s=1",a)}ay(e,s,i,o)}s.optional&&e("}")}return e("return null")}});var dy=w(hA=>{"use strict";var dA=hA,Ml=An(),Qn=it();function cy(n,e,t,r){var i=!1;if(e.resolvedType)if(e.resolvedType instanceof Ml){n("switch(d%s){",r);for(var s=e.resolvedType.values,o=Object.keys(s),a=0;a<o.length;++a)s[o[a]]===e.typeDefault&&!i&&(n("default:")('if(typeof(d%s)==="number"){m%s=d%s;break}',r,r,r),e.repeated||n("break"),i=!0),n("case%j:",o[a])("case %i:",s[o[a]])("m%s=%j",r,s[o[a]])("break");n("}")}else n('if(typeof d%s!=="object")',r)("throw TypeError(%j)",e.fullName+": object expected")("m%s=types[%i].fromObject(d%s)",r,t,r);else{var l=!1;switch(e.type){case"double":case"float":n("m%s=Number(d%s)",r,r);break;case"uint32":case"fixed32":n("m%s=d%s>>>0",r,r);break;case"int32":case"sint32":case"sfixed32":n("m%s=d%s|0",r,r);break;case"uint64":l=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n("if(util.Long)")("(m%s=util.Long.fromValue(d%s)).unsigned=%j",r,r,l)('else if(typeof d%s==="string")',r)("m%s=parseInt(d%s,10)",r,r)('else if(typeof d%s==="number")',r)("m%s=d%s",r,r)('else if(typeof d%s==="object")',r)("m%s=new util.LongBits(d%s.low>>>0,d%s.high>>>0).toNumber(%s)",r,r,r,l?"true":"");break;case"bytes":n('if(typeof d%s==="string")',r)("util.base64.decode(d%s,m%s=util.newBuffer(util.base64.length(d%s)),0)",r,r,r)("else if(d%s.length >= 0)",r)("m%s=d%s",r,r);break;case"string":n("m%s=String(d%s)",r,r);break;case"bool":n("m%s=Boolean(d%s)",r,r);break}}return n}dA.fromObject=function(e){var t=e.fieldsArray,r=Qn.codegen(["d"],e.name+"$fromObject")("if(d instanceof this.ctor)")("return d");if(!t.length)return r("return new this.ctor");r("var m=new this.ctor");for(var i=0;i<t.length;++i){var s=t[i].resolve(),o=Qn.safeProp(s.name);s.map?(r("if(d%s){",o)('if(typeof d%s!=="object")',o)("throw TypeError(%j)",s.fullName+": object expected")("m%s={}",o)("for(var ks=Object.keys(d%s),i=0;i<ks.length;++i){",o),cy(r,s,i,o+"[ks[i]]")("}")("}")):s.repeated?(r("if(d%s){",o)("if(!Array.isArray(d%s))",o)("throw TypeError(%j)",s.fullName+": array expected")("m%s=[]",o)("for(var i=0;i<d%s.length;++i){",o),cy(r,s,i,o+"[i]")("}")("}")):(s.resolvedType instanceof Ml||r("if(d%s!=null){",o),cy(r,s,i,o),s.resolvedType instanceof Ml||r("}"))}return r("return m")};function uy(n,e,t,r){if(e.resolvedType)e.resolvedType instanceof Ml?n("d%s=o.enums===String?(types[%i].values[m%s]===undefined?m%s:types[%i].values[m%s]):m%s",r,t,r,r,t,r,r):n("d%s=types[%i].toObject(m%s,o)",r,t,r);else{var i=!1;switch(e.type){case"double":case"float":n("d%s=o.json&&!isFinite(m%s)?String(m%s):m%s",r,r,r,r);break;case"uint64":i=!0;case"int64":case"sint64":case"fixed64":case"sfixed64":n('if(typeof m%s==="number")',r)("d%s=o.longs===String?String(m%s):m%s",r,r,r)("else")("d%s=o.longs===String?util.Long.prototype.toString.call(m%s):o.longs===Number?new util.LongBits(m%s.low>>>0,m%s.high>>>0).toNumber(%s):m%s",r,r,r,r,i?"true":"",r);break;case"bytes":n("d%s=o.bytes===String?util.base64.encode(m%s,0,m%s.length):o.bytes===Array?Array.prototype.slice.call(m%s):m%s",r,r,r,r,r);break;default:n("d%s=m%s",r,r);break}}return n}dA.toObject=function(e){var t=e.fieldsArray.slice().sort(Qn.compareFieldsById);if(!t.length)return Qn.codegen()("return {}");for(var r=Qn.codegen(["m","o"],e.name+"$toObject")("if(!o)")("o={}")("var d={}"),i=[],s=[],o=[],a=0;a<t.length;++a)t[a].partOf||(t[a].resolve().repeated?i:t[a].map?s:o).push(t[a]);if(i.length){for(r("if(o.arrays||o.defaults){"),a=0;a<i.length;++a)r("d%s=[]",Qn.safeProp(i[a].name));r("}")}if(s.length){for(r("if(o.objects||o.defaults){"),a=0;a<s.length;++a)r("d%s={}",Qn.safeProp(s[a].name));r("}")}if(o.length){for(r("if(o.defaults){"),a=0;a<o.length;++a){var l=o[a],c=Qn.safeProp(l.name);if(l.resolvedType instanceof Ml)r("d%s=o.enums===String?%j:%j",c,l.resolvedType.valuesById[l.typeDefault],l.typeDefault);else if(l.long)r("if(util.Long){")("var n=new util.Long(%i,%i,%j)",l.typeDefault.low,l.typeDefault.high,l.typeDefault.unsigned)("d%s=o.longs===String?n.toString():o.longs===Number?n.toNumber():n",c)("}else")("d%s=o.longs===String?%j:%i",c,l.typeDefault.toString(),l.typeDefault.toNumber());else if(l.bytes){var u="["+Array.prototype.slice.call(l.typeDefault).join(",")+"]";r("if(o.bytes===String)d%s=%j",c,String.fromCharCode.apply(String,l.typeDefault))("else{")("d%s=%s",c,u)("if(o.bytes!==Array)d%s=util.newBuffer(d%s)",c,c)("}")}else r("d%s=%j",c,l.typeDefault)}r("}")}var d=!1;for(a=0;a<t.length;++a){var l=t[a],h=e._fieldsArray.indexOf(l),c=Qn.safeProp(l.name);l.map?(d||(d=!0,r("var ks2")),r("if(m%s&&(ks2=Object.keys(m%s)).length){",c,c)("d%s={}",c)("for(var j=0;j<ks2.length;++j){"),uy(r,l,h,c+"[ks2[j]]")("}")):l.repeated?(r("if(m%s&&m%s.length){",c,c)("d%s=[]",c)("for(var j=0;j<m%s.length;++j){",c),uy(r,l,h,c+"[j]")("}")):(r("if(m%s!=null&&m.hasOwnProperty(%j)){",c,l.name),uy(r,l,h,c),l.partOf&&r("if(o.oneofs)")("d%s=%j",Qn.safeProp(l.partOf.name),l.name)),r("}")}return r("return d")}});var hy=w(fA=>{"use strict";var yL=fA,vL=Pd();yL[".google.protobuf.Any"]={fromObject:function(n){if(n&&n["@type"]){var e=n["@type"].substring(n["@type"].lastIndexOf("/")+1),t=this.lookup(e);if(t){var r=n["@type"].charAt(0)==="."?n["@type"].slice(1):n["@type"];return r.indexOf("/")===-1&&(r="/"+r),this.create({type_url:r,value:t.encode(t.fromObject(n)).finish()})}}return this.fromObject(n)},toObject:function(n,e){var t="type.googleapis.com/",r="",i="";if(e&&e.json&&n.type_url&&n.value){i=n.type_url.substring(n.type_url.lastIndexOf("/")+1),r=n.type_url.substring(0,n.type_url.lastIndexOf("/")+1);var s=this.lookup(i);s&&(n=s.decode(n.value))}if(!(n instanceof this.ctor)&&n instanceof vL){var o=n.$type.toObject(n,e),a=n.$type.fullName[0]==="."?n.$type.fullName.slice(1):n.$type.fullName;return r===""&&(r=t),i=r+a,o["@type"]=i,o}return this.toObject(n,e)}}});var Bd=w((nW,gA)=>{"use strict";gA.exports=_e;var In=Co();((_e.prototype=Object.create(In.prototype)).constructor=_e).className="Type";var _L=An(),gy=wo(),Fd=ri(),SL=Md(),wL=xd(),fy=Pd(),py=Id(),EL=bd(),Et=it(),TL=my(),CL=sy(),bL=ly(),pA=dy(),AL=hy();function _e(n,e){In.call(this,n,e),this.fields={},this.oneofs=void 0,this.extensions=void 0,this.reserved=void 0,this.group=void 0,this._fieldsById=null,this._fieldsArray=null,this._oneofsArray=null,this._ctor=null}Object.defineProperties(_e.prototype,{fieldsById:{get:function(){if(this._fieldsById)return this._fieldsById;this._fieldsById={};for(var n=Object.keys(this.fields),e=0;e<n.length;++e){var t=this.fields[n[e]],r=t.id;if(this._fieldsById[r])throw Error("duplicate id "+r+" in "+this);this._fieldsById[r]=t}return this._fieldsById}},fieldsArray:{get:function(){return this._fieldsArray||(this._fieldsArray=Et.toArray(this.fields))}},oneofsArray:{get:function(){return this._oneofsArray||(this._oneofsArray=Et.toArray(this.oneofs))}},ctor:{get:function(){return this._ctor||(this.ctor=_e.generateConstructor(this)())},set:function(n){var e=n.prototype;e instanceof fy||((n.prototype=new fy).constructor=n,Et.merge(n.prototype,e)),n.$type=n.prototype.$type=this,Et.merge(n,fy,!0),this._ctor=n;for(var t=0;t<this.fieldsArray.length;++t)this._fieldsArray[t].resolve();var r={};for(t=0;t<this.oneofsArray.length;++t)r[this._oneofsArray[t].resolve().name]={get:Et.oneOfGetter(this._oneofsArray[t].oneof),set:Et.oneOfSetter(this._oneofsArray[t].oneof)};t&&Object.defineProperties(n.prototype,r)}}});_e.generateConstructor=function(e){for(var t=Et.codegen(["p"],e.name),r=0,i;r<e.fieldsArray.length;++r)(i=e._fieldsArray[r]).map?t("this%s={}",Et.safeProp(i.name)):i.repeated&&t("this%s=[]",Et.safeProp(i.name));return t("if(p)for(var ks=Object.keys(p),i=0;i<ks.length;++i)if(p[ks[i]]!=null)")("this[ks[i]]=p[ks[i]]")};function Ld(n){return n._fieldsById=n._fieldsArray=n._oneofsArray=null,delete n.encode,delete n.decode,delete n.verify,n}_e.fromJSON=function(e,t){var r=new _e(e,t.options);r.extensions=t.extensions,r.reserved=t.reserved;for(var i=Object.keys(t.fields),s=0;s<i.length;++s)r.add((typeof t.fields[i[s]].keyType<"u"?SL.fromJSON:Fd.fromJSON)(i[s],t.fields[i[s]]));if(t.oneofs)for(i=Object.keys(t.oneofs),s=0;s<i.length;++s)r.add(gy.fromJSON(i[s],t.oneofs[i[s]]));if(t.nested)for(i=Object.keys(t.nested),s=0;s<i.length;++s){var o=t.nested[i[s]];r.add((o.id!==void 0?Fd.fromJSON:o.fields!==void 0?_e.fromJSON:o.values!==void 0?_L.fromJSON:o.methods!==void 0?wL.fromJSON:In.fromJSON)(i[s],o))}return t.extensions&&t.extensions.length&&(r.extensions=t.extensions),t.reserved&&t.reserved.length&&(r.reserved=t.reserved),t.group&&(r.group=!0),t.comment&&(r.comment=t.comment),r};_e.prototype.toJSON=function(e){var t=In.prototype.toJSON.call(this,e),r=e?!!e.keepComments:!1;return Et.toObject(["options",t&&t.options||void 0,"oneofs",In.arrayToJSON(this.oneofsArray,e),"fields",In.arrayToJSON(this.fieldsArray.filter(function(i){return!i.declaringField}),e)||{},"extensions",this.extensions&&this.extensions.length?this.extensions:void 0,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"group",this.group||void 0,"nested",t&&t.nested||void 0,"comment",r?this.comment:void 0])};_e.prototype.resolveAll=function(){for(var e=this.fieldsArray,t=0;t<e.length;)e[t++].resolve();var r=this.oneofsArray;for(t=0;t<r.length;)r[t++].resolve();return In.prototype.resolveAll.call(this)};_e.prototype.get=function(e){return this.fields[e]||this.oneofs&&this.oneofs[e]||this.nested&&this.nested[e]||null};_e.prototype.add=function(e){if(this.get(e.name))throw Error("duplicate name '"+e.name+"' in "+this);if(e instanceof Fd&&e.extend===void 0){if(this._fieldsById?this._fieldsById[e.id]:this.fieldsById[e.id])throw Error("duplicate id "+e.id+" in "+this);if(this.isReservedId(e.id))throw Error("id "+e.id+" is reserved in "+this);if(this.isReservedName(e.name))throw Error("name '"+e.name+"' is reserved in "+this);return e.parent&&e.parent.remove(e),this.fields[e.name]=e,e.message=this,e.onAdd(this),Ld(this)}return e instanceof gy?(this.oneofs||(this.oneofs={}),this.oneofs[e.name]=e,e.onAdd(this),Ld(this)):In.prototype.add.call(this,e)};_e.prototype.remove=function(e){if(e instanceof Fd&&e.extend===void 0){if(!this.fields||this.fields[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.fields[e.name],e.parent=null,e.onRemove(this),Ld(this)}if(e instanceof gy){if(!this.oneofs||this.oneofs[e.name]!==e)throw Error(e+" is not a member of "+this);return delete this.oneofs[e.name],e.parent=null,e.onRemove(this),Ld(this)}return In.prototype.remove.call(this,e)};_e.prototype.isReservedId=function(e){return In.isReservedId(this.reserved,e)};_e.prototype.isReservedName=function(e){return In.isReservedName(this.reserved,e)};_e.prototype.create=function(e){return new this.ctor(e)};_e.prototype.setup=function(){for(var e=this.fullName,t=[],r=0;r<this.fieldsArray.length;++r)t.push(this._fieldsArray[r].resolve().resolvedType);this.encode=TL(this)({Writer:EL,types:t,util:Et}),this.decode=CL(this)({Reader:py,types:t,util:Et}),this.verify=bL(this)({types:t,util:Et}),this.fromObject=pA.fromObject(this)({types:t,util:Et}),this.toObject=pA.toObject(this)({types:t,util:Et});var i=AL[e];if(i){var s=Object.create(this);s.fromObject=this.fromObject,this.fromObject=i.fromObject.bind(s),s.toObject=this.toObject,this.toObject=i.toObject.bind(s)}return this};_e.prototype.encode=function(e,t){return this.setup().encode(e,t)};_e.prototype.encodeDelimited=function(e,t){return this.encode(e,t&&t.len?t.fork():t).ldelim()};_e.prototype.decode=function(e,t){return this.setup().decode(e,t)};_e.prototype.decodeDelimited=function(e){return e instanceof py||(e=py.create(e)),this.decode(e,e.uint32())};_e.prototype.verify=function(e){return this.setup().verify(e)};_e.prototype.fromObject=function(e){return this.setup().fromObject(e)};_e.prototype.toObject=function(e,t){return this.setup().toObject(e,t)};_e.d=function(e){return function(r){Et.decorateType(r,e)}}});var Ud=w((rW,SA)=>{"use strict";SA.exports=$t;var qd=Co();(($t.prototype=Object.create(qd.prototype)).constructor=$t).className="Root";var vy=ri(),yA=An(),IL=wo(),si=it(),vA,yy,Ol;function $t(n){qd.call(this,"",n),this.deferred=[],this.files=[]}$t.fromJSON=function(e,t){return t||(t=new $t),e.options&&t.setOptions(e.options),t.addJSON(e.nested)};$t.prototype.resolvePath=si.path.resolve;$t.prototype.fetch=si.fetch;function _A(){}$t.prototype.load=function n(e,t,r){typeof t=="function"&&(r=t,t=void 0);var i=this;if(!r)return si.asPromise(n,i,e,t);var s=r===_A;function o(p,y){if(r){var _=r;if(r=null,s)throw p;_(p,y)}}function a(p){var y=p.lastIndexOf("google/protobuf/");if(y>-1){var _=p.substring(y);if(_ in Ol)return _}return null}function l(p,y){try{if(si.isString(y)&&y.charAt(0)==="{"&&(y=JSON.parse(y)),!si.isString(y))i.setOptions(y.options).addJSON(y.nested);else{yy.filename=p;var _=yy(y,i,t),S,R=0;if(_.imports)for(;R<_.imports.length;++R)(S=a(_.imports[R])||i.resolvePath(p,_.imports[R]))&&c(S);if(_.weakImports)for(R=0;R<_.weakImports.length;++R)(S=a(_.weakImports[R])||i.resolvePath(p,_.weakImports[R]))&&c(S,!0)}}catch(E){o(E)}!s&&!u&&o(null,i)}function c(p,y){if(p=a(p)||p,!(i.files.indexOf(p)>-1)){if(i.files.push(p),p in Ol){s?l(p,Ol[p]):(++u,setTimeout(function(){--u,l(p,Ol[p])}));return}if(s){var _;try{_=si.fs.readFileSync(p).toString("utf8")}catch(S){y||o(S);return}l(p,_)}else++u,i.fetch(p,function(S,R){if(--u,!!r){if(S){y?u||o(null,i):o(S);return}l(p,R)}})}}var u=0;si.isString(e)&&(e=[e]);for(var d=0,h;d<e.length;++d)(h=i.resolvePath("",e[d]))&&c(h);if(s)return i;u||o(null,i)};$t.prototype.loadSync=function(e,t){if(!si.isNode)throw Error("not supported");return this.load(e,t,_A)};$t.prototype.resolveAll=function(){if(this.deferred.length)throw Error("unresolvable extensions: "+this.deferred.map(function(e){return"'extend "+e.extend+"' in "+e.parent.fullName}).join(", "));return qd.prototype.resolveAll.call(this)};var Vd=/^[A-Z]/;function mA(n,e){var t=e.parent.lookup(e.extend);if(t){var r=new vy(e.fullName,e.id,e.type,e.rule,void 0,e.options);return t.get(r.name)||(r.declaringField=e,e.extensionField=r,t.add(r)),!0}return!1}$t.prototype._handleAdd=function(e){if(e instanceof vy)e.extend!==void 0&&!e.extensionField&&(mA(this,e)||this.deferred.push(e));else if(e instanceof yA)Vd.test(e.name)&&(e.parent[e.name]=e.values);else if(!(e instanceof IL)){if(e instanceof vA)for(var t=0;t<this.deferred.length;)mA(this,this.deferred[t])?this.deferred.splice(t,1):++t;for(var r=0;r<e.nestedArray.length;++r)this._handleAdd(e._nestedArray[r]);Vd.test(e.name)&&(e.parent[e.name]=e)}};$t.prototype._handleRemove=function(e){if(e instanceof vy){if(e.extend!==void 0)if(e.extensionField)e.extensionField.parent.remove(e.extensionField),e.extensionField=null;else{var t=this.deferred.indexOf(e);t>-1&&this.deferred.splice(t,1)}}else if(e instanceof yA)Vd.test(e.name)&&delete e.parent[e.name];else if(e instanceof qd){for(var r=0;r<e.nestedArray.length;++r)this._handleRemove(e._nestedArray[r]);Vd.test(e.name)&&delete e.parent[e.name]}};$t._configure=function(n,e,t){vA=n,yy=e,Ol=t}});var it=w((iW,EA)=>{"use strict";var ze=EA.exports=Kn(),wA=Qm(),_y,Sy;ze.codegen=qb();ze.fetch=zb();ze.path=Hb();ze.fs=ze.inquire("fs");ze.toArray=function(e){if(e){for(var t=Object.keys(e),r=new Array(t.length),i=0;i<t.length;)r[i]=e[t[i++]];return r}return[]};ze.toObject=function(e){for(var t={},r=0;r<e.length;){var i=e[r++],s=e[r++];s!==void 0&&(t[i]=s)}return t};var DL=/\\/g,RL=/"/g;ze.isReserved=function(e){return/^(?:do|if|in|for|let|new|try|var|case|else|enum|eval|false|null|this|true|void|with|break|catch|class|const|super|throw|while|yield|delete|export|import|public|return|static|switch|typeof|default|extends|finally|package|private|continue|debugger|function|arguments|interface|protected|implements|instanceof)$/.test(e)};ze.safeProp=function(e){return!/^[$\w_]+$/.test(e)||ze.isReserved(e)?'["'+e.replace(DL,"\\\\").replace(RL,'\\"')+'"]':"."+e};ze.ucFirst=function(e){return e.charAt(0).toUpperCase()+e.substring(1)};var NL=/_([a-z])/g;ze.camelCase=function(e){return e.substring(0,1)+e.substring(1).replace(NL,function(t,r){return r.toUpperCase()})};ze.compareFieldsById=function(e,t){return e.id-t.id};ze.decorateType=function(e,t){if(e.$type)return t&&e.$type.name!==t&&(ze.decorateRoot.remove(e.$type),e.$type.name=t,ze.decorateRoot.add(e.$type)),e.$type;_y||(_y=Bd());var r=new _y(t||e.name);return ze.decorateRoot.add(r),r.ctor=e,Object.defineProperty(e,"$type",{value:r,enumerable:!1}),Object.defineProperty(e.prototype,"$type",{value:r,enumerable:!1}),r};var kL=0;ze.decorateEnum=function(e){if(e.$type)return e.$type;Sy||(Sy=An());var t=new Sy("Enum"+kL++,e);return ze.decorateRoot.add(t),Object.defineProperty(e,"$type",{value:t,enumerable:!1}),t};ze.setProperty=function(e,t,r){function i(s,o,a){var l=o.shift();if(l==="__proto__"||l==="prototype")return s;if(o.length>0)s[l]=i(s[l]||{},o,a);else{var c=s[l];c&&(a=[].concat(c).concat(a)),s[l]=a}return s}if(typeof e!="object")throw TypeError("dst must be an object");if(!t)throw TypeError("path must be specified");return t=t.split("."),i(e,t,r)};Object.defineProperty(ze,"decorateRoot",{get:function(){return wA.decorated||(wA.decorated=new(Ud()))}})});var is=w((sW,TA)=>{"use strict";TA.exports=Qt;Qt.className="ReflectionObject";var zd=it(),jd;function Qt(n,e){if(!zd.isString(n))throw TypeError("name must be a string");if(e&&!zd.isObject(e))throw TypeError("options must be an object");this.options=e,this.parsedOptions=null,this.name=n,this.parent=null,this.resolved=!1,this.comment=null,this.filename=null}Object.defineProperties(Qt.prototype,{root:{get:function(){for(var n=this;n.parent!==null;)n=n.parent;return n}},fullName:{get:function(){for(var n=[this.name],e=this.parent;e;)n.unshift(e.name),e=e.parent;return n.join(".")}}});Qt.prototype.toJSON=function(){throw Error()};Qt.prototype.onAdd=function(e){this.parent&&this.parent!==e&&this.parent.remove(this),this.parent=e,this.resolved=!1;var t=e.root;t instanceof jd&&t._handleAdd(this)};Qt.prototype.onRemove=function(e){var t=e.root;t instanceof jd&&t._handleRemove(this),this.parent=null,this.resolved=!1};Qt.prototype.resolve=function(){return this.resolved?this:(this.root instanceof jd&&(this.resolved=!0),this)};Qt.prototype.getOption=function(e){if(this.options)return this.options[e]};Qt.prototype.setOption=function(e,t,r){return(!r||!this.options||this.options[e]===void 0)&&((this.options||(this.options={}))[e]=t),this};Qt.prototype.setParsedOption=function(e,t,r){this.parsedOptions||(this.parsedOptions=[]);var i=this.parsedOptions;if(r){var s=i.find(function(l){return Object.prototype.hasOwnProperty.call(l,e)});if(s){var o=s[e];zd.setProperty(o,r,t)}else s={},s[e]=zd.setProperty({},r,t),i.push(s)}else{var a={};a[e]=t,i.push(a)}return this};Qt.prototype.setOptions=function(e,t){if(e)for(var r=Object.keys(e),i=0;i<r.length;++i)this.setOption(r[i],e[r[i]],t);return this};Qt.prototype.toString=function(){var e=this.constructor.className,t=this.fullName;return t.length?e+" "+t:e};Qt._configure=function(n){jd=n}});var An=w((oW,AA)=>{"use strict";AA.exports=Yn;var CA=is();((Yn.prototype=Object.create(CA.prototype)).constructor=Yn).className="Enum";var bA=Co(),Gd=it();function Yn(n,e,t,r,i,s){if(CA.call(this,n,t),e&&typeof e!="object")throw TypeError("values must be an object");if(this.valuesById={},this.values=Object.create(this.valuesById),this.comment=r,this.comments=i||{},this.valuesOptions=s,this.reserved=void 0,e)for(var o=Object.keys(e),a=0;a<o.length;++a)typeof e[o[a]]=="number"&&(this.valuesById[this.values[o[a]]=e[o[a]]]=o[a])}Yn.fromJSON=function(e,t){var r=new Yn(e,t.values,t.options,t.comment,t.comments);return r.reserved=t.reserved,r};Yn.prototype.toJSON=function(e){var t=e?!!e.keepComments:!1;return Gd.toObject(["options",this.options,"valuesOptions",this.valuesOptions,"values",this.values,"reserved",this.reserved&&this.reserved.length?this.reserved:void 0,"comment",t?this.comment:void 0,"comments",t?this.comments:void 0])};Yn.prototype.add=function(e,t,r,i){if(!Gd.isString(e))throw TypeError("name must be a string");if(!Gd.isInteger(t))throw TypeError("id must be an integer");if(this.values[e]!==void 0)throw Error("duplicate name '"+e+"' in "+this);if(this.isReservedId(t))throw Error("id "+t+" is reserved in "+this);if(this.isReservedName(e))throw Error("name '"+e+"' is reserved in "+this);if(this.valuesById[t]!==void 0){if(!(this.options&&this.options.allow_alias))throw Error("duplicate id "+t+" in "+this);this.values[e]=t}else this.valuesById[this.values[e]=t]=e;return i&&(this.valuesOptions===void 0&&(this.valuesOptions={}),this.valuesOptions[e]=i||null),this.comments[e]=r||null,this};Yn.prototype.remove=function(e){if(!Gd.isString(e))throw TypeError("name must be a string");var t=this.values[e];if(t==null)throw Error("name '"+e+"' does not exist in "+this);return delete this.valuesById[t],delete this.values[e],delete this.comments[e],this.valuesOptions&&delete this.valuesOptions[e],this};Yn.prototype.isReservedId=function(e){return bA.isReservedId(this.reserved,e)};Yn.prototype.isReservedName=function(e){return bA.isReservedName(this.reserved,e)}});var my=w((aW,DA)=>{"use strict";DA.exports=OL;var ML=An(),wy=rs(),Ey=it();function IA(n,e,t,r){return e.resolvedType.group?n("types[%i].encode(%s,w.uint32(%i)).uint32(%i)",t,r,(e.id<<3|3)>>>0,(e.id<<3|4)>>>0):n("types[%i].encode(%s,w.uint32(%i).fork()).ldelim()",t,r,(e.id<<3|2)>>>0)}function OL(n){for(var e=Ey.codegen(["m","w"],n.name+"$encode")("if(!w)")("w=Writer.create()"),t,r,i=n.fieldsArray.slice().sort(Ey.compareFieldsById),t=0;t<i.length;++t){var s=i[t].resolve(),o=n._fieldsArray.indexOf(s),a=s.resolvedType instanceof ML?"int32":s.type,l=wy.basic[a];r="m"+Ey.safeProp(s.name),s.map?(e("if(%s!=null&&Object.hasOwnProperty.call(m,%j)){",r,s.name)("for(var ks=Object.keys(%s),i=0;i<ks.length;++i){",r)("w.uint32(%i).fork().uint32(%i).%s(ks[i])",(s.id<<3|2)>>>0,8|wy.mapKey[s.keyType],s.keyType),l===void 0?e("types[%i].encode(%s[ks[i]],w.uint32(18).fork()).ldelim().ldelim()",o,r):e(".uint32(%i).%s(%s[ks[i]]).ldelim()",16|l,a,r),e("}")("}")):s.repeated?(e("if(%s!=null&&%s.length){",r,r),s.packed&&wy.packed[a]!==void 0?e("w.uint32(%i).fork()",(s.id<<3|2)>>>0)("for(var i=0;i<%s.length;++i)",r)("w.%s(%s[i])",a,r)("w.ldelim()"):(e("for(var i=0;i<%s.length;++i)",r),l===void 0?IA(e,s,o,r+"[i]"):e("w.uint32(%i).%s(%s[i])",(s.id<<3|l)>>>0,a,r)),e("}")):(s.optional&&e("if(%s!=null&&Object.hasOwnProperty.call(m,%j))",r,s.name),l===void 0?IA(e,s,o,r):e("w.uint32(%i).%s(%s)",(s.id<<3|l)>>>0,a,r))}return e("return w")}});var NA=w((lW,RA)=>{"use strict";var ie=RA.exports=Bb();ie.build="light";function xL(n,e,t){return typeof e=="function"?(t=e,e=new ie.Root):e||(e=new ie.Root),e.load(n,t)}ie.load=xL;function PL(n,e){return e||(e=new ie.Root),e.loadSync(n)}ie.loadSync=PL;ie.encoder=my();ie.decoder=sy();ie.verifier=ly();ie.converter=dy();ie.ReflectionObject=is();ie.Namespace=Co();ie.Root=Ud();ie.Enum=An();ie.Type=Bd();ie.Field=ri();ie.OneOf=wo();ie.MapField=Md();ie.Service=xd();ie.Method=Od();ie.Message=Pd();ie.wrappers=hy();ie.types=rs();ie.util=it();ie.ReflectionObject._configure(ie.Root);ie.Namespace._configure(ie.Type,ie.Service,ie.Enum);ie.Root._configure(ie.Type);ie.Field._configure(ie.Type)});var Cy=w((cW,OA)=>{"use strict";OA.exports=MA;var Ty=/[\s{}=;:[\],'"()<>]/g,FL=/(?:"([^"\\]*(?:\\.[^"\\]*)*)")/g,LL=/(?:'([^'\\]*(?:\\.[^'\\]*)*)')/g,BL=/^ *[*/]+ */,VL=/^\s*\*?\/*/,qL=/\n/g,UL=/\s/,zL=/\\(.?)/g,jL={0:"\0",r:"\r",n:`
`,t:"	"};function kA(n){return n.replace(zL,function(e,t){switch(t){case"\\":case"":return t;default:return jL[t]||""}})}MA.unescape=kA;function MA(n,e){n=n.toString();var t=0,r=n.length,i=1,s=0,o={},a=[],l=null;function c(k){return Error("illegal "+k+" (line "+i+")")}function u(){var k=l==="'"?LL:FL;k.lastIndex=t-1;var V=k.exec(n);if(!V)throw c("string");return t=k.lastIndex,S(l),l=null,kA(V[1])}function d(k){return n.charAt(k)}function h(k,V,W){var te={type:n.charAt(k++),lineEmpty:!1,leading:W},Je;e?Je=2:Je=3;var pt=k-Je,ve;do if(--pt<0||(ve=n.charAt(pt))===`
`){te.lineEmpty=!0;break}while(ve===" "||ve==="	");for(var C=n.substring(k,V).split(qL),Me=0;Me<C.length;++Me)C[Me]=C[Me].replace(e?VL:BL,"").trim();te.text=C.join(`
`).trim(),o[i]=te,s=i}function p(k){var V=y(k),W=n.substring(k,V),te=/^\s*\/\//.test(W);return te}function y(k){for(var V=k;V<r&&d(V)!==`
`;)V++;return V}function _(){if(a.length>0)return a.shift();if(l)return u();var k,V,W,te,Je,pt=t===0;do{if(t===r)return null;for(k=!1;UL.test(W=d(t));)if(W===`
`&&(pt=!0,++i),++t===r)return null;if(d(t)==="/"){if(++t===r)throw c("comment");if(d(t)==="/")if(e){if(te=t,Je=!1,p(t-1)){Je=!0;do if(t=y(t),t===r||(t++,!pt))break;while(p(t))}else t=Math.min(r,y(t)+1);Je&&(h(te,t,pt),pt=!0),i++,k=!0}else{for(Je=d(te=t+1)==="/";d(++t)!==`
`;)if(t===r)return null;++t,Je&&(h(te,t-1,pt),pt=!0),++i,k=!0}else if((W=d(t))==="*"){te=t+1,Je=e||d(te)==="*";do{if(W===`
`&&++i,++t===r)throw c("comment");V=W,W=d(t)}while(V!=="*"||W!=="/");++t,Je&&(h(te,t-2,pt),pt=!0),k=!0}else return"/"}}while(k);var ve=t;Ty.lastIndex=0;var C=Ty.test(d(ve++));if(!C)for(;ve<r&&!Ty.test(d(ve));)++ve;var Me=n.substring(t,t=ve);return(Me==='"'||Me==="'")&&(l=Me),Me}function S(k){a.push(k)}function R(){if(!a.length){var k=_();if(k===null)return null;S(k)}return a[0]}function E(k,V){var W=R(),te=W===k;if(te)return _(),!0;if(!V)throw c("token '"+W+"', '"+k+"' expected");return!1}function N(k){var V=null,W;return k===void 0?(W=o[i-1],delete o[i-1],W&&(e||W.type==="*"||W.lineEmpty)&&(V=W.leading?W.text:null)):(s<k&&R(),W=o[k],delete o[k],W&&!W.lineEmpty&&(e||W.type==="/")&&(V=W.leading?null:W.text)),V}return Object.defineProperty({next:_,peek:R,push:S,skip:E,cmnt:N},"line",{get:function(){return i}})}});var VA=w((uW,BA)=>{"use strict";BA.exports=Er;Er.filename=null;Er.defaults={keepCase:!1};var GL=Cy(),xA=Ud(),PA=Bd(),FA=ri(),HL=Md(),LA=wo(),KL=An(),WL=xd(),$L=Od(),by=rs(),Ay=it(),QL=/^[1-9][0-9]*$/,YL=/^-?[1-9][0-9]*$/,XL=/^0[x][0-9a-fA-F]+$/,JL=/^-?0[x][0-9a-fA-F]+$/,ZL=/^0[0-7]+$/,e2=/^-?0[0-7]+$/,t2=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/,Xn=/^[a-zA-Z_][a-zA-Z_0-9]*$/,Jn=/^(?:\.?[a-zA-Z_][a-zA-Z_0-9]*)(?:\.[a-zA-Z_][a-zA-Z_0-9]*)*$/,n2=/^(?:\.[a-zA-Z_][a-zA-Z_0-9]*)+$/;function Er(n,e,t){e instanceof xA||(t=e,e=new xA),t||(t=Er.defaults);var r=t.preferTrailingComment||!1,i=GL(n,t.alternateCommentMode||!1),s=i.next,o=i.push,a=i.peek,l=i.skip,c=i.cmnt,u=!0,d,h,p,y,_=!1,S=e,R=t.keepCase?function(A){return A}:Ay.camelCase;function E(A,I,M){var G=Er.filename;return M||(Er.filename=null),Error("illegal "+(I||"token")+" '"+A+"' ("+(G?G+", ":"")+"line "+i.line+")")}function N(){var A=[],I;do{if((I=s())!=='"'&&I!=="'")throw E(I);A.push(s()),l(I),I=a()}while(I==='"'||I==="'");return A.join("")}function k(A){var I=s();switch(I){case"'":case'"':return o(I),N();case"true":case"TRUE":return!0;case"false":case"FALSE":return!1}try{return W(I,!0)}catch{if(A&&Jn.test(I))return I;throw E(I,"value")}}function V(A,I){var M,G;do I&&((M=a())==='"'||M==="'")?A.push(N()):A.push([G=te(s()),l("to",!0)?te(s()):G]);while(l(",",!0));l(";")}function W(A,I){var M=1;switch(A.charAt(0)==="-"&&(M=-1,A=A.substring(1)),A){case"inf":case"INF":case"Inf":return M*(1/0);case"nan":case"NAN":case"Nan":case"NaN":return NaN;case"0":return 0}if(QL.test(A))return M*parseInt(A,10);if(XL.test(A))return M*parseInt(A,16);if(ZL.test(A))return M*parseInt(A,8);if(t2.test(A))return M*parseFloat(A);throw E(A,"number",I)}function te(A,I){switch(A){case"max":case"MAX":case"Max":return 536870911;case"0":return 0}if(!I&&A.charAt(0)==="-")throw E(A,"id");if(YL.test(A))return parseInt(A,10);if(JL.test(A))return parseInt(A,16);if(e2.test(A))return parseInt(A,8);throw E(A,"id")}function Je(){if(d!==void 0)throw E("package");if(d=s(),!Jn.test(d))throw E(d,"name");S=S.define(d),l(";")}function pt(){var A=a(),I;switch(A){case"weak":I=p||(p=[]),s();break;case"public":s();default:I=h||(h=[]);break}A=N(),l(";"),I.push(A)}function ve(){if(l("="),y=N(),_=y==="proto3",!_&&y!=="proto2")throw E(y,"syntax");l(";")}function C(A,I){switch(I){case"option":return Ee(A,I),l(";"),!0;case"message":return b(A,I),!0;case"enum":return pe(A,I),!0;case"service":return We(A,I),!0;case"extend":return zs(A,I),!0}return!1}function Me(A,I,M){var G=i.line;if(A&&(typeof A.comment!="string"&&(A.comment=c()),A.filename=Er.filename),l("{",!0)){for(var z;(z=s())!=="}";)I(z);l(";",!0)}else M&&M(),l(";"),A&&(typeof A.comment!="string"||r)&&(A.comment=c(G)||A.comment)}function b(A,I){if(!Xn.test(I=s()))throw E(I,"type name");var M=new PA(I);Me(M,function(z){if(!C(M,z))switch(z){case"map":oe(M,z);break;case"required":case"repeated":f(M,z);break;case"optional":_?f(M,"proto3_optional"):f(M,"optional");break;case"oneof":be(M,z);break;case"extensions":V(M.extensions||(M.extensions=[]));break;case"reserved":V(M.reserved||(M.reserved=[]),!0);break;default:if(!_||!Jn.test(z))throw E(z);o(z),f(M,"optional");break}}),A.add(M)}function f(A,I,M){var G=s();if(G==="group"){F(A,I);return}for(;G.endsWith(".")||a().startsWith(".");)G+=s();if(!Jn.test(G))throw E(G,"type");var z=s();if(!Xn.test(z))throw E(z,"name");z=R(z),l("=");var ne=new FA(z,te(s()),G,I,M);if(Me(ne,function(Ht){if(Ht==="option")Ee(ne,Ht),l(";");else throw E(Ht)},function(){gt(ne)}),I==="proto3_optional"){var ct=new LA("_"+z);ne.setOption("proto3_optional",!0),ct.add(ne),A.add(ct)}else A.add(ne);!_&&ne.repeated&&(by.packed[G]!==void 0||by.basic[G]===void 0)&&ne.setOption("packed",!1,!0)}function F(A,I){var M=s();if(!Xn.test(M))throw E(M,"name");var G=Ay.lcFirst(M);M===G&&(M=Ay.ucFirst(M)),l("=");var z=te(s()),ne=new PA(M);ne.group=!0;var ct=new FA(G,z,M,I);ct.filename=Er.filename,Me(ne,function(Ht){switch(Ht){case"option":Ee(ne,Ht),l(";");break;case"required":case"repeated":f(ne,Ht);break;case"optional":_?f(ne,"proto3_optional"):f(ne,"optional");break;case"message":b(ne,Ht);break;case"enum":pe(ne,Ht);break;default:throw E(Ht)}}),A.add(ne).add(ct)}function oe(A){l("<");var I=s();if(by.mapKey[I]===void 0)throw E(I,"type");l(",");var M=s();if(!Jn.test(M))throw E(M,"type");l(">");var G=s();if(!Xn.test(G))throw E(G,"name");l("=");var z=new HL(R(G),te(s()),I,M);Me(z,function(ct){if(ct==="option")Ee(z,ct),l(";");else throw E(ct)},function(){gt(z)}),A.add(z)}function be(A,I){if(!Xn.test(I=s()))throw E(I,"name");var M=new LA(R(I));Me(M,function(z){z==="option"?(Ee(M,z),l(";")):(o(z),f(M,"optional"))}),A.add(M)}function pe(A,I){if(!Xn.test(I=s()))throw E(I,"name");var M=new KL(I);Me(M,function(z){switch(z){case"option":Ee(M,z),l(";");break;case"reserved":V(M.reserved||(M.reserved=[]),!0);break;default:qe(M,z)}}),A.add(M)}function qe(A,I){if(!Xn.test(I))throw E(I,"name");l("=");var M=te(s(),!0),G={options:void 0};G.setOption=function(z,ne){this.options===void 0&&(this.options={}),this.options[z]=ne},Me(G,function(ne){if(ne==="option")Ee(G,ne),l(";");else throw E(ne)},function(){gt(G)}),A.add(I,M,G.comment,G.options)}function Ee(A,I){var M=l("(",!0);if(!Jn.test(I=s()))throw E(I,"name");var G=I,z=G,ne;M&&(l(")"),G="("+G+")",z=G,I=a(),n2.test(I)&&(ne=I.slice(1),G+=I,s())),l("=");var ct=It(A,G);Oe(A,z,ct,ne)}function It(A,I){if(l("{",!0)){for(var M={};!l("}",!0);){if(!Xn.test(mt=s()))throw E(mt,"name");if(mt===null)throw E(mt,"end of input");var G,z=mt;if(l(":",!0),a()==="{")G=It(A,I+"."+mt);else if(a()==="["){G=[];var ne;if(l("[",!0)){do ne=k(!0),G.push(ne);while(l(",",!0));l("]"),typeof ne<"u"&&Ke(A,I+"."+mt,ne)}}else G=k(!0),Ke(A,I+"."+mt,G);var ct=M[z];ct&&(G=[].concat(ct).concat(G)),M[z]=G,l(",",!0),l(";",!0)}return M}var Fr=k(!0);return Ke(A,I,Fr),Fr}function Ke(A,I,M){A.setOption&&A.setOption(I,M)}function Oe(A,I,M,G){A.setParsedOption&&A.setParsedOption(I,M,G)}function gt(A){if(l("[",!0)){do Ee(A,"option");while(l(",",!0));l("]")}return A}function We(A,I){if(!Xn.test(I=s()))throw E(I,"service name");var M=new WL(I);Me(M,function(z){if(!C(M,z))if(z==="rpc")Dt(M,z);else throw E(z)}),A.add(M)}function Dt(A,I){var M=c(),G=I;if(!Xn.test(I=s()))throw E(I,"name");var z=I,ne,ct,Fr,Ht;if(l("("),l("stream",!0)&&(ct=!0),!Jn.test(I=s())||(ne=I,l(")"),l("returns"),l("("),l("stream",!0)&&(Ht=!0),!Jn.test(I=s())))throw E(I);Fr=I,l(")");var Yc=new $L(z,G,ne,Fr,ct,Ht);Yc.comment=M,Me(Yc,function(wp){if(wp==="option")Ee(Yc,wp),l(";");else throw E(wp)}),A.add(Yc)}function zs(A,I){if(!Jn.test(I=s()))throw E(I,"reference");var M=I;Me(null,function(z){switch(z){case"required":case"repeated":f(A,z,M);break;case"optional":_?f(A,"proto3_optional",M):f(A,"optional",M);break;default:if(!_||!Jn.test(z))throw E(z);o(z),f(A,"optional",M);break}})}for(var mt;(mt=s())!==null;)switch(mt){case"package":if(!u)throw E(mt);Je();break;case"import":if(!u)throw E(mt);pt();break;case"syntax":if(!u)throw E(mt);ve();break;case"option":Ee(S,mt),l(";");break;default:if(C(S,mt)){u=!1;continue}throw E(mt)}return Er.filename=null,{package:d,imports:h,weakImports:p,syntax:y,root:e}}});var zA=w((dW,UA)=>{"use strict";UA.exports=Dn;var r2=/\/|\./;function Dn(n,e){r2.test(n)||(n="google/protobuf/"+n+".proto",e={nested:{google:{nested:{protobuf:{nested:e}}}}}),Dn[n]=e}Dn("any",{Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}}});var qA;Dn("duration",{Duration:qA={fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}}});Dn("timestamp",{Timestamp:qA});Dn("empty",{Empty:{fields:{}}});Dn("struct",{Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}}});Dn("wrappers",{DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}}});Dn("field_mask",{FieldMask:{fields:{paths:{rule:"repeated",type:"string",id:1}}}});Dn.get=function(e){return Dn[e]||null}});var GA=w((hW,jA)=>{"use strict";var oi=jA.exports=NA();oi.build="full";oi.tokenize=Cy();oi.parse=VA();oi.common=zA();oi.Root._configure(oi.Type,oi.parse,oi.common)});var Hd=w((fW,HA)=>{"use strict";HA.exports=GA()});var Iy=w((pW,i2)=>{i2.exports={nested:{google:{nested:{protobuf:{nested:{FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}}}}}}}}});var YA=w((ee,QA)=>{"use strict";var Ot=Hd();QA.exports=ee=Ot.descriptor=Ot.Root.fromJSON(Iy()).lookup(".google.protobuf");var KA=Ot.Namespace,xl=Ot.Root,Tr=Ot.Enum,ai=Ot.Type,li=Ot.Field,s2=Ot.MapField,Kd=Ot.OneOf,Pl=Ot.Service,Wd=Ot.Method;xl.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.FileDescriptorSet.decode(e));var t=new xl;if(e.file)for(var r,i,s=0,o;s<e.file.length;++s){if(i=t,(r=e.file[s]).package&&r.package.length&&(i=t.define(r.package)),r.name&&r.name.length&&t.files.push(i.filename=r.name),r.messageType)for(o=0;o<r.messageType.length;++o)i.add(ai.fromDescriptor(r.messageType[o],r.syntax));if(r.enumType)for(o=0;o<r.enumType.length;++o)i.add(Tr.fromDescriptor(r.enumType[o]));if(r.extension)for(o=0;o<r.extension.length;++o)i.add(li.fromDescriptor(r.extension[o]));if(r.service)for(o=0;o<r.service.length;++o)i.add(Pl.fromDescriptor(r.service[o]));var a=Ao(r.options,ee.FileOptions);if(a){var l=Object.keys(a);for(o=0;o<l.length;++o)i.setOption(l[o],a[l[o]])}}return t};xl.prototype.toDescriptor=function(e){var t=ee.FileDescriptorSet.create();return WA(this,t.file,e),t};function WA(n,e,t){var r=ee.FileDescriptorProto.create({name:n.filename||(n.fullName.substring(1).replace(/\./g,"_")||"root")+".proto"});t&&(r.syntax=t),n instanceof xl||(r.package=n.fullName.substring(1));for(var i=0,s;i<n.nestedArray.length;++i)(s=n._nestedArray[i])instanceof ai?r.messageType.push(s.toDescriptor(t)):s instanceof Tr?r.enumType.push(s.toDescriptor()):s instanceof li?r.extension.push(s.toDescriptor(t)):s instanceof Pl?r.service.push(s.toDescriptor()):s instanceof KA&&WA(s,e,t);r.options=Io(n.options,ee.FileOptions),r.messageType.length+r.enumType.length+r.extension.length+r.service.length&&e.push(r)}var o2=0;ai.fromDescriptor=function(e,t){typeof e.length=="number"&&(e=ee.DescriptorProto.decode(e));var r=new ai(e.name.length?e.name:"Type"+o2++,Ao(e.options,ee.MessageOptions)),i;if(e.oneofDecl)for(i=0;i<e.oneofDecl.length;++i)r.add(Kd.fromDescriptor(e.oneofDecl[i]));if(e.field)for(i=0;i<e.field.length;++i){var s=li.fromDescriptor(e.field[i],t);r.add(s),e.field[i].hasOwnProperty("oneofIndex")&&r.oneofsArray[e.field[i].oneofIndex].add(s)}if(e.extension)for(i=0;i<e.extension.length;++i)r.add(li.fromDescriptor(e.extension[i],t));if(e.nestedType)for(i=0;i<e.nestedType.length;++i)r.add(ai.fromDescriptor(e.nestedType[i],t)),e.nestedType[i].options&&e.nestedType[i].options.mapEntry&&r.setOption("map_entry",!0);if(e.enumType)for(i=0;i<e.enumType.length;++i)r.add(Tr.fromDescriptor(e.enumType[i]));if(e.extensionRange&&e.extensionRange.length)for(r.extensions=[],i=0;i<e.extensionRange.length;++i)r.extensions.push([e.extensionRange[i].start,e.extensionRange[i].end]);if(e.reservedRange&&e.reservedRange.length||e.reservedName&&e.reservedName.length){if(r.reserved=[],e.reservedRange)for(i=0;i<e.reservedRange.length;++i)r.reserved.push([e.reservedRange[i].start,e.reservedRange[i].end]);if(e.reservedName)for(i=0;i<e.reservedName.length;++i)r.reserved.push(e.reservedName[i])}return r};ai.prototype.toDescriptor=function(e){var t=ee.DescriptorProto.create({name:this.name}),r;for(r=0;r<this.fieldsArray.length;++r){var i;if(t.field.push(i=this._fieldsArray[r].toDescriptor(e)),this._fieldsArray[r]instanceof s2){var s=Dy(this._fieldsArray[r].keyType,this._fieldsArray[r].resolvedKeyType),o=Dy(this._fieldsArray[r].type,this._fieldsArray[r].resolvedType),a=o===11||o===14?this._fieldsArray[r].resolvedType&&$A(this.parent,this._fieldsArray[r].resolvedType)||this._fieldsArray[r].type:void 0;t.nestedType.push(ee.DescriptorProto.create({name:i.typeName,field:[ee.FieldDescriptorProto.create({name:"key",number:1,label:1,type:s}),ee.FieldDescriptorProto.create({name:"value",number:2,label:1,type:o,typeName:a})],options:ee.MessageOptions.create({mapEntry:!0})}))}}for(r=0;r<this.oneofsArray.length;++r)t.oneofDecl.push(this._oneofsArray[r].toDescriptor());for(r=0;r<this.nestedArray.length;++r)this._nestedArray[r]instanceof li?t.field.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof ai?t.nestedType.push(this._nestedArray[r].toDescriptor(e)):this._nestedArray[r]instanceof Tr&&t.enumType.push(this._nestedArray[r].toDescriptor());if(this.extensions)for(r=0;r<this.extensions.length;++r)t.extensionRange.push(ee.DescriptorProto.ExtensionRange.create({start:this.extensions[r][0],end:this.extensions[r][1]}));if(this.reserved)for(r=0;r<this.reserved.length;++r)typeof this.reserved[r]=="string"?t.reservedName.push(this.reserved[r]):t.reservedRange.push(ee.DescriptorProto.ReservedRange.create({start:this.reserved[r][0],end:this.reserved[r][1]}));return t.options=Io(this.options,ee.MessageOptions),t};var a2=/^(?![eE])[0-9]*(?:\.[0-9]*)?(?:[eE][+-]?[0-9]+)?$/;li.fromDescriptor=function(e,t){if(typeof e.length=="number"&&(e=ee.DescriptorProto.decode(e)),typeof e.number!="number")throw Error("missing field id");var r;e.typeName&&e.typeName.length?r=e.typeName:r=h2(e.type);var i;switch(e.label){case 1:i=void 0;break;case 2:i="required";break;case 3:i="repeated";break;default:throw Error("illegal label: "+e.label)}var s=e.extendee;e.extendee!==void 0&&(s=s.length?s:void 0);var o=new li(e.name.length?e.name:"field"+e.number,e.number,r,i,s);if(o.options=Ao(e.options,ee.FieldOptions),e.defaultValue&&e.defaultValue.length){var a=e.defaultValue;switch(a){case"true":case"TRUE":a=!0;break;case"false":case"FALSE":a=!1;break;default:var l=a2.exec(a);l&&(a=parseInt(a));break}o.setOption("default",a)}return f2(e.type)&&(t==="proto3"?e.options&&!e.options.packed&&o.setOption("packed",!1):e.options&&e.options.packed||o.setOption("packed",!1)),o};li.prototype.toDescriptor=function(e){var t=ee.FieldDescriptorProto.create({name:this.name,number:this.id});if(this.map)t.type=11,t.typeName=Ot.util.ucFirst(this.name),t.label=3;else{switch(t.type=Dy(this.type,this.resolve().resolvedType)){case 10:case 11:case 14:t.typeName=this.resolvedType?$A(this.parent,this.resolvedType):this.type;break}switch(this.rule){case"repeated":t.label=3;break;case"required":t.label=2;break;default:t.label=1;break}}if(t.extendee=this.extensionField?this.extensionField.parent.fullName:this.extend,this.partOf&&(t.oneofIndex=this.parent.oneofsArray.indexOf(this.partOf))<0)throw Error("missing oneof");return this.options&&(t.options=Io(this.options,ee.FieldOptions),this.options.default!=null&&(t.defaultValue=String(this.options.default))),e==="proto3"?this.packed||((t.options||(t.options=ee.FieldOptions.create())).packed=!1):this.packed&&((t.options||(t.options=ee.FieldOptions.create())).packed=!0),t};var l2=0;Tr.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.EnumDescriptorProto.decode(e));var t={};if(e.value)for(var r=0;r<e.value.length;++r){var i=e.value[r].name,s=e.value[r].number||0;t[i&&i.length?i:"NAME"+s]=s}return new Tr(e.name&&e.name.length?e.name:"Enum"+l2++,t,Ao(e.options,ee.EnumOptions))};Tr.prototype.toDescriptor=function(){for(var e=[],t=0,r=Object.keys(this.values);t<r.length;++t)e.push(ee.EnumValueDescriptorProto.create({name:r[t],number:this.values[r[t]]}));return ee.EnumDescriptorProto.create({name:this.name,value:e,options:Io(this.options,ee.EnumOptions)})};var c2=0;Kd.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ee.OneofDescriptorProto.decode(e)),new Kd(e.name&&e.name.length?e.name:"oneof"+c2++)};Kd.prototype.toDescriptor=function(){return ee.OneofDescriptorProto.create({name:this.name})};var u2=0;Pl.fromDescriptor=function(e){typeof e.length=="number"&&(e=ee.ServiceDescriptorProto.decode(e));var t=new Pl(e.name&&e.name.length?e.name:"Service"+u2++,Ao(e.options,ee.ServiceOptions));if(e.method)for(var r=0;r<e.method.length;++r)t.add(Wd.fromDescriptor(e.method[r]));return t};Pl.prototype.toDescriptor=function(){for(var e=[],t=0;t<this.methodsArray.length;++t)e.push(this._methodsArray[t].toDescriptor());return ee.ServiceDescriptorProto.create({name:this.name,method:e,options:Io(this.options,ee.ServiceOptions)})};var d2=0;Wd.fromDescriptor=function(e){return typeof e.length=="number"&&(e=ee.MethodDescriptorProto.decode(e)),new Wd(e.name&&e.name.length?e.name:"Method"+d2++,"rpc",e.inputType,e.outputType,!!e.clientStreaming,!!e.serverStreaming,Ao(e.options,ee.MethodOptions))};Wd.prototype.toDescriptor=function(){return ee.MethodDescriptorProto.create({name:this.name,inputType:this.resolvedRequestType?this.resolvedRequestType.fullName:this.requestType,outputType:this.resolvedResponseType?this.resolvedResponseType.fullName:this.responseType,clientStreaming:this.requestStream,serverStreaming:this.responseStream,options:Io(this.options,ee.MethodOptions)})};function h2(n){switch(n){case 1:return"double";case 2:return"float";case 3:return"int64";case 4:return"uint64";case 5:return"int32";case 6:return"fixed64";case 7:return"fixed32";case 8:return"bool";case 9:return"string";case 12:return"bytes";case 13:return"uint32";case 15:return"sfixed32";case 16:return"sfixed64";case 17:return"sint32";case 18:return"sint64"}throw Error("illegal type: "+n)}function f2(n){switch(n){case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 13:case 14:case 15:case 16:case 17:case 18:return!0}return!1}function Dy(n,e){switch(n){case"double":return 1;case"float":return 2;case"int64":return 3;case"uint64":return 4;case"int32":return 5;case"fixed64":return 6;case"fixed32":return 7;case"bool":return 8;case"string":return 9;case"bytes":return 12;case"uint32":return 13;case"sfixed32":return 15;case"sfixed64":return 16;case"sint32":return 17;case"sint64":return 18}if(e instanceof Tr)return 14;if(e instanceof ai)return e.group?10:11;throw Error("illegal type: "+n)}function Ao(n,e){if(n){for(var t=[],r=0,i,s,o;r<e.fieldsArray.length;++r)(s=(i=e._fieldsArray[r]).name)!=="uninterpretedOption"&&n.hasOwnProperty(s)&&(o=n[s],i.resolvedType instanceof Tr&&typeof o=="number"&&i.resolvedType.valuesById[o]!==void 0&&(o=i.resolvedType.valuesById[o]),t.push(p2(s),o));return t.length?Ot.util.toObject(t):void 0}}function Io(n,e){if(n){for(var t=[],r=0,i=Object.keys(n),s,o;r<i.length;++r)if(o=n[s=i[r]],s!=="default"){var a=e.fields[s];!a&&!(a=e.fields[s=Ot.util.camelCase(s)])||t.push(s,o)}return t.length?e.fromObject(Ot.util.toObject(t)):void 0}}function $A(n,e){var t=n.fullName.split("."),r=e.fullName.split("."),i=0,s=0,o=r.length-1;if(!(n instanceof xl)&&e instanceof KA)for(;i<t.length&&s<o&&t[i]===r[s];){var a=e.lookup(t[i++],!0);if(a!==null&&a!==e)break;++s}else for(;i<t.length&&s<o&&t[i]===r[s];++i,++s);return r.slice(s).join(".")}function p2(n){return n.substring(0,1)+n.substring(1).replace(/([A-Z])(?=[a-z]|$)/g,function(e,t){return"_"+t.toLowerCase()})}});var XA=w((gW,g2)=>{g2.exports={nested:{google:{nested:{protobuf:{nested:{Api:{fields:{name:{type:"string",id:1},methods:{rule:"repeated",type:"Method",id:2},options:{rule:"repeated",type:"Option",id:3},version:{type:"string",id:4},sourceContext:{type:"SourceContext",id:5},mixins:{rule:"repeated",type:"Mixin",id:6},syntax:{type:"Syntax",id:7}}},Method:{fields:{name:{type:"string",id:1},requestTypeUrl:{type:"string",id:2},requestStreaming:{type:"bool",id:3},responseTypeUrl:{type:"string",id:4},responseStreaming:{type:"bool",id:5},options:{rule:"repeated",type:"Option",id:6},syntax:{type:"Syntax",id:7}}},Mixin:{fields:{name:{type:"string",id:1},root:{type:"string",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}}}}}}}}});var JA=w((mW,m2)=>{m2.exports={nested:{google:{nested:{protobuf:{nested:{SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var ZA=w((yW,y2)=>{y2.exports={nested:{google:{nested:{protobuf:{nested:{Type:{fields:{name:{type:"string",id:1},fields:{rule:"repeated",type:"Field",id:2},oneofs:{rule:"repeated",type:"string",id:3},options:{rule:"repeated",type:"Option",id:4},sourceContext:{type:"SourceContext",id:5},syntax:{type:"Syntax",id:6}}},Field:{fields:{kind:{type:"Kind",id:1},cardinality:{type:"Cardinality",id:2},number:{type:"int32",id:3},name:{type:"string",id:4},typeUrl:{type:"string",id:6},oneofIndex:{type:"int32",id:7},packed:{type:"bool",id:8},options:{rule:"repeated",type:"Option",id:9},jsonName:{type:"string",id:10},defaultValue:{type:"string",id:11}},nested:{Kind:{values:{TYPE_UNKNOWN:0,TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Cardinality:{values:{CARDINALITY_UNKNOWN:0,CARDINALITY_OPTIONAL:1,CARDINALITY_REQUIRED:2,CARDINALITY_REPEATED:3}}}},Enum:{fields:{name:{type:"string",id:1},enumvalue:{rule:"repeated",type:"EnumValue",id:2},options:{rule:"repeated",type:"Option",id:3},sourceContext:{type:"SourceContext",id:4},syntax:{type:"Syntax",id:5}}},EnumValue:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{rule:"repeated",type:"Option",id:3}}},Option:{fields:{name:{type:"string",id:1},value:{type:"Any",id:2}}},Syntax:{values:{SYNTAX_PROTO2:0,SYNTAX_PROTO3:1}},Any:{fields:{type_url:{type:"string",id:1},value:{type:"bytes",id:2}}},SourceContext:{fields:{fileName:{type:"string",id:1}}}}}}}}}});var rI=w(ci=>{"use strict";Object.defineProperty(ci,"__esModule",{value:!0});ci.addCommonProtos=ci.loadProtosWithOptionsSync=ci.loadProtosWithOptions=void 0;var eI=de("fs"),tI=de("path"),Do=Hd();function nI(n,e){let t=n.resolvePath;n.resolvePath=(r,i)=>{if(tI.isAbsolute(i))return i;for(let s of e){let o=tI.join(s,i);try{return eI.accessSync(o,eI.constants.R_OK),o}catch{continue}}return process.emitWarning(`${i} not found in any of the include paths ${e}`),t(r,i)}}function v2(n,e){return g(this,null,function*(){let t=new Do.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))return Promise.reject(new Error("The includeDirs option must be an array"));nI(t,e.includeDirs)}let r=yield t.load(n,e);return r.resolveAll(),r})}ci.loadProtosWithOptions=v2;function _2(n,e){let t=new Do.Root;if(e=e||{},e.includeDirs){if(!Array.isArray(e.includeDirs))throw new Error("The includeDirs option must be an array");nI(t,e.includeDirs)}let r=t.loadSync(n,e);return r.resolveAll(),r}ci.loadProtosWithOptionsSync=_2;function S2(){let n=XA(),e=Iy(),t=JA(),r=ZA();Do.common("api",n.nested.google.nested.protobuf.nested),Do.common("descriptor",e.nested.google.nested.protobuf.nested),Do.common("source_context",t.nested.google.nested.protobuf.nested),Do.common("type",r.nested.google.nested.protobuf.nested)}ci.addCommonProtos=S2});var oI=w((sI,Ry)=>{"use strict";var iI=function(n){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=null;try{e=new WebAssembly.Instance(new WebAssembly.Module(new Uint8Array([0,97,115,109,1,0,0,0,1,13,2,96,0,1,127,96,4,127,127,127,127,1,127,3,7,6,0,1,1,1,1,1,6,6,1,127,1,65,0,11,7,50,6,3,109,117,108,0,1,5,100,105,118,95,115,0,2,5,100,105,118,95,117,0,3,5,114,101,109,95,115,0,4,5,114,101,109,95,117,0,5,8,103,101,116,95,104,105,103,104,0,0,10,191,1,6,4,0,35,0,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,126,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,127,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,128,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,129,34,4,66,32,135,167,36,0,32,4,167,11,36,1,1,126,32,0,173,32,1,173,66,32,134,132,32,2,173,32,3,173,66,32,134,132,130,34,4,66,32,135,167,36,0,32,4,167,11])),{}).exports}catch{}function t(b,f,F){this.low=b|0,this.high=f|0,this.unsigned=!!F}t.prototype.__isLong__,Object.defineProperty(t.prototype,"__isLong__",{value:!0});function r(b){return(b&&b.__isLong__)===!0}function i(b){var f=Math.clz32(b&-b);return b?31-f:f}t.isLong=r;var s={},o={};function a(b,f){var F,oe,be;return f?(b>>>=0,(be=0<=b&&b<256)&&(oe=o[b],oe)?oe:(F=c(b,0,!0),be&&(o[b]=F),F)):(b|=0,(be=-128<=b&&b<128)&&(oe=s[b],oe)?oe:(F=c(b,b<0?-1:0,!1),be&&(s[b]=F),F))}t.fromInt=a;function l(b,f){if(isNaN(b))return f?k:N;if(f){if(b<0)return k;if(b>=S)return pt}else{if(b<=-R)return ve;if(b+1>=R)return Je}return b<0?l(-b,f).neg():c(b%_|0,b/_|0,f)}t.fromNumber=l;function c(b,f,F){return new t(b,f,F)}t.fromBits=c;var u=Math.pow;function d(b,f,F){if(b.length===0)throw Error("empty string");if(typeof f=="number"?(F=f,f=!1):f=!!f,b==="NaN"||b==="Infinity"||b==="+Infinity"||b==="-Infinity")return f?k:N;if(F=F||10,F<2||36<F)throw RangeError("radix");var oe;if((oe=b.indexOf("-"))>0)throw Error("interior hyphen");if(oe===0)return d(b.substring(1),f,F).neg();for(var be=l(u(F,8)),pe=N,qe=0;qe<b.length;qe+=8){var Ee=Math.min(8,b.length-qe),It=parseInt(b.substring(qe,qe+Ee),F);if(Ee<8){var Ke=l(u(F,Ee));pe=pe.mul(Ke).add(l(It))}else pe=pe.mul(be),pe=pe.add(l(It))}return pe.unsigned=f,pe}t.fromString=d;function h(b,f){return typeof b=="number"?l(b,f):typeof b=="string"?d(b,f):c(b.low,b.high,typeof f=="boolean"?f:b.unsigned)}t.fromValue=h;var p=65536,y=1<<24,_=p*p,S=_*_,R=S/2,E=a(y),N=a(0);t.ZERO=N;var k=a(0,!0);t.UZERO=k;var V=a(1);t.ONE=V;var W=a(1,!0);t.UONE=W;var te=a(-1);t.NEG_ONE=te;var Je=c(-1,2147483647,!1);t.MAX_VALUE=Je;var pt=c(-1,-1,!0);t.MAX_UNSIGNED_VALUE=pt;var ve=c(0,-2147483648,!1);t.MIN_VALUE=ve;var C=t.prototype;C.toInt=function(){return this.unsigned?this.low>>>0:this.low},C.toNumber=function(){return this.unsigned?(this.high>>>0)*_+(this.low>>>0):this.high*_+(this.low>>>0)},C.toString=function(f){if(f=f||10,f<2||36<f)throw RangeError("radix");if(this.isZero())return"0";if(this.isNegative())if(this.eq(ve)){var F=l(f),oe=this.div(F),be=oe.mul(F).sub(this);return oe.toString(f)+be.toInt().toString(f)}else return"-"+this.neg().toString(f);for(var pe=l(u(f,6),this.unsigned),qe=this,Ee="";;){var It=qe.div(pe),Ke=qe.sub(It.mul(pe)).toInt()>>>0,Oe=Ke.toString(f);if(qe=It,qe.isZero())return Oe+Ee;for(;Oe.length<6;)Oe="0"+Oe;Ee=""+Oe+Ee}},C.getHighBits=function(){return this.high},C.getHighBitsUnsigned=function(){return this.high>>>0},C.getLowBits=function(){return this.low},C.getLowBitsUnsigned=function(){return this.low>>>0},C.getNumBitsAbs=function(){if(this.isNegative())return this.eq(ve)?64:this.neg().getNumBitsAbs();for(var f=this.high!=0?this.high:this.low,F=31;F>0&&!(f&1<<F);F--);return this.high!=0?F+33:F+1},C.isZero=function(){return this.high===0&&this.low===0},C.eqz=C.isZero,C.isNegative=function(){return!this.unsigned&&this.high<0},C.isPositive=function(){return this.unsigned||this.high>=0},C.isOdd=function(){return(this.low&1)===1},C.isEven=function(){return(this.low&1)===0},C.equals=function(f){return r(f)||(f=h(f)),this.unsigned!==f.unsigned&&this.high>>>31===1&&f.high>>>31===1?!1:this.high===f.high&&this.low===f.low},C.eq=C.equals,C.notEquals=function(f){return!this.eq(f)},C.neq=C.notEquals,C.ne=C.notEquals,C.lessThan=function(f){return this.comp(f)<0},C.lt=C.lessThan,C.lessThanOrEqual=function(f){return this.comp(f)<=0},C.lte=C.lessThanOrEqual,C.le=C.lessThanOrEqual,C.greaterThan=function(f){return this.comp(f)>0},C.gt=C.greaterThan,C.greaterThanOrEqual=function(f){return this.comp(f)>=0},C.gte=C.greaterThanOrEqual,C.ge=C.greaterThanOrEqual,C.compare=function(f){if(r(f)||(f=h(f)),this.eq(f))return 0;var F=this.isNegative(),oe=f.isNegative();return F&&!oe?-1:!F&&oe?1:this.unsigned?f.high>>>0>this.high>>>0||f.high===this.high&&f.low>>>0>this.low>>>0?-1:1:this.sub(f).isNegative()?-1:1},C.comp=C.compare,C.negate=function(){return!this.unsigned&&this.eq(ve)?ve:this.not().add(V)},C.neg=C.negate,C.add=function(f){r(f)||(f=h(f));var F=this.high>>>16,oe=this.high&65535,be=this.low>>>16,pe=this.low&65535,qe=f.high>>>16,Ee=f.high&65535,It=f.low>>>16,Ke=f.low&65535,Oe=0,gt=0,We=0,Dt=0;return Dt+=pe+Ke,We+=Dt>>>16,Dt&=65535,We+=be+It,gt+=We>>>16,We&=65535,gt+=oe+Ee,Oe+=gt>>>16,gt&=65535,Oe+=F+qe,Oe&=65535,c(We<<16|Dt,Oe<<16|gt,this.unsigned)},C.subtract=function(f){return r(f)||(f=h(f)),this.add(f.neg())},C.sub=C.subtract,C.multiply=function(f){if(this.isZero())return this;if(r(f)||(f=h(f)),e){var F=e.mul(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}if(f.isZero())return this.unsigned?k:N;if(this.eq(ve))return f.isOdd()?ve:N;if(f.eq(ve))return this.isOdd()?ve:N;if(this.isNegative())return f.isNegative()?this.neg().mul(f.neg()):this.neg().mul(f).neg();if(f.isNegative())return this.mul(f.neg()).neg();if(this.lt(E)&&f.lt(E))return l(this.toNumber()*f.toNumber(),this.unsigned);var oe=this.high>>>16,be=this.high&65535,pe=this.low>>>16,qe=this.low&65535,Ee=f.high>>>16,It=f.high&65535,Ke=f.low>>>16,Oe=f.low&65535,gt=0,We=0,Dt=0,zs=0;return zs+=qe*Oe,Dt+=zs>>>16,zs&=65535,Dt+=pe*Oe,We+=Dt>>>16,Dt&=65535,Dt+=qe*Ke,We+=Dt>>>16,Dt&=65535,We+=be*Oe,gt+=We>>>16,We&=65535,We+=pe*Ke,gt+=We>>>16,We&=65535,We+=qe*It,gt+=We>>>16,We&=65535,gt+=oe*Oe+be*Ke+pe*It+qe*Ee,gt&=65535,c(Dt<<16|zs,gt<<16|We,this.unsigned)},C.mul=C.multiply,C.divide=function(f){if(r(f)||(f=h(f)),f.isZero())throw Error("division by zero");if(e){if(!this.unsigned&&this.high===-2147483648&&f.low===-1&&f.high===-1)return this;var F=(this.unsigned?e.div_u:e.div_s)(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}if(this.isZero())return this.unsigned?k:N;var oe,be,pe;if(this.unsigned){if(f.unsigned||(f=f.toUnsigned()),f.gt(this))return k;if(f.gt(this.shru(1)))return W;pe=k}else{if(this.eq(ve)){if(f.eq(V)||f.eq(te))return ve;if(f.eq(ve))return V;var qe=this.shr(1);return oe=qe.div(f).shl(1),oe.eq(N)?f.isNegative()?V:te:(be=this.sub(f.mul(oe)),pe=oe.add(be.div(f)),pe)}else if(f.eq(ve))return this.unsigned?k:N;if(this.isNegative())return f.isNegative()?this.neg().div(f.neg()):this.neg().div(f).neg();if(f.isNegative())return this.div(f.neg()).neg();pe=N}for(be=this;be.gte(f);){oe=Math.max(1,Math.floor(be.toNumber()/f.toNumber()));for(var Ee=Math.ceil(Math.log(oe)/Math.LN2),It=Ee<=48?1:u(2,Ee-48),Ke=l(oe),Oe=Ke.mul(f);Oe.isNegative()||Oe.gt(be);)oe-=It,Ke=l(oe,this.unsigned),Oe=Ke.mul(f);Ke.isZero()&&(Ke=V),pe=pe.add(Ke),be=be.sub(Oe)}return pe},C.div=C.divide,C.modulo=function(f){if(r(f)||(f=h(f)),e){var F=(this.unsigned?e.rem_u:e.rem_s)(this.low,this.high,f.low,f.high);return c(F,e.get_high(),this.unsigned)}return this.sub(this.div(f).mul(f))},C.mod=C.modulo,C.rem=C.modulo,C.not=function(){return c(~this.low,~this.high,this.unsigned)},C.countLeadingZeros=function(){return this.high?Math.clz32(this.high):Math.clz32(this.low)+32},C.clz=C.countLeadingZeros,C.countTrailingZeros=function(){return this.low?i(this.low):i(this.high)+32},C.ctz=C.countTrailingZeros,C.and=function(f){return r(f)||(f=h(f)),c(this.low&f.low,this.high&f.high,this.unsigned)},C.or=function(f){return r(f)||(f=h(f)),c(this.low|f.low,this.high|f.high,this.unsigned)},C.xor=function(f){return r(f)||(f=h(f)),c(this.low^f.low,this.high^f.high,this.unsigned)},C.shiftLeft=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low<<f,this.high<<f|this.low>>>32-f,this.unsigned):c(0,this.low<<f-32,this.unsigned)},C.shl=C.shiftLeft,C.shiftRight=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>f,this.unsigned):c(this.high>>f-32,this.high>=0?0:-1,this.unsigned)},C.shr=C.shiftRight,C.shiftRightUnsigned=function(f){return r(f)&&(f=f.toInt()),(f&=63)===0?this:f<32?c(this.low>>>f|this.high<<32-f,this.high>>>f,this.unsigned):f===32?c(this.high,0,this.unsigned):c(this.high>>>f-32,0,this.unsigned)},C.shru=C.shiftRightUnsigned,C.shr_u=C.shiftRightUnsigned,C.rotateLeft=function(f){var F;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(F=32-f,c(this.low<<f|this.high>>>F,this.high<<f|this.low>>>F,this.unsigned)):(f-=32,F=32-f,c(this.high<<f|this.low>>>F,this.low<<f|this.high>>>F,this.unsigned))},C.rotl=C.rotateLeft,C.rotateRight=function(f){var F;return r(f)&&(f=f.toInt()),(f&=63)===0?this:f===32?c(this.high,this.low,this.unsigned):f<32?(F=32-f,c(this.high<<F|this.low>>>f,this.low<<F|this.high>>>f,this.unsigned)):(f-=32,F=32-f,c(this.low<<F|this.high>>>f,this.high<<F|this.low>>>f,this.unsigned))},C.rotr=C.rotateRight,C.toSigned=function(){return this.unsigned?c(this.low,this.high,!1):this},C.toUnsigned=function(){return this.unsigned?this:c(this.low,this.high,!0)},C.toBytes=function(f){return f?this.toBytesLE():this.toBytesBE()},C.toBytesLE=function(){var f=this.high,F=this.low;return[F&255,F>>>8&255,F>>>16&255,F>>>24,f&255,f>>>8&255,f>>>16&255,f>>>24]},C.toBytesBE=function(){var f=this.high,F=this.low;return[f>>>24,f>>>16&255,f>>>8&255,f&255,F>>>24,F>>>16&255,F>>>8&255,F&255]},t.fromBytes=function(f,F,oe){return oe?t.fromBytesLE(f,F):t.fromBytesBE(f,F)},t.fromBytesLE=function(f,F){return new t(f[0]|f[1]<<8|f[2]<<16|f[3]<<24,f[4]|f[5]<<8|f[6]<<16|f[7]<<24,F)},t.fromBytesBE=function(f,F){return new t(f[4]<<24|f[5]<<16|f[6]<<8|f[7],f[0]<<24|f[1]<<16|f[2]<<8|f[3],F)};var Me=t;return n.default=Me,"default"in n?n.default:n}({});typeof define=="function"&&define.amd?define([],function(){return iI}):typeof Ry=="object"&&typeof sI=="object"&&(Ry.exports=iI)});var Oy=w(Tt=>{"use strict";Object.defineProperty(Tt,"__esModule",{value:!0});Tt.loadFileDescriptorSetFromObject=Tt.loadFileDescriptorSetFromBuffer=Tt.fromJSON=Tt.loadSync=Tt.load=Tt.isAnyExtension=Tt.Long=void 0;var w2=WC(),Zn=Hd(),ky=YA(),My=rI(),E2=oI();Tt.Long=E2;function T2(n){return"@type"in n&&typeof n["@type"]=="string"}Tt.isAnyExtension=T2;var cI={longs:String,enums:String,bytes:String,defaults:!0,oneofs:!0,json:!0};function C2(n,e){return n===""?e:n+"."+e}function b2(n){return n instanceof Zn.Service||n instanceof Zn.Type||n instanceof Zn.Enum}function A2(n){return n instanceof Zn.Namespace||n instanceof Zn.Root}function uI(n,e){let t=C2(e,n.name);return b2(n)?[[t,n]]:A2(n)&&typeof n.nested<"u"?Object.keys(n.nested).map(r=>uI(n.nested[r],t)).reduce((r,i)=>r.concat(i),[]):[]}function aI(n,e){return function(r){return n.toObject(n.decode(r),e)}}function lI(n){return function(t){if(Array.isArray(t))throw new Error(`Failed to serialize message: expected object with ${n.name} structure, got array instead`);let r=n.fromObject(t);return n.encode(r).finish()}}function I2(n,e,t,r){let i=n.resolvedRequestType,s=n.resolvedResponseType;return{path:"/"+e+"/"+n.name,requestStream:!!n.requestStream,responseStream:!!n.responseStream,requestSerialize:lI(i),requestDeserialize:aI(i,t),responseSerialize:lI(s),responseDeserialize:aI(s,t),originalName:w2(n.name),requestType:Ny(i,r),responseType:Ny(s,r)}}function D2(n,e,t,r){let i={};for(let s of n.methodsArray)i[s.name]=I2(s,e,t,r);return i}function Ny(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 DescriptorProto",type:t.$type.toObject(t,cI),fileDescriptorProtos:e}}function R2(n,e){let t=n.toDescriptor("proto3");return{format:"Protocol Buffer 3 EnumDescriptorProto",type:t.$type.toObject(t,cI),fileDescriptorProtos:e}}function N2(n,e,t,r){if(n instanceof Zn.Service)return D2(n,e,t,r);if(n instanceof Zn.Type)return Ny(n,r);if(n instanceof Zn.Enum)return R2(n,r);throw new Error("Type mismatch in reflection object handling")}function $d(n,e){let t={};n.resolveAll();let i=n.toDescriptor("proto3").file.map(s=>Buffer.from(ky.FileDescriptorProto.encode(s).finish()));for(let[s,o]of uI(n,""))t[s]=N2(o,s,e,i);return t}function dI(n,e){e=e||{};let t=Zn.Root.fromDescriptor(n);return t.resolveAll(),$d(t,e)}function k2(n,e){return(0,My.loadProtosWithOptions)(n,e).then(t=>$d(t,e))}Tt.load=k2;function M2(n,e){let t=(0,My.loadProtosWithOptionsSync)(n,e);return $d(t,e)}Tt.loadSync=M2;function O2(n,e){e=e||{};let t=Zn.Root.fromJSON(n);return t.resolveAll(),$d(t,e)}Tt.fromJSON=O2;function x2(n,e){let t=ky.FileDescriptorSet.decode(n);return dI(t,e)}Tt.loadFileDescriptorSetFromBuffer=x2;function P2(n,e){let t=ky.FileDescriptorSet.fromObject(n);return dI(t,e)}Tt.loadFileDescriptorSetFromObject=P2;(0,My.addCommonProtos)()});var os=w(Ae=>{"use strict";Object.defineProperty(Ae,"__esModule",{value:!0});Ae.setup=Ae.getChannelzServiceDefinition=Ae.getChannelzHandlers=Ae.unregisterChannelzRef=Ae.registerChannelzSocket=Ae.registerChannelzServer=Ae.registerChannelzSubchannel=Ae.registerChannelzChannel=Ae.ChannelzCallTracker=Ae.ChannelzChildrenTracker=Ae.ChannelzTrace=void 0;var hI=de("net"),Fl=rn(),Bl=le(),F2=Gn(),L2=gd(),B2=Nm();function xy(n){return{channel_id:n.id,name:n.name}}function By(n){return{subchannel_id:n.id,name:n.name}}function V2(n){return{server_id:n.id}}function Yd(n){return{socket_id:n.id,name:n.name}}var fI=32,Py=class{constructor(){this.events=[],this.eventsLogged=0,this.creationTimestamp=new Date}addTrace(e,t,r){let i=new Date;this.events.push({description:t,severity:e,timestamp:i,childChannel:r?.kind==="channel"?r:void 0,childSubchannel:r?.kind==="subchannel"?r:void 0}),this.events.length>=fI*2&&(this.events=this.events.slice(fI)),this.eventsLogged+=1}getTraceMessage(){return{creation_timestamp:Cr(this.creationTimestamp),num_events_logged:this.eventsLogged,events:this.events.map(e=>({description:e.description,severity:e.severity,timestamp:Cr(e.timestamp),channel_ref:e.childChannel?xy(e.childChannel):null,subchannel_ref:e.childSubchannel?By(e.childSubchannel):null}))}}};Ae.ChannelzTrace=Py;var Fy=class{constructor(){this.channelChildren=new Map,this.subchannelChildren=new Map,this.socketChildren=new Map}refChild(e){var t,r,i;switch(e.kind){case"channel":{let s=(t=this.channelChildren.get(e.id))!==null&&t!==void 0?t:{ref:e,count:0};s.count+=1,this.channelChildren.set(e.id,s);break}case"subchannel":{let s=(r=this.subchannelChildren.get(e.id))!==null&&r!==void 0?r:{ref:e,count:0};s.count+=1,this.subchannelChildren.set(e.id,s);break}case"socket":{let s=(i=this.socketChildren.get(e.id))!==null&&i!==void 0?i:{ref:e,count:0};s.count+=1,this.socketChildren.set(e.id,s);break}}}unrefChild(e){switch(e.kind){case"channel":{let t=this.channelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.channelChildren.delete(e.id):this.channelChildren.set(e.id,t));break}case"subchannel":{let t=this.subchannelChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.subchannelChildren.delete(e.id):this.subchannelChildren.set(e.id,t));break}case"socket":{let t=this.socketChildren.get(e.id);t!==void 0&&(t.count-=1,t.count===0?this.socketChildren.delete(e.id):this.socketChildren.set(e.id,t));break}}}getChildLists(){let e=[];for(let{ref:i}of this.channelChildren.values())e.push(i);let t=[];for(let{ref:i}of this.subchannelChildren.values())t.push(i);let r=[];for(let{ref:i}of this.socketChildren.values())r.push(i);return{channels:e,subchannels:t,sockets:r}}};Ae.ChannelzChildrenTracker=Fy;var Ly=class{constructor(){this.callsStarted=0,this.callsSucceeded=0,this.callsFailed=0,this.lastCallStartedTimestamp=null}addCallStarted(){this.callsStarted+=1,this.lastCallStartedTimestamp=new Date}addCallSucceeded(){this.callsSucceeded+=1}addCallFailed(){this.callsFailed+=1}};Ae.ChannelzCallTracker=Ly;var q2=1;function Xd(){return q2++}var Ll=[],Vy=[],ui=[],qy=[];function U2(n,e,t){let r=Xd(),i={id:r,name:n,kind:"channel"};return t&&(Ll[r]={ref:i,getInfo:e}),i}Ae.registerChannelzChannel=U2;function z2(n,e,t){let r=Xd(),i={id:r,name:n,kind:"subchannel"};return t&&(Vy[r]={ref:i,getInfo:e}),i}Ae.registerChannelzSubchannel=z2;function j2(n,e){let t=Xd(),r={id:t,kind:"server"};return e&&(ui[t]={ref:r,getInfo:n}),r}Ae.registerChannelzServer=j2;function G2(n,e,t){let r=Xd(),i={id:r,name:n,kind:"socket"};return t&&(qy[r]={ref:i,getInfo:e}),i}Ae.registerChannelzSocket=G2;function H2(n){switch(n.kind){case"channel":delete Ll[n.id];return;case"subchannel":delete Vy[n.id];return;case"server":delete ui[n.id];return;case"socket":delete qy[n.id];return}}Ae.unregisterChannelzRef=H2;function K2(n){let e=Number.parseInt(n,16);return[e/256|0,e%256]}function pI(n){if(n==="")return[];let e=n.split(":").map(r=>K2(r));return[].concat(...e)}function W2(n){if((0,hI.isIPv4)(n))return Buffer.from(Uint8Array.from(n.split(".").map(e=>Number.parseInt(e))));if((0,hI.isIPv6)(n)){let e,t,r=n.indexOf("::");r===-1?(e=n,t=""):(e=n.substring(0,r),t=n.substring(r+2));let i=Buffer.from(pI(e)),s=Buffer.from(pI(t)),o=Buffer.alloc(16-i.length-s.length,0);return Buffer.concat([i,o,s])}else return null}function mI(n){switch(n){case Fl.ConnectivityState.CONNECTING:return{state:"CONNECTING"};case Fl.ConnectivityState.IDLE:return{state:"IDLE"};case Fl.ConnectivityState.READY:return{state:"READY"};case Fl.ConnectivityState.SHUTDOWN:return{state:"SHUTDOWN"};case Fl.ConnectivityState.TRANSIENT_FAILURE:return{state:"TRANSIENT_FAILURE"};default:return{state:"UNKNOWN"}}}function Cr(n){if(!n)return null;let e=n.getTime();return{seconds:e/1e3|0,nanos:e%1e3*1e6}}function yI(n){let e=n.getInfo();return{ref:xy(n.ref),data:{target:e.target,state:mI(e.state),calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Cr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},channel_ref:e.children.channels.map(t=>xy(t)),subchannel_ref:e.children.subchannels.map(t=>By(t))}}function $2(n,e){let t=Number.parseInt(n.request.channel_id),r=Ll[t];if(r===void 0){e({code:Bl.Status.NOT_FOUND,details:"No channel data found for id "+t});return}e(null,{channel:yI(r)})}function Q2(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_channel_id);for(;i<Ll.length;i++){let s=Ll[i];if(s!==void 0&&(r.push(yI(s)),r.length>=t))break}e(null,{channel:r,end:i>=ui.length})}function vI(n){let e=n.getInfo();return{ref:V2(n.ref),data:{calls_started:e.callTracker.callsStarted,calls_succeeded:e.callTracker.callsSucceeded,calls_failed:e.callTracker.callsFailed,last_call_started_timestamp:Cr(e.callTracker.lastCallStartedTimestamp),trace:e.trace.getTraceMessage()},listen_socket:e.listenerChildren.sockets.map(t=>Yd(t))}}function Y2(n,e){let t=Number.parseInt(n.request.server_id),r=ui[t];if(r===void 0){e({code:Bl.Status.NOT_FOUND,details:"No server data found for id "+t});return}e(null,{server:vI(r)})}function X2(n,e){let t=Number.parseInt(n.request.max_results),r=[],i=Number.parseInt(n.request.start_server_id);for(;i<ui.length;i++){let s=ui[i];if(s!==void 0&&(r.push(vI(s)),r.length>=t))break}e(null,{server:r,end:i>=ui.length})}function J2(n,e){let t=Number.parseInt(n.request.subchannel_id),r=Vy[t];if(r===void 0){e({code:Bl.Status.NOT_FOUND,details:"No subchannel data found for id "+t});return}let i=r.getInfo(),s={ref:By(r.ref),data:{target:i.target,state:mI(i.state),calls_started:i.callTracker.callsStarted,calls_succeeded:i.callTracker.callsSucceeded,calls_failed:i.callTracker.callsFailed,last_call_started_timestamp:Cr(i.callTracker.lastCallStartedTimestamp),trace:i.trace.getTraceMessage()},socket_ref:i.children.sockets.map(o=>Yd(o))};e(null,{subchannel:s})}function gI(n){var e;return(0,F2.isTcpSubchannelAddress)(n)?{address:"tcpip_address",tcpip_address:{ip_address:(e=W2(n.host))!==null&&e!==void 0?e:void 0,port:n.port}}:{address:"uds_address",uds_address:{filename:n.path}}}function Z2(n,e){var t,r,i,s,o;let a=Number.parseInt(n.request.socket_id),l=qy[a];if(l===void 0){e({code:Bl.Status.NOT_FOUND,details:"No socket data found for id "+a});return}let c=l.getInfo(),u=c.security?{model:"tls",tls:{cipher_suite:c.security.cipherSuiteStandardName?"standard_name":"other_name",standard_name:(t=c.security.cipherSuiteStandardName)!==null&&t!==void 0?t:void 0,other_name:(r=c.security.cipherSuiteOtherName)!==null&&r!==void 0?r:void 0,local_certificate:(i=c.security.localCertificate)!==null&&i!==void 0?i:void 0,remote_certificate:(s=c.security.remoteCertificate)!==null&&s!==void 0?s:void 0}}:null,d={ref:Yd(l.ref),local:c.localAddress?gI(c.localAddress):null,remote:c.remoteAddress?gI(c.remoteAddress):null,remote_name:(o=c.remoteName)!==null&&o!==void 0?o:void 0,security:u,data:{keep_alives_sent:c.keepAlivesSent,streams_started:c.streamsStarted,streams_succeeded:c.streamsSucceeded,streams_failed:c.streamsFailed,last_local_stream_created_timestamp:Cr(c.lastLocalStreamCreatedTimestamp),last_remote_stream_created_timestamp:Cr(c.lastRemoteStreamCreatedTimestamp),messages_received:c.messagesReceived,messages_sent:c.messagesSent,last_message_received_timestamp:Cr(c.lastMessageReceivedTimestamp),last_message_sent_timestamp:Cr(c.lastMessageSentTimestamp),local_flow_control_window:c.localFlowControlWindow?{value:c.localFlowControlWindow}:null,remote_flow_control_window:c.remoteFlowControlWindow?{value:c.remoteFlowControlWindow}:null}};e(null,{socket:d})}function eB(n,e){let t=Number.parseInt(n.request.server_id),r=ui[t];if(r===void 0){e({code:Bl.Status.NOT_FOUND,details:"No server data found for id "+t});return}let i=Number.parseInt(n.request.start_socket_id),s=Number.parseInt(n.request.max_results),a=r.getInfo().sessionChildren.sockets.sort((u,d)=>u.id-d.id),l=[],c=0;for(;c<a.length&&!(a[c].id>=i&&(l.push(Yd(a[c])),l.length>=s));c++);e(null,{socket_ref:l,end:c>=a.length})}function _I(){return{GetChannel:$2,GetTopChannels:Q2,GetServer:Y2,GetServers:X2,GetSubchannel:J2,GetSocket:Z2,GetServerSockets:eB}}Ae.getChannelzHandlers=_I;var Qd=null;function SI(){if(Qd)return Qd;let n=Oy().loadSync,e=n("channelz.proto",{keepCase:!0,longs:String,enums:String,defaults:!0,oneofs:!0,includeDirs:[`${__dirname}/../../proto`]});return Qd=(0,B2.loadPackageDefinition)(e).grpc.channelz.v1.Channelz.service,Qd}Ae.getChannelzServiceDefinition=SI;function tB(){(0,L2.registerAdminService)(SI,_I)}Ae.setup=tB});var wI=w(Zd=>{"use strict";Object.defineProperty(Zd,"__esModule",{value:!0});Zd.Subchannel=void 0;var Se=rn(),nB=yl(),Uy=Le(),Jd=le(),rB=Wt(),iB=Gn(),Ro=os(),sB="subchannel",oB=~(1<<31),zy=class{constructor(e,t,r,i,s){var o;this.channelTarget=e,this.subchannelAddress=t,this.options=r,this.credentials=i,this.connector=s,this.connectivityState=Se.ConnectivityState.IDLE,this.transport=null,this.continueConnecting=!1,this.stateListeners=new Set,this.refcount=0,this.channelzEnabled=!0,this.callTracker=new Ro.ChannelzCallTracker,this.childrenTracker=new Ro.ChannelzChildrenTracker,this.streamTracker=new Ro.ChannelzCallTracker;let a={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoffTimeout=new nB.BackoffTimeout(()=>{this.handleBackoffTimer()},a),this.backoffTimeout.unref(),this.subchannelAddressString=(0,iB.subchannelAddressToString)(t),this.keepaliveTime=(o=r["grpc.keepalive_time_ms"])!==null&&o!==void 0?o:-1,r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Ro.ChannelzTrace,this.channelzRef=(0,Ro.registerChannelzSubchannel)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Subchannel created"),this.trace("Subchannel constructed with options "+JSON.stringify(r,void 0,2))}getChannelzInfo(){return{state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists(),target:this.subchannelAddressString}}trace(e){Uy.trace(Jd.LogVerbosity.DEBUG,sB,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}refTrace(e){Uy.trace(Jd.LogVerbosity.DEBUG,"subchannel_refcount","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}handleBackoffTimer(){this.continueConnecting?this.transitionToState([Se.ConnectivityState.TRANSIENT_FAILURE],Se.ConnectivityState.CONNECTING):this.transitionToState([Se.ConnectivityState.TRANSIENT_FAILURE],Se.ConnectivityState.IDLE)}startBackoff(){this.backoffTimeout.runOnce()}stopBackoff(){this.backoffTimeout.stop(),this.backoffTimeout.reset()}startConnectingInternal(){let e=this.options;if(e["grpc.keepalive_time_ms"]){let t=Math.min(this.keepaliveTime,oB);e=Object.assign(Object.assign({},e),{"grpc.keepalive_time_ms":t})}this.connector.connect(this.subchannelAddress,this.credentials,e).then(t=>{this.transitionToState([Se.ConnectivityState.CONNECTING],Se.ConnectivityState.READY)&&(this.transport=t,this.channelzEnabled&&this.childrenTracker.refChild(t.getChannelzRef()),t.addDisconnectListener(r=>{this.transitionToState([Se.ConnectivityState.READY],Se.ConnectivityState.IDLE),r&&this.keepaliveTime>0&&(this.keepaliveTime*=2,Uy.log(Jd.LogVerbosity.ERROR,`Connection to ${(0,rB.uriToString)(this.channelTarget)} at ${this.subchannelAddressString} rejected by server because of excess pings. Increasing ping interval to ${this.keepaliveTime} ms`))}))},t=>{this.transitionToState([Se.ConnectivityState.CONNECTING],Se.ConnectivityState.TRANSIENT_FAILURE,`${t}`)})}transitionToState(e,t,r){var i,s;if(e.indexOf(this.connectivityState)===-1)return!1;this.trace(Se.ConnectivityState[this.connectivityState]+" -> "+Se.ConnectivityState[t]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+Se.ConnectivityState[t]);let o=this.connectivityState;switch(this.connectivityState=t,t){case Se.ConnectivityState.READY:this.stopBackoff();break;case Se.ConnectivityState.CONNECTING:this.startBackoff(),this.startConnectingInternal(),this.continueConnecting=!1;break;case Se.ConnectivityState.TRANSIENT_FAILURE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(i=this.transport)===null||i===void 0||i.shutdown(),this.transport=null,this.backoffTimeout.isRunning()||process.nextTick(()=>{this.handleBackoffTimer()});break;case Se.ConnectivityState.IDLE:this.channelzEnabled&&this.transport&&this.childrenTracker.unrefChild(this.transport.getChannelzRef()),(s=this.transport)===null||s===void 0||s.shutdown(),this.transport=null;break;default:throw new Error(`Invalid state: unknown ConnectivityState ${t}`)}for(let a of this.stateListeners)a(this,o,t,this.keepaliveTime,r);return!0}ref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount+1)),this.refcount+=1}unref(){this.refTrace("refcount "+this.refcount+" -> "+(this.refcount-1)),this.refcount-=1,this.refcount===0&&(this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Shutting down"),this.channelzEnabled&&(0,Ro.unregisterChannelzRef)(this.channelzRef),process.nextTick(()=>{this.transitionToState([Se.ConnectivityState.CONNECTING,Se.ConnectivityState.READY],Se.ConnectivityState.IDLE)}))}unrefIfOneRef(){return this.refcount===1?(this.unref(),!0):!1}createCall(e,t,r,i){if(!this.transport)throw new Error("Cannot create call, subchannel not READY");let s;return this.channelzEnabled?(this.callTracker.addCallStarted(),this.streamTracker.addCallStarted(),s={onCallEnd:o=>{o.code===Jd.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}}):s={},this.transport.createCall(e,t,r,i,s)}startConnecting(){process.nextTick(()=>{this.transitionToState([Se.ConnectivityState.IDLE],Se.ConnectivityState.CONNECTING)||this.connectivityState===Se.ConnectivityState.TRANSIENT_FAILURE&&(this.continueConnecting=!0)})}getConnectivityState(){return this.connectivityState}addConnectivityStateListener(e){this.stateListeners.add(e)}removeConnectivityStateListener(e){this.stateListeners.delete(e)}resetBackoff(){process.nextTick(()=>{this.backoffTimeout.reset(),this.transitionToState([Se.ConnectivityState.TRANSIENT_FAILURE],Se.ConnectivityState.CONNECTING)})}getAddress(){return this.subchannelAddressString}getChannelzRef(){return this.channelzRef}getRealSubchannel(){return this}realSubchannelEquals(e){return e.getRealSubchannel()===this}throttleKeepalive(e){e>this.keepaliveTime&&(this.keepaliveTime=e)}};Zd.Subchannel=zy});var Ky=w(fi=>{"use strict";Object.defineProperty(fi,"__esModule",{value:!0});fi.setup=fi.DEFAULT_PORT=void 0;var EI=zn(),CI=de("dns"),bI=de("util"),aB=rm(),jy=le(),Gy=Mt(),lB=Le(),cB=le(),di=Wt(),TI=de("net"),uB=yl(),dB="dns_resolver";function hi(n){lB.trace(cB.LogVerbosity.DEBUG,dB,n)}fi.DEFAULT_PORT=443;var hB=3e4,fB=bI.promisify(CI.resolveTxt),pB=bI.promisify(CI.lookup);function gB(...n){let e=[];for(let t=0;t<Math.max.apply(null,n.map(r=>r.length));t++)for(let r of n)t<r.length&&e.push(r[t]);return e}var Hy=class{constructor(e,t,r){var i,s,o;this.target=e,this.listener=t,this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.continueResolving=!1,this.isNextResolutionTimerRunning=!1,this.isServiceConfigEnabled=!0,this.returnedIpResult=!1,hi("Resolver constructed for target "+(0,di.uriToString)(e));let a=(0,di.splitHostPort)(e.path);a===null?(this.ipResult=null,this.dnsHostname=null,this.port=null):(0,TI.isIPv4)(a.host)||(0,TI.isIPv6)(a.host)?(this.ipResult=[{host:a.host,port:(i=a.port)!==null&&i!==void 0?i:fi.DEFAULT_PORT}],this.dnsHostname=null,this.port=null):(this.ipResult=null,this.dnsHostname=a.host,this.port=(s=a.port)!==null&&s!==void 0?s:fi.DEFAULT_PORT),this.percentage=Math.random()*100,r["grpc.service_config_disable_resolution"]===1&&(this.isServiceConfigEnabled=!1),this.defaultResolutionError={code:jy.Status.UNAVAILABLE,details:`Name resolution failed for target ${(0,di.uriToString)(this.target)}`,metadata:new Gy.Metadata};let l={initialDelay:r["grpc.initial_reconnect_backoff_ms"],maxDelay:r["grpc.max_reconnect_backoff_ms"]};this.backoff=new uB.BackoffTimeout(()=>{this.continueResolving&&this.startResolutionWithBackoff()},l),this.backoff.unref(),this.minTimeBetweenResolutionsMs=(o=r["grpc.dns_min_time_between_resolutions_ms"])!==null&&o!==void 0?o:hB,this.nextResolutionTimer=setTimeout(()=>{},0),clearTimeout(this.nextResolutionTimer)}startResolution(){if(this.ipResult!==null){this.returnedIpResult||(hi("Returning IP address for target "+(0,di.uriToString)(this.target)),setImmediate(()=>{this.listener.onSuccessfulResolution(this.ipResult,null,null,null,{})}),this.returnedIpResult=!0),this.backoff.stop(),this.backoff.reset(),this.stopNextResolutionTimer();return}if(this.dnsHostname===null)hi("Failed to parse DNS address "+(0,di.uriToString)(this.target)),setImmediate(()=>{this.listener.onError({code:jy.Status.UNAVAILABLE,details:`Failed to parse DNS address ${(0,di.uriToString)(this.target)}`,metadata:new Gy.Metadata})}),this.stopNextResolutionTimer();else{if(this.pendingLookupPromise!==null)return;hi("Looking up DNS hostname "+this.dnsHostname),this.latestLookupResult=null;let e=this.dnsHostname;this.pendingLookupPromise=pB(e,{all:!0}),this.pendingLookupPromise.then(t=>{if(this.pendingLookupPromise===null)return;this.pendingLookupPromise=null,this.backoff.reset(),this.backoff.stop();let r=t.filter(o=>o.family===4),i=t.filter(o=>o.family===6);this.latestLookupResult=gB(i,r).map(o=>({host:o.address,port:+this.port}));let s="["+this.latestLookupResult.map(o=>o.host+":"+o.port).join(",")+"]";if(hi("Resolved addresses for target "+(0,di.uriToString)(this.target)+": "+s),this.latestLookupResult.length===0){this.listener.onError(this.defaultResolutionError);return}this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})},t=>{this.pendingLookupPromise!==null&&(hi("Resolution error for target "+(0,di.uriToString)(this.target)+": "+t.message),this.pendingLookupPromise=null,this.stopNextResolutionTimer(),this.listener.onError(this.defaultResolutionError))}),this.isServiceConfigEnabled&&this.pendingTxtPromise===null&&(this.pendingTxtPromise=fB(e),this.pendingTxtPromise.then(t=>{if(this.pendingTxtPromise!==null){this.pendingTxtPromise=null;try{this.latestServiceConfig=(0,aB.extractAndSelectServiceConfig)(t,this.percentage)}catch(r){this.latestServiceConfigError={code:jy.Status.UNAVAILABLE,details:`Parsing service config failed with error ${r.message}`,metadata:new Gy.Metadata}}this.latestLookupResult!==null&&this.listener.onSuccessfulResolution(this.latestLookupResult,this.latestServiceConfig,this.latestServiceConfigError,null,{})}},t=>{}))}}startNextResolutionTimer(){var e,t;clearTimeout(this.nextResolutionTimer),this.nextResolutionTimer=(t=(e=setTimeout(()=>{this.stopNextResolutionTimer(),this.continueResolving&&this.startResolutionWithBackoff()},this.minTimeBetweenResolutionsMs)).unref)===null||t===void 0?void 0:t.call(e),this.isNextResolutionTimerRunning=!0}stopNextResolutionTimer(){clearTimeout(this.nextResolutionTimer),this.isNextResolutionTimerRunning=!1}startResolutionWithBackoff(){this.pendingLookupPromise===null&&(this.continueResolving=!1,this.backoff.runOnce(),this.startNextResolutionTimer(),this.startResolution())}updateResolution(){this.pendingLookupPromise===null&&(this.isNextResolutionTimerRunning||this.backoff.isRunning()?(this.isNextResolutionTimerRunning?hi('resolution update delayed by "min time between resolutions" rate limit'):hi("resolution update delayed by backoff timer until "+this.backoff.getEndTime().toISOString()),this.continueResolving=!0):this.startResolutionWithBackoff())}destroy(){this.continueResolving=!1,this.backoff.reset(),this.backoff.stop(),this.stopNextResolutionTimer(),this.pendingLookupPromise=null,this.pendingTxtPromise=null,this.latestLookupResult=null,this.latestServiceConfig=null,this.latestServiceConfigError=null,this.returnedIpResult=!1}static getDefaultAuthority(e){return e.path}};function mB(){(0,EI.registerResolver)("dns",Hy),(0,EI.registerDefaultScheme)("dns")}fi.setup=mB});var Wy=w(Mo=>{"use strict";Object.defineProperty(Mo,"__esModule",{value:!0});Mo.getProxiedConnection=Mo.mapProxyName=void 0;var Vl=Le(),No=le(),yB=zn(),vB=de("http"),_B=de("tls"),SB=Le(),AI=Gn(),ko=Wt(),wB=de("url"),EB=Ky(),TB="proxy";function pi(n){SB.trace(No.LogVerbosity.DEBUG,TB,n)}function CB(){let n="",e="";if(process.env.grpc_proxy)e="grpc_proxy",n=process.env.grpc_proxy;else if(process.env.https_proxy)e="https_proxy",n=process.env.https_proxy;else if(process.env.http_proxy)e="http_proxy",n=process.env.http_proxy;else return{};let t;try{t=new wB.URL(n)}catch{return(0,Vl.log)(No.LogVerbosity.ERROR,`cannot parse value of "${e}" env var`),{}}if(t.protocol!=="http:")return(0,Vl.log)(No.LogVerbosity.ERROR,`"${t.protocol}" scheme not supported in proxy URI`),{};let r=null;t.username&&(t.password?((0,Vl.log)(No.LogVerbosity.INFO,"userinfo found in proxy URI"),r=`${t.username}:${t.password}`):r=t.username);let i=t.hostname,s=t.port;s===""&&(s="80");let o={address:`${i}:${s}`};return r&&(o.creds=r),pi("Proxy server "+o.address+" set by environment variable "+e),o}function bB(){let n=process.env.no_grpc_proxy,e="no_grpc_proxy";return n||(n=process.env.no_proxy,e="no_proxy"),n?(pi("No proxy server list set by environment variable "+e),n.split(",")):[]}function AB(n,e){var t;let r={target:n,extraOptions:{}};if(((t=e["grpc.enable_http_proxy"])!==null&&t!==void 0?t:1)===0||n.scheme==="unix")return r;let i=CB();if(!i.address)return r;let s=(0,ko.splitHostPort)(n.path);if(!s)return r;let o=s.host;for(let l of bB())if(l===o)return pi("Not using proxy for target in no_proxy list: "+(0,ko.uriToString)(n)),r;let a={"grpc.http_connect_target":(0,ko.uriToString)(n)};return i.creds&&(a["grpc.http_connect_creds"]=i.creds),{target:{scheme:"dns",path:i.address},extraOptions:a}}Mo.mapProxyName=AB;function IB(n,e,t){var r;if(!("grpc.http_connect_target"in e))return Promise.resolve({});let i=e["grpc.http_connect_target"],s=(0,ko.parseUri)(i);if(s===null)return Promise.resolve({});let o=(0,ko.splitHostPort)(s.path);if(o===null)return Promise.resolve({});let a=`${o.host}:${(r=o.port)!==null&&r!==void 0?r:EB.DEFAULT_PORT}`,l={method:"CONNECT",path:a},c={Host:a};(0,AI.isTcpSubchannelAddress)(n)?(l.host=n.host,l.port=n.port):l.socketPath=n.path,"grpc.http_connect_creds"in e&&(c["Proxy-Authorization"]="Basic "+Buffer.from(e["grpc.http_connect_creds"]).toString("base64")),l.headers=c;let u=(0,AI.subchannelAddressToString)(n);return pi("Using proxy "+u+" to connect to "+l.path),new Promise((d,h)=>{let p=vB.request(l);p.once("connect",(y,_,S)=>{var R;if(p.removeAllListeners(),_.removeAllListeners(),y.statusCode===200)if(pi("Successfully connected to "+l.path+" through proxy "+u),"secureContext"in t){let E=(0,yB.getDefaultAuthority)(s),N=(0,ko.splitHostPort)(E),k=(R=N?.host)!==null&&R!==void 0?R:E,V=_B.connect(Object.assign({host:k,servername:k,socket:_},t),()=>{pi("Successfully established a TLS connection to "+l.path+" through proxy "+u),d({socket:V,realTarget:s})});V.on("error",W=>{pi("Failed to establish a TLS connection to "+l.path+" through proxy "+u+" with error "+W.message),h()})}else pi("Successfully established a plaintext connection to "+l.path+" through proxy "+u),d({socket:_,realTarget:s});else(0,Vl.log)(No.LogVerbosity.ERROR,"Failed to connect to "+l.path+" through proxy "+u+" with status "+y.statusCode),h()}),p.once("error",y=>{p.removeAllListeners(),(0,Vl.log)(No.LogVerbosity.ERROR,"Failed to connect to proxy "+u+" with error "+y.message),h()}),p.end()})}Mo.getProxiedConnection=IB});var Qy=w(eh=>{"use strict";Object.defineProperty(eh,"__esModule",{value:!0});eh.StreamDecoder=void 0;var br=function(n){return n[n.NO_DATA=0]="NO_DATA",n[n.READING_SIZE=1]="READING_SIZE",n[n.READING_MESSAGE=2]="READING_MESSAGE",n}(br||{}),$y=class{constructor(){this.readState=br.NO_DATA,this.readCompressFlag=Buffer.alloc(1),this.readPartialSize=Buffer.alloc(4),this.readSizeRemaining=4,this.readMessageSize=0,this.readPartialMessage=[],this.readMessageRemaining=0}write(e){let t=0,r,i=[];for(;t<e.length;)switch(this.readState){case br.NO_DATA:this.readCompressFlag=e.slice(t,t+1),t+=1,this.readState=br.READING_SIZE,this.readPartialSize.fill(0),this.readSizeRemaining=4,this.readMessageSize=0,this.readMessageRemaining=0,this.readPartialMessage=[];break;case br.READING_SIZE:if(r=Math.min(e.length-t,this.readSizeRemaining),e.copy(this.readPartialSize,4-this.readSizeRemaining,t,t+r),this.readSizeRemaining-=r,t+=r,this.readSizeRemaining===0)if(this.readMessageSize=this.readPartialSize.readUInt32BE(0),this.readMessageRemaining=this.readMessageSize,this.readMessageRemaining>0)this.readState=br.READING_MESSAGE;else{let s=Buffer.concat([this.readCompressFlag,this.readPartialSize],5);this.readState=br.NO_DATA,i.push(s)}break;case br.READING_MESSAGE:if(r=Math.min(e.length-t,this.readMessageRemaining),this.readPartialMessage.push(e.slice(t,t+r)),this.readMessageRemaining-=r,t+=r,this.readMessageRemaining===0){let s=[this.readCompressFlag,this.readPartialSize].concat(this.readPartialMessage),o=Buffer.concat(s,this.readMessageSize+5);this.readState=br.NO_DATA,i.push(o)}break;default:throw new Error("Unexpected read state")}return i}};eh.StreamDecoder=$y});var II=w(th=>{"use strict";Object.defineProperty(th,"__esModule",{value:!0});th.Http2SubchannelCall=void 0;var Ar=de("http2"),DB=de("os"),me=le(),gi=Mt(),RB=Qy(),NB=Le(),kB=le(),MB="subchannel_call";function OB(n){for(let[e,t]of Object.entries(DB.constants.errno))if(t===n)return e;return"Unknown system error "+n}var Yy=class{constructor(e,t,r,i,s){this.http2Stream=e,this.callEventTracker=t,this.listener=r,this.transport=i,this.callId=s,this.decoder=new RB.StreamDecoder,this.isReadFilterPending=!1,this.isPushPending=!1,this.canPush=!1,this.readsClosed=!1,this.statusOutput=!1,this.unpushedReadMessages=[],this.mappedStatusCode=me.Status.UNKNOWN,this.finalStatus=null,this.internalError=null,e.on("response",(o,a)=>{let l="";for(let c of Object.keys(o))l+="		"+c+": "+o[c]+`
`;switch(this.trace(`Received server headers:
`+l),o[":status"]){case 400:this.mappedStatusCode=me.Status.INTERNAL;break;case 401:this.mappedStatusCode=me.Status.UNAUTHENTICATED;break;case 403:this.mappedStatusCode=me.Status.PERMISSION_DENIED;break;case 404:this.mappedStatusCode=me.Status.UNIMPLEMENTED;break;case 429:case 502:case 503:case 504:this.mappedStatusCode=me.Status.UNAVAILABLE;break;default:this.mappedStatusCode=me.Status.UNKNOWN}if(a&Ar.constants.NGHTTP2_FLAG_END_STREAM)this.handleTrailers(o);else{let c;try{c=gi.Metadata.fromHttp2Headers(o)}catch(u){this.endCall({code:me.Status.UNKNOWN,details:u.message,metadata:new gi.Metadata});return}this.listener.onReceiveMetadata(c)}}),e.on("trailers",o=>{this.handleTrailers(o)}),e.on("data",o=>{if(this.statusOutput)return;this.trace("receive HTTP/2 data frame of length "+o.length);let a=this.decoder.write(o);for(let l of a)this.trace("parsed message of length "+l.length),this.callEventTracker.addMessageReceived(),this.tryPush(l)}),e.on("end",()=>{this.readsClosed=!0,this.maybeOutputStatus()}),e.on("close",()=>{process.nextTick(()=>{var o;if(this.trace("HTTP/2 stream closed with code "+e.rstCode),((o=this.finalStatus)===null||o===void 0?void 0:o.code)===me.Status.OK)return;let a,l="";switch(e.rstCode){case Ar.constants.NGHTTP2_NO_ERROR:if(this.finalStatus!==null)return;a=me.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`;break;case Ar.constants.NGHTTP2_REFUSED_STREAM:a=me.Status.UNAVAILABLE,l="Stream refused by server";break;case Ar.constants.NGHTTP2_CANCEL:a=me.Status.CANCELLED,l="Call cancelled";break;case Ar.constants.NGHTTP2_ENHANCE_YOUR_CALM:a=me.Status.RESOURCE_EXHAUSTED,l="Bandwidth exhausted or memory limit exceeded";break;case Ar.constants.NGHTTP2_INADEQUATE_SECURITY:a=me.Status.PERMISSION_DENIED,l="Protocol not secure enough";break;case Ar.constants.NGHTTP2_INTERNAL_ERROR:a=me.Status.INTERNAL,this.internalError===null?l=`Received RST_STREAM with code ${e.rstCode} (Internal server error)`:this.internalError.code==="ECONNRESET"||this.internalError.code==="ETIMEDOUT"?(a=me.Status.UNAVAILABLE,l=this.internalError.message):l=`Received RST_STREAM with code ${e.rstCode} triggered by internal client error: ${this.internalError.message}`;break;default:a=me.Status.INTERNAL,l=`Received RST_STREAM with code ${e.rstCode}`}this.endCall({code:a,details:l,metadata:new gi.Metadata,rstCode:e.rstCode})})}),e.on("error",o=>{o.code!=="ERR_HTTP2_STREAM_ERROR"&&(this.trace("Node error event: message="+o.message+" code="+o.code+" errno="+OB(o.errno)+" syscall="+o.syscall),this.internalError=o),this.callEventTracker.onStreamEnd(!1)})}onDisconnect(){this.endCall({code:me.Status.UNAVAILABLE,details:"Connection dropped",metadata:new gi.Metadata})}outputStatus(){this.statusOutput||(this.statusOutput=!0,this.trace("ended with status: code="+this.finalStatus.code+' details="'+this.finalStatus.details+'"'),this.callEventTracker.onCallEnd(this.finalStatus),process.nextTick(()=>{this.listener.onReceiveStatus(this.finalStatus)}),this.http2Stream.resume())}trace(e){NB.trace(kB.LogVerbosity.DEBUG,MB,"["+this.callId+"] "+e)}endCall(e){(this.finalStatus===null||this.finalStatus.code===me.Status.OK)&&(this.finalStatus=e,this.maybeOutputStatus()),this.destroyHttp2Stream()}maybeOutputStatus(){this.finalStatus!==null&&(this.finalStatus.code!==me.Status.OK||this.readsClosed&&this.unpushedReadMessages.length===0&&!this.isReadFilterPending&&!this.isPushPending)&&this.outputStatus()}push(e){this.trace("pushing to reader message of length "+(e instanceof Buffer?e.length:null)),this.canPush=!1,this.isPushPending=!0,process.nextTick(()=>{this.isPushPending=!1,!this.statusOutput&&(this.listener.onReceiveMessage(e),this.maybeOutputStatus())})}tryPush(e){this.canPush?(this.http2Stream.pause(),this.push(e)):(this.trace("unpushedReadMessages.push message of length "+e.length),this.unpushedReadMessages.push(e))}handleTrailers(e){this.callEventTracker.onStreamEnd(!0);let t="";for(let l of Object.keys(e))t+="		"+l+": "+e[l]+`
`;this.trace(`Received server trailers:
`+t);let r;try{r=gi.Metadata.fromHttp2Headers(e)}catch{r=new gi.Metadata}let i=r.getMap(),s=this.mappedStatusCode;if(s===me.Status.UNKNOWN&&typeof i["grpc-status"]=="string"){let l=Number(i["grpc-status"]);l in me.Status&&(s=l,this.trace("received status code "+l+" from server")),r.remove("grpc-status")}let o="";if(typeof i["grpc-message"]=="string"){try{o=decodeURI(i["grpc-message"])}catch{o=i["grpc-message"]}r.remove("grpc-message"),this.trace('received status details string "'+o+'" from server')}let a={code:s,details:o,metadata:r};this.endCall(a)}destroyHttp2Stream(){var e;if(!this.http2Stream.destroyed){let t;((e=this.finalStatus)===null||e===void 0?void 0:e.code)===me.Status.OK?t=Ar.constants.NGHTTP2_NO_ERROR:t=Ar.constants.NGHTTP2_CANCEL,this.trace("close http2 stream with code "+t),this.http2Stream.close(t)}}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.endCall({code:e,details:t,metadata:new gi.Metadata})}getStatus(){return this.finalStatus}getPeer(){return this.transport.getPeerName()}getCallNumber(){return this.callId}startRead(){if(this.finalStatus!==null&&this.finalStatus.code!==me.Status.OK){this.readsClosed=!0,this.maybeOutputStatus();return}if(this.canPush=!0,this.unpushedReadMessages.length>0){let e=this.unpushedReadMessages.shift();this.push(e);return}this.http2Stream.resume()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length);let r=i=>{process.nextTick(()=>{var s;let o=me.Status.UNAVAILABLE;i?.code==="ERR_STREAM_WRITE_AFTER_END"&&(o=me.Status.INTERNAL),i&&this.cancelWithStatus(o,`Write error: ${i.message}`),(s=e.callback)===null||s===void 0||s.call(e)})};this.trace("sending data chunk of length "+t.length),this.callEventTracker.addMessageSent();try{this.http2Stream.write(t,r)}catch(i){this.endCall({code:me.Status.UNAVAILABLE,details:`Write failed with error ${i.message}`,metadata:new gi.Metadata})}}halfClose(){this.trace("end() called"),this.trace("calling end() on HTTP/2 stream"),this.http2Stream.end()}};th.Http2SubchannelCall=Yy});var Xy=w(nh=>{"use strict";Object.defineProperty(nh,"__esModule",{value:!0});nh.getNextCallNumber=void 0;var xB=0;function PB(){return xB++}nh.getNextCallNumber=PB});var NI=w(ih=>{"use strict";Object.defineProperty(ih,"__esModule",{value:!0});ih.Http2SubchannelConnector=void 0;var nv=de("http2"),DI=de("tls"),Jy=os(),ql=le(),FB=Wy(),xo=Le(),RI=zn(),rh=Gn(),Oo=Wt(),LB=de("net"),BB=II(),VB=Xy(),Zy="transport",qB="transport_flowctrl",UB=Vg().version,{HTTP2_HEADER_AUTHORITY:zB,HTTP2_HEADER_CONTENT_TYPE:jB,HTTP2_HEADER_METHOD:GB,HTTP2_HEADER_PATH:HB,HTTP2_HEADER_TE:KB,HTTP2_HEADER_USER_AGENT:WB}=nv.constants,$B=2e4,QB=Buffer.from("too_many_pings","ascii"),ev=class{constructor(e,t,r,i){this.session=e,this.remoteName=i,this.keepaliveTimeMs=-1,this.keepaliveTimeoutMs=$B,this.keepaliveTimerId=null,this.pendingSendKeepalivePing=!1,this.keepaliveTimeoutId=null,this.keepaliveWithoutCalls=!1,this.activeCalls=new Set,this.disconnectListeners=[],this.disconnectHandled=!1,this.channelzEnabled=!0,this.streamTracker=new Jy.ChannelzCallTracker,this.keepalivesSent=0,this.messagesSent=0,this.messagesReceived=0,this.lastMessageSentTimestamp=null,this.lastMessageReceivedTimestamp=null,this.subchannelAddressString=(0,rh.subchannelAddressToString)(t),r["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,Jy.registerChannelzSocket)(this.subchannelAddressString,()=>this.getChannelzInfo(),this.channelzEnabled),this.userAgent=[r["grpc.primary_user_agent"],`grpc-node-js/${UB}`,r["grpc.secondary_user_agent"]].filter(s=>s).join(" "),"grpc.keepalive_time_ms"in r&&(this.keepaliveTimeMs=r["grpc.keepalive_time_ms"]),"grpc.keepalive_timeout_ms"in r&&(this.keepaliveTimeoutMs=r["grpc.keepalive_timeout_ms"]),"grpc.keepalive_permit_without_calls"in r?this.keepaliveWithoutCalls=r["grpc.keepalive_permit_without_calls"]===1:this.keepaliveWithoutCalls=!1,e.once("close",()=>{this.trace("session closed"),this.stopKeepalivePings(),this.handleDisconnect()}),e.once("goaway",(s,o,a)=>{let l=!1;s===nv.constants.NGHTTP2_ENHANCE_YOUR_CALM&&a&&a.equals(QB)&&(l=!0),this.trace("connection closed by GOAWAY with code "+s+" and data "+a?.toString()),this.reportDisconnectToOwner(l)}),e.once("error",s=>{this.trace("connection closed with error "+s.message)}),xo.isTracerEnabled(Zy)&&(e.on("remoteSettings",s=>{this.trace("new settings received"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))}),e.on("localSettings",s=>{this.trace("local settings acknowledged by remote"+(this.session!==e?" on the old connection":"")+": "+JSON.stringify(s))})),this.keepaliveWithoutCalls&&this.maybeStartKeepalivePingTimer()}getChannelzInfo(){var e,t,r;let i=this.session.socket,s=i.remoteAddress?(0,rh.stringToSubchannelAddress)(i.remoteAddress,i.remotePort):null,o=i.localAddress?(0,rh.stringToSubchannelAddress)(i.localAddress,i.localPort):null,a;if(this.session.encrypted){let c=i,u=c.getCipher(),d=c.getCertificate(),h=c.getPeerCertificate();a={cipherSuiteStandardName:(e=u.standardName)!==null&&e!==void 0?e:null,cipherSuiteOtherName:u.standardName?null:u.name,localCertificate:d&&"raw"in d?d.raw:null,remoteCertificate:h&&"raw"in h?h.raw:null}}else a=null;return{remoteAddress:s,localAddress:o,security:a,remoteName:this.remoteName,streamsStarted:this.streamTracker.callsStarted,streamsSucceeded:this.streamTracker.callsSucceeded,streamsFailed:this.streamTracker.callsFailed,messagesSent:this.messagesSent,messagesReceived:this.messagesReceived,keepAlivesSent:this.keepalivesSent,lastLocalStreamCreatedTimestamp:this.streamTracker.lastCallStartedTimestamp,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:this.lastMessageSentTimestamp,lastMessageReceivedTimestamp:this.lastMessageReceivedTimestamp,localFlowControlWindow:(t=this.session.state.localWindowSize)!==null&&t!==void 0?t:null,remoteFlowControlWindow:(r=this.session.state.remoteWindowSize)!==null&&r!==void 0?r:null}}trace(e){xo.trace(ql.LogVerbosity.DEBUG,Zy,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}keepaliveTrace(e){xo.trace(ql.LogVerbosity.DEBUG,"keepalive","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}flowControlTrace(e){xo.trace(ql.LogVerbosity.DEBUG,qB,"("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}internalsTrace(e){xo.trace(ql.LogVerbosity.DEBUG,"transport_internals","("+this.channelzRef.id+") "+this.subchannelAddressString+" "+e)}reportDisconnectToOwner(e){this.disconnectHandled||(this.disconnectHandled=!0,this.disconnectListeners.forEach(t=>t(e)))}handleDisconnect(){this.reportDisconnectToOwner(!1),setImmediate(()=>{for(let e of this.activeCalls)e.onDisconnect()})}addDisconnectListener(e){this.disconnectListeners.push(e)}clearKeepaliveTimer(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null)}clearKeepaliveTimeout(){this.keepaliveTimeoutId&&(clearTimeout(this.keepaliveTimeoutId),this.keepaliveTimeoutId=null)}canSendPing(){return this.keepaliveTimeMs>0&&(this.keepaliveWithoutCalls||this.activeCalls.size>0)}maybeSendPing(){var e,t;if(this.clearKeepaliveTimer(),!this.canSendPing()){this.pendingSendKeepalivePing=!0;return}this.channelzEnabled&&(this.keepalivesSent+=1),this.keepaliveTrace("Sending ping with timeout "+this.keepaliveTimeoutMs+"ms"),this.keepaliveTimeoutId||(this.keepaliveTimeoutId=setTimeout(()=>{this.keepaliveTrace("Ping timeout passed without response"),this.handleDisconnect()},this.keepaliveTimeoutMs),(t=(e=this.keepaliveTimeoutId).unref)===null||t===void 0||t.call(e));try{this.session.ping((r,i,s)=>{r&&(this.keepaliveTrace("Ping failed with error "+r.message),this.handleDisconnect()),this.keepaliveTrace("Received ping response"),this.clearKeepaliveTimeout(),this.maybeStartKeepalivePingTimer()})}catch{this.handleDisconnect()}}maybeStartKeepalivePingTimer(){var e,t;this.canSendPing()&&(this.pendingSendKeepalivePing?(this.pendingSendKeepalivePing=!1,this.maybeSendPing()):!this.keepaliveTimerId&&!this.keepaliveTimeoutId&&(this.keepaliveTrace("Starting keepalive timer for "+this.keepaliveTimeMs+"ms"),this.keepaliveTimerId=(t=(e=setTimeout(()=>{this.maybeSendPing()},this.keepaliveTimeMs)).unref)===null||t===void 0?void 0:t.call(e)))}stopKeepalivePings(){this.keepaliveTimerId&&(clearTimeout(this.keepaliveTimerId),this.keepaliveTimerId=null),this.clearKeepaliveTimeout()}removeActiveCall(e){this.activeCalls.delete(e),this.activeCalls.size===0&&this.session.unref()}addActiveCall(e){this.activeCalls.add(e),this.activeCalls.size===1&&(this.session.ref(),this.keepaliveWithoutCalls||this.maybeStartKeepalivePingTimer())}createCall(e,t,r,i,s){let o=e.toHttp2Headers();o[zB]=t,o[WB]=this.userAgent,o[jB]="application/grpc",o[GB]="POST",o[HB]=r,o[KB]="trailers";let a;try{a=this.session.request(o)}catch(u){throw this.handleDisconnect(),u}this.flowControlTrace("local window size: "+this.session.state.localWindowSize+" remote window size: "+this.session.state.remoteWindowSize),this.internalsTrace("session.closed="+this.session.closed+" session.destroyed="+this.session.destroyed+" session.socket.destroyed="+this.session.socket.destroyed);let l,c;return this.channelzEnabled?(this.streamTracker.addCallStarted(),l={addMessageSent:()=>{var u;this.messagesSent+=1,this.lastMessageSentTimestamp=new Date,(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;this.messagesReceived+=1,this.lastMessageReceivedTimestamp=new Date,(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;u?this.streamTracker.addCallSucceeded():this.streamTracker.addCallFailed(),(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}}):l={addMessageSent:()=>{var u;(u=s.addMessageSent)===null||u===void 0||u.call(s)},addMessageReceived:()=>{var u;(u=s.addMessageReceived)===null||u===void 0||u.call(s)},onCallEnd:u=>{var d;(d=s.onCallEnd)===null||d===void 0||d.call(s,u),this.removeActiveCall(c)},onStreamEnd:u=>{var d;(d=s.onStreamEnd)===null||d===void 0||d.call(s,u)}},c=new BB.Http2SubchannelCall(a,l,i,this,(0,VB.getNextCallNumber)()),this.addActiveCall(c),c}getChannelzRef(){return this.channelzRef}getPeerName(){return this.subchannelAddressString}shutdown(){this.session.close(),(0,Jy.unregisterChannelzRef)(this.channelzRef)}},tv=class{constructor(e){this.channelTarget=e,this.session=null,this.isShutdown=!1}trace(e){xo.trace(ql.LogVerbosity.DEBUG,Zy,(0,Oo.uriToString)(this.channelTarget)+" "+e)}createSession(e,t,r,i){return this.isShutdown?Promise.reject():new Promise((s,o)=>{var a,l,c;let u;i.realTarget?(u=(0,Oo.uriToString)(i.realTarget),this.trace("creating HTTP/2 session through proxy to "+(0,Oo.uriToString)(i.realTarget))):(u=null,this.trace("creating HTTP/2 session to "+(0,rh.subchannelAddressToString)(e)));let d=(0,RI.getDefaultAuthority)((a=i.realTarget)!==null&&a!==void 0?a:this.channelTarget),h=t._getConnectionOptions()||{};h.maxSendHeaderBlockLength=Number.MAX_SAFE_INTEGER,"grpc-node.max_session_memory"in r?h.maxSessionMemory=r["grpc-node.max_session_memory"]:h.maxSessionMemory=Number.MAX_SAFE_INTEGER;let p="http://";if("secureContext"in h){if(p="https://",r["grpc.ssl_target_name_override"]){let S=r["grpc.ssl_target_name_override"];h.checkServerIdentity=(R,E)=>(0,DI.checkServerIdentity)(S,E),h.servername=S}else{let S=(c=(l=(0,Oo.splitHostPort)(d))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";h.servername=S}i.socket&&(h.createConnection=(S,R)=>i.socket)}else h.createConnection=(S,R)=>i.socket?i.socket:LB.connect(e);h=Object.assign(Object.assign(Object.assign({},h),e),{enableTrace:r["grpc-node.tls_enable_trace"]===1});let y=nv.connect(p+d,h);this.session=y;let _="Failed to connect";y.unref(),y.once("connect",()=>{y.removeAllListeners(),s(new ev(y,e,r,u)),this.session=null}),y.once("close",()=>{this.session=null,setImmediate(()=>{o(`${_} (${new Date().toISOString()})`)})}),y.once("error",S=>{_=S.message,this.trace("connection failed with error "+_)})})}connect(e,t,r){var i,s;if(this.isShutdown)return Promise.reject();let o=t._getConnectionOptions()||{};if("secureContext"in o){if(o.ALPNProtocols=["h2"],r["grpc.ssl_target_name_override"]){let a=r["grpc.ssl_target_name_override"];o.checkServerIdentity=(l,c)=>(0,DI.checkServerIdentity)(a,c),o.servername=a}else if("grpc.http_connect_target"in r){let a=(0,RI.getDefaultAuthority)((i=(0,Oo.parseUri)(r["grpc.http_connect_target"]))!==null&&i!==void 0?i:{path:"localhost"}),l=(0,Oo.splitHostPort)(a);o.servername=(s=l?.host)!==null&&s!==void 0?s:a}r["grpc-node.tls_enable_trace"]&&(o.enableTrace=!0)}return(0,FB.getProxiedConnection)(e,r,o).then(a=>this.createSession(e,t,r,a))}shutdown(){var e;this.isShutdown=!0,(e=this.session)===null||e===void 0||e.close(),this.session=null}};ih.Http2SubchannelConnector=tv});var kI=w(Po=>{"use strict";Object.defineProperty(Po,"__esModule",{value:!0});Po.getSubchannelPool=Po.SubchannelPool=void 0;var YB=gC(),XB=wI(),JB=Gn(),ZB=Wt(),eV=NI(),tV=1e4,Ul=class{constructor(){this.pool=Object.create(null),this.cleanupTimer=null}unrefUnusedSubchannels(){let e=!0;for(let t in this.pool){let i=this.pool[t].filter(s=>!s.subchannel.unrefIfOneRef());i.length>0&&(e=!1),this.pool[t]=i}e&&this.cleanupTimer!==null&&(clearInterval(this.cleanupTimer),this.cleanupTimer=null)}ensureCleanupTask(){var e,t;this.cleanupTimer===null&&(this.cleanupTimer=setInterval(()=>{this.unrefUnusedSubchannels()},tV),(t=(e=this.cleanupTimer).unref)===null||t===void 0||t.call(e))}getOrCreateSubchannel(e,t,r,i){this.ensureCleanupTask();let s=(0,ZB.uriToString)(e);if(s in this.pool){let a=this.pool[s];for(let l of a)if((0,JB.subchannelAddressEqual)(t,l.subchannelAddress)&&(0,YB.channelOptionsEqual)(r,l.channelArguments)&&i._equals(l.channelCredentials))return l.subchannel}let o=new XB.Subchannel(e,t,r,i,new eV.Http2SubchannelConnector(e));return s in this.pool||(this.pool[s]=[]),this.pool[s].push({subchannelAddress:t,channelArguments:r,channelCredentials:i,subchannel:o}),o.ref(),o}};Po.SubchannelPool=Ul;var nV=new Ul;function rV(n){return n?nV:new Ul}Po.getSubchannelPool=rV});var iv=w(Fo=>{"use strict";Object.defineProperty(Fo,"__esModule",{value:!0});Fo.FilterStackFactory=Fo.FilterStack=void 0;var sh=class{constructor(e){this.filters=e}sendMetadata(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMetadata(t);return t}receiveMetadata(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMetadata(t);return t}sendMessage(e){let t=e;for(let r=0;r<this.filters.length;r++)t=this.filters[r].sendMessage(t);return t}receiveMessage(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveMessage(t);return t}receiveTrailers(e){let t=e;for(let r=this.filters.length-1;r>=0;r--)t=this.filters[r].receiveTrailers(t);return t}push(e){this.filters.unshift(...e)}getFilters(){return this.filters}};Fo.FilterStack=sh;var rv=class n{constructor(e){this.factories=e}push(e){this.factories.unshift(...e)}clone(){return new n([...this.factories])}createFilter(){return new sh(this.factories.map(e=>e.createFilter()))}};Fo.FilterStackFactory=rv});var sv=w(oh=>{"use strict";Object.defineProperty(oh,"__esModule",{value:!0});oh.CompressionAlgorithms=void 0;var MI=function(n){return n[n.identity=0]="identity",n[n.deflate=1]="deflate",n[n.gzip=2]="gzip",n}(MI||(oh.CompressionAlgorithms=MI={}))});var lh=w(ah=>{"use strict";Object.defineProperty(ah,"__esModule",{value:!0});ah.BaseFilter=void 0;var ov=class{sendMetadata(e){return g(this,null,function*(){return e})}receiveMetadata(e){return e}sendMessage(e){return g(this,null,function*(){return e})}receiveMessage(e){return g(this,null,function*(){return e})}receiveTrailers(e){return e}};ah.BaseFilter=ov});var PI=w(Bo=>{"use strict";Object.defineProperty(Bo,"__esModule",{value:!0});Bo.CompressionFilterFactory=Bo.CompressionFilter=void 0;var ch=de("zlib"),xI=sv(),iV=le(),sV=lh(),oV=Le(),aV=n=>typeof n=="number"&&typeof xI.CompressionAlgorithms[n]=="string",Lo=class{writeMessage(e,t){return g(this,null,function*(){let r=e;t&&(r=yield this.compressMessage(r));let i=Buffer.allocUnsafe(r.length+5);return i.writeUInt8(t?1:0,0),i.writeUInt32BE(r.length,1),r.copy(i,5),i})}readMessage(e){return g(this,null,function*(){let t=e.readUInt8(0)===1,r=e.slice(5);return t&&(r=yield this.decompressMessage(r)),r})}},as=class extends Lo{compressMessage(e){return g(this,null,function*(){return e})}writeMessage(e,t){return g(this,null,function*(){let r=Buffer.allocUnsafe(e.length+5);return r.writeUInt8(0,0),r.writeUInt32BE(e.length,1),e.copy(r,5),r})}decompressMessage(e){return Promise.reject(new Error('Received compressed message but "grpc-encoding" header was identity'))}},av=class extends Lo{compressMessage(e){return new Promise((t,r)=>{ch.deflate(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{ch.inflate(e,(i,s)=>{i?r(i):t(s)})})}},lv=class extends Lo{compressMessage(e){return new Promise((t,r)=>{ch.gzip(e,(i,s)=>{i?r(i):t(s)})})}decompressMessage(e){return new Promise((t,r)=>{ch.unzip(e,(i,s)=>{i?r(i):t(s)})})}},cv=class extends Lo{constructor(e){super(),this.compressionName=e}compressMessage(e){return Promise.reject(new Error(`Received message compressed with unsupported compression method ${this.compressionName}`))}decompressMessage(e){return Promise.reject(new Error(`Compression method not supported: ${this.compressionName}`))}};function OI(n){switch(n){case"identity":return new as;case"deflate":return new av;case"gzip":return new lv;default:return new cv(n)}}var uh=class extends sV.BaseFilter{constructor(e,t){var r;super(),this.sharedFilterConfig=t,this.sendCompression=new as,this.receiveCompression=new as,this.currentCompressionAlgorithm="identity";let i=e["grpc.default_compression_algorithm"];if(i!==void 0)if(aV(i)){let s=xI.CompressionAlgorithms[i],o=(r=t.serverSupportedEncodingHeader)===null||r===void 0?void 0:r.split(",");(!o||o.includes(s))&&(this.currentCompressionAlgorithm=s,this.sendCompression=OI(this.currentCompressionAlgorithm))}else oV.log(iV.LogVerbosity.ERROR,`Invalid value provided for grpc.default_compression_algorithm option: ${i}`)}sendMetadata(e){return g(this,null,function*(){let t=yield e;return t.set("grpc-accept-encoding","identity,deflate,gzip"),t.set("accept-encoding","identity"),this.currentCompressionAlgorithm==="identity"?t.remove("grpc-encoding"):t.set("grpc-encoding",this.currentCompressionAlgorithm),t})}receiveMetadata(e){let t=e.get("grpc-encoding");if(t.length>0){let i=t[0];typeof i=="string"&&(this.receiveCompression=OI(i))}e.remove("grpc-encoding");let r=e.get("grpc-accept-encoding")[0];return r&&(this.sharedFilterConfig.serverSupportedEncodingHeader=r,r.split(",").includes(this.currentCompressionAlgorithm)||(this.sendCompression=new as,this.currentCompressionAlgorithm="identity")),e.remove("grpc-accept-encoding"),e}sendMessage(e){return g(this,null,function*(){var t;let r=yield e,i;return this.sendCompression instanceof as?i=!1:i=(((t=r.flags)!==null&&t!==void 0?t:0)&2)===0,{message:yield this.sendCompression.writeMessage(r.message,i),flags:r.flags}})}receiveMessage(e){return g(this,null,function*(){return this.receiveCompression.readMessage(yield e)})}};Bo.CompressionFilter=uh;var uv=class{constructor(e,t){this.options=t,this.sharedFilterConfig={}}createFilter(){return new uh(this.options,this.sharedFilterConfig)}};Bo.CompressionFilterFactory=uv});var LI=w(Vo=>{"use strict";Object.defineProperty(Vo,"__esModule",{value:!0});Vo.MaxMessageSizeFilterFactory=Vo.MaxMessageSizeFilter=void 0;var lV=lh(),dh=le(),FI=Mt(),hh=class extends lV.BaseFilter{constructor(e){super(),this.maxSendMessageSize=dh.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=dh.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,"grpc.max_send_message_length"in e&&(this.maxSendMessageSize=e["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in e&&(this.maxReceiveMessageSize=e["grpc.max_receive_message_length"])}sendMessage(e){return g(this,null,function*(){if(this.maxSendMessageSize===-1)return e;{let t=yield e;if(t.message.length>this.maxSendMessageSize)throw{code:dh.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${t.message.length} vs. ${this.maxSendMessageSize})`,metadata:new FI.Metadata};return t}})}receiveMessage(e){return g(this,null,function*(){if(this.maxReceiveMessageSize===-1)return e;{let t=yield e;if(t.length>this.maxReceiveMessageSize)throw{code:dh.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${t.length} vs. ${this.maxReceiveMessageSize})`,metadata:new FI.Metadata};return t}})}};Vo.MaxMessageSizeFilter=hh;var dv=class{constructor(e){this.options=e}createFilter(){return new hh(this.options)}};Vo.MaxMessageSizeFilterFactory=dv});var fh=w(er=>{"use strict";Object.defineProperty(er,"__esModule",{value:!0});er.deadlineToString=er.getRelativeTimeout=er.getDeadlineTimeoutString=er.minDeadline=void 0;function cV(...n){let e=1/0;for(let t of n){let r=t instanceof Date?t.getTime():t;r<e&&(e=r)}return e}er.minDeadline=cV;var uV=[["m",1],["S",1e3],["M",60*1e3],["H",60*60*1e3]];function dV(n){let e=new Date().getTime();n instanceof Date&&(n=n.getTime());let t=Math.max(n-e,0);for(let[r,i]of uV){let s=t/i;if(s<1e8)return String(Math.ceil(s))+r}throw new Error("Deadline is too far in the future")}er.getDeadlineTimeoutString=dV;var hV=2147483647;function fV(n){let e=n instanceof Date?n.getTime():n,t=new Date().getTime(),r=e-t;return r<0?0:r>hV?1/0:r}er.getRelativeTimeout=fV;function pV(n){if(n instanceof Date)return n.toISOString();{let e=new Date(n);return Number.isNaN(e.getTime())?""+n:e.toISOString()}}er.deadlineToString=pV});var gh=w(ph=>{"use strict";Object.defineProperty(ph,"__esModule",{value:!0});ph.restrictControlPlaneStatusCode=void 0;var tr=le(),gV=[tr.Status.OK,tr.Status.INVALID_ARGUMENT,tr.Status.NOT_FOUND,tr.Status.ALREADY_EXISTS,tr.Status.FAILED_PRECONDITION,tr.Status.ABORTED,tr.Status.OUT_OF_RANGE,tr.Status.DATA_LOSS];function mV(n,e){return gV.includes(n)?{code:tr.Status.INTERNAL,details:`Invalid status from control plane: ${n} ${tr.Status[n]} ${e}`}:{code:n,details:e}}ph.restrictControlPlaneStatusCode=mV});var VI=w(vh=>{"use strict";Object.defineProperty(vh,"__esModule",{value:!0});vh.LoadBalancingCall=void 0;var BI=rn(),mh=le(),yV=fh(),yh=Mt(),zl=Zr(),vV=Wt(),_V=Le(),hv=gh(),SV=de("http2"),wV="load_balancing_call",fv=class{constructor(e,t,r,i,s,o,a){var l,c;this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.metadata=null,this.listener=null,this.onCallEnded=null;let u=this.methodName.split("/"),d="";u.length>=2&&(d=u[1]);let h=(c=(l=(0,vV.splitHostPort)(this.host))===null||l===void 0?void 0:l.host)!==null&&c!==void 0?c:"localhost";this.serviceUrl=`https://${h}/${d}`}trace(e){_V.trace(mh.LogVerbosity.DEBUG,wV,"["+this.callNumber+"] "+e)}outputStatus(e,t){var r,i;if(!this.ended){this.ended=!0,this.trace("ended with status: code="+e.code+' details="'+e.details+'"');let s=Object.assign(Object.assign({},e),{progress:t});(r=this.listener)===null||r===void 0||r.onReceiveStatus(s),(i=this.onCallEnded)===null||i===void 0||i.call(this,s.code)}}doPick(){var e,t;if(this.ended)return;if(!this.metadata)throw new Error("doPick called before start");this.trace("Pick called");let r=this.channel.doPick(this.metadata,this.callConfig.pickInformation),i=r.subchannel?"("+r.subchannel.getChannelzRef().id+") "+r.subchannel.getAddress():""+r.subchannel;switch(this.trace("Pick result: "+zl.PickResultType[r.pickResultType]+" subchannel: "+i+" status: "+((e=r.status)===null||e===void 0?void 0:e.code)+" "+((t=r.status)===null||t===void 0?void 0:t.details)),r.pickResultType){case zl.PickResultType.COMPLETE:this.credentials.generateMetadata({service_url:this.serviceUrl}).then(a=>{var l,c,u;if(this.ended){this.trace("Credentials metadata generation finished after call ended");return}let d=this.metadata.clone();if(d.merge(a),d.get("authorization").length>1&&this.outputStatus({code:mh.Status.INTERNAL,details:'"authorization" metadata cannot have multiple values',metadata:new yh.Metadata},"PROCESSED"),r.subchannel.getConnectivityState()!==BI.ConnectivityState.READY){this.trace("Picked subchannel "+i+" has state "+BI.ConnectivityState[r.subchannel.getConnectivityState()]+" after getting credentials metadata. Retrying pick"),this.doPick();return}this.deadline!==1/0&&d.set("grpc-timeout",(0,yV.getDeadlineTimeoutString)(this.deadline));try{this.child=r.subchannel.getRealSubchannel().createCall(d,this.host,this.methodName,{onReceiveMetadata:h=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(h)},onReceiveMessage:h=>{this.trace("Received message"),this.listener.onReceiveMessage(h)},onReceiveStatus:h=>{this.trace("Received status"),h.rstCode===SV.constants.NGHTTP2_REFUSED_STREAM?this.outputStatus(h,"REFUSED"):this.outputStatus(h,"PROCESSED")}})}catch(h){this.trace("Failed to start call on picked subchannel "+i+" with error "+h.message),this.outputStatus({code:mh.Status.INTERNAL,details:"Failed to start HTTP/2 stream with error "+h.message,metadata:new yh.Metadata},"NOT_STARTED");return}(c=(l=this.callConfig).onCommitted)===null||c===void 0||c.call(l),(u=r.onCallStarted)===null||u===void 0||u.call(r),this.onCallEnded=r.onCallEnded,this.trace("Created child call ["+this.child.getCallNumber()+"]"),this.readPending&&this.child.startRead(),this.pendingMessage&&this.child.sendMessageWithContext(this.pendingMessage.context,this.pendingMessage.message),this.pendingHalfClose&&this.child.halfClose()},a=>{let{code:l,details:c}=(0,hv.restrictControlPlaneStatusCode)(typeof a.code=="number"?a.code:mh.Status.UNKNOWN,`Getting metadata from plugin failed with error: ${a.message}`);this.outputStatus({code:l,details:c,metadata:new yh.Metadata},"PROCESSED")});break;case zl.PickResultType.DROP:let{code:s,details:o}=(0,hv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:s,details:o,metadata:r.status.metadata},"DROP")});break;case zl.PickResultType.TRANSIENT_FAILURE:if(this.metadata.getOptions().waitForReady)this.channel.queueCallForPick(this);else{let{code:a,details:l}=(0,hv.restrictControlPlaneStatusCode)(r.status.code,r.status.details);setImmediate(()=>{this.outputStatus({code:a,details:l,metadata:r.status.metadata},"PROCESSED")})}break;case zl.PickResultType.QUEUE:this.channel.queueCallForPick(this)}}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new yh.Metadata},"PROCESSED")}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.listener=t,this.metadata=e,this.doPick()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.child.sendMessageWithContext(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){throw new Error("Method not implemented.")}getCallNumber(){return this.callNumber}};vh.LoadBalancingCall=fv});var UI=w(Sh=>{"use strict";Object.defineProperty(Sh,"__esModule",{value:!0});Sh.ResolvingCall=void 0;var qo=le(),_h=fh(),qI=Mt(),EV=Le(),TV=gh(),CV="resolving_call",pv=class{constructor(e,t,r,i,s,o){this.channel=e,this.method=t,this.filterStackFactory=i,this.credentials=s,this.callNumber=o,this.child=null,this.readPending=!1,this.pendingMessage=null,this.pendingHalfClose=!1,this.ended=!1,this.readFilterPending=!1,this.writeFilterPending=!1,this.pendingChildStatus=null,this.metadata=null,this.listener=null,this.statusWatchers=[],this.deadlineTimer=setTimeout(()=>{},0),this.filterStack=null,this.deadline=r.deadline,this.host=r.host,r.parentCall&&(r.flags&qo.Propagate.CANCELLATION&&r.parentCall.on("cancelled",()=>{this.cancelWithStatus(qo.Status.CANCELLED,"Cancelled by parent call")}),r.flags&qo.Propagate.DEADLINE&&(this.trace("Propagating deadline from parent: "+r.parentCall.getDeadline()),this.deadline=(0,_h.minDeadline)(this.deadline,r.parentCall.getDeadline()))),this.trace("Created"),this.runDeadlineTimer()}trace(e){EV.trace(qo.LogVerbosity.DEBUG,CV,"["+this.callNumber+"] "+e)}runDeadlineTimer(){clearTimeout(this.deadlineTimer),this.trace("Deadline: "+(0,_h.deadlineToString)(this.deadline));let e=(0,_h.getRelativeTimeout)(this.deadline);if(e!==1/0){this.trace("Deadline will be reached in "+e+"ms");let t=()=>{this.cancelWithStatus(qo.Status.DEADLINE_EXCEEDED,"Deadline exceeded")};e<=0?process.nextTick(t):this.deadlineTimer=setTimeout(t,e)}}outputStatus(e){if(!this.ended){this.ended=!0,this.filterStack||(this.filterStack=this.filterStackFactory.createFilter()),clearTimeout(this.deadlineTimer);let t=this.filterStack.receiveTrailers(e);this.trace("ended with status: code="+t.code+' details="'+t.details+'"'),this.statusWatchers.forEach(r=>r(t)),process.nextTick(()=>{var r;(r=this.listener)===null||r===void 0||r.onReceiveStatus(t)})}}sendMessageOnChild(e,t){if(!this.child)throw new Error("sendMessageonChild called with child not populated");let r=this.child;this.writeFilterPending=!0,this.filterStack.sendMessage(Promise.resolve({message:t,flags:e.flags})).then(i=>{this.writeFilterPending=!1,r.sendMessageWithContext(e,i.message),this.pendingHalfClose&&r.halfClose()},i=>{this.cancelWithStatus(i.code,i.details)})}getConfig(){if(this.ended)return;if(!this.metadata||!this.listener)throw new Error("getConfig called before start");let e=this.channel.getConfig(this.method,this.metadata);if(e.type==="NONE"){this.channel.queueCallForConfig(this);return}else if(e.type==="ERROR"){this.metadata.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e.error);return}let t=e.config;if(t.status!==qo.Status.OK){let{code:r,details:i}=(0,TV.restrictControlPlaneStatusCode)(t.status,"Failed to route call to method "+this.method);this.outputStatus({code:r,details:i,metadata:new qI.Metadata});return}if(t.methodConfig.timeout){let r=new Date;r.setSeconds(r.getSeconds()+t.methodConfig.timeout.seconds),r.setMilliseconds(r.getMilliseconds()+t.methodConfig.timeout.nanos/1e6),this.deadline=(0,_h.minDeadline)(this.deadline,r),this.runDeadlineTimer()}this.filterStackFactory.push(t.dynamicFilterFactories),this.filterStack=this.filterStackFactory.createFilter(),this.filterStack.sendMetadata(Promise.resolve(this.metadata)).then(r=>{this.child=this.channel.createInnerCall(t,this.method,this.host,this.credentials,this.deadline),this.trace("Created child ["+this.child.getCallNumber()+"]"),this.child.start(r,{onReceiveMetadata:i=>{this.trace("Received metadata"),this.listener.onReceiveMetadata(this.filterStack.receiveMetadata(i))},onReceiveMessage:i=>{this.trace("Received message"),this.readFilterPending=!0,this.filterStack.receiveMessage(i).then(s=>{this.trace("Finished filtering received message"),this.readFilterPending=!1,this.listener.onReceiveMessage(s),this.pendingChildStatus&&this.outputStatus(this.pendingChildStatus)},s=>{this.cancelWithStatus(s.code,s.details)})},onReceiveStatus:i=>{this.trace("Received status"),this.readFilterPending?this.pendingChildStatus=i:this.outputStatus(i)}}),this.readPending&&this.child.startRead(),this.pendingMessage?this.sendMessageOnChild(this.pendingMessage.context,this.pendingMessage.message):this.pendingHalfClose&&this.child.halfClose()},r=>{this.outputStatus(r)})}reportResolverError(e){var t;!((t=this.metadata)===null||t===void 0)&&t.getOptions().waitForReady?this.channel.queueCallForConfig(this):this.outputStatus(e)}cancelWithStatus(e,t){var r;this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),(r=this.child)===null||r===void 0||r.cancelWithStatus(e,t),this.outputStatus({code:e,details:t,metadata:new qI.Metadata})}getPeer(){var e,t;return(t=(e=this.child)===null||e===void 0?void 0:e.getPeer())!==null&&t!==void 0?t:this.channel.getTarget()}start(e,t){this.trace("start called"),this.metadata=e.clone(),this.listener=t,this.getConfig()}sendMessageWithContext(e,t){this.trace("write() called with message of length "+t.length),this.child?this.sendMessageOnChild(e,t):this.pendingMessage={context:e,message:t}}startRead(){this.trace("startRead called"),this.child?this.child.startRead():this.readPending=!0}halfClose(){this.trace("halfClose called"),this.child&&!this.writeFilterPending?this.child.halfClose():this.pendingHalfClose=!0}setCredentials(e){this.credentials=this.credentials.compose(e)}addStatusWatcher(e){this.statusWatchers.push(e)}getCallNumber(){return this.callNumber}};Sh.ResolvingCall=pv});var zI=w(mi=>{"use strict";Object.defineProperty(mi,"__esModule",{value:!0});mi.RetryingCall=mi.MessageBufferTracker=mi.RetryThrottler=void 0;var wh=le(),bV=Mt(),AV=Le(),IV="retrying_call",mv=class{constructor(e,t,r){this.maxTokens=e,this.tokenRatio=t,r?this.tokens=r.tokens*(e/r.maxTokens):this.tokens=e}addCallSucceeded(){this.tokens=Math.max(this.tokens+this.tokenRatio,this.maxTokens)}addCallFailed(){this.tokens=Math.min(this.tokens-1,0)}canRetryCall(){return this.tokens>this.maxTokens/2}};mi.RetryThrottler=mv;var yv=class{constructor(e,t){this.totalLimit=e,this.limitPerCall=t,this.totalAllocated=0,this.allocatedPerCall=new Map}allocate(e,t){var r;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;return this.limitPerCall-i<e||this.totalLimit-this.totalAllocated<e?!1:(this.allocatedPerCall.set(t,i+e),this.totalAllocated+=e,!0)}free(e,t){var r;if(this.totalAllocated<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > total allocated ${this.totalAllocated}`);this.totalAllocated-=e;let i=(r=this.allocatedPerCall.get(t))!==null&&r!==void 0?r:0;if(i<e)throw new Error(`Invalid buffer allocation state: call ${t} freed ${e} > allocated for call ${i}`);this.allocatedPerCall.set(t,i-e)}freeAll(e){var t;let r=(t=this.allocatedPerCall.get(e))!==null&&t!==void 0?t:0;if(this.totalAllocated<r)throw new Error(`Invalid buffer allocation state: call ${e} allocated ${r} > total allocated ${this.totalAllocated}`);this.totalAllocated-=r,this.allocatedPerCall.delete(e)}};mi.MessageBufferTracker=yv;var gv="grpc-previous-rpc-attempts",vv=class{constructor(e,t,r,i,s,o,a,l,c){if(this.channel=e,this.callConfig=t,this.methodName=r,this.host=i,this.credentials=s,this.deadline=o,this.callNumber=a,this.bufferTracker=l,this.retryThrottler=c,this.listener=null,this.initialMetadata=null,this.underlyingCalls=[],this.writeBuffer=[],this.writeBufferOffset=0,this.readStarted=!1,this.transparentRetryUsed=!1,this.attempts=0,this.hedgingTimer=null,this.committedCallIndex=null,this.initialRetryBackoffSec=0,this.nextRetryBackoffSec=0,t.methodConfig.retryPolicy){this.state="RETRY";let u=t.methodConfig.retryPolicy;this.nextRetryBackoffSec=this.initialRetryBackoffSec=Number(u.initialBackoff.substring(0,u.initialBackoff.length-1))}else t.methodConfig.hedgingPolicy?this.state="HEDGING":this.state="TRANSPARENT_ONLY"}getCallNumber(){return this.callNumber}trace(e){AV.trace(wh.LogVerbosity.DEBUG,IV,"["+this.callNumber+"] "+e)}reportStatus(e){this.trace("ended with status: code="+e.code+' details="'+e.details+'"'),this.bufferTracker.freeAll(this.callNumber),this.writeBufferOffset=this.writeBufferOffset+this.writeBuffer.length,this.writeBuffer=[],process.nextTick(()=>{var t;(t=this.listener)===null||t===void 0||t.onReceiveStatus({code:e.code,details:e.details,metadata:e.metadata})})}cancelWithStatus(e,t){this.trace("cancelWithStatus code: "+e+' details: "'+t+'"'),this.reportStatus({code:e,details:t,metadata:new bV.Metadata});for(let{call:r}of this.underlyingCalls)r.cancelWithStatus(e,t)}getPeer(){return this.committedCallIndex!==null?this.underlyingCalls[this.committedCallIndex].call.getPeer():"unknown"}getBufferEntry(e){var t;return(t=this.writeBuffer[e-this.writeBufferOffset])!==null&&t!==void 0?t:{entryType:"FREED",allocated:!1}}getNextBufferIndex(){return this.writeBufferOffset+this.writeBuffer.length}clearSentMessages(){if(this.state!=="COMMITTED")return;let e=this.underlyingCalls[this.committedCallIndex].nextMessageToSend;for(let t=this.writeBufferOffset;t<e;t++){let r=this.getBufferEntry(t);r.allocated&&this.bufferTracker.free(r.message.message.length,this.callNumber)}this.writeBuffer=this.writeBuffer.slice(e-this.writeBufferOffset),this.writeBufferOffset=e}commitCall(e){if(this.state!=="COMMITTED"&&this.underlyingCalls[e].state!=="COMPLETED"){this.trace("Committing call ["+this.underlyingCalls[e].call.getCallNumber()+"] at index "+e),this.state="COMMITTED",this.committedCallIndex=e;for(let t=0;t<this.underlyingCalls.length;t++)t!==e&&this.underlyingCalls[t].state!=="COMPLETED"&&(this.underlyingCalls[t].state="COMPLETED",this.underlyingCalls[t].call.cancelWithStatus(wh.Status.CANCELLED,"Discarded in favor of other hedged attempt"));this.clearSentMessages()}}commitCallWithMostMessages(){if(this.state==="COMMITTED")return;let e=-1,t=-1;for(let[r,i]of this.underlyingCalls.entries())i.state==="ACTIVE"&&i.nextMessageToSend>e&&(e=i.nextMessageToSend,t=r);t===-1?this.state="TRANSPARENT_ONLY":this.commitCall(t)}isStatusCodeInList(e,t){return e.some(r=>r===t||r.toString().toLowerCase()===wh.Status[t].toLowerCase())}getNextRetryBackoffMs(){var e;let t=(e=this.callConfig)===null||e===void 0?void 0:e.methodConfig.retryPolicy;if(!t)return 0;let r=Math.random()*this.nextRetryBackoffSec*1e3,i=Number(t.maxBackoff.substring(0,t.maxBackoff.length-1));return this.nextRetryBackoffSec=Math.min(this.nextRetryBackoffSec*t.backoffMultiplier,i),r}maybeRetryCall(e,t){if(this.state!=="RETRY"){t(!1);return}let r=this.callConfig.methodConfig.retryPolicy;if(this.attempts>=Math.min(r.maxAttempts,5)){t(!1);return}let i;if(e===null)i=this.getNextRetryBackoffMs();else if(e<0){this.state="TRANSPARENT_ONLY",t(!1);return}else i=e,this.nextRetryBackoffSec=this.initialRetryBackoffSec;setTimeout(()=>{var s,o;if(this.state!=="RETRY"){t(!1);return}(!((o=(s=this.retryThrottler)===null||s===void 0?void 0:s.canRetryCall())!==null&&o!==void 0)||o)&&(t(!0),this.attempts+=1,this.startNewAttempt())},i)}countActiveCalls(){let e=0;for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&(e+=1);return e}handleProcessedStatus(e,t,r){var i,s,o;switch(this.state){case"COMMITTED":case"TRANSPARENT_ONLY":this.commitCall(t),this.reportStatus(e);break;case"HEDGING":if(this.isStatusCodeInList((i=this.callConfig.methodConfig.hedgingPolicy.nonFatalStatusCodes)!==null&&i!==void 0?i:[],e.code)){(s=this.retryThrottler)===null||s===void 0||s.addCallFailed();let a;if(r===null)a=0;else if(r<0){this.state="TRANSPARENT_ONLY",this.commitCall(t),this.reportStatus(e);return}else a=r;setTimeout(()=>{this.maybeStartHedgingAttempt(),this.countActiveCalls()===0&&(this.commitCall(t),this.reportStatus(e))},a)}else this.commitCall(t),this.reportStatus(e);break;case"RETRY":this.isStatusCodeInList(this.callConfig.methodConfig.retryPolicy.retryableStatusCodes,e.code)?((o=this.retryThrottler)===null||o===void 0||o.addCallFailed(),this.maybeRetryCall(r,a=>{a||(this.commitCall(t),this.reportStatus(e))})):(this.commitCall(t),this.reportStatus(e));break}}getPushback(e){let t=e.get("grpc-retry-pushback-ms");if(t.length===0)return null;try{return parseInt(t[0])}catch{return-1}}handleChildStatus(e,t){var r;if(this.underlyingCalls[t].state==="COMPLETED")return;if(this.trace("state="+this.state+" handling status with progress "+e.progress+" from child ["+this.underlyingCalls[t].call.getCallNumber()+"] in state "+this.underlyingCalls[t].state),this.underlyingCalls[t].state="COMPLETED",e.code===wh.Status.OK){(r=this.retryThrottler)===null||r===void 0||r.addCallSucceeded(),this.commitCall(t),this.reportStatus(e);return}if(this.state==="COMMITTED"){this.reportStatus(e);return}let i=this.getPushback(e.metadata);switch(e.progress){case"NOT_STARTED":this.startNewAttempt();break;case"REFUSED":this.transparentRetryUsed?this.handleProcessedStatus(e,t,i):(this.transparentRetryUsed=!0,this.startNewAttempt());break;case"DROP":this.commitCall(t),this.reportStatus(e);break;case"PROCESSED":this.handleProcessedStatus(e,t,i);break}}maybeStartHedgingAttempt(){if(this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let e=this.callConfig.methodConfig.hedgingPolicy;this.attempts>=Math.min(e.maxAttempts,5)||(this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer())}maybeStartHedgingTimer(){var e,t,r;if(this.hedgingTimer&&clearTimeout(this.hedgingTimer),this.state!=="HEDGING"||!this.callConfig.methodConfig.hedgingPolicy)return;let i=this.callConfig.methodConfig.hedgingPolicy;if(this.attempts>=Math.min(i.maxAttempts,5))return;let s=(e=i.hedgingDelay)!==null&&e!==void 0?e:"0s",o=Number(s.substring(0,s.length-1));this.hedgingTimer=setTimeout(()=>{this.maybeStartHedgingAttempt()},o*1e3),(r=(t=this.hedgingTimer).unref)===null||r===void 0||r.call(t)}startNewAttempt(){let e=this.channel.createLoadBalancingCall(this.callConfig,this.methodName,this.host,this.credentials,this.deadline);this.trace("Created child call ["+e.getCallNumber()+"] for attempt "+this.attempts);let t=this.underlyingCalls.length;this.underlyingCalls.push({state:"ACTIVE",call:e,nextMessageToSend:0});let r=this.attempts-1,i=this.initialMetadata.clone();r>0&&i.set(gv,`${r}`);let s=!1;e.start(i,{onReceiveMetadata:o=>{this.trace("Received metadata from child ["+e.getCallNumber()+"]"),this.commitCall(t),s=!0,r>0&&o.set(gv,`${r}`),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMetadata(o)},onReceiveMessage:o=>{this.trace("Received message from child ["+e.getCallNumber()+"]"),this.commitCall(t),this.underlyingCalls[t].state==="ACTIVE"&&this.listener.onReceiveMessage(o)},onReceiveStatus:o=>{this.trace("Received status from child ["+e.getCallNumber()+"]"),!s&&r>0&&o.metadata.set(gv,`${r}`),this.handleChildStatus(o,t)}}),this.sendNextChildMessage(t),this.readStarted&&e.startRead()}start(e,t){this.trace("start called"),this.listener=t,this.initialMetadata=e,this.attempts+=1,this.startNewAttempt(),this.maybeStartHedgingTimer()}handleChildWriteCompleted(e){var t,r;let i=this.underlyingCalls[e],s=i.nextMessageToSend;(r=(t=this.getBufferEntry(s)).callback)===null||r===void 0||r.call(t),this.clearSentMessages(),i.nextMessageToSend+=1,this.sendNextChildMessage(e)}sendNextChildMessage(e){let t=this.underlyingCalls[e];if(t.state!=="COMPLETED"&&this.getBufferEntry(t.nextMessageToSend)){let r=this.getBufferEntry(t.nextMessageToSend);switch(r.entryType){case"MESSAGE":t.call.sendMessageWithContext({callback:i=>{this.handleChildWriteCompleted(e)}},r.message.message);break;case"HALF_CLOSE":t.nextMessageToSend+=1,t.call.halfClose();break;case"FREED":break}}}sendMessageWithContext(e,t){var r;this.trace("write() called with message of length "+t.length);let i={message:t,flags:e.flags},s=this.getNextBufferIndex(),o={entryType:"MESSAGE",message:i,allocated:this.bufferTracker.allocate(t.length,this.callNumber)};if(this.writeBuffer.push(o),o.allocated){(r=e.callback)===null||r===void 0||r.call(e);for(let[a,l]of this.underlyingCalls.entries())l.state==="ACTIVE"&&l.nextMessageToSend===s&&l.call.sendMessageWithContext({callback:c=>{this.handleChildWriteCompleted(a)}},t)}else{if(this.commitCallWithMostMessages(),this.committedCallIndex===null)return;let a=this.underlyingCalls[this.committedCallIndex];o.callback=e.callback,a.state==="ACTIVE"&&a.nextMessageToSend===s&&a.call.sendMessageWithContext({callback:l=>{this.handleChildWriteCompleted(this.committedCallIndex)}},t)}}startRead(){this.trace("startRead called"),this.readStarted=!0;for(let e of this.underlyingCalls)e?.state==="ACTIVE"&&e.call.startRead()}halfClose(){this.trace("halfClose called");let e=this.getNextBufferIndex();this.writeBuffer.push({entryType:"HALF_CLOSE",allocated:!1});for(let t of this.underlyingCalls)t?.state==="ACTIVE"&&t.nextMessageToSend===e&&(t.nextMessageToSend+=1,t.call.halfClose())}setCredentials(e){throw new Error("Method not implemented.")}getMethod(){return this.methodName}getHost(){return this.host}};mi.RetryingCall=vv});var Th=w(Eh=>{"use strict";Object.defineProperty(Eh,"__esModule",{value:!0});Eh.BaseSubchannelWrapper=void 0;var _v=class{constructor(e){this.child=e}getConnectivityState(){return this.child.getConnectivityState()}addConnectivityStateListener(e){this.child.addConnectivityStateListener(e)}removeConnectivityStateListener(e){this.child.removeConnectivityStateListener(e)}startConnecting(){this.child.startConnecting()}getAddress(){return this.child.getAddress()}throttleKeepalive(e){this.child.throttleKeepalive(e)}ref(){this.child.ref()}unref(){this.child.unref()}getChannelzRef(){return this.child.getChannelzRef()}getRealSubchannel(){return this.child.getRealSubchannel()}realSubchannelEquals(e){return this.getRealSubchannel()===e.getRealSubchannel()}};Eh.BaseSubchannelWrapper=_v});var HI=w(Ah=>{"use strict";Object.defineProperty(Ah,"__esModule",{value:!0});Ah.InternalChannel=void 0;var DV=od(),RV=pC(),NV=kI(),jI=Zr(),jl=le(),kV=iv(),MV=PI(),GI=zn(),Sv=Le(),OV=LI(),xV=Wy(),Ch=Wt(),nr=rn(),Gl=os(),PV=VI(),FV=fh(),LV=UI(),wv=Xy(),BV=gh(),Ev=zI(),VV=Th(),qV=2147483647,UV=1e3,zV=30*60*1e3,bh=new Map,jV=1<<24,GV=1<<20,Tv=class extends VV.BaseSubchannelWrapper{constructor(e,t){super(e),this.channel=t,this.refCount=0,this.subchannelStateListener=(r,i,s,o)=>{t.throttleKeepalive(o)},e.addConnectivityStateListener(this.subchannelStateListener)}ref(){this.child.ref(),this.refCount+=1}unref(){this.child.unref(),this.refCount-=1,this.refCount<=0&&(this.child.removeConnectivityStateListener(this.subchannelStateListener),this.channel.removeWrappedSubchannel(this))}},Cv=class{constructor(e,t,r){var i,s,o,a,l,c,u,d;if(this.credentials=t,this.options=r,this.connectivityState=nr.ConnectivityState.IDLE,this.currentPicker=new jI.UnavailablePicker,this.configSelectionQueue=[],this.pickQueue=[],this.connectivityStateWatchers=[],this.configSelector=null,this.currentResolutionError=null,this.wrappedSubchannels=new Set,this.callCount=0,this.idleTimer=null,this.channelzEnabled=!0,this.callTracker=new Gl.ChannelzCallTracker,this.childrenTracker=new Gl.ChannelzChildrenTracker,typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof DV.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.originalTarget=e;let h=(0,Ch.parseUri)(e);if(h===null)throw new Error(`Could not parse target name "${e}"`);let p=(0,GI.mapUriDefaultScheme)(h);if(p===null)throw new Error(`Could not find a default scheme for target name "${e}"`);this.callRefTimer=setInterval(()=>{},qV),(s=(i=this.callRefTimer).unref)===null||s===void 0||s.call(i),this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzTrace=new Gl.ChannelzTrace,this.channelzRef=(0,Gl.registerChannelzChannel)(e,()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Channel created"),this.options["grpc.default_authority"]?this.defaultAuthority=this.options["grpc.default_authority"]:this.defaultAuthority=(0,GI.getDefaultAuthority)(p);let y=(0,xV.mapProxyName)(p,r);this.target=y.target,this.options=Object.assign({},this.options,y.extraOptions),this.subchannelPool=(0,NV.getSubchannelPool)(((o=r["grpc.use_local_subchannel_pool"])!==null&&o!==void 0?o:0)===0),this.retryBufferTracker=new Ev.MessageBufferTracker((a=r["grpc.retry_buffer_size"])!==null&&a!==void 0?a:jV,(l=r["grpc.per_rpc_retry_buffer_size"])!==null&&l!==void 0?l:GV),this.keepaliveTime=(c=r["grpc.keepalive_time_ms"])!==null&&c!==void 0?c:-1,this.idleTimeoutMs=Math.max((u=r["grpc.client_idle_timeout_ms"])!==null&&u!==void 0?u:zV,UV);let _={createSubchannel:(R,E)=>{let N=this.subchannelPool.getOrCreateSubchannel(this.target,R,Object.assign({},this.options,E),this.credentials);N.throttleKeepalive(this.keepaliveTime),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Created subchannel or used existing subchannel",N.getChannelzRef());let k=new Tv(N,this);return this.wrappedSubchannels.add(k),k},updateState:(R,E)=>{this.currentPicker=E;let N=this.pickQueue.slice();this.pickQueue=[],N.length>0&&this.callRefTimerUnref();for(let k of N)k.doPick();this.updateState(R)},requestReresolution:()=>{throw new Error("Resolving load balancer should never call requestReresolution")},addChannelzChild:R=>{this.channelzEnabled&&this.childrenTracker.refChild(R)},removeChannelzChild:R=>{this.channelzEnabled&&this.childrenTracker.unrefChild(R)}};this.resolvingLoadBalancer=new RV.ResolvingLoadBalancer(this.target,_,r,(R,E)=>{R.retryThrottling?bh.set(this.getTarget(),new Ev.RetryThrottler(R.retryThrottling.maxTokens,R.retryThrottling.tokenRatio,bh.get(this.getTarget()))):bh.delete(this.getTarget()),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Address resolution succeeded"),this.configSelector=E,this.currentResolutionError=null,process.nextTick(()=>{let N=this.configSelectionQueue;this.configSelectionQueue=[],N.length>0&&this.callRefTimerUnref();for(let k of N)k.getConfig()})},R=>{this.channelzEnabled&&this.channelzTrace.addTrace("CT_WARNING","Address resolution failed with code "+R.code+' and details "'+R.details+'"'),this.configSelectionQueue.length>0&&this.trace("Name resolution failed with calls queued for config selection"),this.configSelector===null&&(this.currentResolutionError=Object.assign(Object.assign({},(0,BV.restrictControlPlaneStatusCode)(R.code,R.details)),{metadata:R.metadata}));let E=this.configSelectionQueue;this.configSelectionQueue=[],E.length>0&&this.callRefTimerUnref();for(let N of E)N.reportResolverError(R)}),this.filterStackFactory=new kV.FilterStackFactory([new OV.MaxMessageSizeFilterFactory(this.options),new MV.CompressionFilterFactory(this,this.options)]),this.trace("Channel constructed with options "+JSON.stringify(r,void 0,2));let S=new Error;(0,Sv.trace)(jl.LogVerbosity.DEBUG,"channel_stacktrace","("+this.channelzRef.id+`) Channel constructed 
`+((d=S.stack)===null||d===void 0?void 0:d.substring(S.stack.indexOf(`
`)+1)))}getChannelzInfo(){return{target:this.originalTarget,state:this.connectivityState,trace:this.channelzTrace,callTracker:this.callTracker,children:this.childrenTracker.getChildLists()}}trace(e,t){(0,Sv.trace)(t??jl.LogVerbosity.DEBUG,"channel","("+this.channelzRef.id+") "+(0,Ch.uriToString)(this.target)+" "+e)}callRefTimerRef(){var e,t,r,i;!((t=(e=this.callRefTimer).hasRef)===null||t===void 0)&&t.call(e)||(this.trace("callRefTimer.ref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(i=(r=this.callRefTimer).ref)===null||i===void 0||i.call(r))}callRefTimerUnref(){var e,t;(!this.callRefTimer.hasRef||this.callRefTimer.hasRef())&&(this.trace("callRefTimer.unref | configSelectionQueue.length="+this.configSelectionQueue.length+" pickQueue.length="+this.pickQueue.length),(t=(e=this.callRefTimer).unref)===null||t===void 0||t.call(e))}removeConnectivityStateWatcher(e){let t=this.connectivityStateWatchers.findIndex(r=>r===e);t>=0&&this.connectivityStateWatchers.splice(t,1)}updateState(e){(0,Sv.trace)(jl.LogVerbosity.DEBUG,"connectivity_state","("+this.channelzRef.id+") "+(0,Ch.uriToString)(this.target)+" "+nr.ConnectivityState[this.connectivityState]+" -> "+nr.ConnectivityState[e]),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connectivity state change to "+nr.ConnectivityState[e]),this.connectivityState=e;let t=this.connectivityStateWatchers.slice();for(let r of t)e!==r.currentState&&(r.timer&&clearTimeout(r.timer),this.removeConnectivityStateWatcher(r),r.callback());e!==nr.ConnectivityState.TRANSIENT_FAILURE&&(this.currentResolutionError=null)}throttleKeepalive(e){if(e>this.keepaliveTime){this.keepaliveTime=e;for(let t of this.wrappedSubchannels)t.throttleKeepalive(e)}}removeWrappedSubchannel(e){this.wrappedSubchannels.delete(e)}doPick(e,t){return this.currentPicker.pick({metadata:e,extraPickInfo:t})}queueCallForPick(e){this.pickQueue.push(e),this.callRefTimerRef()}getConfig(e,t){return this.resolvingLoadBalancer.exitIdle(),this.configSelector?{type:"SUCCESS",config:this.configSelector(e,t)}:this.currentResolutionError?{type:"ERROR",error:this.currentResolutionError}:{type:"NONE"}}queueCallForConfig(e){this.configSelectionQueue.push(e),this.callRefTimerRef()}enterIdle(){this.resolvingLoadBalancer.destroy(),this.updateState(nr.ConnectivityState.IDLE),this.currentPicker=new jI.QueuePicker(this.resolvingLoadBalancer)}maybeStartIdleTimer(){var e,t;this.connectivityState!==nr.ConnectivityState.SHUTDOWN&&this.callCount===0&&(this.idleTimer=setTimeout(()=>{this.trace("Idle timer triggered after "+this.idleTimeoutMs+"ms of inactivity"),this.enterIdle()},this.idleTimeoutMs),(t=(e=this.idleTimer).unref)===null||t===void 0||t.call(e))}onCallStart(){this.channelzEnabled&&this.callTracker.addCallStarted(),this.callCount+=1,this.idleTimer&&(clearTimeout(this.idleTimer),this.idleTimer=null)}onCallEnd(e){this.channelzEnabled&&(e.code===jl.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()),this.callCount-=1,this.maybeStartIdleTimer()}createLoadBalancingCall(e,t,r,i,s){let o=(0,wv.getNextCallNumber)();return this.trace("createLoadBalancingCall ["+o+'] method="'+t+'"'),new PV.LoadBalancingCall(this,e,t,r,i,s,o)}createRetryingCall(e,t,r,i,s){let o=(0,wv.getNextCallNumber)();return this.trace("createRetryingCall ["+o+'] method="'+t+'"'),new Ev.RetryingCall(this,e,t,r,i,s,o,this.retryBufferTracker,bh.get(this.getTarget()))}createInnerCall(e,t,r,i,s){return this.options["grpc.enable_retries"]===0?this.createLoadBalancingCall(e,t,r,i,s):this.createRetryingCall(e,t,r,i,s)}createResolvingCall(e,t,r,i,s){let o=(0,wv.getNextCallNumber)();this.trace("createResolvingCall ["+o+'] method="'+e+'", deadline='+(0,FV.deadlineToString)(t));let a={deadline:t,flags:s??jl.Propagate.DEFAULTS,host:r??this.defaultAuthority,parentCall:i},l=new LV.ResolvingCall(this,e,a,this.filterStackFactory.clone(),this.credentials._getCallCredentials(),o);return this.onCallStart(),l.addStatusWatcher(c=>{this.onCallEnd(c)}),l}close(){this.resolvingLoadBalancer.destroy(),this.updateState(nr.ConnectivityState.SHUTDOWN),clearInterval(this.callRefTimer),this.idleTimer&&clearTimeout(this.idleTimer),this.channelzEnabled&&(0,Gl.unregisterChannelzRef)(this.channelzRef),this.subchannelPool.unrefUnusedSubchannels()}getTarget(){return(0,Ch.uriToString)(this.target)}getConnectivityState(e){let t=this.connectivityState;return e&&(this.resolvingLoadBalancer.exitIdle(),this.maybeStartIdleTimer()),t}watchConnectivityState(e,t,r){if(this.connectivityState===nr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");let i=null;if(t!==1/0){let o=t instanceof Date?t:new Date(t),a=new Date;if(t===-1/0||o<=a){process.nextTick(r,new Error("Deadline passed without connectivity state change"));return}i=setTimeout(()=>{this.removeConnectivityStateWatcher(s),r(new Error("Deadline passed without connectivity state change"))},o.getTime()-a.getTime())}let s={currentState:e,callback:r,timer:i};this.connectivityStateWatchers.push(s)}getChannelzRef(){return this.channelzRef}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");if(this.connectivityState===nr.ConnectivityState.SHUTDOWN)throw new Error("Channel has been shut down");return this.createResolvingCall(e,t,r,i,s)}};Ah.InternalChannel=Cv});var Dm=w(Ih=>{"use strict";Object.defineProperty(Ih,"__esModule",{value:!0});Ih.ChannelImplementation=void 0;var HV=od(),KV=HI(),bv=class{constructor(e,t,r){if(typeof e!="string")throw new TypeError("Channel target must be a string");if(!(t instanceof HV.ChannelCredentials))throw new TypeError("Channel credentials must be a ChannelCredentials object");if(r&&typeof r!="object")throw new TypeError("Channel options must be an object");this.internalChannel=new KV.InternalChannel(e,t,r)}close(){this.internalChannel.close()}getTarget(){return this.internalChannel.getTarget()}getConnectivityState(e){return this.internalChannel.getConnectivityState(e)}watchConnectivityState(e,t,r){this.internalChannel.watchConnectivityState(e,t,r)}getChannelzRef(){return this.internalChannel.getChannelzRef()}createCall(e,t,r,i,s){if(typeof e!="string")throw new TypeError("Channel#createCall: method must be a string");if(!(typeof t=="number"||t instanceof Date))throw new TypeError("Channel#createCall: deadline must be a number or Date");return this.internalChannel.createCall(e,t,r,i,s)}};Ih.ChannelImplementation=bv});var tD=w(fn=>{"use strict";Object.defineProperty(fn,"__esModule",{value:!0});fn.Http2ServerCallStream=fn.ServerDuplexStreamImpl=fn.ServerWritableStreamImpl=fn.ServerReadableStreamImpl=fn.ServerUnaryCallImpl=void 0;var YI=de("events"),Uo=de("http2"),Dv=de("stream"),XI=de("zlib"),JI=de("util"),Ie=le(),Rv=Mt(),WV=Qy(),ZI=Le(),Kl=ed(),eD="server_call",$V=(0,JI.promisify)(XI.unzip),QV=(0,JI.promisify)(XI.inflate);function Hl(n){ZI.trace(Ie.LogVerbosity.DEBUG,eD,n)}var YV="grpc-accept-encoding",XV="grpc-encoding",KI="grpc-message",WI="grpc-status",$I="grpc-timeout",JV=/(\d{1,8})\s*([HMSmun])/,ZV={H:36e5,M:6e4,S:1e3,m:1,u:.001,n:1e-6},eq={[YV]:"identity,deflate,gzip",[XV]:"identity"},QI={[Uo.constants.HTTP2_HEADER_STATUS]:Uo.constants.HTTP_STATUS_OK,[Uo.constants.HTTP2_HEADER_CONTENT_TYPE]:"application/grpc+proto"},tq={waitForTrailers:!0},Av=class extends YI.EventEmitter{constructor(e,t,r){super(),this.call=e,this.metadata=t,this.request=r,this.cancelled=!1,this.call.setupSurfaceCall(this)}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};fn.ServerUnaryCallImpl=Av;var Dh=class extends Dv.Readable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.deserialize=r,this.cancelled=!1,this.call.setupSurfaceCall(this),this.call.setupReadable(this,i)}_read(e){this.call.consumeUnpushedMessages(this)&&this.call.resume()}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}};fn.ServerReadableStreamImpl=Dh;var Wl=class extends Dv.Writable{constructor(e,t,r,i){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.request=i,this.cancelled=!1,this.trailingMetadata=new Rv.Metadata,this.call.setupSurfaceCall(this),this.on("error",s=>{this.call.sendError(s),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}_write(e,t,r){try{let i=this.call.serializeMessage(e);if(!this.call.write(i)){this.call.once("drain",r);return}}catch(i){this.emit("error",{details:(0,Kl.getErrorMessage)(i),code:Ie.Status.INTERNAL})}r()}_final(e){this.call.sendStatus({code:Ie.Status.OK,details:"OK",metadata:this.trailingMetadata}),e(null)}end(e){return e&&(this.trailingMetadata=e),super.end()}};fn.ServerWritableStreamImpl=Wl;var zo=class extends Dv.Duplex{constructor(e,t,r,i,s){super({objectMode:!0}),this.call=e,this.metadata=t,this.serialize=r,this.deserialize=i,this.cancelled=!1,this.trailingMetadata=new Rv.Metadata,this.call.setupSurfaceCall(this),this.call.setupReadable(this,s),this.on("error",o=>{this.call.sendError(o),this.end()})}getPeer(){return this.call.getPeer()}sendMetadata(e){this.call.sendMetadata(e)}getDeadline(){return this.call.getDeadline()}getPath(){return this.call.getPath()}end(e){return e&&(this.trailingMetadata=e),super.end()}};fn.ServerDuplexStreamImpl=zo;zo.prototype._read=Dh.prototype._read;zo.prototype._write=Wl.prototype._write;zo.prototype._final=Wl.prototype._final;var Iv=class extends YI.EventEmitter{constructor(e,t,r){super(),this.stream=e,this.handler=t,this.cancelled=!1,this.deadlineTimer=null,this.statusSent=!1,this.deadline=1/0,this.wantTrailers=!1,this.metadataSent=!1,this.canPush=!1,this.isPushPending=!1,this.bufferedMessages=[],this.messagesToPush=[],this.maxSendMessageSize=Ie.DEFAULT_MAX_SEND_MESSAGE_LENGTH,this.maxReceiveMessageSize=Ie.DEFAULT_MAX_RECEIVE_MESSAGE_LENGTH,this.stream.once("error",i=>{}),this.stream.once("close",()=>{var i;Hl("Request to method "+((i=this.handler)===null||i===void 0?void 0:i.path)+" stream closed with rstCode "+this.stream.rstCode),this.statusSent||(this.cancelled=!0,this.emit("cancelled","cancelled"),this.emit("streamEnd",!1),this.sendStatus({code:Ie.Status.CANCELLED,details:"Cancelled by client",metadata:null}),this.deadlineTimer&&clearTimeout(this.deadlineTimer))}),this.stream.on("drain",()=>{this.emit("drain")}),"grpc.max_send_message_length"in r&&(this.maxSendMessageSize=r["grpc.max_send_message_length"]),"grpc.max_receive_message_length"in r&&(this.maxReceiveMessageSize=r["grpc.max_receive_message_length"])}checkCancelled(){return(this.stream.destroyed||this.stream.closed)&&(this.cancelled=!0),this.cancelled}getDecompressedMessage(e,t){return t==="deflate"?QV(e.subarray(5)):t==="gzip"?$V(e.subarray(5)):t==="identity"?e.subarray(5):Promise.reject({code:Ie.Status.UNIMPLEMENTED,details:`Received message compressed with unsupported encoding "${t}"`})}sendMetadata(e){if(this.checkCancelled()||this.metadataSent)return;this.metadataSent=!0;let t=e?e.toHttp2Headers():null,r=Object.assign(Object.assign(Object.assign({},QI),eq),t);this.stream.respond(r,tq)}receiveMetadata(e){let t=Rv.Metadata.fromHttp2Headers(e);ZI.isTracerEnabled(eD)&&Hl("Request to "+this.handler.path+" received headers "+JSON.stringify(t.toJSON()));let r=t.get($I);if(r.length>0){let i=r[0].toString().match(JV);if(i===null){let a=new Error("Invalid deadline");return a.code=Ie.Status.OUT_OF_RANGE,this.sendError(a),t}let s=+i[1]*ZV[i[2]]|0,o=new Date;this.deadline=o.setMilliseconds(o.getMilliseconds()+s),this.deadlineTimer=setTimeout(nq,s,this),t.remove($I)}return t.remove(Uo.constants.HTTP2_HEADER_ACCEPT_ENCODING),t.remove(Uo.constants.HTTP2_HEADER_TE),t.remove(Uo.constants.HTTP2_HEADER_CONTENT_TYPE),t.remove("grpc-accept-encoding"),t}receiveUnaryMessage(e){return new Promise((t,r)=>{let{stream:i}=this,s=0,o=this,a=[],l=this.maxReceiveMessageSize;this.stream.on("data",c),this.stream.on("end",u),this.stream.on("error",u);function c(d){if(s+=d.byteLength,l!==-1&&s>l){i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),r({code:Ie.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${s} vs. ${l})`});return}a.push(d)}function u(d){if(i.removeListener("data",c),i.removeListener("end",u),i.removeListener("error",u),d!==void 0){r({code:Ie.Status.INTERNAL,details:d.message});return}if(s===0){r({code:Ie.Status.INTERNAL,details:"received empty unary message"});return}o.emit("receiveMessage");let h=Buffer.concat(a,s),y=h.readUInt8(0)===1?e:"identity",_=o.getDecompressedMessage(h,y);if(Buffer.isBuffer(_)){t(o.deserializeMessageWithInternalError(_));return}_.then(S=>t(o.deserializeMessageWithInternalError(S)),S=>r(S.code?S:{code:Ie.Status.INTERNAL,details:`Received "grpc-encoding" header "${e}" but ${e} decompression failed`}))}})}deserializeMessageWithInternalError(e){return g(this,null,function*(){try{return this.deserializeMessage(e)}catch(t){throw{details:(0,Kl.getErrorMessage)(t),code:Ie.Status.INTERNAL}}})}serializeMessage(e){let t=this.handler.serialize(e),r=t.byteLength,i=Buffer.allocUnsafe(r+5);return i.writeUInt8(0,0),i.writeUInt32BE(r,1),t.copy(i,5),i}deserializeMessage(e){return this.handler.deserialize(e)}sendUnaryMessage(e,t,r,i){return g(this,null,function*(){if(!this.checkCancelled()){if(r===void 0&&(r=null),e){!Object.prototype.hasOwnProperty.call(e,"metadata")&&r&&(e.metadata=r),this.sendError(e);return}try{let s=this.serializeMessage(t);this.write(s),this.sendStatus({code:Ie.Status.OK,details:"OK",metadata:r})}catch(s){this.sendError({details:(0,Kl.getErrorMessage)(s),code:Ie.Status.INTERNAL})}}})}sendStatus(e){var t,r;if(this.emit("callEnd",e.code),this.emit("streamEnd",e.code===Ie.Status.OK),!this.checkCancelled())if(Hl("Request to method "+((t=this.handler)===null||t===void 0?void 0:t.path)+" ended with status code: "+Ie.Status[e.code]+" details: "+e.details),this.deadlineTimer&&clearTimeout(this.deadlineTimer),this.stream.headersSent)this.wantTrailers||(this.wantTrailers=!0,this.stream.once("wantTrailers",()=>{var i;let s=Object.assign({[WI]:e.code,[KI]:encodeURI(e.details)},(i=e.metadata)===null||i===void 0?void 0:i.toHttp2Headers());this.stream.sendTrailers(s),this.statusSent=!0}),this.stream.end());else{let i=Object.assign(Object.assign({[WI]:e.code,[KI]:encodeURI(e.details)},QI),(r=e.metadata)===null||r===void 0?void 0:r.toHttp2Headers());this.stream.respond(i,{endStream:!0}),this.statusSent=!0}}sendError(e){let t={code:Ie.Status.UNKNOWN,details:"message"in e?e.message:"Unknown Error",metadata:"metadata"in e&&e.metadata!==void 0?e.metadata:null};"code"in e&&typeof e.code=="number"&&Number.isInteger(e.code)&&(t.code=e.code,"details"in e&&typeof e.details=="string"&&(t.details=e.details)),this.sendStatus(t)}write(e){if(!this.checkCancelled()){if(this.maxSendMessageSize!==-1&&e.length>this.maxSendMessageSize){this.sendError({code:Ie.Status.RESOURCE_EXHAUSTED,details:`Sent message larger than max (${e.length} vs. ${this.maxSendMessageSize})`});return}return this.sendMetadata(),this.emit("sendMessage"),this.stream.write(e)}}resume(){this.stream.resume()}setupSurfaceCall(e){this.once("cancelled",t=>{e.cancelled=!0,e.emit("cancelled",t)}),this.once("callEnd",t=>e.emit("callEnd",t))}setupReadable(e,t){let r=new WV.StreamDecoder,i=!1,s=!1,o=!1,a=()=>g(this,null,function*(){!o&&i&&!s&&(o=!0,yield this.pushOrBufferMessage(e,null))});this.stream.on("data",l=>g(this,null,function*(){let c=r.write(l);s=!0,this.stream.pause();for(let u of c){if(this.maxReceiveMessageSize!==-1&&u.length>this.maxReceiveMessageSize){this.sendError({code:Ie.Status.RESOURCE_EXHAUSTED,details:`Received message larger than max (${u.length} vs. ${this.maxReceiveMessageSize})`});return}this.emit("receiveMessage");let h=u.readUInt8(0)===1?t:"identity",p=yield this.getDecompressedMessage(u,h);if(!p)return;yield this.pushOrBufferMessage(e,p)}s=!1,this.stream.resume(),yield a()})),this.stream.once("end",()=>g(this,null,function*(){i=!0,yield a()}))}consumeUnpushedMessages(e){for(this.canPush=!0;this.messagesToPush.length>0;){let t=this.messagesToPush.shift(),r=e.push(t);if(t===null||r===!1){this.canPush=!1;break}}return this.canPush}pushOrBufferMessage(e,t){return g(this,null,function*(){this.isPushPending?this.bufferedMessages.push(t):yield this.pushMessage(e,t)})}pushMessage(e,t){return g(this,null,function*(){if(t===null){Hl("Received end of stream"),this.canPush?e.push(null):this.messagesToPush.push(null);return}Hl("Received message of length "+t.length),this.isPushPending=!0;try{let r=yield this.deserializeMessage(t);this.canPush?e.push(r)||(this.canPush=!1,this.stream.pause()):this.messagesToPush.push(r)}catch(r){this.bufferedMessages.length=0;let i=(0,Kl.getErrorCode)(r);(i===null||i<Ie.Status.OK||i>Ie.Status.UNAUTHENTICATED)&&(i=Ie.Status.INTERNAL),e.emit("error",{details:(0,Kl.getErrorMessage)(r),code:i})}this.isPushPending=!1,this.bufferedMessages.length>0&&(yield this.pushMessage(e,this.bufferedMessages.shift()))})}getPeer(){var e;let t=(e=this.stream.session)===null||e===void 0?void 0:e.socket;return t?.remoteAddress?t.remotePort?`${t.remoteAddress}:${t.remotePort}`:t.remoteAddress:"unknown"}getDeadline(){return this.deadline}getPath(){return this.handler.path}};fn.Http2ServerCallStream=Iv;function nq(n){let e=new Error("Deadline exceeded");e.code=Ie.Status.DEADLINE_EXCEEDED,n.sendError(e),n.cancelled=!0,n.emit("cancelled","deadline")}});var Mv=w(Rh=>{"use strict";Object.defineProperty(Rh,"__esModule",{value:!0});Rh.ServerCredentials=void 0;var nD=Jg(),$l=class{static createInsecure(){return new Nv}static createSsl(e,t,r=!1){if(e!==null&&!Buffer.isBuffer(e))throw new TypeError("rootCerts must be null or a Buffer");if(!Array.isArray(t))throw new TypeError("keyCertPairs must be an array");if(typeof r!="boolean")throw new TypeError("checkClientCertificate must be a boolean");let i=[],s=[];for(let o=0;o<t.length;o++){let a=t[o];if(a===null||typeof a!="object")throw new TypeError(`keyCertPair[${o}] must be an object`);if(!Buffer.isBuffer(a.private_key))throw new TypeError(`keyCertPair[${o}].private_key must be a Buffer`);if(!Buffer.isBuffer(a.cert_chain))throw new TypeError(`keyCertPair[${o}].cert_chain must be a Buffer`);i.push(a.cert_chain),s.push(a.private_key)}return new kv({ca:e||(0,nD.getDefaultRootsData)()||void 0,cert:i,key:s,requestCert:r,ciphers:nD.CIPHER_SUITES})}};Rh.ServerCredentials=$l;var Nv=class extends $l{_isSecure(){return!1}_getSettings(){return null}},kv=class extends $l{constructor(e){super(),this.options=e}_isSecure(){return!0}_getSettings(){return this.options}}});var sD=w(Mh=>{"use strict";Object.defineProperty(Mh,"__esModule",{value:!0});Mh.Server=void 0;var yi=de("http2"),Ir=le(),ls=tD(),rq=Mv(),rD=zn(),Nh=Le(),Rn=Gn(),iq=Wt(),jt=os(),kh=~(1<<31),sq=~(1<<31),oq=2e4,{HTTP2_HEADER_PATH:iD}=yi.constants,aq="server";function lq(){}function Ov(n){return{code:Ir.Status.UNIMPLEMENTED,details:`The server does not implement the method ${n}`}}function cq(n,e){let t=Ov(e);switch(n){case"unary":return(r,i)=>{i(t,null)};case"clientStream":return(r,i)=>{i(t,null)};case"serverStream":return r=>{r.emit("error",t)};case"bidi":return r=>{r.emit("error",t)};default:throw new Error(`Invalid handlerType ${n}`)}}var xv=class{constructor(e){var t,r,i,s;this.http2ServerList=[],this.handlers=new Map,this.sessions=new Map,this.started=!1,this.shutdown=!1,this.serverAddressString="null",this.channelzEnabled=!0,this.channelzTrace=new jt.ChannelzTrace,this.callTracker=new jt.ChannelzCallTracker,this.listenerChildrenTracker=new jt.ChannelzChildrenTracker,this.sessionChildrenTracker=new jt.ChannelzChildrenTracker,this.options=e??{},this.options["grpc.enable_channelz"]===0&&(this.channelzEnabled=!1),this.channelzRef=(0,jt.registerChannelzServer)(()=>this.getChannelzInfo(),this.channelzEnabled),this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Server created"),this.maxConnectionAgeMs=(t=this.options["grpc.max_connection_age_ms"])!==null&&t!==void 0?t:kh,this.maxConnectionAgeGraceMs=(r=this.options["grpc.max_connection_age_grace_ms"])!==null&&r!==void 0?r:kh,this.keepaliveTimeMs=(i=this.options["grpc.keepalive_time_ms"])!==null&&i!==void 0?i:sq,this.keepaliveTimeoutMs=(s=this.options["grpc.keepalive_timeout_ms"])!==null&&s!==void 0?s:oq,this.trace("Server constructed")}getChannelzInfo(){return{trace:this.channelzTrace,callTracker:this.callTracker,listenerChildren:this.listenerChildrenTracker.getChildLists(),sessionChildren:this.sessionChildrenTracker.getChildLists()}}getChannelzSessionInfoGetter(e){return()=>{var t,r,i;let s=this.sessions.get(e),o=e.socket,a=o.remoteAddress?(0,Rn.stringToSubchannelAddress)(o.remoteAddress,o.remotePort):null,l=o.localAddress?(0,Rn.stringToSubchannelAddress)(o.localAddress,o.localPort):null,c;if(e.encrypted){let d=o,h=d.getCipher(),p=d.getCertificate(),y=d.getPeerCertificate();c={cipherSuiteStandardName:(t=h.standardName)!==null&&t!==void 0?t:null,cipherSuiteOtherName:h.standardName?null:h.name,localCertificate:p&&"raw"in p?p.raw:null,remoteCertificate:y&&"raw"in y?y.raw:null}}else c=null;return{remoteAddress:a,localAddress:l,security:c,remoteName:null,streamsStarted:s.streamTracker.callsStarted,streamsSucceeded:s.streamTracker.callsSucceeded,streamsFailed:s.streamTracker.callsFailed,messagesSent:s.messagesSent,messagesReceived:s.messagesReceived,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:s.streamTracker.lastCallStartedTimestamp,lastMessageSentTimestamp:s.lastMessageSentTimestamp,lastMessageReceivedTimestamp:s.lastMessageReceivedTimestamp,localFlowControlWindow:(r=e.state.localWindowSize)!==null&&r!==void 0?r:null,remoteFlowControlWindow:(i=e.state.remoteWindowSize)!==null&&i!==void 0?i:null}}}trace(e){Nh.trace(Ir.LogVerbosity.DEBUG,aq,"("+this.channelzRef.id+") "+e)}addProtoService(){throw new Error("Not implemented. Use addService() instead")}addService(e,t){if(e===null||typeof e!="object"||t===null||typeof t!="object")throw new Error("addService() requires two objects as arguments");let r=Object.keys(e);if(r.length===0)throw new Error("Cannot add an empty service to a server");r.forEach(i=>{let s=e[i],o;s.requestStream?s.responseStream?o="bidi":o="clientStream":s.responseStream?o="serverStream":o="unary";let a=t[i],l;if(a===void 0&&typeof s.originalName=="string"&&(a=t[s.originalName]),a!==void 0?l=a.bind(t):l=cq(o,i),this.register(s.path,l,s.responseSerialize,s.requestDeserialize,o)===!1)throw new Error(`Method handler for ${s.path} already provided.`)})}removeService(e){if(e===null||typeof e!="object")throw new Error("removeService() requires object as argument");Object.keys(e).forEach(r=>{let i=e[r];this.unregister(i.path)})}bind(e,t){throw new Error("Not implemented. Use bindAsync() instead")}bindAsync(e,t,r){if(this.started===!0)throw new Error("server is already started");if(this.shutdown)throw new Error("bindAsync called after shutdown");if(typeof e!="string")throw new TypeError("port must be a string");if(t===null||!(t instanceof rq.ServerCredentials))throw new TypeError("creds must be a ServerCredentials object");if(typeof r!="function")throw new TypeError("callback must be a function");let i=(0,iq.parseUri)(e);if(i===null)throw new Error(`Could not parse port "${e}"`);let s=(0,rD.mapUriDefaultScheme)(i);if(s===null)throw new Error(`Could not get a default scheme for port "${e}"`);let o={maxSendHeaderBlockLength:Number.MAX_SAFE_INTEGER};"grpc-node.max_session_memory"in this.options?o.maxSessionMemory=this.options["grpc-node.max_session_memory"]:o.maxSessionMemory=Number.MAX_SAFE_INTEGER,"grpc.max_concurrent_streams"in this.options&&(o.settings={maxConcurrentStreams:this.options["grpc.max_concurrent_streams"]});let a=(p,y)=>{process.nextTick(()=>r(p,y))},l=()=>{let p;if(t._isSecure()){let y=Object.assign(o,t._getSettings());y.enableTrace=this.options["grpc-node.tls_enable_trace"]===1,p=yi.createSecureServer(y),p.on("secureConnection",_=>{_.on("error",S=>{this.trace("An incoming TLS connection closed with error: "+S.message)})})}else p=yi.createServer(o);return p.setTimeout(0,lq),this._setupHandlers(p),p},c=(p,y,_)=>p.length===0?Promise.resolve({port:y,count:_}):Promise.all(p.map(S=>{this.trace("Attempting to bind "+(0,Rn.subchannelAddressToString)(S));let R;(0,Rn.isTcpSubchannelAddress)(S)?R={host:S.host,port:y}:R=S;let E=l();return new Promise((N,k)=>{let V=W=>{this.trace("Failed to bind "+(0,Rn.subchannelAddressToString)(S)+" with error "+W.message),N(W)};E.once("error",V),E.listen(R,()=>{if(this.shutdown){E.close(),N(new Error("bindAsync failed because server is shutdown"));return}let W=E.address(),te;typeof W=="string"?te={path:W}:te={host:W.address,port:W.port};let Je=(0,jt.registerChannelzSocket)((0,Rn.subchannelAddressToString)(te),()=>({localAddress:te,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(Je),this.http2ServerList.push({server:E,channelzRef:Je}),this.trace("Successfully bound "+(0,Rn.subchannelAddressToString)(te)),N("port"in te?te.port:y),E.removeListener("error",V)})})})).then(S=>{let R=0;for(let E of S)if(typeof E=="number"&&(R+=1,E!==y))throw new Error("Invalid state: multiple port numbers added from single address");return{port:y,count:R+_}}),u=p=>{if(p.length===0)return Promise.resolve({port:0,count:0});let y=p[0],_=l();return new Promise((S,R)=>{let E=N=>{this.trace("Failed to bind "+(0,Rn.subchannelAddressToString)(y)+" with error "+N.message),S(u(p.slice(1)))};_.once("error",E),_.listen(y,()=>{if(this.shutdown){_.close(),S({port:0,count:0});return}let N=_.address(),k={host:N.address,port:N.port},V=(0,jt.registerChannelzSocket)((0,Rn.subchannelAddressToString)(k),()=>({localAddress:k,remoteAddress:null,security:null,remoteName:null,streamsStarted:0,streamsSucceeded:0,streamsFailed:0,messagesSent:0,messagesReceived:0,keepAlivesSent:0,lastLocalStreamCreatedTimestamp:null,lastRemoteStreamCreatedTimestamp:null,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null,localFlowControlWindow:null,remoteFlowControlWindow:null}),this.channelzEnabled);this.channelzEnabled&&this.listenerChildrenTracker.refChild(V),this.http2ServerList.push({server:_,channelzRef:V}),this.trace("Successfully bound "+(0,Rn.subchannelAddressToString)(k)),S(c(p.slice(1),N.port,1)),_.removeListener("error",E)})})},d={onSuccessfulResolution:(p,y,_)=>{if(d.onSuccessfulResolution=()=>{},this.shutdown&&a(new Error("bindAsync failed because server is shutdown"),0),p.length===0){a(new Error(`No addresses resolved for port ${e}`),0);return}let S;(0,Rn.isTcpSubchannelAddress)(p[0])?p[0].port===0?S=u(p):S=c(p,p[0].port,0):S=c(p,1,0),S.then(R=>{if(R.count===0){let E=`No address added out of total ${p.length} resolved`;Nh.log(Ir.LogVerbosity.ERROR,E),a(new Error(E),0)}else R.count<p.length&&Nh.log(Ir.LogVerbosity.INFO,`WARNING Only ${R.count} addresses added out of total ${p.length} resolved`),a(null,R.port)},R=>{let E=`No address added out of total ${p.length} resolved`;Nh.log(Ir.LogVerbosity.ERROR,E),a(new Error(E),0)})},onError:p=>{a(new Error(p.details),0)}};(0,rD.createResolver)(s,d,this.options).updateResolution()}forceShutdown(){for(let{server:e,channelzRef:t}of this.http2ServerList)e.listening&&e.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(t),(0,jt.unregisterChannelzRef)(t))});this.started=!1,this.shutdown=!0,this.sessions.forEach((e,t)=>{t.destroy(yi.constants.NGHTTP2_CANCEL)}),this.sessions.clear(),this.channelzEnabled&&(0,jt.unregisterChannelzRef)(this.channelzRef)}register(e,t,r,i,s){return this.handlers.has(e)?!1:(this.handlers.set(e,{func:t,serialize:r,deserialize:i,type:s,path:e}),!0)}unregister(e){return this.handlers.delete(e)}start(){if(this.http2ServerList.length===0||this.http2ServerList.every(({server:e})=>e.listening!==!0))throw new Error("server must be bound in order to start");if(this.started===!0)throw new Error("server is already started");this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Starting"),this.started=!0}tryShutdown(e){let t=s=>{this.channelzEnabled&&(0,jt.unregisterChannelzRef)(this.channelzRef),e(s)},r=0;function i(){r--,r===0&&t()}this.started=!1,this.shutdown=!0;for(let{server:s,channelzRef:o}of this.http2ServerList)s.listening&&(r++,s.close(()=>{this.channelzEnabled&&(this.listenerChildrenTracker.unrefChild(o),(0,jt.unregisterChannelzRef)(o)),i()}));this.sessions.forEach((s,o)=>{o.closed||(r+=1,o.close(i))}),r===0&&t()}addHttp2Port(){throw new Error("Not yet implemented")}getChannelzRef(){return this.channelzRef}_verifyContentType(e,t){let r=t[yi.constants.HTTP2_HEADER_CONTENT_TYPE];return typeof r!="string"||!r.startsWith("application/grpc")?(e.respond({[yi.constants.HTTP2_HEADER_STATUS]:yi.constants.HTTP_STATUS_UNSUPPORTED_MEDIA_TYPE},{endStream:!0}),!1):!0}_retrieveHandler(e){this.trace("Received call to method "+e+" at address "+this.serverAddressString);let t=this.handlers.get(e);return t===void 0?(this.trace("No handler registered for method "+e+". Sending UNIMPLEMENTED status."),null):t}_respondWithError(e,t,r=null){let i=new ls.Http2ServerCallStream(t,null,this.options);e.code===void 0&&(e.code=Ir.Status.INTERNAL),this.channelzEnabled&&(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed()),i.sendError(e)}_channelzHandler(e,t){let r=this.sessions.get(e.session);if(this.callTracker.addCallStarted(),r?.streamTracker.addCallStarted(),!this._verifyContentType(e,t)){this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed();return}let i=t[iD],s=this._retrieveHandler(i);if(!s){this._respondWithError(Ov(i),e,r);return}let o=new ls.Http2ServerCallStream(e,s,this.options);o.once("callEnd",a=>{a===Ir.Status.OK?this.callTracker.addCallSucceeded():this.callTracker.addCallFailed()}),r&&(o.once("streamEnd",a=>{a?r.streamTracker.addCallSucceeded():r.streamTracker.addCallFailed()}),o.on("sendMessage",()=>{r.messagesSent+=1,r.lastMessageSentTimestamp=new Date}),o.on("receiveMessage",()=>{r.messagesReceived+=1,r.lastMessageReceivedTimestamp=new Date})),this._runHandlerForCall(o,s,t)||(this.callTracker.addCallFailed(),r?.streamTracker.addCallFailed(),o.sendError({code:Ir.Status.INTERNAL,details:`Unknown handler type: ${s.type}`}))}_streamHandler(e,t){if(this._verifyContentType(e,t)!==!0)return;let r=t[iD],i=this._retrieveHandler(r);if(!i){this._respondWithError(Ov(r),e,null);return}let s=new ls.Http2ServerCallStream(e,i,this.options);this._runHandlerForCall(s,i,t)||s.sendError({code:Ir.Status.INTERNAL,details:`Unknown handler type: ${i.type}`})}_runHandlerForCall(e,t,r){var i;let s=e.receiveMetadata(r),o=(i=s.get("grpc-encoding")[0])!==null&&i!==void 0?i:"identity";s.remove("grpc-encoding");let{type:a}=t;if(a==="unary")uq(e,t,s,o);else if(a==="clientStream")dq(e,t,s,o);else if(a==="serverStream")hq(e,t,s,o);else if(a==="bidi")fq(e,t,s,o);else return!1;return!0}_setupHandlers(e){if(e===null)return;let t=e.address(),r="null";t&&(typeof t=="string"?r=t:r=t.address+":"+t.port),this.serverAddressString=r;let i=this.channelzEnabled?this._channelzHandler:this._streamHandler;e.on("stream",i.bind(this)),e.on("session",s=>{var o,a,l,c,u;if(!this.started){s.destroy();return}let d=(0,jt.registerChannelzSocket)((o=s.socket.remoteAddress)!==null&&o!==void 0?o:"unknown",this.getChannelzSessionInfoGetter(s),this.channelzEnabled),h={ref:d,streamTracker:new jt.ChannelzCallTracker,messagesSent:0,messagesReceived:0,lastMessageSentTimestamp:null,lastMessageReceivedTimestamp:null};this.sessions.set(s,h);let p=s.socket.remoteAddress;this.channelzEnabled&&(this.channelzTrace.addTrace("CT_INFO","Connection established by client "+p),this.sessionChildrenTracker.refChild(d));let y=null,_=null,S=!1;if(this.maxConnectionAgeMs!==kh){let E=this.maxConnectionAgeMs/10,N=Math.random()*E*2-E;y=(l=(a=setTimeout(()=>{var k,V;S=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by max connection age from "+p);try{s.goaway(yi.constants.NGHTTP2_NO_ERROR,~(1<<31),Buffer.from("max_age"))}catch{s.destroy();return}s.close(),this.maxConnectionAgeGraceMs!==kh&&(_=(V=(k=setTimeout(()=>{s.destroy()},this.maxConnectionAgeGraceMs)).unref)===null||V===void 0?void 0:V.call(k))},this.maxConnectionAgeMs+N)).unref)===null||l===void 0?void 0:l.call(a)}let R=(u=(c=setInterval(()=>{var E,N;let k=(N=(E=setTimeout(()=>{S=!0,this.channelzEnabled&&this.channelzTrace.addTrace("CT_INFO","Connection dropped by keepalive timeout from "+p),s.close()},this.keepaliveTimeoutMs)).unref)===null||N===void 0?void 0:N.call(E);try{s.ping((V,W,te)=>{clearTimeout(k)})}catch{s.destroy()}},this.keepaliveTimeMs)).unref)===null||u===void 0?void 0:u.call(c);s.on("close",()=>{this.channelzEnabled&&(S||this.channelzTrace.addTrace("CT_INFO","Connection dropped by client "+p),this.sessionChildrenTracker.unrefChild(d),(0,jt.unregisterChannelzRef)(d)),y&&clearTimeout(y),_&&clearTimeout(_),R&&clearTimeout(R),this.sessions.delete(s)})})}};Mh.Server=xv;function uq(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ls.ServerUnaryCallImpl(n,t,i);e.func(s,(o,a,l,c)=>{n.sendUnaryMessage(o,a,l,c)})}catch(i){n.sendError(i)}})}function dq(n,e,t,r){let i=new ls.ServerReadableStreamImpl(n,t,e.deserialize,r);function s(o,a,l,c){i.destroy(),n.sendUnaryMessage(o,a,l,c)}n.cancelled||(i.on("error",s),e.func(i,s))}function hq(n,e,t,r){return g(this,null,function*(){try{let i=yield n.receiveUnaryMessage(r);if(i===void 0||n.cancelled)return;let s=new ls.ServerWritableStreamImpl(n,t,e.serialize,i);e.func(s)}catch(i){n.sendError(i)}})}function fq(n,e,t,r){let i=new ls.ServerDuplexStreamImpl(n,t,e.serialize,e.deserialize,r);n.cancelled||e.func(i)}});var oD=w(Oh=>{"use strict";Object.defineProperty(Oh,"__esModule",{value:!0});Oh.StatusBuilder=void 0;var Pv=class{constructor(){this.code=null,this.details=null,this.metadata=null}withCode(e){return this.code=e,this}withDetails(e){return this.details=e,this}withMetadata(e){return this.metadata=e,this}build(){let e={};return this.code!==null&&(e.code=this.code),this.details!==null&&(e.details=this.details),this.metadata!==null&&(e.metadata=this.metadata),e}};Oh.StatusBuilder=Pv});var Fv=w(vi=>{"use strict";Object.defineProperty(vi,"__esModule",{value:!0});vi.isDuration=vi.durationToMs=vi.msToDuration=void 0;function pq(n){return{seconds:n/1e3|0,nanos:n%1e3*1e6|0}}vi.msToDuration=pq;function gq(n){return n.seconds*1e3+n.nanos/1e6|0}vi.durationToMs=gq;function mq(n){return typeof n.seconds=="number"&&typeof n.nanos=="number"}vi.isDuration=mq});var Gv=w(_i=>{"use strict";var Lv;Object.defineProperty(_i,"__esModule",{value:!0});_i.setup=_i.OutlierDetectionLoadBalancer=_i.OutlierDetectionLoadBalancingConfig=void 0;var Ph=rn(),lD=le(),cs=Fv(),cD=Hv(),uD=Qr(),yq=fd(),vq=Zr(),aD=Gn(),_q=Th(),Sq=Le(),wq="outlier_detection";function st(n){Sq.trace(lD.LogVerbosity.DEBUG,wq,n)}var jv="outlier_detection",Eq=((Lv=process.env.GRPC_EXPERIMENTAL_ENABLE_OUTLIER_DETECTION)!==null&&Lv!==void 0?Lv:"true")==="true",Tq={stdev_factor:1900,enforcement_percentage:100,minimum_hosts:5,request_volume:100},Cq={threshold:85,enforcement_percentage:100,minimum_hosts:5,request_volume:50};function jo(n,e,t,r){if(e in n&&typeof n[e]!==t){let i=r?`${r}.${e}`:e;throw new Error(`outlier detection config ${i} parse error: expected ${t}, got ${typeof n[e]}`)}}function Bv(n,e,t){let r=t?`${t}.${e}`:e;if(e in n){if(!(0,cs.isDuration)(n[e]))throw new Error(`outlier detection config ${r} parse error: expected Duration, got ${typeof n[e]}`);if(!(n[e].seconds>=0&&n[e].seconds<=315576e6&&n[e].nanos>=0&&n[e].nanos<=999999999))throw new Error(`outlier detection config ${r} parse error: values out of range for non-negative Duaration`)}}function xh(n,e,t){let r=t?`${t}.${e}`:e;if(jo(n,e,"number",t),e in n&&!(n[e]>=0&&n[e]<=100))throw new Error(`outlier detection config ${r} parse error: value out of range for percentage (0-100)`)}var Ql=class n{constructor(e,t,r,i,s,o,a){if(this.childPolicy=a,a.length>0&&a[0].getLoadBalancerName()==="pick_first")throw new Error("outlier_detection LB policy cannot have a pick_first child policy");this.intervalMs=e??1e4,this.baseEjectionTimeMs=t??3e4,this.maxEjectionTimeMs=r??3e5,this.maxEjectionPercent=i??10,this.successRateEjection=s?Object.assign(Object.assign({},Tq),s):null,this.failurePercentageEjection=o?Object.assign(Object.assign({},Cq),o):null}getLoadBalancerName(){return jv}toJsonObject(){return{interval:(0,cs.msToDuration)(this.intervalMs),base_ejection_time:(0,cs.msToDuration)(this.baseEjectionTimeMs),max_ejection_time:(0,cs.msToDuration)(this.maxEjectionTimeMs),max_ejection_percent:this.maxEjectionPercent,success_rate_ejection:this.successRateEjection,failure_percentage_ejection:this.failurePercentageEjection,child_policy:this.childPolicy.map(e=>e.toJsonObject())}}getIntervalMs(){return this.intervalMs}getBaseEjectionTimeMs(){return this.baseEjectionTimeMs}getMaxEjectionTimeMs(){return this.maxEjectionTimeMs}getMaxEjectionPercent(){return this.maxEjectionPercent}getSuccessRateEjectionConfig(){return this.successRateEjection}getFailurePercentageEjectionConfig(){return this.failurePercentageEjection}getChildPolicy(){return this.childPolicy}copyWithChildPolicy(e){return new n(this.intervalMs,this.baseEjectionTimeMs,this.maxEjectionTimeMs,this.maxEjectionPercent,this.successRateEjection,this.failurePercentageEjection,e)}static createFromJson(e){var t;if(Bv(e,"interval"),Bv(e,"base_ejection_time"),Bv(e,"max_ejection_time"),xh(e,"max_ejection_percent"),"success_rate_ejection"in e){if(typeof e.success_rate_ejection!="object")throw new Error("outlier detection config success_rate_ejection must be an object");jo(e.success_rate_ejection,"stdev_factor","number","success_rate_ejection"),xh(e.success_rate_ejection,"enforcement_percentage","success_rate_ejection"),jo(e.success_rate_ejection,"minimum_hosts","number","success_rate_ejection"),jo(e.success_rate_ejection,"request_volume","number","success_rate_ejection")}if("failure_percentage_ejection"in e){if(typeof e.failure_percentage_ejection!="object")throw new Error("outlier detection config failure_percentage_ejection must be an object");xh(e.failure_percentage_ejection,"threshold","failure_percentage_ejection"),xh(e.failure_percentage_ejection,"enforcement_percentage","failure_percentage_ejection"),jo(e.failure_percentage_ejection,"minimum_hosts","number","failure_percentage_ejection"),jo(e.failure_percentage_ejection,"request_volume","number","failure_percentage_ejection")}return new n(e.interval?(0,cs.durationToMs)(e.interval):null,e.base_ejection_time?(0,cs.durationToMs)(e.base_ejection_time):null,e.max_ejection_time?(0,cs.durationToMs)(e.max_ejection_time):null,(t=e.max_ejection_percent)!==null&&t!==void 0?t:null,e.success_rate_ejection,e.failure_percentage_ejection,e.child_policy.map(uD.validateLoadBalancingConfig))}};_i.OutlierDetectionLoadBalancingConfig=Ql;var qv=class extends _q.BaseSubchannelWrapper{constructor(e,t){super(e),this.mapEntry=t,this.stateListeners=[],this.ejected=!1,this.refCount=0,this.childSubchannelState=e.getConnectivityState(),e.addConnectivityStateListener((r,i,s,o)=>{if(this.childSubchannelState=s,!this.ejected)for(let a of this.stateListeners)a(this,i,s,o)})}getConnectivityState(){return this.ejected?Ph.ConnectivityState.TRANSIENT_FAILURE:this.childSubchannelState}addConnectivityStateListener(e){this.stateListeners.push(e)}removeConnectivityStateListener(e){let t=this.stateListeners.indexOf(e);t>-1&&this.stateListeners.splice(t,1)}ref(){this.child.ref(),this.refCount+=1}unref(){if(this.child.unref(),this.refCount-=1,this.refCount<=0&&this.mapEntry){let e=this.mapEntry.subchannelWrappers.indexOf(this);e>=0&&this.mapEntry.subchannelWrappers.splice(e,1)}}eject(){this.ejected=!0;for(let e of this.stateListeners)e(this,this.childSubchannelState,Ph.ConnectivityState.TRANSIENT_FAILURE,-1)}uneject(){this.ejected=!1;for(let e of this.stateListeners)e(this,Ph.ConnectivityState.TRANSIENT_FAILURE,this.childSubchannelState,-1)}getMapEntry(){return this.mapEntry}getWrappedSubchannel(){return this.child}};function Vv(){return{success:0,failure:0}}var Uv=class{constructor(){this.activeBucket=Vv(),this.inactiveBucket=Vv()}addSuccess(){this.activeBucket.success+=1}addFailure(){this.activeBucket.failure+=1}switchBuckets(){this.inactiveBucket=this.activeBucket,this.activeBucket=Vv()}getLastSuccesses(){return this.inactiveBucket.success}getLastFailures(){return this.inactiveBucket.failure}},zv=class{constructor(e,t){this.wrappedPicker=e,this.countCalls=t}pick(e){let t=this.wrappedPicker.pick(e);if(t.pickResultType===vq.PickResultType.COMPLETE){let r=t.subchannel,i=r.getMapEntry();if(i){let s=t.onCallEnded;return this.countCalls&&(s=o=>{var a;o===lD.Status.OK?i.counter.addSuccess():i.counter.addFailure(),(a=t.onCallEnded)===null||a===void 0||a.call(t,o)}),Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel(),onCallEnded:s})}else return Object.assign(Object.assign({},t),{subchannel:r.getWrappedSubchannel()})}else return t}},Fh=class{constructor(e){this.addressMap=new Map,this.latestConfig=null,this.timerStartTime=null,this.childBalancer=new yq.ChildLoadBalancerHandler((0,cD.createChildChannelControlHelper)(e,{createSubchannel:(t,r)=>{let i=e.createSubchannel(t,r),s=this.addressMap.get((0,aD.subchannelAddressToString)(t)),o=new qv(i,s);return s?.currentEjectionTimestamp!==null&&o.eject(),s?.subchannelWrappers.push(o),o},updateState:(t,r)=>{t===Ph.ConnectivityState.READY?e.updateState(t,new zv(r,this.isCountingEnabled())):e.updateState(t,r)}})),this.ejectionTimer=setInterval(()=>{},0),clearInterval(this.ejectionTimer)}isCountingEnabled(){return this.latestConfig!==null&&(this.latestConfig.getSuccessRateEjectionConfig()!==null||this.latestConfig.getFailurePercentageEjectionConfig()!==null)}getCurrentEjectionPercent(){let e=0;for(let t of this.addressMap.values())t.currentEjectionTimestamp!==null&&(e+=1);return e*100/this.addressMap.size}runSuccessRateCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getSuccessRateEjectionConfig();if(!t)return;st("Running success rate check");let r=t.request_volume,i=0,s=[];for(let[d,h]of this.addressMap){let p=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();st("Stats for "+d+": successes="+p+" failures="+y+" targetRequestVolume="+r),p+y>=r&&(i+=1,s.push(p/(p+y)))}if(st("Found "+i+" success rate candidates; currentEjectionPercent="+this.getCurrentEjectionPercent()+" successRates=["+s+"]"),i<t.minimum_hosts)return;let o=s.reduce((d,h)=>d+h)/s.length,a=0;for(let d of s){let h=d-o;a+=h*h}let l=a/s.length,c=Math.sqrt(l),u=o-c*(t.stdev_factor/1e3);st("stdev="+c+" ejectionThreshold="+u);for(let[d,h]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let p=h.counter.getLastSuccesses(),y=h.counter.getLastFailures();if(p+y<r)continue;let _=p/(p+y);if(st("Checking candidate "+d+" successRate="+_),_<u){let S=Math.random()*100;st("Candidate "+d+" randomNumber="+S+" enforcement_percentage="+t.enforcement_percentage),S<t.enforcement_percentage&&(st("Ejecting candidate "+d),this.eject(h,e))}}}runFailurePercentageCheck(e){if(!this.latestConfig)return;let t=this.latestConfig.getFailurePercentageEjectionConfig();if(!t)return;st("Running failure percentage check. threshold="+t.threshold+" request volume threshold="+t.request_volume);let r=0;for(let i of this.addressMap.values()){let s=i.counter.getLastSuccesses(),o=i.counter.getLastFailures();s+o>=t.request_volume&&(r+=1)}if(!(r<t.minimum_hosts))for(let[i,s]of this.addressMap.entries()){if(this.getCurrentEjectionPercent()>=this.latestConfig.getMaxEjectionPercent())break;let o=s.counter.getLastSuccesses(),a=s.counter.getLastFailures();if(st("Candidate successes="+o+" failures="+a),o+a<t.request_volume)continue;if(a*100/(a+o)>t.threshold){let c=Math.random()*100;st("Candidate "+i+" randomNumber="+c+" enforcement_percentage="+t.enforcement_percentage),c<t.enforcement_percentage&&(st("Ejecting candidate "+i),this.eject(s,e))}}}eject(e,t){e.currentEjectionTimestamp=new Date,e.ejectionTimeMultiplier+=1;for(let r of e.subchannelWrappers)r.eject()}uneject(e){e.currentEjectionTimestamp=null;for(let t of e.subchannelWrappers)t.uneject()}switchAllBuckets(){for(let e of this.addressMap.values())e.counter.switchBuckets()}startTimer(e){var t,r;this.ejectionTimer=setTimeout(()=>this.runChecks(),e),(r=(t=this.ejectionTimer).unref)===null||r===void 0||r.call(t)}runChecks(){let e=new Date;if(st("Ejection timer running"),this.switchAllBuckets(),!!this.latestConfig){this.timerStartTime=e,this.startTimer(this.latestConfig.getIntervalMs()),this.runSuccessRateCheck(e),this.runFailurePercentageCheck(e);for(let[t,r]of this.addressMap.entries())if(r.currentEjectionTimestamp===null)r.ejectionTimeMultiplier>0&&(r.ejectionTimeMultiplier-=1);else{let i=this.latestConfig.getBaseEjectionTimeMs(),s=this.latestConfig.getMaxEjectionTimeMs(),o=new Date(r.currentEjectionTimestamp.getTime());o.setMilliseconds(o.getMilliseconds()+Math.min(i*r.ejectionTimeMultiplier,Math.max(i,s))),o<new Date&&(st("Unejecting "+t),this.uneject(r))}}}updateAddressList(e,t,r){if(!(t instanceof Ql))return;let i=new Set;for(let o of e)i.add((0,aD.subchannelAddressToString)(o));for(let o of i)this.addressMap.has(o)||(st("Adding map entry for "+o),this.addressMap.set(o,{counter:new Uv,currentEjectionTimestamp:null,ejectionTimeMultiplier:0,subchannelWrappers:[]}));for(let o of this.addressMap.keys())i.has(o)||(st("Removing map entry for "+o),this.addressMap.delete(o));let s=(0,uD.getFirstUsableConfig)(t.getChildPolicy(),!0);if(this.childBalancer.updateAddressList(e,s,r),t.getSuccessRateEjectionConfig()||t.getFailurePercentageEjectionConfig())if(this.timerStartTime){st("Previous timer existed. Replacing timer"),clearTimeout(this.ejectionTimer);let o=t.getIntervalMs()-(new Date().getTime()-this.timerStartTime.getTime());this.startTimer(o)}else st("Starting new timer"),this.timerStartTime=new Date,this.startTimer(t.getIntervalMs()),this.switchAllBuckets();else{st("Counting disabled. Cancelling timer."),this.timerStartTime=null,clearTimeout(this.ejectionTimer);for(let o of this.addressMap.values())this.uneject(o),o.ejectionTimeMultiplier=0}this.latestConfig=t}exitIdle(){this.childBalancer.exitIdle()}resetBackoff(){this.childBalancer.resetBackoff()}destroy(){clearTimeout(this.ejectionTimer),this.childBalancer.destroy()}getTypeName(){return jv}};_i.OutlierDetectionLoadBalancer=Fh;function bq(){Eq&&(0,cD.registerLoadBalancerType)(jv,Fh,Ql)}_i.setup=bq});var Hv=w(Q=>{"use strict";Object.defineProperty(Q,"__esModule",{value:!0});Q.OutlierDetectionLoadBalancingConfig=Q.BaseSubchannelWrapper=Q.registerAdminService=Q.FilterStackFactory=Q.BaseFilter=Q.PickResultType=Q.QueuePicker=Q.UnavailablePicker=Q.ChildLoadBalancerHandler=Q.subchannelAddressToString=Q.validateLoadBalancingConfig=Q.getFirstUsableConfig=Q.registerLoadBalancerType=Q.createChildChannelControlHelper=Q.BackoffTimeout=Q.durationToMs=Q.uriToString=Q.createResolver=Q.registerResolver=Q.log=Q.trace=void 0;var dD=Le();Object.defineProperty(Q,"trace",{enumerable:!0,get:function(){return dD.trace}});Object.defineProperty(Q,"log",{enumerable:!0,get:function(){return dD.log}});var hD=zn();Object.defineProperty(Q,"registerResolver",{enumerable:!0,get:function(){return hD.registerResolver}});Object.defineProperty(Q,"createResolver",{enumerable:!0,get:function(){return hD.createResolver}});var Aq=Wt();Object.defineProperty(Q,"uriToString",{enumerable:!0,get:function(){return Aq.uriToString}});var Iq=Fv();Object.defineProperty(Q,"durationToMs",{enumerable:!0,get:function(){return Iq.durationToMs}});var Dq=yl();Object.defineProperty(Q,"BackoffTimeout",{enumerable:!0,get:function(){return Dq.BackoffTimeout}});var Lh=Qr();Object.defineProperty(Q,"createChildChannelControlHelper",{enumerable:!0,get:function(){return Lh.createChildChannelControlHelper}});Object.defineProperty(Q,"registerLoadBalancerType",{enumerable:!0,get:function(){return Lh.registerLoadBalancerType}});Object.defineProperty(Q,"getFirstUsableConfig",{enumerable:!0,get:function(){return Lh.getFirstUsableConfig}});Object.defineProperty(Q,"validateLoadBalancingConfig",{enumerable:!0,get:function(){return Lh.validateLoadBalancingConfig}});var Rq=Gn();Object.defineProperty(Q,"subchannelAddressToString",{enumerable:!0,get:function(){return Rq.subchannelAddressToString}});var Nq=fd();Object.defineProperty(Q,"ChildLoadBalancerHandler",{enumerable:!0,get:function(){return Nq.ChildLoadBalancerHandler}});var Kv=Zr();Object.defineProperty(Q,"UnavailablePicker",{enumerable:!0,get:function(){return Kv.UnavailablePicker}});Object.defineProperty(Q,"QueuePicker",{enumerable:!0,get:function(){return Kv.QueuePicker}});Object.defineProperty(Q,"PickResultType",{enumerable:!0,get:function(){return Kv.PickResultType}});var kq=lh();Object.defineProperty(Q,"BaseFilter",{enumerable:!0,get:function(){return kq.BaseFilter}});var Mq=iv();Object.defineProperty(Q,"FilterStackFactory",{enumerable:!0,get:function(){return Mq.FilterStackFactory}});var Oq=gd();Object.defineProperty(Q,"registerAdminService",{enumerable:!0,get:function(){return Oq.registerAdminService}});var xq=Th();Object.defineProperty(Q,"BaseSubchannelWrapper",{enumerable:!0,get:function(){return xq.BaseSubchannelWrapper}});var Pq=Gv();Object.defineProperty(Q,"OutlierDetectionLoadBalancingConfig",{enumerable:!0,get:function(){return Pq.OutlierDetectionLoadBalancingConfig}})});var fD=w(Bh=>{"use strict";Object.defineProperty(Bh,"__esModule",{value:!0});Bh.setup=void 0;var Fq=zn(),Wv=class{constructor(e,t,r){this.listener=t,this.addresses=[],this.hasReturnedResult=!1;let i;e.authority===""?i="/"+e.path:i=e.path,this.addresses=[{path:i}]}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(this.listener.onSuccessfulResolution,this.addresses,null,null,null,{}))}destroy(){}static getDefaultAuthority(e){return"localhost"}};function Lq(){(0,Fq.registerResolver)("unix",Wv)}Bh.setup=Lq});var vD=w(Uh=>{"use strict";Object.defineProperty(Uh,"__esModule",{value:!0});Uh.setup=void 0;var pD=de("net"),Vh=le(),$v=Mt(),gD=zn(),mD=Wt(),Bq=Le(),Vq="ip_resolver";function yD(n){Bq.trace(Vh.LogVerbosity.DEBUG,Vq,n)}var Qv="ipv4",Yv="ipv6",qq=443,qh=class{constructor(e,t,r){var i;this.listener=t,this.addresses=[],this.error=null,this.hasReturnedResult=!1,yD("Resolver constructed for target "+(0,mD.uriToString)(e));let s=[];if(!(e.scheme===Qv||e.scheme===Yv)){this.error={code:Vh.Status.UNAVAILABLE,details:`Unrecognized scheme ${e.scheme} in IP resolver`,metadata:new $v.Metadata};return}let o=e.path.split(",");for(let a of o){let l=(0,mD.splitHostPort)(a);if(l===null){this.error={code:Vh.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new $v.Metadata};return}if(e.scheme===Qv&&!(0,pD.isIPv4)(l.host)||e.scheme===Yv&&!(0,pD.isIPv6)(l.host)){this.error={code:Vh.Status.UNAVAILABLE,details:`Failed to parse ${e.scheme} address ${a}`,metadata:new $v.Metadata};return}s.push({host:l.host,port:(i=l.port)!==null&&i!==void 0?i:qq})}this.addresses=s,yD("Parsed "+e.scheme+" address list "+this.addresses)}updateResolution(){this.hasReturnedResult||(this.hasReturnedResult=!0,process.nextTick(()=>{this.error?this.listener.onError(this.error):this.listener.onSuccessfulResolution(this.addresses,null,null,null,{})}))}destroy(){this.hasReturnedResult=!1}static getDefaultAuthority(e){return e.path.split(",")[0]}};function Uq(){(0,gD.registerResolver)(Qv,qh),(0,gD.registerResolver)(Yv,qh)}Uh.setup=Uq});var wD=w(rr=>{"use strict";Object.defineProperty(rr,"__esModule",{value:!0});rr.setup=rr.PickFirstLoadBalancer=rr.shuffled=rr.PickFirstLoadBalancingConfig=void 0;var _D=Qr(),Ct=rn(),zh=Zr(),zq=Le(),jq=le(),Gq="pick_first";function Xv(n){zq.trace(jq.LogVerbosity.DEBUG,Gq,n)}var Yl="pick_first",Hq=250,Xl=class n{constructor(e){this.shuffleAddressList=e}getLoadBalancerName(){return Yl}toJsonObject(){return{[Yl]:{shuffleAddressList:this.shuffleAddressList}}}getShuffleAddressList(){return this.shuffleAddressList}static createFromJson(e){if("shuffleAddressList"in e&&typeof e.shuffleAddressList!="boolean")throw new Error("pick_first config field shuffleAddressList must be a boolean if provided");return new n(e.shuffleAddressList===!0)}};rr.PickFirstLoadBalancingConfig=Xl;var Jv=class{constructor(e){this.subchannel=e}pick(e){return{pickResultType:zh.PickResultType.COMPLETE,subchannel:this.subchannel,status:null,onCallStarted:null,onCallEnded:null}}};function SD(n){let e=n.slice();for(let t=e.length-1;t>1;t--){let r=Math.floor(Math.random()*(t+1)),i=e[t];e[t]=e[r],e[r]=i}return e}rr.shuffled=SD;var jh=class{constructor(e){this.channelControlHelper=e,this.children=[],this.currentState=Ct.ConnectivityState.IDLE,this.currentSubchannelIndex=0,this.currentPick=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.onSubchannelStateUpdate(t,r,i,o)},this.triedAllSubchannels=!1,this.stickyTransientFailureMode=!1,this.requestedResolutionSinceLastUpdate=!1,this.lastError=null,this.latestAddressList=null,this.connectionDelayTimeout=setTimeout(()=>{},0),clearTimeout(this.connectionDelayTimeout)}allChildrenHaveReportedTF(){return this.children.every(e=>e.hasReportedTransientFailure)}calculateAndReportNewState(){this.currentPick?this.updateState(Ct.ConnectivityState.READY,new Jv(this.currentPick)):this.children.length===0?this.updateState(Ct.ConnectivityState.IDLE,new zh.QueuePicker(this)):this.stickyTransientFailureMode?this.updateState(Ct.ConnectivityState.TRANSIENT_FAILURE,new zh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(Ct.ConnectivityState.CONNECTING,new zh.QueuePicker(this))}requestReresolution(){this.requestedResolutionSinceLastUpdate=!0,this.channelControlHelper.requestReresolution()}maybeEnterStickyTransientFailureMode(){if(this.allChildrenHaveReportedTF()&&(this.requestedResolutionSinceLastUpdate||this.requestReresolution(),!this.stickyTransientFailureMode)){this.stickyTransientFailureMode=!0;for(let{subchannel:e}of this.children)e.startConnecting();this.calculateAndReportNewState()}}removeCurrentPick(){if(this.currentPick!==null){let e=this.currentPick;this.currentPick=null,e.unref(),e.removeConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.removeChannelzChild(e.getChannelzRef())}}onSubchannelStateUpdate(e,t,r,i){var s;if(!((s=this.currentPick)===null||s===void 0)&&s.realSubchannelEquals(e)){r!==Ct.ConnectivityState.READY&&(this.removeCurrentPick(),this.calculateAndReportNewState(),this.requestReresolution());return}for(let[o,a]of this.children.entries())if(e.realSubchannelEquals(a.subchannel)){r===Ct.ConnectivityState.READY&&this.pickSubchannel(a.subchannel),r===Ct.ConnectivityState.TRANSIENT_FAILURE&&(a.hasReportedTransientFailure=!0,i&&(this.lastError=i),this.maybeEnterStickyTransientFailureMode(),o===this.currentSubchannelIndex&&this.startNextSubchannelConnecting(o+1)),a.subchannel.startConnecting();return}}startNextSubchannelConnecting(e){if(clearTimeout(this.connectionDelayTimeout),!this.triedAllSubchannels){for(let[t,r]of this.children.entries())if(t>=e){let i=r.subchannel.getConnectivityState();if(i===Ct.ConnectivityState.IDLE||i===Ct.ConnectivityState.CONNECTING){this.startConnecting(t);return}}this.triedAllSubchannels=!0,this.maybeEnterStickyTransientFailureMode()}}startConnecting(e){var t,r;clearTimeout(this.connectionDelayTimeout),this.currentSubchannelIndex=e,this.children[e].subchannel.getConnectivityState()===Ct.ConnectivityState.IDLE&&(Xv("Start connecting to subchannel with address "+this.children[e].subchannel.getAddress()),process.nextTick(()=>{var i;(i=this.children[e])===null||i===void 0||i.subchannel.startConnecting()})),this.connectionDelayTimeout=(r=(t=setTimeout(()=>{this.startNextSubchannelConnecting(e+1)},Hq)).unref)===null||r===void 0?void 0:r.call(t)}pickSubchannel(e){this.currentPick&&e.realSubchannelEquals(this.currentPick)||(Xv("Pick subchannel with address "+e.getAddress()),this.stickyTransientFailureMode=!1,this.currentPick!==null&&(this.currentPick.unref(),this.channelControlHelper.removeChannelzChild(this.currentPick.getChannelzRef()),this.currentPick.removeConnectivityStateListener(this.subchannelStateListener)),this.currentPick=e,e.ref(),this.channelControlHelper.addChannelzChild(e.getChannelzRef()),this.resetSubchannelList(),clearTimeout(this.connectionDelayTimeout),this.calculateAndReportNewState())}updateState(e,t){Xv(Ct.ConnectivityState[this.currentState]+" -> "+Ct.ConnectivityState[e]),this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.children)this.currentPick&&e.subchannel.realSubchannelEquals(this.currentPick)||e.subchannel.removeConnectivityStateListener(this.subchannelStateListener),e.subchannel.unref(),this.channelControlHelper.removeChannelzChild(e.subchannel.getChannelzRef());this.currentSubchannelIndex=0,this.children=[],this.triedAllSubchannels=!1,this.requestedResolutionSinceLastUpdate=!1}connectToAddressList(e){let t=e.map(r=>({subchannel:this.channelControlHelper.createSubchannel(r,{}),hasReportedTransientFailure:!1}));for(let{subchannel:r}of t)r.ref(),this.channelControlHelper.addChannelzChild(r.getChannelzRef());this.resetSubchannelList(),this.children=t;for(let{subchannel:r}of this.children)if(r.addConnectivityStateListener(this.subchannelStateListener),r.getConnectivityState()===Ct.ConnectivityState.READY){this.pickSubchannel(r);return}for(let r of this.children)r.subchannel.getConnectivityState()===Ct.ConnectivityState.TRANSIENT_FAILURE&&(r.hasReportedTransientFailure=!0);this.startNextSubchannelConnecting(0),this.calculateAndReportNewState()}updateAddressList(e,t){t instanceof Xl&&(t.getShuffleAddressList()&&(e=SD(e)),this.latestAddressList=e,this.connectToAddressList(e))}exitIdle(){this.currentState===Ct.ConnectivityState.IDLE&&this.latestAddressList&&this.connectToAddressList(this.latestAddressList)}resetBackoff(){}destroy(){this.resetSubchannelList(),this.removeCurrentPick()}getTypeName(){return Yl}};rr.PickFirstLoadBalancer=jh;function Kq(){(0,_D.registerLoadBalancerType)(Yl,jh,Xl),(0,_D.registerDefaultLoadBalancerType)(Yl)}rr.setup=Kq});var TD=w(Go=>{"use strict";Object.defineProperty(Go,"__esModule",{value:!0});Go.setup=Go.RoundRobinLoadBalancer=void 0;var Wq=Qr(),bt=rn(),Gh=Zr(),$q=Gn(),Qq=Le(),Yq=le(),Xq="round_robin";function ED(n){Qq.trace(Yq.LogVerbosity.DEBUG,Xq,n)}var Hh="round_robin",Zv=class n{getLoadBalancerName(){return Hh}constructor(){}toJsonObject(){return{[Hh]:{}}}static createFromJson(e){return new n}},e_=class{constructor(e,t=0){this.subchannelList=e,this.nextIndex=t}pick(e){let t=this.subchannelList[this.nextIndex];return this.nextIndex=(this.nextIndex+1)%this.subchannelList.length,{pickResultType:Gh.PickResultType.COMPLETE,subchannel:t,status:null,onCallStarted:null,onCallEnded:null}}peekNextSubchannel(){return this.subchannelList[this.nextIndex]}},Kh=class{constructor(e){this.channelControlHelper=e,this.subchannels=[],this.currentState=bt.ConnectivityState.IDLE,this.currentReadyPicker=null,this.lastError=null,this.subchannelStateListener=(t,r,i,s,o)=>{this.calculateAndUpdateState(),(i===bt.ConnectivityState.TRANSIENT_FAILURE||i===bt.ConnectivityState.IDLE)&&(o&&(this.lastError=o),this.channelControlHelper.requestReresolution(),t.startConnecting())}}countSubchannelsWithState(e){return this.subchannels.filter(t=>t.getConnectivityState()===e).length}calculateAndUpdateState(){if(this.countSubchannelsWithState(bt.ConnectivityState.READY)>0){let e=this.subchannels.filter(r=>r.getConnectivityState()===bt.ConnectivityState.READY),t=0;this.currentReadyPicker!==null&&(t=e.indexOf(this.currentReadyPicker.peekNextSubchannel()),t<0&&(t=0)),this.updateState(bt.ConnectivityState.READY,new e_(e,t))}else this.countSubchannelsWithState(bt.ConnectivityState.CONNECTING)>0?this.updateState(bt.ConnectivityState.CONNECTING,new Gh.QueuePicker(this)):this.countSubchannelsWithState(bt.ConnectivityState.TRANSIENT_FAILURE)>0?this.updateState(bt.ConnectivityState.TRANSIENT_FAILURE,new Gh.UnavailablePicker({details:`No connection established. Last error: ${this.lastError}`})):this.updateState(bt.ConnectivityState.IDLE,new Gh.QueuePicker(this))}updateState(e,t){ED(bt.ConnectivityState[this.currentState]+" -> "+bt.ConnectivityState[e]),e===bt.ConnectivityState.READY?this.currentReadyPicker=t:this.currentReadyPicker=null,this.currentState=e,this.channelControlHelper.updateState(e,t)}resetSubchannelList(){for(let e of this.subchannels)e.removeConnectivityStateListener(this.subchannelStateListener),e.unref(),this.channelControlHelper.removeChannelzChild(e.getChannelzRef());this.subchannels=[]}updateAddressList(e,t){this.resetSubchannelList(),ED("Connect to address list "+e.map(r=>(0,$q.subchannelAddressToString)(r))),this.subchannels=e.map(r=>this.channelControlHelper.createSubchannel(r,{}));for(let r of this.subchannels){r.ref(),r.addConnectivityStateListener(this.subchannelStateListener),this.channelControlHelper.addChannelzChild(r.getChannelzRef());let i=r.getConnectivityState();(i===bt.ConnectivityState.IDLE||i===bt.ConnectivityState.TRANSIENT_FAILURE)&&r.startConnecting()}this.calculateAndUpdateState()}exitIdle(){for(let e of this.subchannels)e.startConnecting()}resetBackoff(){}destroy(){this.resetSubchannelList()}getTypeName(){return Hh}};Go.RoundRobinLoadBalancer=Kh;function Jq(){(0,Wq.registerLoadBalancerType)(Hh,Kh,Zv)}Go.setup=Jq});var ID=w(B=>{"use strict";Object.defineProperty(B,"__esModule",{value:!0});B.experimental=B.addAdminServicesToServer=B.getChannelzHandlers=B.getChannelzServiceDefinition=B.InterceptorConfigurationError=B.InterceptingCall=B.RequesterBuilder=B.ListenerBuilder=B.StatusBuilder=B.getClientChannel=B.ServerCredentials=B.Server=B.setLogVerbosity=B.setLogger=B.load=B.loadObject=B.CallCredentials=B.ChannelCredentials=B.waitForClientReady=B.closeClient=B.Channel=B.makeGenericClientConstructor=B.makeClientConstructor=B.loadPackageDefinition=B.Client=B.compressionAlgorithms=B.propagate=B.connectivityState=B.status=B.logVerbosity=B.Metadata=B.credentials=void 0;var Wh=Yg();Object.defineProperty(B,"CallCredentials",{enumerable:!0,get:function(){return Wh.CallCredentials}});var Zq=Dm();Object.defineProperty(B,"Channel",{enumerable:!0,get:function(){return Zq.ChannelImplementation}});var eU=sv();Object.defineProperty(B,"compressionAlgorithms",{enumerable:!0,get:function(){return eU.CompressionAlgorithms}});var tU=rn();Object.defineProperty(B,"connectivityState",{enumerable:!0,get:function(){return tU.ConnectivityState}});var $h=od();Object.defineProperty(B,"ChannelCredentials",{enumerable:!0,get:function(){return $h.ChannelCredentials}});var CD=Im();Object.defineProperty(B,"Client",{enumerable:!0,get:function(){return CD.Client}});var t_=le();Object.defineProperty(B,"logVerbosity",{enumerable:!0,get:function(){return t_.LogVerbosity}});Object.defineProperty(B,"status",{enumerable:!0,get:function(){return t_.Status}});Object.defineProperty(B,"propagate",{enumerable:!0,get:function(){return t_.Propagate}});var bD=Le(),n_=Nm();Object.defineProperty(B,"loadPackageDefinition",{enumerable:!0,get:function(){return n_.loadPackageDefinition}});Object.defineProperty(B,"makeClientConstructor",{enumerable:!0,get:function(){return n_.makeClientConstructor}});Object.defineProperty(B,"makeGenericClientConstructor",{enumerable:!0,get:function(){return n_.makeClientConstructor}});var nU=Mt();Object.defineProperty(B,"Metadata",{enumerable:!0,get:function(){return nU.Metadata}});var rU=sD();Object.defineProperty(B,"Server",{enumerable:!0,get:function(){return rU.Server}});var iU=Mv();Object.defineProperty(B,"ServerCredentials",{enumerable:!0,get:function(){return iU.ServerCredentials}});var sU=oD();Object.defineProperty(B,"StatusBuilder",{enumerable:!0,get:function(){return sU.StatusBuilder}});B.credentials={combineChannelCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),combineCallCredentials:(n,...e)=>e.reduce((t,r)=>t.compose(r),n),createInsecure:$h.ChannelCredentials.createInsecure,createSsl:$h.ChannelCredentials.createSsl,createFromSecureContext:$h.ChannelCredentials.createFromSecureContext,createFromMetadataGenerator:Wh.CallCredentials.createFromMetadataGenerator,createFromGoogleCredential:Wh.CallCredentials.createFromGoogleCredential,createEmpty:Wh.CallCredentials.createEmpty};var oU=n=>n.close();B.closeClient=oU;var aU=(n,e,t)=>n.waitForReady(e,t);B.waitForClientReady=aU;var lU=(n,e)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.loadObject=lU;var cU=(n,e,t)=>{throw new Error("Not available in this library. Use @grpc/proto-loader and loadPackageDefinition instead")};B.load=cU;var uU=n=>{bD.setLogger(n)};B.setLogger=uU;var dU=n=>{bD.setLoggerVerbosity(n)};B.setLogVerbosity=dU;var hU=n=>CD.Client.prototype.getChannel.call(n);B.getClientChannel=hU;var Qh=Cm();Object.defineProperty(B,"ListenerBuilder",{enumerable:!0,get:function(){return Qh.ListenerBuilder}});Object.defineProperty(B,"RequesterBuilder",{enumerable:!0,get:function(){return Qh.RequesterBuilder}});Object.defineProperty(B,"InterceptingCall",{enumerable:!0,get:function(){return Qh.InterceptingCall}});Object.defineProperty(B,"InterceptorConfigurationError",{enumerable:!0,get:function(){return Qh.InterceptorConfigurationError}});var AD=os();Object.defineProperty(B,"getChannelzServiceDefinition",{enumerable:!0,get:function(){return AD.getChannelzServiceDefinition}});Object.defineProperty(B,"getChannelzHandlers",{enumerable:!0,get:function(){return AD.getChannelzHandlers}});var fU=gd();Object.defineProperty(B,"addAdminServicesToServer",{enumerable:!0,get:function(){return fU.addAdminServicesToServer}});var pU=Hv();B.experimental=pU;var gU=Ky(),mU=fD(),yU=vD(),vU=wD(),_U=TD(),SU=Gv(),wU=os();gU.setup(),mU.setup(),yU.setup(),vU.setup(),_U.setup(),SU.setup(),wU.setup()});var Yk="firebase",Xk="10.7.1";Vr(Yk,Xk,"app");var Ks=new Dp("ANGULARFIRE2_VERSION");var Jk=(n,e)=>{let t=e?[e]:$w(),r=[];return t.forEach(i=>{i.container.getProvider(n).instances.forEach(o=>{r.includes(o)||r.push(o)})}),r},$i=class{constructor(){return Jk(Zk)}},Zk="app-check";function Mp(){}var uu=class{zone;delegate;constructor(e,t=_w){this.zone=e,this.delegate=t}now(){return this.delegate.now()}schedule(e,t,r){let i=this.zone,s=function(o){i.runGuarded(()=>{e.apply(this,[o])})};return this.delegate.schedule(s,t,r)}},Op=class{zone;task=null;constructor(e){this.zone=e}call(e,t){let r=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",Mp,{},Mp,Mp)),t.pipe(Cw({next:r,complete:r,error:r})).subscribe(e).add(r)}unscheduleTask(){setTimeout(()=>{this.task!=null&&this.task.state==="scheduled"&&(this.task.invoke(),this.task=null)},10)}},du=(()=>{class n{ngZone;outsideAngular;insideAngular;constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new uu(Zone.current)),this.insideAngular=t.run(()=>new uu(Zone.current,Xc)),globalThis.\u0275AngularFireScheduler||=this}static \u0275fac=function(r){return new(r||n)(Z(Br))};static \u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"root"})}return n})();function eM(){let n=globalThis.\u0275AngularFireScheduler;if(!n)throw new Error(`Either AngularFireModule has not been provided in your AppModule (this can be done manually or implictly using
provideFirebaseApp) or you're calling an AngularFire method outside of an NgModule (which is not supported).`);return n}function qt(n){return tM(eM())(n)}function tM(n){return function(t){return t=t.lift(new Op(n.ngZone)),t.pipe(Gs(n.outsideAngular),Gi(n.insideAngular))}}var iM=new Map,sM={activated:!1,tokenObservers:[]},oM={initialized:!1,enabled:!1};function _n(n){return iM.get(n)||Object.assign({},sM)}function eE(){return oM}var aM="https://content-firebaseappcheck.googleapis.com/v1";var lM="exchangeDebugToken",Yw={OFFSET_DURATION:5*60*1e3,RETRIAL_MIN_WAIT:30*1e3,RETRIAL_MAX_WAIT:16*60*1e3},x5=24*60*60*1e3;var Pp=class{constructor(e,t,r,i,s){if(this.operation=e,this.retryPolicy=t,this.getWaitDuration=r,this.lowerBound=i,this.upperBound=s,this.pending=null,this.nextErrorWaitInterval=i,i>s)throw new Error("Proactive refresh lower bound greater than upper bound!")}start(){this.nextErrorWaitInterval=this.lowerBound,this.process(!0).catch(()=>{})}stop(){this.pending&&(this.pending.reject("cancelled"),this.pending=null)}isRunning(){return!!this.pending}process(e){return g(this,null,function*(){this.stop();try{this.pending=new kp,this.pending.promise.catch(t=>{}),yield cM(this.getNextRun(e)),this.pending.resolve(),yield this.pending.promise,this.pending=new kp,this.pending.promise.catch(t=>{}),yield this.operation(),this.pending.resolve(),yield this.pending.promise,this.process(!0).catch(()=>{})}catch(t){this.retryPolicy(t)?this.process(!1).catch(()=>{}):this.stop()}})}getNextRun(e){if(e)return this.nextErrorWaitInterval=this.lowerBound,this.getWaitDuration();{let t=this.nextErrorWaitInterval;return this.nextErrorWaitInterval*=2,this.nextErrorWaitInterval>this.upperBound&&(this.nextErrorWaitInterval=this.upperBound),t}}};function cM(n){return new Promise(e=>{setTimeout(e,n)})}var uM={"already-initialized":"You have already called initializeAppCheck() for FirebaseApp {$appName} with different options. To avoid this error, call initializeAppCheck() with the same options as when it was originally called. This will return the already initialized instance.","use-before-activation":"App Check is being used before initializeAppCheck() is called for FirebaseApp {$appName}. Call initializeAppCheck() before instantiating other Firebase services.","fetch-network-error":"Fetch failed to connect to a network. Check Internet connection. Original error: {$originalErrorMessage}.","fetch-parse-error":"Fetch client could not parse response. Original error: {$originalErrorMessage}.","fetch-status-error":"Fetch server returned an HTTP error status. HTTP status: {$httpStatus}.","storage-open":"Error thrown when opening storage. Original error: {$originalErrorMessage}.","storage-get":"Error thrown when reading from storage. Original error: {$originalErrorMessage}.","storage-set":"Error thrown when writing to storage. Original error: {$originalErrorMessage}.","recaptcha-error":"ReCAPTCHA error.",throttled:"Requests throttled due to {$httpStatus} error. Attempts allowed again after {$time}"},qr=new Kw("appCheck","AppCheck",uM);function tE(n){if(!_n(n).activated)throw qr.create("use-before-activation",{appName:n.name})}function nE(r,i){return g(this,arguments,function*({url:n,body:e},t){let s={"Content-Type":"application/json"},o=t.getImmediate({optional:!0});if(o){let p=yield o.getHeartbeatsHeader();p&&(s["X-Firebase-Client"]=p)}let a={method:"POST",body:JSON.stringify(e),headers:s},l;try{l=yield fetch(n,a)}catch(p){throw qr.create("fetch-network-error",{originalErrorMessage:p?.message})}if(l.status!==200)throw qr.create("fetch-status-error",{httpStatus:l.status});let c;try{c=yield l.json()}catch(p){throw qr.create("fetch-parse-error",{originalErrorMessage:p?.message})}let u=c.ttl.match(/^([\d.]+)(s)$/);if(!u||!u[2]||isNaN(Number(u[1])))throw qr.create("fetch-parse-error",{originalErrorMessage:`ttl field (timeToLive) is not in standard Protobuf Duration format: ${c.ttl}`});let d=Number(u[1])*1e3,h=Date.now();return{token:c.token,expireTimeMillis:h+d,issuedAtTimeMillis:h}})}function rE(n,e){let{projectId:t,appId:r,apiKey:i}=n.options;return{url:`${aM}/projects/${t}/apps/${r}:${lM}?key=${i}`,body:{debug_token:e}}}var dM="firebase-app-check-database",hM=1,Fp="firebase-app-check-store";var hu=null;function fM(){return hu||(hu=new Promise((n,e)=>{try{let t=indexedDB.open(dM,hM);t.onsuccess=r=>{n(r.target.result)},t.onerror=r=>{var i;e(qr.create("storage-open",{originalErrorMessage:(i=r.target.error)===null||i===void 0?void 0:i.message}))},t.onupgradeneeded=r=>{let i=r.target.result;switch(r.oldVersion){case 0:i.createObjectStore(Fp,{keyPath:"compositeKey"})}}}catch(t){e(qr.create("storage-open",{originalErrorMessage:t?.message}))}}),hu)}function pM(n,e){return gM(mM(n),e)}function gM(n,e){return g(this,null,function*(){let r=(yield fM()).transaction(Fp,"readwrite"),s=r.objectStore(Fp).put({compositeKey:n,value:e});return new Promise((o,a)=>{s.onsuccess=l=>{o()},r.onerror=l=>{var c;a(qr.create("storage-set",{originalErrorMessage:(c=l.target.error)===null||c===void 0?void 0:c.message}))}})})}function mM(n){return`${n.options.appId}-${n.name}`}var Lp=new cu("@firebase/app-check");function xp(n,e){return lu()?pM(n,e).catch(t=>{Lp.warn(`Failed to write token to IndexedDB. Error: ${t}`)}):Promise.resolve()}function iE(){return eE().enabled}function sE(){return g(this,null,function*(){let n=eE();if(n.enabled&&n.token)return n.token.promise;throw Error(`
            Can't get debug token in production mode.
        `)})}var yM={error:"UNKNOWN_ERROR"};function vM(n){return zw.encodeString(JSON.stringify(n),!1)}function Bp(n,e=!1){return g(this,null,function*(){let t=n.app;tE(t);let r=_n(t),i=r.token,s;if(i&&!za(i)&&(r.token=void 0,i=void 0),!i){let l=yield r.cachedTokenPromise;l&&(za(l)?i=l:yield xp(t,void 0))}if(!e&&i&&za(i))return{token:i.token};let o=!1;if(iE()){r.exchangeTokenPromise||(r.exchangeTokenPromise=nE(rE(t,yield sE()),n.heartbeatServiceProvider).finally(()=>{r.exchangeTokenPromise=void 0}),o=!0);let l=yield r.exchangeTokenPromise;return yield xp(t,l),r.token=l,{token:l.token}}try{r.exchangeTokenPromise||(r.exchangeTokenPromise=r.provider.getToken().finally(()=>{r.exchangeTokenPromise=void 0}),o=!0),i=yield _n(t).exchangeTokenPromise}catch(l){l.code==="appCheck/throttled"?Lp.warn(l.message):Lp.error(l),s=l}let a;return i?s?za(i)?a={token:i.token,internalError:s}:a=Jw(s):(a={token:i.token},r.token=i,yield xp(t,i)):a=Jw(s),o&&EM(t,a),a})}function _M(n){return g(this,null,function*(){let e=n.app;tE(e);let{provider:t}=_n(e);if(iE()){let r=yield sE(),{token:i}=yield nE(rE(e,r),n.heartbeatServiceProvider);return{token:i}}else{let{token:r}=yield t.getToken();return{token:r}}})}function SM(n,e,t,r){let{app:i}=n,s=_n(i),o={next:t,error:r,type:e};if(s.tokenObservers=[...s.tokenObservers,o],s.token&&za(s.token)){let a=s.token;Promise.resolve().then(()=>{t({token:a.token}),Xw(n)}).catch(()=>{})}s.cachedTokenPromise.then(()=>Xw(n))}function oE(n,e){let t=_n(n),r=t.tokenObservers.filter(i=>i.next!==e);r.length===0&&t.tokenRefresher&&t.tokenRefresher.isRunning()&&t.tokenRefresher.stop(),t.tokenObservers=r}function Xw(n){let{app:e}=n,t=_n(e),r=t.tokenRefresher;r||(r=wM(n),t.tokenRefresher=r),!r.isRunning()&&t.isTokenAutoRefreshEnabled&&r.start()}function wM(n){let{app:e}=n;return new Pp(()=>g(this,null,function*(){let t=_n(e),r;if(t.token?r=yield Bp(n,!0):r=yield Bp(n),r.error)throw r.error;if(r.internalError)throw r.internalError}),()=>!0,()=>{let t=_n(e);if(t.token){let r=t.token.issuedAtTimeMillis+(t.token.expireTimeMillis-t.token.issuedAtTimeMillis)*.5+3e5,i=t.token.expireTimeMillis-5*60*1e3;return r=Math.min(r,i),Math.max(0,r-Date.now())}else return 0},Yw.RETRIAL_MIN_WAIT,Yw.RETRIAL_MAX_WAIT)}function EM(n,e){let t=_n(n).tokenObservers;for(let r of t)try{r.type==="EXTERNAL"&&e.error!=null?r.error(e.error):r.next(e)}catch{}}function za(n){return n.expireTimeMillis-Date.now()>0}function Jw(n){return{token:vM(yM),error:n}}var Vp=class{constructor(e,t){this.app=e,this.heartbeatServiceProvider=t}_delete(){let{tokenObservers:e}=_n(this.app);for(let t of e)oE(this.app,t.next);return Promise.resolve()}};function TM(n,e){return new Vp(n,e)}function CM(n){return{getToken:e=>Bp(n,e),getLimitedUseToken:()=>_M(n),addTokenListener:e=>SM(n,"INTERNAL",e),removeTokenListener:e=>oE(n.app,e)}}var bM="@firebase/app-check",AM="0.8.1";var IM="app-check",Zw="app-check-internal";function DM(){Ua(new Wi(IM,n=>{let e=n.getProvider("app").getImmediate(),t=n.getProvider("heartbeat");return TM(e,t)},"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback((n,e,t)=>{n.getProvider(Zw).initialize()})),Ua(new Wi(Zw,n=>{let e=n.getProvider("app-check").getImmediate();return CM(e)},"PUBLIC").setInstantiationMode("EXPLICIT")),Vr(bM,AM)}DM();var RM=["localhost","0.0.0.0","127.0.0.1"],K5=typeof window<"u"&&RM.includes(window.location.hostname);var NM="firebase",kM="10.7.1";Vt.registerVersion(NM,kM,"app-compat");var MM=["ngOnDestroy"],cE=(n,e,t,r={})=>new Proxy(n,{get:(i,s)=>t.runOutsideAngular(()=>{if(n[s])return r?.spy?.get&&r.spy.get(s,n[s]),n[s];if(MM.indexOf(s)>-1)return()=>{};let o=e.toPromise().then(a=>{let l=a?.[s];return typeof l=="function"?l.bind(a):l?.then?l.then(c=>t.run(()=>c)):t.run(()=>l)});return new Proxy(()=>{},{get:(a,l)=>o[l],apply:(a,l,c)=>o.then(u=>{let d=u?.(...c);return r?.spy?.apply&&r.spy.apply(s,c,d),d})})})});var fu=class{constructor(e){return e}},Ws=new xe("angularfire2.app.options"),$s=new xe("angularfire2.app.name");function ja(n,e,t){let r=typeof t=="string"&&t||"[DEFAULT]",i=typeof t=="object"&&t||{};i.name=i.name||r;let o=Vt.apps.filter(a=>a&&a.name===i.name)[0]||e.runOutsideAngular(()=>Vt.initializeApp(n,i));try{if(JSON.stringify(n)!==JSON.stringify(o.options)){let a=!!module.hot;OM("error",`${o.name} Firebase App already initialized with different options${a?", you may need to reload as Firebase is not HMR aware.":"."}`)}}catch{}return new fu(o)}var OM=(n,...e)=>{Rp()&&typeof console<"u"&&console[n](...e)},xM={provide:fu,useFactory:ja,deps:[Ws,Br,[new Rw,$s]]},uE=(()=>{class n{static initializeApp(t,r){return{ngModule:n,providers:[{provide:Ws,useValue:t},{provide:$s,useValue:r}]}}constructor(t){Vt.registerVersion("angularfire",Ks.full,"core"),Vt.registerVersion("angularfire",Ks.full,"app-compat"),Vt.registerVersion("angular",Pw.full,t.toString())}static \u0275fac=function(r){return new(r||n)(Z(Hs))};static \u0275mod=vt({type:n});static \u0275inj=yt({providers:[xM]})}return n})();function pu(n,e,t,r,i){let[,s,o]=globalThis.\u0275AngularfireInstanceCache.find(a=>a[0]===n)||[];if(s)return PM(i,o)||(lE("error",`${e} was already initialized on the ${t} Firebase App with different settings.${FM?" You may need to reload as Firebase is not HMR aware.":""}`),lE("warn",{is:i,was:o})),s;{let a=r();return globalThis.\u0275AngularfireInstanceCache.push([n,a,i]),a}}function PM(n,e){try{return n.toString()===e.toString()}catch{return n===e}}var FM=typeof module<"u"&&!!module.hot,lE=(n,...e)=>{Rp()&&typeof console<"u"&&console[n](...e)};globalThis.\u0275AngularfireInstanceCache||=[];var qp=new xe("angularfire2.auth.use-emulator"),Up=new xe("angularfire2.auth.settings"),zp=new xe("angularfire2.auth.tenant-id"),jp=new xe("angularfire2.auth.langugage-code"),Gp=new xe("angularfire2.auth.use-device-language"),Hp=new xe("angularfire.auth.persistence"),Kp=(n,e,t,r,i,s,o,a)=>pu(`${n.name}.auth`,"AngularFireAuth",n.name,()=>{let l=e.runOutsideAngular(()=>n.auth());if(t&&l.useEmulator(...t),r&&(l.tenantId=r),l.languageCode=i,s&&l.useDeviceLanguage(),o)for(let[c,u]of Object.entries(o))l.settings[c]=u;return a&&l.setPersistence(a),l},[t,r,i,s,o,a]),gu=(()=>{class n{authState;idToken;user;idTokenResult;credential;constructor(t,r,i,s,o,a,l,c,u,d,h,p){let y=new vw,_=Lr(void 0).pipe(Gi(o.outsideAngular),Hi(()=>s.runOutsideAngular(()=>import("./chunk-2YTKQEPF.mjs"))),ut(()=>ja(t,s,r)),ut(S=>Kp(S,s,a,c,u,d,l,h)),Tp({bufferSize:1,refCount:!1}));if(su(i))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Lr(null);else{_.pipe(Tw()).subscribe();let S=_.pipe(Hi(N=>N.getRedirectResult().then(k=>k,()=>null)),qt,Tp({bufferSize:1,refCount:!1})),R=_.pipe(Hi(N=>new js(k=>({unsubscribe:s.runOutsideAngular(()=>N.onAuthStateChanged(V=>k.next(V),V=>k.error(V),()=>k.complete()))})))),E=_.pipe(Hi(N=>new js(k=>({unsubscribe:s.runOutsideAngular(()=>N.onIdTokenChanged(V=>k.next(V),V=>k.error(V),()=>k.complete()))}))));this.authState=S.pipe(Cp(R),Gs(o.outsideAngular),Gi(o.insideAngular)),this.user=S.pipe(Cp(E),Gs(o.outsideAngular),Gi(o.insideAngular)),this.idToken=this.user.pipe(Hi(N=>N?Fn(N.getIdToken()):Lr(null))),this.idTokenResult=this.user.pipe(Hi(N=>N?Fn(N.getIdTokenResult()):Lr(null))),this.credential=ww(S,y,this.authState.pipe(La(N=>!N))).pipe(ut(N=>N?.user?N:null),Gs(o.outsideAngular),Gi(o.insideAngular))}return cE(this,_,s,{spy:{apply:(S,R,E)=>{(S.startsWith("signIn")||S.startsWith("createUser"))&&E.then(N=>y.next(N))}}})}static \u0275fac=function(r){return new(r||n)(Z(Ws),Z($s,8),Z(Hs),Z(Br),Z(du),Z(qp,8),Z(Up,8),Z(zp,8),Z(jp,8),Z(Gp,8),Z(Hp,8),Z($i,8))};static \u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})();var Ur=(()=>{let e=class e{constructor(r,i){this.fireauth=r,this.router=i}login(r,i){this.fireauth.signInWithEmailAndPassword(r,i).then(s=>{localStorage.setItem("token","true"),s.user?.emailVerified==!0?this.router.navigate(["/dashboard"]):this.router.navigate(["/verify-email"])},s=>{alert("Something Went wrong"),this.router.navigate(["/login"])})}register(r,i){this.fireauth.createUserWithEmailAndPassword(r,i).then(s=>{alert("Registration Successful"),this.router.navigate(["/login"]),this.SendEmailForVerification(s.user)},s=>{alert(s.message),this.router.navigate(["/register"])})}logout(){this.fireauth.signOut().then(()=>{localStorage.removeItem("token"),this.router.navigate(["/login"])},r=>{alert("Logout Successful")})}forgotpassword(r){this.fireauth.sendPasswordResetEmail(r).then(()=>{this.router.navigate(["/verify-email"])},i=>{alert("Something went wrong")})}SendEmailForVerification(r){r.sendEmailVerification().then(i=>{this.router.navigate(["/verify-email"])},i=>{alert("something went wrong. Not able to send mail.")})}};e.\u0275fac=function(i){return new(i||e)(Z(gu),Z(ou))},e.\u0275prov=vn({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();var SE=(()=>{let e=class e{constructor(r,i){this._renderer=r,this._elementRef=i,this.onChange=s=>{},this.onTouched=()=>{}}setProperty(r,i){this._renderer.setProperty(this._elementRef.nativeElement,r,i)}registerOnTouched(r){this.onTouched=r}registerOnChange(r){this.onChange=r}setDisabledState(r){this.setProperty("disabled",r)}};e.\u0275fac=function(i){return new(i||e)(ge(Ap),ge(bp))},e.\u0275dir=pr({type:e});let n=e;return n})(),LM=(()=>{let e=class e extends SE{};e.\u0275fac=(()=>{let r;return function(s){return(r||(r=Dw(e)))(s||e)}})(),e.\u0275dir=pr({type:e,features:[Ki]});let n=e;return n})(),wE=new xe("NgValueAccessor");var BM={provide:wE,useExisting:tu(()=>Bn),multi:!0};function VM(){let n=Np()?Np().getUserAgent():"";return/android (\d+)/.test(n.toLowerCase())}var qM=new xe("CompositionEventMode"),Bn=(()=>{let e=class e extends SE{constructor(r,i,s){super(r,i),this._compositionMode=s,this._composing=!1,this._compositionMode==null&&(this._compositionMode=!VM())}writeValue(r){let i=r??"";this.setProperty("value",i)}_handleInput(r){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(r)}_compositionStart(){this._composing=!0}_compositionEnd(r){this._composing=!1,this._compositionMode&&this.onChange(r)}};e.\u0275fac=function(i){return new(i||e)(ge(Ap),ge(bp),ge(qM,8))},e.\u0275dir=pr({type:e,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(i,s){i&1&&Pe("input",function(a){return s._handleInput(a.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(a){return s._compositionEnd(a.target.value)})},features:[iu([BM]),Ki]});let n=e;return n})();var EE=new xe("NgValidators"),TE=new xe("NgAsyncValidators");function CE(n){return n!=null}function bE(n){return Ow(n)?Fn(n):n}function AE(n){let e={};return n.forEach(t=>{e=t!=null?Zt(Zt({},e),t):e}),Object.keys(e).length===0?null:e}function IE(n,e){return e.map(t=>t(n))}function UM(n){return!n.validate}function DE(n){return n.map(e=>UM(e)?e:t=>e.validate(t))}function zM(n){if(!n)return null;let e=n.filter(CE);return e.length==0?null:function(t){return AE(IE(t,e))}}function $p(n){return n!=null?zM(DE(n)):null}function jM(n){if(!n)return null;let e=n.filter(CE);return e.length==0?null:function(t){let r=IE(t,e).map(bE);return Sw(r).pipe(ut(AE))}}function Qp(n){return n!=null?jM(DE(n)):null}function fE(n,e){return n===null?[e]:Array.isArray(n)?[...n,e]:[n,e]}function GM(n){return n._rawValidators}function HM(n){return n._rawAsyncValidators}function Wp(n){return n?Array.isArray(n)?n:[n]:[]}function vu(n,e){return Array.isArray(n)?n.includes(e):n===e}function pE(n,e){let t=Wp(e);return Wp(n).forEach(i=>{vu(t,i)||t.push(i)}),t}function gE(n,e){return Wp(e).filter(t=>!vu(n,t))}var _u=class{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=$p(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=Qp(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e=void 0){this.control&&this.control.reset(e)}hasError(e,t){return this.control?this.control.hasError(e,t):!1}getError(e,t){return this.control?this.control.getError(e,t):null}},Ys=class extends _u{get formDirective(){return null}get path(){return null}},Wa=class extends _u{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}},Su=class{constructor(e){this._cd=e}get isTouched(){return!!this._cd?.control?.touched}get isUntouched(){return!!this._cd?.control?.untouched}get isPristine(){return!!this._cd?.control?.pristine}get isDirty(){return!!this._cd?.control?.dirty}get isValid(){return!!this._cd?.control?.valid}get isInvalid(){return!!this._cd?.control?.invalid}get isPending(){return!!this._cd?.control?.pending}get isSubmitted(){return!!this._cd?.submitted}},KM={"[class.ng-untouched]":"isUntouched","[class.ng-touched]":"isTouched","[class.ng-pristine]":"isPristine","[class.ng-dirty]":"isDirty","[class.ng-valid]":"isValid","[class.ng-invalid]":"isInvalid","[class.ng-pending]":"isPending"},PH=fr(Zt({},KM),{"[class.ng-submitted]":"isSubmitted"}),zr=(()=>{let e=class e extends Su{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(ge(Wa,2))},e.\u0275dir=pr({type:e,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(i,s){i&2&&Ip("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)},features:[Ki]});let n=e;return n})(),jr=(()=>{let e=class e extends Su{constructor(r){super(r)}};e.\u0275fac=function(i){return new(i||e)(ge(Ys,10))},e.\u0275dir=pr({type:e,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(i,s){i&2&&Ip("ng-untouched",s.isUntouched)("ng-touched",s.isTouched)("ng-pristine",s.isPristine)("ng-dirty",s.isDirty)("ng-valid",s.isValid)("ng-invalid",s.isInvalid)("ng-pending",s.isPending)("ng-submitted",s.isSubmitted)},features:[Ki]});let n=e;return n})();var Ga="VALID",yu="INVALID",Qs="PENDING",Ha="DISABLED";function RE(n){return(Tu(n)?n.validators:n)||null}function WM(n){return Array.isArray(n)?$p(n):n||null}function NE(n,e){return(Tu(e)?e.asyncValidators:n)||null}function $M(n){return Array.isArray(n)?Qp(n):n||null}function Tu(n){return n!=null&&!Array.isArray(n)&&typeof n=="object"}function QM(n,e,t){let r=n.controls;if(!(e?Object.keys(r):r).length)throw new nu(1e3,"");if(!r[t])throw new nu(1001,"")}function YM(n,e,t){n._forEachChild((r,i)=>{if(t[i]===void 0)throw new nu(1002,"")})}var wu=class{constructor(e,t){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._assignValidators(e),this._assignAsyncValidators(t)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Ga}get invalid(){return this.status===yu}get pending(){return this.status==Qs}get disabled(){return this.status===Ha}get enabled(){return this.status!==Ha}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._assignValidators(e)}setAsyncValidators(e){this._assignAsyncValidators(e)}addValidators(e){this.setValidators(pE(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(pE(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(gE(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(gE(e,this._rawAsyncValidators))}hasValidator(e){return vu(this._rawValidators,e)}hasAsyncValidator(e){return vu(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=Qs,e.emitEvent!==!1&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ha,this.errors=null,this._forEachChild(r=>{r.disable(fr(Zt({},e),{onlySelf:!0}))}),this._updateValue(),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(fr(Zt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!0))}enable(e={}){let t=this._parentMarkedDirty(e.onlySelf);this.status=Ga,this._forEachChild(r=>{r.enable(fr(Zt({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(fr(Zt({},e),{skipPristineCheck:t})),this._onDisabledChange.forEach(r=>r(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}getRawValue(){return this.value}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Ga||this.status===Qs)&&this._runAsyncValidator(e.emitEvent)),e.emitEvent!==!1&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(t=>t._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Ha:Ga}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=Qs,this._hasOwnPendingAsyncValidator=!0;let t=bE(this.asyncValidator(this));this._asyncValidationSubscription=t.subscribe(r=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(r,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,t={}){this.errors=e,this._updateControlsErrors(t.emitEvent!==!1)}get(e){let t=e;return t==null||(Array.isArray(t)||(t=t.split(".")),t.length===0)?null:t.reduce((r,i)=>r&&r._find(i),this)}getError(e,t){let r=t?this.get(t):this;return r&&r.errors?r.errors[e]:null}hasError(e,t){return!!this.getError(e,t)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Ba,this.statusChanges=new Ba}_calculateStatus(){return this._allControlsDisabled()?Ha:this.errors?yu:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(Qs)?Qs:this._anyControlsHaveStatus(yu)?yu:Ga}_anyControlsHaveStatus(e){return this._anyControls(t=>t.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){Tu(e)&&e.updateOn!=null&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){let t=this._parent&&this._parent.dirty;return!e&&!!t&&!this._parent._anyControlsDirty()}_find(e){return null}_assignValidators(e){this._rawValidators=Array.isArray(e)?e.slice():e,this._composedValidatorFn=WM(this._rawValidators)}_assignAsyncValidators(e){this._rawAsyncValidators=Array.isArray(e)?e.slice():e,this._composedAsyncValidatorFn=$M(this._rawAsyncValidators)}},Eu=class extends wu{constructor(e,t,r){super(RE(t),NE(r,t)),this.controls=e,this._initObservables(),this._setUpdateStrategy(t),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,t){return this.controls[e]?this.controls[e]:(this.controls[e]=t,t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange),t)}addControl(e,t,r={}){this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}removeControl(e,t={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:t.emitEvent}),this._onCollectionChange()}setControl(e,t,r={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],t&&this.registerControl(e,t),this.updateValueAndValidity({emitEvent:r.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,t={}){YM(this,!0,e),Object.keys(e).forEach(r=>{QM(this,!0,r),this.controls[r].setValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t)}patchValue(e,t={}){e!=null&&(Object.keys(e).forEach(r=>{let i=this.controls[r];i&&i.patchValue(e[r],{onlySelf:!0,emitEvent:t.emitEvent})}),this.updateValueAndValidity(t))}reset(e={},t={}){this._forEachChild((r,i)=>{r.reset(e?e[i]:null,{onlySelf:!0,emitEvent:t.emitEvent})}),this._updatePristine(t),this._updateTouched(t),this.updateValueAndValidity(t)}getRawValue(){return this._reduceChildren({},(e,t,r)=>(e[r]=t.getRawValue(),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(t,r)=>r._syncPendingControls()?!0:t);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(t=>{let r=this.controls[t];r&&e(r,t)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(let[t,r]of Object.entries(this.controls))if(this.contains(t)&&e(r))return!0;return!1}_reduceValue(){let e={};return this._reduceChildren(e,(t,r,i)=>((r.enabled||this.disabled)&&(t[i]=r.value),t))}_reduceChildren(e,t){let r=e;return this._forEachChild((i,s)=>{r=t(r,i,s)}),r}_allControlsDisabled(){for(let e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_find(e){return this.controls.hasOwnProperty(e)?this.controls[e]:null}};var Cu=new xe("CallSetDisabledState",{providedIn:"root",factory:()=>bu}),bu="always";function XM(n,e){return[...e.path,n]}function kE(n,e,t=bu){ME(n,e),e.valueAccessor.writeValue(n.value),(n.disabled||t==="always")&&e.valueAccessor.setDisabledState?.(n.disabled),ZM(n,e),tO(n,e),eO(n,e),JM(n,e)}function mE(n,e){n.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function JM(n,e){if(e.valueAccessor.setDisabledState){let t=r=>{e.valueAccessor.setDisabledState(r)};n.registerOnDisabledChange(t),e._registerOnDestroy(()=>{n._unregisterOnDisabledChange(t)})}}function ME(n,e){let t=GM(n);e.validator!==null?n.setValidators(fE(t,e.validator)):typeof t=="function"&&n.setValidators([t]);let r=HM(n);e.asyncValidator!==null?n.setAsyncValidators(fE(r,e.asyncValidator)):typeof r=="function"&&n.setAsyncValidators([r]);let i=()=>n.updateValueAndValidity();mE(e._rawValidators,i),mE(e._rawAsyncValidators,i)}function ZM(n,e){e.valueAccessor.registerOnChange(t=>{n._pendingValue=t,n._pendingChange=!0,n._pendingDirty=!0,n.updateOn==="change"&&OE(n,e)})}function eO(n,e){e.valueAccessor.registerOnTouched(()=>{n._pendingTouched=!0,n.updateOn==="blur"&&n._pendingChange&&OE(n,e),n.updateOn!=="submit"&&n.markAsTouched()})}function OE(n,e){n._pendingDirty&&n.markAsDirty(),n.setValue(n._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(n._pendingValue),n._pendingChange=!1}function tO(n,e){let t=(r,i)=>{e.valueAccessor.writeValue(r),i&&e.viewToModelUpdate(r)};n.registerOnChange(t),e._registerOnDestroy(()=>{n._unregisterOnChange(t)})}function nO(n,e){n==null,ME(n,e)}function rO(n,e){if(!n.hasOwnProperty("model"))return!1;let t=n.model;return t.isFirstChange()?!0:!Object.is(e,t.currentValue)}function iO(n){return Object.getPrototypeOf(n.constructor)===LM}function sO(n,e){n._syncPendingControls(),e.forEach(t=>{let r=t.control;r.updateOn==="submit"&&r._pendingChange&&(t.viewToModelUpdate(r._pendingValue),r._pendingChange=!1)})}function oO(n,e){if(!e)return null;Array.isArray(e);let t,r,i;return e.forEach(s=>{s.constructor===Bn?t=s:iO(s)?r=s:i=s}),i||r||t||null}var aO={provide:Ys,useExisting:tu(()=>gr)},Ka=(()=>Promise.resolve())(),gr=(()=>{let e=class e extends Ys{constructor(r,i,s){super(),this.callSetDisabledState=s,this.submitted=!1,this._directives=new Set,this.ngSubmit=new Ba,this.form=new Eu({},$p(r),Qp(i))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(r){Ka.then(()=>{let i=this._findContainer(r.path);r.control=i.registerControl(r.name,r.control),kE(r.control,r,this.callSetDisabledState),r.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(r)})}getControl(r){return this.form.get(r.path)}removeControl(r){Ka.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name),this._directives.delete(r)})}addFormGroup(r){Ka.then(()=>{let i=this._findContainer(r.path),s=new Eu({});nO(s,r),i.registerControl(r.name,s),s.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(r){Ka.then(()=>{let i=this._findContainer(r.path);i&&i.removeControl(r.name)})}getFormGroup(r){return this.form.get(r.path)}updateModel(r,i){Ka.then(()=>{this.form.get(r.path).setValue(i)})}setValue(r){this.control.setValue(r)}onSubmit(r){return this.submitted=!0,sO(this.form,this._directives),this.ngSubmit.emit(r),r?.target?.method==="dialog"}onReset(){this.resetForm()}resetForm(r=void 0){this.form.reset(r),this.submitted=!1}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.form._updateOn=this.options.updateOn)}_findContainer(r){return r.pop(),r.length?this.form.get(r):this.form}};e.\u0275fac=function(i){return new(i||e)(ge(EE,10),ge(TE,10),ge(Cu,8))},e.\u0275dir=pr({type:e,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(i,s){i&1&&Pe("submit",function(a){return s.onSubmit(a)})("reset",function(){return s.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[iu([aO]),Ki]});let n=e;return n})();function yE(n,e){let t=n.indexOf(e);t>-1&&n.splice(t,1)}function vE(n){return typeof n=="object"&&n!==null&&Object.keys(n).length===2&&"value"in n&&"disabled"in n}var lO=class extends wu{constructor(e=null,t,r){super(RE(t),NE(r,t)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(t),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),Tu(t)&&(t.nonNullable||t.initialValueIsDefault)&&(vE(e)?this.defaultValue=e.value:this.defaultValue=e)}setValue(e,t={}){this.value=this._pendingValue=e,this._onChange.length&&t.emitModelToViewChange!==!1&&this._onChange.forEach(r=>r(this.value,t.emitViewToModelChange!==!1)),this.updateValueAndValidity(t)}patchValue(e,t={}){this.setValue(e,t)}reset(e=this.defaultValue,t={}){this._applyFormState(e),this.markAsPristine(t),this.markAsUntouched(t),this.setValue(this.value,t),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){yE(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){yE(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return this.updateOn==="submit"&&(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),this._pendingChange)?(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),!0):!1}_applyFormState(e){vE(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}};var cO={provide:Wa,useExisting:tu(()=>mr)},_E=(()=>Promise.resolve())(),mr=(()=>{let e=class e extends Wa{constructor(r,i,s,o,a,l){super(),this._changeDetectorRef=a,this.callSetDisabledState=l,this.control=new lO,this._registered=!1,this.name="",this.update=new Ba,this._parent=r,this._setValidators(i),this._setAsyncValidators(s),this.valueAccessor=oO(this,o)}ngOnChanges(r){if(this._checkForErrors(),!this._registered||"name"in r){if(this._registered&&(this._checkName(),this.formDirective)){let i=r.name.previousValue;this.formDirective.removeControl({name:i,path:this._getPath(i)})}this._setUpControl()}"isDisabled"in r&&this._updateDisabled(r),rO(r,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(r){this.viewModel=r,this.update.emit(r)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&this.options.updateOn!=null&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!!(this.options&&this.options.standalone)}_setUpStandalone(){kE(this.control,this,this.callSetDisabledState),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),!this._isStandalone()&&this.name}_updateValue(r){_E.then(()=>{this.control.setValue(r,{emitViewToModelChange:!1}),this._changeDetectorRef?.markForCheck()})}_updateDisabled(r){let i=r.isDisabled.currentValue,s=i!==0&&Fw(i);_E.then(()=>{s&&!this.control.disabled?this.control.disable():!s&&this.control.disabled&&this.control.enable(),this._changeDetectorRef?.markForCheck()})}_getPath(r){return this._parent?XM(r,this._parent):[r]}};e.\u0275fac=function(i){return new(i||e)(ge(Ys,9),ge(EE,10),ge(TE,10),ge(wE,10),ge(Nw,8),ge(Cu,8))},e.\u0275dir=pr({type:e,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[iu([cO]),Ki,bw]});let n=e;return n})(),Gr=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275dir=pr({type:e,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]});let n=e;return n})();var uO=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({});let n=e;return n})();var dO=new xe("NgModelWithFormControlWarning");var xE=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({imports:[uO]});let n=e;return n})();var PE=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:Cu,useValue:r.callSetDisabledState??bu}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({imports:[xE]});let n=e;return n})(),FE=(()=>{let e=class e{static withConfig(r){return{ngModule:e,providers:[{provide:dO,useValue:r.warnOnNgModelWithFormControl??"always"},{provide:Cu,useValue:r.callSetDisabledState??bu}]}}};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({imports:[xE]});let n=e;return n})();var LE=(()=>{let e=class e{constructor(r){this.auth=r,this.email="",this.password=""}login(){if(this.email==""){alert("Please enter the email");return}if(this.password==""){alert("Please enter the password ");return}this.auth.login(this.email,this.password),this.email="",this.password=""}};e.\u0275fac=function(i){return new(i||e)(ge(Ur))},e.\u0275cmp=en({type:e,selectors:[["app-login"]],decls:29,vars:2,consts:[[1,"container-fluid"],[1,"row","mt-5"],[1,"col"],[1,"col-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[1,"text-dark","text-muted"],["for","exampleInputEmail1",1,"form-label"],["type","email","name","email",1,"form-control",3,"ngModel","ngModelChange"],["for","exampleInputPassword1",1,"form-label"],["type","password","name","password",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-info",3,"click"],[1,"row"],[1,"col","md-6"],["href","/register",2,"text-decoration","none"],[1,"text-danger"],["href","/forgot-password",1,"text-dark",2,"text-decoration","none"]],template:function(i,s){i&1&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"form")(7,"div",6)(8,"h4",7),Y(9,"Login"),K()(),H(10,"div",6)(11,"label",8),Y(12,"Email "),K(),H(13,"input",9),Pe("ngModelChange",function(a){return s.email=a}),K()(),H(14,"div",6)(15,"label",10),Y(16,"Password"),K(),H(17,"input",11),Pe("ngModelChange",function(a){return s.password=a}),K()(),H(18,"button",12),Pe("click",function(){return s.login()}),Y(19,"Login"),K(),H(20,"div",13)(21,"div",14)(22,"a",15),Y(23,"Need Account ? "),H(24,"span",16),Y(25,"Register"),K()()(),H(26,"div",14)(27,"a",17),Y(28,"Forgot Password ?"),K()()()()()()()()()()),i&2&&(et(13),Bt("ngModel",s.email),et(4),Bt("ngModel",s.password))},dependencies:[Gr,Bn,zr,jr,mr,gr]});let n=e;return n})();import{inspect as EU,TextEncoder as TU,TextDecoder as CU}from"util";import{randomBytes as bU}from"crypto";var hO=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},wn={},x,yg=yg||{},$=hO||self;function Vu(n){var e=typeof n;return e=e!="object"?e:n?Array.isArray(n)?"array":e:"null",e=="array"||e=="object"&&typeof n.length=="number"}function ll(n){var e=typeof n;return e=="object"&&n!=null||e=="function"}function fO(n){return Object.prototype.hasOwnProperty.call(n,Yp)&&n[Yp]||(n[Yp]=++pO)}var Yp="closure_uid_"+(1e9*Math.random()>>>0),pO=0;function gO(n,e,t){return n.call.apply(n.bind,arguments)}function mO(n,e,t){if(!n)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var i=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(i,r),n.apply(e,i)}}return function(){return n.apply(e,arguments)}}function _t(n,e,t){return Function.prototype.bind&&Function.prototype.bind.toString().indexOf("native code")!=-1?_t=gO:_t=mO,_t.apply(null,arguments)}function Au(n,e){var t=Array.prototype.slice.call(arguments,1);return function(){var r=t.slice();return r.push.apply(r,arguments),n.apply(this,r)}}function nt(n,e){function t(){}t.prototype=e.prototype,n.$=e.prototype,n.prototype=new t,n.prototype.constructor=n,n.ac=function(r,i,s){for(var o=Array(arguments.length-2),a=2;a<arguments.length;a++)o[a-2]=arguments[a];return e.prototype[i].apply(r,o)}}function Hr(){this.s=this.s,this.o=this.o}var yO=0;Hr.prototype.s=!1;Hr.prototype.sa=function(){!this.s&&(this.s=!0,this.N(),yO!=0)&&fO(this)};Hr.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var YE=Array.prototype.indexOf?function(n,e){return Array.prototype.indexOf.call(n,e,void 0)}:function(n,e){if(typeof n=="string")return typeof e!="string"||e.length!=1?-1:n.indexOf(e,0);for(let t=0;t<n.length;t++)if(t in n&&n[t]===e)return t;return-1};function vg(n){let e=n.length;if(0<e){let t=Array(e);for(let r=0;r<e;r++)t[r]=n[r];return t}return[]}function BE(n,e){for(let t=1;t<arguments.length;t++){let r=arguments[t];if(Vu(r)){let i=n.length||0,s=r.length||0;n.length=i+s;for(let o=0;o<s;o++)n[i+o]=r[o]}else n.push(r)}}function St(n,e){this.type=n,this.g=this.target=e,this.defaultPrevented=!1}St.prototype.h=function(){this.defaultPrevented=!0};var vO=function(){if(!$.addEventListener||!Object.defineProperty)return!1;var n=!1,e=Object.defineProperty({},"passive",{get:function(){n=!0}});try{let t=()=>{};$.addEventListener("test",t,e),$.removeEventListener("test",t,e)}catch{}return n}();function el(n){return/^[\s\xa0]*$/.test(n)}function qu(){var n=$.navigator;return n&&(n=n.userAgent)?n:""}function Vn(n){return qu().indexOf(n)!=-1}function _g(n){return _g[" "](n),n}_g[" "]=function(){};function _O(n,e){var t=ax;return Object.prototype.hasOwnProperty.call(t,n)?t[n]:t[n]=e(n)}var SO=Vn("Opera"),eo=Vn("Trident")||Vn("MSIE"),XE=Vn("Edge"),tg=XE||eo,JE=Vn("Gecko")&&!(qu().toLowerCase().indexOf("webkit")!=-1&&!Vn("Edge"))&&!(Vn("Trident")||Vn("MSIE"))&&!Vn("Edge"),wO=qu().toLowerCase().indexOf("webkit")!=-1&&!Vn("Edge");function ZE(){var n=$.document;return n?n.documentMode:void 0}var ng;e:{if(Iu="",Du=function(){var n=qu();if(JE)return/rv:([^\);]+)(\)|;)/.exec(n);if(XE)return/Edge\/([\d\.]+)/.exec(n);if(eo)return/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(n);if(wO)return/WebKit\/(\S+)/.exec(n);if(SO)return/(?:Version)[ \/]?(\S+)/.exec(n)}(),Du&&(Iu=Du?Du[1]:""),eo&&(Ru=ZE(),Ru!=null&&Ru>parseFloat(Iu))){ng=String(Ru);break e}ng=Iu}var Iu,Du,Ru,rg;$.document&&eo?(Xp=ZE(),rg=Xp||parseInt(ng,10)||void 0):rg=void 0;var Xp,EO=rg;function tl(n,e){if(St.call(this,n?n.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,n){var t=this.type=n.type,r=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:null;if(this.target=n.target||n.srcElement,this.g=e,e=n.relatedTarget){if(JE){e:{try{_g(e.nodeName);var i=!0;break e}catch{}i=!1}i||(e=null)}}else t=="mouseover"?e=n.fromElement:t=="mouseout"&&(e=n.toElement);this.relatedTarget=e,r?(this.clientX=r.clientX!==void 0?r.clientX:r.pageX,this.clientY=r.clientY!==void 0?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=n.clientX!==void 0?n.clientX:n.pageX,this.clientY=n.clientY!==void 0?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0),this.button=n.button,this.key=n.key||"",this.ctrlKey=n.ctrlKey,this.altKey=n.altKey,this.shiftKey=n.shiftKey,this.metaKey=n.metaKey,this.pointerId=n.pointerId||0,this.pointerType=typeof n.pointerType=="string"?n.pointerType:TO[n.pointerType]||"",this.state=n.state,this.i=n,n.defaultPrevented&&tl.$.h.call(this)}}nt(tl,St);var TO={2:"touch",3:"pen",4:"mouse"};tl.prototype.h=function(){tl.$.h.call(this);var n=this.i;n.preventDefault?n.preventDefault():n.returnValue=!1};var cl="closure_listenable_"+(1e6*Math.random()|0),CO=0;function bO(n,e,t,r,i){this.listener=n,this.proxy=null,this.src=e,this.type=t,this.capture=!!r,this.la=i,this.key=++CO,this.fa=this.ia=!1}function Uu(n){n.fa=!0,n.listener=null,n.proxy=null,n.src=null,n.la=null}function Sg(n,e,t){for(let r in n)e.call(t,n[r],r,n)}function AO(n,e){for(let t in n)e.call(void 0,n[t],t,n)}function eT(n){let e={};for(let t in n)e[t]=n[t];return e}var VE="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function tT(n,e){let t,r;for(let i=1;i<arguments.length;i++){r=arguments[i];for(t in r)n[t]=r[t];for(let s=0;s<VE.length;s++)t=VE[s],Object.prototype.hasOwnProperty.call(r,t)&&(n[t]=r[t])}}function zu(n){this.src=n,this.g={},this.h=0}zu.prototype.add=function(n,e,t,r,i){var s=n.toString();n=this.g[s],n||(n=this.g[s]=[],this.h++);var o=sg(n,e,r,i);return-1<o?(e=n[o],t||(e.ia=!1)):(e=new bO(e,this.src,s,!!r,i),e.ia=t,n.push(e)),e};function ig(n,e){var t=e.type;if(t in n.g){var r=n.g[t],i=YE(r,e),s;(s=0<=i)&&Array.prototype.splice.call(r,i,1),s&&(Uu(e),n.g[t].length==0&&(delete n.g[t],n.h--))}}function sg(n,e,t,r){for(var i=0;i<n.length;++i){var s=n[i];if(!s.fa&&s.listener==e&&s.capture==!!t&&s.la==r)return i}return-1}var wg="closure_lm_"+(1e6*Math.random()|0),Jp={};function nT(n,e,t,r,i){if(r&&r.once)return iT(n,e,t,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)nT(n,e[s],t,r,i);return null}return t=Cg(t),n&&n[cl]?n.O(e,t,ll(r)?!!r.capture:!!r,i):rT(n,e,t,!1,r,i)}function rT(n,e,t,r,i,s){if(!e)throw Error("Invalid event type");var o=ll(i)?!!i.capture:!!i,a=Tg(n);if(a||(n[wg]=a=new zu(n)),t=a.add(e,t,r,o,s),t.proxy)return t;if(r=IO(),t.proxy=r,r.src=n,r.listener=t,n.addEventListener)vO||(i=o),i===void 0&&(i=!1),n.addEventListener(e.toString(),r,i);else if(n.attachEvent)n.attachEvent(oT(e.toString()),r);else if(n.addListener&&n.removeListener)n.addListener(r);else throw Error("addEventListener and attachEvent are unavailable.");return t}function IO(){function n(t){return e.call(n.src,n.listener,t)}let e=DO;return n}function iT(n,e,t,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)iT(n,e[s],t,r,i);return null}return t=Cg(t),n&&n[cl]?n.P(e,t,ll(r)?!!r.capture:!!r,i):rT(n,e,t,!0,r,i)}function sT(n,e,t,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)sT(n,e[s],t,r,i);else r=ll(r)?!!r.capture:!!r,t=Cg(t),n&&n[cl]?(n=n.i,e=String(e).toString(),e in n.g&&(s=n.g[e],t=sg(s,t,r,i),-1<t&&(Uu(s[t]),Array.prototype.splice.call(s,t,1),s.length==0&&(delete n.g[e],n.h--)))):n&&(n=Tg(n))&&(e=n.g[e.toString()],n=-1,e&&(n=sg(e,t,r,i)),(t=-1<n?e[n]:null)&&Eg(t))}function Eg(n){if(typeof n!="number"&&n&&!n.fa){var e=n.src;if(e&&e[cl])ig(e.i,n);else{var t=n.type,r=n.proxy;e.removeEventListener?e.removeEventListener(t,r,n.capture):e.detachEvent?e.detachEvent(oT(t),r):e.addListener&&e.removeListener&&e.removeListener(r),(t=Tg(e))?(ig(t,n),t.h==0&&(t.src=null,e[wg]=null)):Uu(n)}}}function oT(n){return n in Jp?Jp[n]:Jp[n]="on"+n}function DO(n,e){if(n.fa)n=!0;else{e=new tl(e,this);var t=n.listener,r=n.la||n.src;n.ia&&Eg(n),n=t.call(r,e)}return n}function Tg(n){return n=n[wg],n instanceof zu?n:null}var Zp="__closure_events_fn_"+(1e9*Math.random()>>>0);function Cg(n){return typeof n=="function"?n:(n[Zp]||(n[Zp]=function(e){return n.handleEvent(e)}),n[Zp])}function tt(){Hr.call(this),this.i=new zu(this),this.S=this,this.J=null}nt(tt,Hr);tt.prototype[cl]=!0;tt.prototype.removeEventListener=function(n,e,t,r){sT(this,n,e,t,r)};function ht(n,e){var t,r=n.J;if(r)for(t=[];r;r=r.J)t.push(r);if(n=n.S,r=e.type||e,typeof e=="string")e=new St(e,n);else if(e instanceof St)e.target=e.target||n;else{var i=e;e=new St(r,n),tT(e,i)}if(i=!0,t)for(var s=t.length-1;0<=s;s--){var o=e.g=t[s];i=Nu(o,r,!0,e)&&i}if(o=e.g=n,i=Nu(o,r,!0,e)&&i,i=Nu(o,r,!1,e)&&i,t)for(s=0;s<t.length;s++)o=e.g=t[s],i=Nu(o,r,!1,e)&&i}tt.prototype.N=function(){if(tt.$.N.call(this),this.i){var n=this.i,e;for(e in n.g){for(var t=n.g[e],r=0;r<t.length;r++)Uu(t[r]);delete n.g[e],n.h--}}this.J=null};tt.prototype.O=function(n,e,t,r){return this.i.add(String(n),e,!1,t,r)};tt.prototype.P=function(n,e,t,r){return this.i.add(String(n),e,!0,t,r)};function Nu(n,e,t,r){if(e=n.i.g[String(e)],!e)return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==t){var a=o.listener,l=o.la||o.src;o.ia&&ig(n.i,o),i=a.call(l,r)!==!1&&i}}return i&&!r.defaultPrevented}var bg=$.JSON.stringify,og=class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return 0<this.h?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}};function RO(){var n=Ag;let e=null;return n.g&&(e=n.g,n.g=n.g.next,n.g||(n.h=null),e.next=null),e}var ag=class{constructor(){this.h=this.g=null}add(e,t){let r=aT.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},aT=new og(()=>new lg,n=>n.reset()),lg=class{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}};function NO(n){var e=1;n=n.split(":");let t=[];for(;0<e&&n.length;)t.push(n.shift()),e--;return n.length&&t.push(n.join(":")),t}function kO(n){$.setTimeout(()=>{throw n},0)}var nl,rl=!1,Ag=new ag,lT=()=>{let n=$.Promise.resolve(void 0);nl=()=>{n.then(MO)}},MO=()=>{for(var n;n=RO();){try{n.h.call(n.g)}catch(t){kO(t)}var e=aT;e.j(n),100>e.h&&(e.h++,n.next=e.g,e.g=n)}rl=!1};function ju(n,e){tt.call(this),this.h=n||1,this.g=e||$,this.j=_t(this.qb,this),this.l=Date.now()}nt(ju,tt);x=ju.prototype;x.ga=!1;x.T=null;x.qb=function(){if(this.ga){var n=Date.now()-this.l;0<n&&n<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-n):(this.T&&(this.g.clearTimeout(this.T),this.T=null),ht(this,"tick"),this.ga&&(Ig(this),this.start()))}};x.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())};function Ig(n){n.ga=!1,n.T&&(n.g.clearTimeout(n.T),n.T=null)}x.N=function(){ju.$.N.call(this),Ig(this),delete this.g};function Dg(n,e,t){if(typeof n=="function")t&&(n=_t(n,t));else if(n&&typeof n.handleEvent=="function")n=_t(n.handleEvent,n);else throw Error("Invalid listener argument");return 2147483647<Number(e)?-1:$.setTimeout(n,e||0)}function cT(n){n.g=Dg(()=>{n.g=null,n.i&&(n.i=!1,cT(n))},n.j);let e=n.h;n.h=null,n.m.apply(null,e)}var cg=class extends Hr{constructor(e,t){super(),this.m=e,this.j=t,this.h=null,this.i=!1,this.g=null}l(e){this.h=arguments,this.g?this.i=!0:cT(this)}N(){super.N(),this.g&&($.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}};function il(n){Hr.call(this),this.h=n,this.g={}}nt(il,Hr);var qE=[];function uT(n,e,t,r){Array.isArray(t)||(t&&(qE[0]=t.toString()),t=qE);for(var i=0;i<t.length;i++){var s=nT(e,t[i],r||n.handleEvent,!1,n.h||n);if(!s)break;n.g[s.key]=s}}function dT(n){Sg(n.g,function(e,t){this.g.hasOwnProperty(t)&&Eg(e)},n),n.g={}}il.prototype.N=function(){il.$.N.call(this),dT(this)};il.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};function Gu(){this.g=!0}Gu.prototype.Ea=function(){this.g=!1};function OO(n,e,t,r,i,s){n.info(function(){if(n.g)if(s)for(var o="",a=s.split("&"),l=0;l<a.length;l++){var c=a[l].split("=");if(1<c.length){var u=c[0];c=c[1];var d=u.split("_");o=2<=d.length&&d[1]=="type"?o+(u+"="+c+"&"):o+(u+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+`
`+t+`
`+o})}function xO(n,e,t,r,i,s,o){n.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+`
`+t+`
`+s+" "+o})}function Js(n,e,t,r){n.info(function(){return"XMLHTTP TEXT ("+e+"): "+FO(n,t)+(r?" "+r:"")})}function PO(n,e){n.info(function(){return"TIMEOUT: "+e})}Gu.prototype.info=function(){};function FO(n,e){if(!n.g)return e;if(!e)return null;try{var t=JSON.parse(e);if(t){for(n=0;n<t.length;n++)if(Array.isArray(t[n])){var r=t[n];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if(s!="noop"&&s!="stop"&&s!="close")for(var o=1;o<i.length;o++)i[o]=""}}}}return bg(t)}catch{return e}}var Ji={},UE=null;function Hu(){return UE=UE||new tt}Ji.Ta="serverreachability";function hT(n){St.call(this,Ji.Ta,n)}nt(hT,St);function sl(n){let e=Hu();ht(e,new hT(e))}Ji.STAT_EVENT="statevent";function fT(n,e){St.call(this,Ji.STAT_EVENT,n),this.stat=e}nt(fT,St);function Nt(n){let e=Hu();ht(e,new fT(e,n))}Ji.Ua="timingevent";function pT(n,e){St.call(this,Ji.Ua,n),this.size=e}nt(pT,St);function ul(n,e){if(typeof n!="function")throw Error("Fn must not be null and must be a function");return $.setTimeout(function(){n()},e)}var Ku={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},gT={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function Rg(){}Rg.prototype.h=null;function zE(n){return n.h||(n.h=n.i())}function mT(){}var dl={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function Ng(){St.call(this,"d")}nt(Ng,St);function kg(){St.call(this,"c")}nt(kg,St);var ug;function Wu(){}nt(Wu,Rg);Wu.prototype.g=function(){return new XMLHttpRequest};Wu.prototype.i=function(){return{}};ug=new Wu;function hl(n,e,t,r){this.l=n,this.j=e,this.m=t,this.W=r||1,this.U=new il(this),this.P=LO,n=tg?125:void 0,this.V=new ju(n),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new yT}function yT(){this.i=null,this.g="",this.h=!1}var LO=45e3,vT={},dg={};x=hl.prototype;x.setTimeout=function(n){this.P=n};function hg(n,e,t){n.L=1,n.A=Qu(vr(e)),n.u=t,n.S=!0,_T(n,null)}function _T(n,e){n.G=Date.now(),fl(n),n.B=vr(n.A);var t=n.B,r=n.W;Array.isArray(r)||(r=[String(r)]),IT(t.i,"t",r),n.o=0,t=n.l.J,n.h=new yT,n.g=$T(n.l,t?e:null,!n.u),0<n.O&&(n.M=new cg(_t(n.Pa,n,n.g),n.O)),uT(n.U,n.g,"readystatechange",n.nb),e=n.I?eT(n.I):{},n.u?(n.v||(n.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",n.g.ha(n.B,n.v,n.u,e)):(n.v="GET",n.g.ha(n.B,n.v,null,e)),sl(),OO(n.j,n.v,n.B,n.m,n.W,n.u)}x.nb=function(n){n=n.target;let e=this.M;e&&qn(n)==3?e.l():this.Pa(n)};x.Pa=function(n){try{if(n==this.g)e:{let u=qn(this.g);var e=this.g.Ia();let d=this.g.da();if(!(3>u)&&(u!=3||tg||this.g&&(this.h.h||this.g.ja()||KE(this.g)))){this.J||u!=4||e==7||(e==8||0>=d?sl(3):sl(2)),$u(this);var t=this.g.da();this.ca=t;t:if(ST(this)){var r=KE(this.g);n="";var i=r.length,s=qn(this.g)==4;if(!this.h.i){if(typeof TextDecoder>"u"){Qi(this),Za(this);var o="";break t}this.h.i=new $.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,n+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=n,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=t==200,xO(this.j,this.v,this.B,this.m,this.W,u,t),this.i){if(this.aa&&!this.K){t:{if(this.g){var a,l=this.g;if((a=l.g?l.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!el(a)){var c=a;break t}}c=null}if(t=c)Js(this.j,this.m,t,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,fg(this,t);else{this.i=!1,this.s=3,Nt(12),Qi(this),Za(this);break e}}this.S?(wT(this,u,o),tg&&this.i&&u==3&&(uT(this.U,this.V,"tick",this.mb),this.V.start())):(Js(this.j,this.m,o,null),fg(this,o)),u==4&&Qi(this),this.i&&!this.J&&(u==4?GT(this.l,this):(this.i=!1,fl(this)))}else ix(this.g),t==400&&0<o.indexOf("Unknown SID")?(this.s=3,Nt(12)):(this.s=0,Nt(13)),Qi(this),Za(this)}}}catch{}finally{}};function ST(n){return n.g?n.v=="GET"&&n.L!=2&&n.l.Ha:!1}function wT(n,e,t){let r=!0,i;for(;!n.J&&n.o<t.length;)if(i=BO(n,t),i==dg){e==4&&(n.s=4,Nt(14),r=!1),Js(n.j,n.m,null,"[Incomplete Response]");break}else if(i==vT){n.s=4,Nt(15),Js(n.j,n.m,t,"[Invalid Chunk]"),r=!1;break}else Js(n.j,n.m,i,null),fg(n,i);ST(n)&&n.o!=0&&(n.h.g=n.h.g.slice(n.o),n.o=0),e!=4||t.length!=0||n.h.h||(n.s=1,Nt(16),r=!1),n.i=n.i&&r,r?0<t.length&&!n.ba&&(n.ba=!0,e=n.l,e.g==n&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+t.length),Lg(e),e.M=!0,Nt(11))):(Js(n.j,n.m,t,"[Invalid Chunked Response]"),Qi(n),Za(n))}x.mb=function(){if(this.g){var n=qn(this.g),e=this.g.ja();this.o<e.length&&($u(this),wT(this,n,e),this.i&&n!=4&&fl(this))}};function BO(n,e){var t=n.o,r=e.indexOf(`
`,t);return r==-1?dg:(t=Number(e.substring(t,r)),isNaN(t)?vT:(r+=1,r+t>e.length?dg:(e=e.slice(r,r+t),n.o=r+t,e)))}x.cancel=function(){this.J=!0,Qi(this)};function fl(n){n.Y=Date.now()+n.P,ET(n,n.P)}function ET(n,e){if(n.C!=null)throw Error("WatchDog timer not null");n.C=ul(_t(n.lb,n),e)}function $u(n){n.C&&($.clearTimeout(n.C),n.C=null)}x.lb=function(){this.C=null;let n=Date.now();0<=n-this.Y?(PO(this.j,this.B),this.L!=2&&(sl(),Nt(17)),Qi(this),this.s=2,Za(this)):ET(this,this.Y-n)};function Za(n){n.l.H==0||n.J||GT(n.l,n)}function Qi(n){$u(n);var e=n.M;e&&typeof e.sa=="function"&&e.sa(),n.M=null,Ig(n.V),dT(n.U),n.g&&(e=n.g,n.g=null,e.abort(),e.sa())}function fg(n,e){try{var t=n.l;if(t.H!=0&&(t.g==n||pg(t.i,n))){if(!n.K&&pg(t.i,n)&&t.H==3){try{var r=t.Ja.g.parse(e)}catch{r=null}if(Array.isArray(r)&&r.length==3){var i=r;if(i[0]==0){e:if(!t.u){if(t.g)if(t.g.G+3e3<n.G)Pu(t),Ju(t);else break e;Fg(t),Nt(18)}}else t.Fa=i[1],0<t.Fa-t.V&&37500>i[2]&&t.G&&t.A==0&&!t.v&&(t.v=ul(_t(t.ib,t),6e3));if(1>=NT(t.i)&&t.oa){try{t.oa()}catch{}t.oa=void 0}}else Yi(t,11)}else if((n.K||t.g==n)&&Pu(t),!el(e))for(i=t.Ja.g.parse(e),e=0;e<i.length;e++){let c=i[e];if(t.V=c[0],c=c[1],t.H==2)if(c[0]=="c"){t.K=c[1],t.pa=c[2];let u=c[3];u!=null&&(t.ra=u,t.l.info("VER="+t.ra));let d=c[4];d!=null&&(t.Ga=d,t.l.info("SVER="+t.Ga));let h=c[5];h!=null&&typeof h=="number"&&0<h&&(r=1.5*h,t.L=r,t.l.info("backChannelRequestTimeoutMs_="+r)),r=t;let p=n.g;if(p){let y=p.g?p.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(y){var s=r.i;s.g||y.indexOf("spdy")==-1&&y.indexOf("quic")==-1&&y.indexOf("h2")==-1||(s.j=s.l,s.g=new Set,s.h&&(Mg(s,s.h),s.h=null))}if(r.F){let _=p.g?p.g.getResponseHeader("X-HTTP-Session-Id"):null;_&&(r.Da=_,Te(r.I,r.F,_))}}t.H=3,t.h&&t.h.Ba(),t.ca&&(t.S=Date.now()-n.G,t.l.info("Handshake RTT: "+t.S+"ms")),r=t;var o=n;if(r.wa=WT(r,r.J?r.pa:null,r.Y),o.K){kT(r.i,o);var a=o,l=r.L;l&&a.setTimeout(l),a.C&&($u(a),fl(a)),r.g=o}else zT(r);0<t.j.length&&Zu(t)}else c[0]!="stop"&&c[0]!="close"||Yi(t,7);else t.H==3&&(c[0]=="stop"||c[0]=="close"?c[0]=="stop"?Yi(t,7):Pg(t):c[0]!="noop"&&t.h&&t.h.Aa(c),t.A=0)}}sl(4)}catch{}}function VO(n){if(n.Z&&typeof n.Z=="function")return n.Z();if(typeof Map<"u"&&n instanceof Map||typeof Set<"u"&&n instanceof Set)return Array.from(n.values());if(typeof n=="string")return n.split("");if(Vu(n)){for(var e=[],t=n.length,r=0;r<t;r++)e.push(n[r]);return e}e=[],t=0;for(r in n)e[t++]=n[r];return e}function qO(n){if(n.ta&&typeof n.ta=="function")return n.ta();if(!n.Z||typeof n.Z!="function"){if(typeof Map<"u"&&n instanceof Map)return Array.from(n.keys());if(!(typeof Set<"u"&&n instanceof Set)){if(Vu(n)||typeof n=="string"){var e=[];n=n.length;for(var t=0;t<n;t++)e.push(t);return e}e=[],t=0;for(let r in n)e[t++]=r;return e}}}function TT(n,e){if(n.forEach&&typeof n.forEach=="function")n.forEach(e,void 0);else if(Vu(n)||typeof n=="string")Array.prototype.forEach.call(n,e,void 0);else for(var t=qO(n),r=VO(n),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],t&&t[s],n)}var CT=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function UO(n,e){if(n){n=n.split("&");for(var t=0;t<n.length;t++){var r=n[t].indexOf("="),i=null;if(0<=r){var s=n[t].substring(0,r);i=n[t].substring(r+1)}else s=n[t];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}function Xi(n){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,n instanceof Xi){this.h=n.h,Ou(this,n.j),this.s=n.s,this.g=n.g,xu(this,n.m),this.l=n.l;var e=n.i,t=new ol;t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),jE(this,t),this.o=n.o}else n&&(e=String(n).match(CT))?(this.h=!1,Ou(this,e[1]||"",!0),this.s=Xa(e[2]||""),this.g=Xa(e[3]||"",!0),xu(this,e[4]),this.l=Xa(e[5]||"",!0),jE(this,e[6]||"",!0),this.o=Xa(e[7]||"")):(this.h=!1,this.i=new ol(null,this.h))}Xi.prototype.toString=function(){var n=[],e=this.j;e&&n.push(Ja(e,GE,!0),":");var t=this.g;return(t||e=="file")&&(n.push("//"),(e=this.s)&&n.push(Ja(e,GE,!0),"@"),n.push(encodeURIComponent(String(t)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t=this.m,t!=null&&n.push(":",String(t))),(t=this.l)&&(this.g&&t.charAt(0)!="/"&&n.push("/"),n.push(Ja(t,t.charAt(0)=="/"?GO:jO,!0))),(t=this.i.toString())&&n.push("?",t),(t=this.o)&&n.push("#",Ja(t,KO)),n.join("")};function vr(n){return new Xi(n)}function Ou(n,e,t){n.j=t?Xa(e,!0):e,n.j&&(n.j=n.j.replace(/:$/,""))}function xu(n,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);n.m=e}else n.m=null}function jE(n,e,t){e instanceof ol?(n.i=e,WO(n.i,n.h)):(t||(e=Ja(e,HO)),n.i=new ol(e,n.h))}function Te(n,e,t){n.i.set(e,t)}function Qu(n){return Te(n,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),n}function Xa(n,e){return n?e?decodeURI(n.replace(/%25/g,"%2525")):decodeURIComponent(n):""}function Ja(n,e,t){return typeof n=="string"?(n=encodeURI(n).replace(e,zO),t&&(n=n.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),n):null}function zO(n){return n=n.charCodeAt(0),"%"+(n>>4&15).toString(16)+(n&15).toString(16)}var GE=/[#\/\?@]/g,jO=/[#\?:]/g,GO=/[#\?]/g,HO=/[#\?@]/g,KO=/#/g;function ol(n,e){this.h=this.g=null,this.i=n||null,this.j=!!e}function Kr(n){n.g||(n.g=new Map,n.h=0,n.i&&UO(n.i,function(e,t){n.add(decodeURIComponent(e.replace(/\+/g," ")),t)}))}x=ol.prototype;x.add=function(n,e){Kr(this),this.i=null,n=to(this,n);var t=this.g.get(n);return t||this.g.set(n,t=[]),t.push(e),this.h+=1,this};function bT(n,e){Kr(n),e=to(n,e),n.g.has(e)&&(n.i=null,n.h-=n.g.get(e).length,n.g.delete(e))}function AT(n,e){return Kr(n),e=to(n,e),n.g.has(e)}x.forEach=function(n,e){Kr(this),this.g.forEach(function(t,r){t.forEach(function(i){n.call(e,i,r,this)},this)},this)};x.ta=function(){Kr(this);let n=Array.from(this.g.values()),e=Array.from(this.g.keys()),t=[];for(let r=0;r<e.length;r++){let i=n[r];for(let s=0;s<i.length;s++)t.push(e[r])}return t};x.Z=function(n){Kr(this);let e=[];if(typeof n=="string")AT(this,n)&&(e=e.concat(this.g.get(to(this,n))));else{n=Array.from(this.g.values());for(let t=0;t<n.length;t++)e=e.concat(n[t])}return e};x.set=function(n,e){return Kr(this),this.i=null,n=to(this,n),AT(this,n)&&(this.h-=this.g.get(n).length),this.g.set(n,[e]),this.h+=1,this};x.get=function(n,e){return n?(n=this.Z(n),0<n.length?String(n[0]):e):e};function IT(n,e,t){bT(n,e),0<t.length&&(n.i=null,n.g.set(to(n,e),vg(t)),n.h+=t.length)}x.toString=function(){if(this.i)return this.i;if(!this.g)return"";let n=[],e=Array.from(this.g.keys());for(var t=0;t<e.length;t++){var r=e[t];let s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;o[r]!==""&&(i+="="+encodeURIComponent(String(o[r]))),n.push(i)}}return this.i=n.join("&")};function to(n,e){return e=String(e),n.j&&(e=e.toLowerCase()),e}function WO(n,e){e&&!n.j&&(Kr(n),n.i=null,n.g.forEach(function(t,r){var i=r.toLowerCase();r!=i&&(bT(this,r),IT(this,i,t))},n)),n.j=e}var $O=class{constructor(n,e){this.g=n,this.map=e}};function DT(n){this.l=n||QO,$.PerformanceNavigationTiming?(n=$.performance.getEntriesByType("navigation"),n=0<n.length&&(n[0].nextHopProtocol=="hq"||n[0].nextHopProtocol=="h2")):n=!!($.g&&$.g.Ka&&$.g.Ka()&&$.g.Ka().dc),this.j=n?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var QO=10;function RT(n){return n.h?!0:n.g?n.g.size>=n.j:!1}function NT(n){return n.h?1:n.g?n.g.size:0}function pg(n,e){return n.h?n.h==e:n.g?n.g.has(e):!1}function Mg(n,e){n.g?n.g.add(e):n.h=e}function kT(n,e){n.h&&n.h==e?n.h=null:n.g&&n.g.has(e)&&n.g.delete(e)}DT.prototype.cancel=function(){if(this.i=MT(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&this.g.size!==0){for(let n of this.g.values())n.cancel();this.g.clear()}};function MT(n){if(n.h!=null)return n.i.concat(n.h.F);if(n.g!=null&&n.g.size!==0){let e=n.i;for(let t of n.g.values())e=e.concat(t.F);return e}return vg(n.i)}var YO=class{stringify(n){return $.JSON.stringify(n,void 0)}parse(n){return $.JSON.parse(n,void 0)}};function XO(){this.g=new YO}function JO(n,e,t){let r=t||"";try{TT(n,function(i,s){let o=i;ll(i)&&(o=bg(i)),e.push(r+s+"="+encodeURIComponent(o))})}catch(i){throw e.push(r+"type="+encodeURIComponent("_badmap")),i}}function ZO(n,e){let t=new Gu;if($.Image){let r=new Image;r.onload=Au(ku,t,r,"TestLoadImage: loaded",!0,e),r.onerror=Au(ku,t,r,"TestLoadImage: error",!1,e),r.onabort=Au(ku,t,r,"TestLoadImage: abort",!1,e),r.ontimeout=Au(ku,t,r,"TestLoadImage: timeout",!1,e),$.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=n}else e(!1)}function ku(n,e,t,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch{}}function pl(n){this.l=n.ec||null,this.j=n.ob||!1}nt(pl,Rg);pl.prototype.g=function(){return new Yu(this.l,this.j)};pl.prototype.i=function(n){return function(){return n}}({});function Yu(n,e){tt.call(this),this.F=n,this.u=e,this.m=void 0,this.readyState=Og,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}nt(Yu,tt);var Og=0;x=Yu.prototype;x.open=function(n,e){if(this.readyState!=Og)throw this.abort(),Error("Error reopening a connection");this.C=n,this.B=e,this.readyState=1,al(this)};x.send=function(n){if(this.readyState!=1)throw this.abort(),Error("need to call open() first. ");this.g=!0;let e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};n&&(e.body=n),(this.F||$).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))};x.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),1<=this.readyState&&this.g&&this.readyState!=4&&(this.g=!1,gl(this)),this.readyState=Og};x.$a=function(n){if(this.g&&(this.l=n,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=n.headers,this.readyState=2,al(this)),this.g&&(this.readyState=3,al(this),this.g)))if(this.responseType==="arraybuffer")n.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(typeof $.ReadableStream<"u"&&"body"in n){if(this.j=n.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;OT(this)}else n.text().then(this.Za.bind(this),this.ka.bind(this))};function OT(n){n.j.read().then(n.Xa.bind(n)).catch(n.ka.bind(n))}x.Xa=function(n){if(this.g){if(this.u&&n.value)this.response.push(n.value);else if(!this.u){var e=n.value?n.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!n.done}))&&(this.response=this.responseText+=e)}n.done?gl(this):al(this),this.readyState==3&&OT(this)}};x.Za=function(n){this.g&&(this.response=this.responseText=n,gl(this))};x.Ya=function(n){this.g&&(this.response=n,gl(this))};x.ka=function(){this.g&&gl(this)};function gl(n){n.readyState=4,n.l=null,n.j=null,n.A=null,al(n)}x.setRequestHeader=function(n,e){this.v.append(n,e)};x.getResponseHeader=function(n){return this.h&&this.h.get(n.toLowerCase())||""};x.getAllResponseHeaders=function(){if(!this.h)return"";let n=[],e=this.h.entries();for(var t=e.next();!t.done;)t=t.value,n.push(t[0]+": "+t[1]),t=e.next();return n.join(`\r
`)};function al(n){n.onreadystatechange&&n.onreadystatechange.call(n)}Object.defineProperty(Yu.prototype,"withCredentials",{get:function(){return this.m==="include"},set:function(n){this.m=n?"include":"same-origin"}});var ex=$.JSON.parse;function Fe(n){tt.call(this),this.headers=new Map,this.u=n||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=xT,this.L=this.M=!1}nt(Fe,tt);var xT="",tx=/^https?$/i,nx=["POST","PUT"];x=Fe.prototype;x.Oa=function(n){this.M=n};x.ha=function(n,e,t,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+n);e=e?e.toUpperCase():"GET",this.I=n,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():ug.g(),this.C=this.u?zE(this.u):zE(ug),this.g.onreadystatechange=_t(this.La,this);try{this.G=!0,this.g.open(e,String(n),!0),this.G=!1}catch(s){HE(this,s);return}if(n=t||"",t=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)t.set(i,r[i]);else if(typeof r.keys=="function"&&typeof r.get=="function")for(let s of r.keys())t.set(s,r.get(s));else throw Error("Unknown input type for opt_headers: "+String(r));r=Array.from(t.keys()).find(s=>s.toLowerCase()=="content-type"),i=$.FormData&&n instanceof $.FormData,!(0<=YE(nx,e))||r||i||t.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(let[s,o]of t)this.g.setRequestHeader(s,o);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{LT(this),0<this.B&&((this.L=rx(this.g))?(this.g.timeout=this.B,this.g.ontimeout=_t(this.ua,this)):this.A=Dg(this.ua,this.B,this)),this.v=!0,this.g.send(n),this.v=!1}catch(s){HE(this,s)}};function rx(n){return eo&&typeof n.timeout=="number"&&n.ontimeout!==void 0}x.ua=function(){typeof yg<"u"&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,ht(this,"timeout"),this.abort(8))};function HE(n,e){n.h=!1,n.g&&(n.l=!0,n.g.abort(),n.l=!1),n.j=e,n.m=5,PT(n),Xu(n)}function PT(n){n.F||(n.F=!0,ht(n,"complete"),ht(n,"error"))}x.abort=function(n){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=n||7,ht(this,"complete"),ht(this,"abort"),Xu(this))};x.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Xu(this,!0)),Fe.$.N.call(this)};x.La=function(){this.s||(this.G||this.v||this.l?FT(this):this.kb())};x.kb=function(){FT(this)};function FT(n){if(n.h&&typeof yg<"u"&&(!n.C[1]||qn(n)!=4||n.da()!=2)){if(n.v&&qn(n)==4)Dg(n.La,0,n);else if(ht(n,"readystatechange"),qn(n)==4){n.h=!1;try{let o=n.da();e:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break e;default:e=!1}var t;if(!(t=e)){var r;if(r=o===0){var i=String(n.I).match(CT)[1]||null;!i&&$.self&&$.self.location&&(i=$.self.location.protocol.slice(0,-1)),r=!tx.test(i?i.toLowerCase():"")}t=r}if(t)ht(n,"complete"),ht(n,"success");else{n.m=6;try{var s=2<qn(n)?n.g.statusText:""}catch{s=""}n.j=s+" ["+n.da()+"]",PT(n)}}finally{Xu(n)}}}}function Xu(n,e){if(n.g){LT(n);let t=n.g,r=n.C[0]?()=>{}:null;n.g=null,n.C=null,e||ht(n,"ready");try{t.onreadystatechange=r}catch{}}}function LT(n){n.g&&n.L&&(n.g.ontimeout=null),n.A&&($.clearTimeout(n.A),n.A=null)}x.isActive=function(){return!!this.g};function qn(n){return n.g?n.g.readyState:0}x.da=function(){try{return 2<qn(this)?this.g.status:-1}catch{return-1}};x.ja=function(){try{return this.g?this.g.responseText:""}catch{return""}};x.Wa=function(n){if(this.g){var e=this.g.responseText;return n&&e.indexOf(n)==0&&(e=e.substring(n.length)),ex(e)}};function KE(n){try{if(!n.g)return null;if("response"in n.g)return n.g.response;switch(n.K){case xT:case"text":return n.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in n.g)return n.g.mozResponseArrayBuffer}return null}catch{return null}}function ix(n){let e={};n=(n.g&&2<=qn(n)&&n.g.getAllResponseHeaders()||"").split(`\r
`);for(let r=0;r<n.length;r++){if(el(n[r]))continue;var t=NO(n[r]);let i=t[0];if(t=t[1],typeof t!="string")continue;t=t.trim();let s=e[i]||[];e[i]=s,s.push(t)}AO(e,function(r){return r.join(", ")})}x.Ia=function(){return this.m};x.Sa=function(){return typeof this.j=="string"?this.j:String(this.j)};function BT(n){let e="";return Sg(n,function(t,r){e+=r,e+=":",e+=t,e+=`\r
`}),e}function xg(n,e,t){e:{for(r in t){var r=!1;break e}r=!0}r||(t=BT(t),typeof n=="string"?t!=null&&encodeURIComponent(String(t)):Te(n,e,t))}function Qa(n,e,t){return t&&t.internalChannelParams&&t.internalChannelParams[n]||e}function VT(n){this.Ga=0,this.j=[],this.l=new Gu,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Qa("failFast",!1,n),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Qa("baseRetryDelayMs",5e3,n),this.hb=Qa("retryDelaySeedMs",1e4,n),this.eb=Qa("forwardChannelMaxRetries",2,n),this.xa=Qa("forwardChannelRequestTimeoutMs",2e4,n),this.va=n&&n.xmlHttpFactory||void 0,this.Ha=n&&n.useFetchStreams||!1,this.L=void 0,this.J=n&&n.supportsCrossDomainXhr||!1,this.K="",this.i=new DT(n&&n.concurrentRequestLimit),this.Ja=new XO,this.P=n&&n.fastHandshake||!1,this.O=n&&n.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=n&&n.bc||!1,n&&n.Ea&&this.l.Ea(),n&&n.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&n&&n.detectBufferingProxy||!1,this.qa=void 0,n&&n.longPollingTimeout&&0<n.longPollingTimeout&&(this.qa=n.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}x=VT.prototype;x.ra=8;x.H=1;function Pg(n){if(qT(n),n.H==3){var e=n.W++,t=vr(n.I);if(Te(t,"SID",n.K),Te(t,"RID",e),Te(t,"TYPE","terminate"),ml(n,t),e=new hl(n,n.l,e),e.L=2,e.A=Qu(vr(t)),t=!1,$.navigator&&$.navigator.sendBeacon)try{t=$.navigator.sendBeacon(e.A.toString(),"")}catch{}!t&&$.Image&&(new Image().src=e.A,t=!0),t||(e.g=$T(e.l,null),e.g.ha(e.A)),e.G=Date.now(),fl(e)}KT(n)}function Ju(n){n.g&&(Lg(n),n.g.cancel(),n.g=null)}function qT(n){Ju(n),n.u&&($.clearTimeout(n.u),n.u=null),Pu(n),n.i.cancel(),n.m&&(typeof n.m=="number"&&$.clearTimeout(n.m),n.m=null)}function Zu(n){if(!RT(n.i)&&!n.m){n.m=!0;var e=n.Na;nl||lT(),rl||(nl(),rl=!0),Ag.add(e,n),n.C=0}}function sx(n,e){return NT(n.i)>=n.i.j-(n.m?1:0)?!1:n.m?(n.j=e.F.concat(n.j),!0):n.H==1||n.H==2||n.C>=(n.cb?0:n.eb)?!1:(n.m=ul(_t(n.Na,n,e),HT(n,n.C)),n.C++,!0)}x.Na=function(n){if(this.m)if(this.m=null,this.H==1){if(!n){this.W=Math.floor(1e5*Math.random()),n=this.W++;let i=new hl(this,this.l,n),s=this.s;if(this.U&&(s?(s=eT(s),tT(s,this.U)):s=this.U),this.o!==null||this.O||(i.I=s,s=null),this.P)e:{for(var e=0,t=0;t<this.j.length;t++){t:{var r=this.j[t];if("__data__"in r.map&&(r=r.map.__data__,typeof r=="string")){r=r.length;break t}r=void 0}if(r===void 0)break;if(e+=r,4096<e){e=t;break e}if(e===4096||t===this.j.length-1){e=t+1;break e}}e=1e3}else e=1e3;e=UT(this,i,e),t=vr(this.I),Te(t,"RID",n),Te(t,"CVER",22),this.F&&Te(t,"X-HTTP-Session-Id",this.F),ml(this,t),s&&(this.O?e="headers="+encodeURIComponent(String(BT(s)))+"&"+e:this.o&&xg(t,this.o,s)),Mg(this.i,i),this.bb&&Te(t,"TYPE","init"),this.P?(Te(t,"$req",e),Te(t,"SID","null"),i.aa=!0,hg(i,t,null)):hg(i,t,e),this.H=2}}else this.H==3&&(n?WE(this,n):this.j.length==0||RT(this.i)||WE(this))};function WE(n,e){var t;e?t=e.m:t=n.W++;let r=vr(n.I);Te(r,"SID",n.K),Te(r,"RID",t),Te(r,"AID",n.V),ml(n,r),n.o&&n.s&&xg(r,n.o,n.s),t=new hl(n,n.l,t,n.C+1),n.o===null&&(t.I=n.s),e&&(n.j=e.F.concat(n.j)),e=UT(n,t,1e3),t.setTimeout(Math.round(.5*n.xa)+Math.round(.5*n.xa*Math.random())),Mg(n.i,t),hg(t,r,e)}function ml(n,e){n.na&&Sg(n.na,function(t,r){Te(e,r,t)}),n.h&&TT({},function(t,r){Te(e,r,t)})}function UT(n,e,t){t=Math.min(n.j.length,t);var r=n.h?_t(n.h.Va,n.h,n):null;e:{var i=n.j;let s=-1;for(;;){let o=["count="+t];s==-1?0<t?(s=i[0].g,o.push("ofs="+s)):s=0:o.push("ofs="+s);let a=!0;for(let l=0;l<t;l++){let c=i[l].g,u=i[l].map;if(c-=s,0>c)s=Math.max(0,i[l].g-100),a=!1;else try{JO(u,o,"req"+c+"_")}catch{r&&r(u)}}if(a){r=o.join("&");break e}}}return n=n.j.splice(0,t),e.F=n,r}function zT(n){if(!n.g&&!n.u){n.ba=1;var e=n.Ma;nl||lT(),rl||(nl(),rl=!0),Ag.add(e,n),n.A=0}}function Fg(n){return n.g||n.u||3<=n.A?!1:(n.ba++,n.u=ul(_t(n.Ma,n),HT(n,n.A)),n.A++,!0)}x.Ma=function(){if(this.u=null,jT(this),this.ca&&!(this.M||this.g==null||0>=this.S)){var n=2*this.S;this.l.info("BP detection timer enabled: "+n),this.B=ul(_t(this.jb,this),n)}};x.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,Nt(10),Ju(this),jT(this))};function Lg(n){n.B!=null&&($.clearTimeout(n.B),n.B=null)}function jT(n){n.g=new hl(n,n.l,"rpc",n.ba),n.o===null&&(n.g.I=n.s),n.g.O=0;var e=vr(n.wa);Te(e,"RID","rpc"),Te(e,"SID",n.K),Te(e,"AID",n.V),Te(e,"CI",n.G?"0":"1"),!n.G&&n.qa&&Te(e,"TO",n.qa),Te(e,"TYPE","xmlhttp"),ml(n,e),n.o&&n.s&&xg(e,n.o,n.s),n.L&&n.g.setTimeout(n.L);var t=n.g;n=n.pa,t.L=1,t.A=Qu(vr(e)),t.u=null,t.S=!0,_T(t,n)}x.ib=function(){this.v!=null&&(this.v=null,Ju(this),Fg(this),Nt(19))};function Pu(n){n.v!=null&&($.clearTimeout(n.v),n.v=null)}function GT(n,e){var t=null;if(n.g==e){Pu(n),Lg(n),n.g=null;var r=2}else if(pg(n.i,e))t=e.F,kT(n.i,e),r=1;else return;if(n.H!=0){if(e.i)if(r==1){t=e.u?e.u.length:0,e=Date.now()-e.G;var i=n.C;r=Hu(),ht(r,new pT(r,t)),Zu(n)}else zT(n);else if(i=e.s,i==3||i==0&&0<e.ca||!(r==1&&sx(n,e)||r==2&&Fg(n)))switch(t&&0<t.length&&(e=n.i,e.i=e.i.concat(t)),i){case 1:Yi(n,5);break;case 4:Yi(n,10);break;case 3:Yi(n,6);break;default:Yi(n,2)}}}function HT(n,e){let t=n.ab+Math.floor(Math.random()*n.hb);return n.isActive()||(t*=2),t*e}function Yi(n,e){if(n.l.info("Error code "+e),e==2){var t=null;n.h&&(t=null);var r=_t(n.pb,n);t||(t=new Xi("//www.google.com/images/cleardot.gif"),$.location&&$.location.protocol=="http"||Ou(t,"https"),Qu(t)),ZO(t.toString(),r)}else Nt(2);n.H=0,n.h&&n.h.za(e),KT(n),qT(n)}x.pb=function(n){n?(this.l.info("Successfully pinged google.com"),Nt(2)):(this.l.info("Failed to ping google.com"),Nt(1))};function KT(n){if(n.H=0,n.ma=[],n.h){let e=MT(n.i);(e.length!=0||n.j.length!=0)&&(BE(n.ma,e),BE(n.ma,n.j),n.i.i.length=0,vg(n.j),n.j.length=0),n.h.ya()}}function WT(n,e,t){var r=t instanceof Xi?vr(t):new Xi(t);if(r.g!="")e&&(r.g=e+"."+r.g),xu(r,r.m);else{var i=$.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Xi(null);r&&Ou(s,r),e&&(s.g=e),i&&xu(s,i),t&&(s.l=t),r=s}return t=n.F,e=n.Da,t&&e&&Te(r,t,e),Te(r,"VER",n.ra),ml(n,r),r}function $T(n,e,t){if(e&&!n.J)throw Error("Can't create secondary domain capable XhrIo object.");return e=n.Ha&&!n.va?new Fe(new pl({ob:t})):new Fe(n.va),e.Oa(n.J),e}x.isActive=function(){return!!this.h&&this.h.isActive(this)};function QT(){}x=QT.prototype;x.Ba=function(){};x.Aa=function(){};x.za=function(){};x.ya=function(){};x.isActive=function(){return!0};x.Va=function(){};function Fu(){if(eo&&!(10<=Number(EO)))throw Error("Environmental error: no available transport.")}Fu.prototype.g=function(n,e){return new Kt(n,e)};function Kt(n,e){tt.call(this),this.g=new VT(e),this.l=n,this.h=e&&e.messageUrlParams||null,n=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(n?n["X-Client-Protocol"]="webchannel":n={"X-Client-Protocol":"webchannel"}),this.g.s=n,n=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(n?n["X-WebChannel-Content-Type"]=e.messageContentType:n={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(n?n["X-WebChannel-Client-Profile"]=e.Ca:n={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=n,(n=e&&e.cc)&&!el(n)&&(this.g.o=n),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!el(e)&&(this.g.F=e,n=this.h,n!==null&&e in n&&(n=this.h,e in n&&delete n[e])),this.j=new no(this)}nt(Kt,tt);Kt.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var n=this.g,e=this.l,t=this.h||void 0;Nt(0),n.Y=e,n.na=t||{},n.G=n.aa,n.I=WT(n,null,n.Y),Zu(n)};Kt.prototype.close=function(){Pg(this.g)};Kt.prototype.u=function(n){var e=this.g;if(typeof n=="string"){var t={};t.__data__=n,n=t}else this.v&&(t={},t.__data__=bg(n),n=t);e.j.push(new $O(e.fb++,n)),e.H==3&&Zu(e)};Kt.prototype.N=function(){this.g.h=null,delete this.j,Pg(this.g),delete this.g,Kt.$.N.call(this)};function YT(n){Ng.call(this),n.__headers__&&(this.headers=n.__headers__,this.statusCode=n.__status__,delete n.__headers__,delete n.__status__);var e=n.__sm__;if(e){e:{for(let t in e){n=t;break e}n=void 0}(this.i=n)&&(n=this.i,e=e!==null&&n in e?e[n]:void 0),this.data=e}else this.data=n}nt(YT,Ng);function XT(){kg.call(this),this.status=1}nt(XT,kg);function no(n){this.g=n}nt(no,QT);no.prototype.Ba=function(){ht(this.g,"a")};no.prototype.Aa=function(n){ht(this.g,new YT(n))};no.prototype.za=function(n){ht(this.g,new XT)};no.prototype.ya=function(){ht(this.g,"b")};function ox(){this.blockSize=-1}function Sn(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}nt(Sn,ox);Sn.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0};function eg(n,e,t){t||(t=0);var r=Array(16);if(typeof e=="string")for(var i=0;16>i;++i)r[i]=e.charCodeAt(t++)|e.charCodeAt(t++)<<8|e.charCodeAt(t++)<<16|e.charCodeAt(t++)<<24;else for(i=0;16>i;++i)r[i]=e[t++]|e[t++]<<8|e[t++]<<16|e[t++]<<24;e=n.g[0],t=n.g[1],i=n.g[2];var s=n.g[3],o=e+(s^t&(i^s))+r[0]+3614090360&4294967295;e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[1]+3905402710&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[2]+606105819&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[3]+3250441966&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[4]+4118548399&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[5]+1200080426&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[6]+2821735955&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[7]+4249261313&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[8]+1770035416&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[9]+2336552879&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[10]+4294925233&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[11]+2304563134&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(s^t&(i^s))+r[12]+1804603682&4294967295,e=t+(o<<7&4294967295|o>>>25),o=s+(i^e&(t^i))+r[13]+4254626195&4294967295,s=e+(o<<12&4294967295|o>>>20),o=i+(t^s&(e^t))+r[14]+2792965006&4294967295,i=s+(o<<17&4294967295|o>>>15),o=t+(e^i&(s^e))+r[15]+1236535329&4294967295,t=i+(o<<22&4294967295|o>>>10),o=e+(i^s&(t^i))+r[1]+4129170786&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[6]+3225465664&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[11]+643717713&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[0]+3921069994&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[5]+3593408605&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[10]+38016083&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[15]+3634488961&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[4]+3889429448&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[9]+568446438&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[14]+3275163606&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[3]+4107603335&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[8]+1163531501&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(i^s&(t^i))+r[13]+2850285829&4294967295,e=t+(o<<5&4294967295|o>>>27),o=s+(t^i&(e^t))+r[2]+4243563512&4294967295,s=e+(o<<9&4294967295|o>>>23),o=i+(e^t&(s^e))+r[7]+1735328473&4294967295,i=s+(o<<14&4294967295|o>>>18),o=t+(s^e&(i^s))+r[12]+2368359562&4294967295,t=i+(o<<20&4294967295|o>>>12),o=e+(t^i^s)+r[5]+4294588738&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[8]+2272392833&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[11]+1839030562&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[14]+4259657740&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[1]+2763975236&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[4]+1272893353&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[7]+4139469664&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[10]+3200236656&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[13]+681279174&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[0]+3936430074&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[3]+3572445317&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[6]+76029189&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(t^i^s)+r[9]+3654602809&4294967295,e=t+(o<<4&4294967295|o>>>28),o=s+(e^t^i)+r[12]+3873151461&4294967295,s=e+(o<<11&4294967295|o>>>21),o=i+(s^e^t)+r[15]+530742520&4294967295,i=s+(o<<16&4294967295|o>>>16),o=t+(i^s^e)+r[2]+3299628645&4294967295,t=i+(o<<23&4294967295|o>>>9),o=e+(i^(t|~s))+r[0]+4096336452&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[7]+1126891415&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[14]+2878612391&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[5]+4237533241&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[12]+1700485571&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[3]+2399980690&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[10]+4293915773&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[1]+2240044497&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[8]+1873313359&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[15]+4264355552&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[6]+2734768916&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[13]+1309151649&4294967295,t=i+(o<<21&4294967295|o>>>11),o=e+(i^(t|~s))+r[4]+4149444226&4294967295,e=t+(o<<6&4294967295|o>>>26),o=s+(t^(e|~i))+r[11]+3174756917&4294967295,s=e+(o<<10&4294967295|o>>>22),o=i+(e^(s|~t))+r[2]+718787259&4294967295,i=s+(o<<15&4294967295|o>>>17),o=t+(s^(i|~e))+r[9]+3951481745&4294967295,n.g[0]=n.g[0]+e&4294967295,n.g[1]=n.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,n.g[2]=n.g[2]+i&4294967295,n.g[3]=n.g[3]+s&4294967295}Sn.prototype.j=function(n,e){e===void 0&&(e=n.length);for(var t=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(i==0)for(;s<=t;)eg(this,n,s),s+=this.blockSize;if(typeof n=="string"){for(;s<e;)if(r[i++]=n.charCodeAt(s++),i==this.blockSize){eg(this,r),i=0;break}}else for(;s<e;)if(r[i++]=n[s++],i==this.blockSize){eg(this,r),i=0;break}}this.h=i,this.i+=e};Sn.prototype.l=function(){var n=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);n[0]=128;for(var e=1;e<n.length-8;++e)n[e]=0;var t=8*this.i;for(e=n.length-8;e<n.length;++e)n[e]=t&255,t/=256;for(this.j(n),n=Array(16),e=t=0;4>e;++e)for(var r=0;32>r;r+=8)n[t++]=this.g[e]>>>r&255;return n};function he(n,e){this.h=e;for(var t=[],r=!0,i=n.length-1;0<=i;i--){var s=n[i]|0;r&&s==e||(t[i]=s,r=!1)}this.g=t}var ax={};function Bg(n){return-128<=n&&128>n?_O(n,function(e){return new he([e|0],0>e?-1:0)}):new he([n|0],0>n?-1:0)}function Un(n){if(isNaN(n)||!isFinite(n))return Zs;if(0>n)return dt(Un(-n));for(var e=[],t=1,r=0;n>=t;r++)e[r]=n/t|0,t*=gg;return new he(e,0)}function JT(n,e){if(n.length==0)throw Error("number format error: empty string");if(e=e||10,2>e||36<e)throw Error("radix out of range: "+e);if(n.charAt(0)=="-")return dt(JT(n.substring(1),e));if(0<=n.indexOf("-"))throw Error('number format error: interior "-" character');for(var t=Un(Math.pow(e,8)),r=Zs,i=0;i<n.length;i+=8){var s=Math.min(8,n.length-i),o=parseInt(n.substring(i,i+s),e);8>s?(s=Un(Math.pow(e,s)),r=r.R(s).add(Un(o))):(r=r.R(t),r=r.add(Un(o)))}return r}var gg=4294967296,Zs=Bg(0),mg=Bg(1),$E=Bg(16777216);x=he.prototype;x.ea=function(){if(tn(this))return-dt(this).ea();for(var n=0,e=1,t=0;t<this.g.length;t++){var r=this.D(t);n+=(0<=r?r:gg+r)*e,e*=gg}return n};x.toString=function(n){if(n=n||10,2>n||36<n)throw Error("radix out of range: "+n);if(yr(this))return"0";if(tn(this))return"-"+dt(this).toString(n);for(var e=Un(Math.pow(n,6)),t=this,r="";;){var i=Bu(t,e).g;t=Lu(t,i.R(e));var s=((0<t.g.length?t.g[0]:t.h)>>>0).toString(n);if(t=i,yr(t))return s+r;for(;6>s.length;)s="0"+s;r=s+r}};x.D=function(n){return 0>n?0:n<this.g.length?this.g[n]:this.h};function yr(n){if(n.h!=0)return!1;for(var e=0;e<n.g.length;e++)if(n.g[e]!=0)return!1;return!0}function tn(n){return n.h==-1}x.X=function(n){return n=Lu(this,n),tn(n)?-1:yr(n)?0:1};function dt(n){for(var e=n.g.length,t=[],r=0;r<e;r++)t[r]=~n.g[r];return new he(t,~n.h).add(mg)}x.abs=function(){return tn(this)?dt(this):this};x.add=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0,i=0;i<=e;i++){var s=r+(this.D(i)&65535)+(n.D(i)&65535),o=(s>>>16)+(this.D(i)>>>16)+(n.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,t[i]=o<<16|s}return new he(t,t[t.length-1]&-2147483648?-1:0)};function Lu(n,e){return n.add(dt(e))}x.R=function(n){if(yr(this)||yr(n))return Zs;if(tn(this))return tn(n)?dt(this).R(dt(n)):dt(dt(this).R(n));if(tn(n))return dt(this.R(dt(n)));if(0>this.X($E)&&0>n.X($E))return Un(this.ea()*n.ea());for(var e=this.g.length+n.g.length,t=[],r=0;r<2*e;r++)t[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<n.g.length;i++){var s=this.D(r)>>>16,o=this.D(r)&65535,a=n.D(i)>>>16,l=n.D(i)&65535;t[2*r+2*i]+=o*l,Mu(t,2*r+2*i),t[2*r+2*i+1]+=s*l,Mu(t,2*r+2*i+1),t[2*r+2*i+1]+=o*a,Mu(t,2*r+2*i+1),t[2*r+2*i+2]+=s*a,Mu(t,2*r+2*i+2)}for(r=0;r<e;r++)t[r]=t[2*r+1]<<16|t[2*r];for(r=e;r<2*e;r++)t[r]=0;return new he(t,0)};function Mu(n,e){for(;(n[e]&65535)!=n[e];)n[e+1]+=n[e]>>>16,n[e]&=65535,e++}function Ya(n,e){this.g=n,this.h=e}function Bu(n,e){if(yr(e))throw Error("division by zero");if(yr(n))return new Ya(Zs,Zs);if(tn(n))return e=Bu(dt(n),e),new Ya(dt(e.g),dt(e.h));if(tn(e))return e=Bu(n,dt(e)),new Ya(dt(e.g),e.h);if(30<n.g.length){if(tn(n)||tn(e))throw Error("slowDivide_ only works with positive integers.");for(var t=mg,r=e;0>=r.X(n);)t=QE(t),r=QE(r);var i=Xs(t,1),s=Xs(r,1);for(r=Xs(r,2),t=Xs(t,2);!yr(r);){var o=s.add(r);0>=o.X(n)&&(i=i.add(t),s=o),r=Xs(r,1),t=Xs(t,1)}return e=Lu(n,i.R(e)),new Ya(i,e)}for(i=Zs;0<=n.X(e);){for(t=Math.max(1,Math.floor(n.ea()/e.ea())),r=Math.ceil(Math.log(t)/Math.LN2),r=48>=r?1:Math.pow(2,r-48),s=Un(t),o=s.R(e);tn(o)||0<o.X(n);)t-=r,s=Un(t),o=s.R(e);yr(s)&&(s=mg),i=i.add(s),n=Lu(n,o)}return new Ya(i,n)}x.gb=function(n){return Bu(this,n).h};x.and=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)&n.D(r);return new he(t,this.h&n.h)};x.or=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)|n.D(r);return new he(t,this.h|n.h)};x.xor=function(n){for(var e=Math.max(this.g.length,n.g.length),t=[],r=0;r<e;r++)t[r]=this.D(r)^n.D(r);return new he(t,this.h^n.h)};function QE(n){for(var e=n.g.length+1,t=[],r=0;r<e;r++)t[r]=n.D(r)<<1|n.D(r-1)>>>31;return new he(t,n.h)}function Xs(n,e){var t=e>>5;e%=32;for(var r=n.g.length-t,i=[],s=0;s<r;s++)i[s]=0<e?n.D(s+t)>>>e|n.D(s+t+1)<<32-e:n.D(s+t);return new he(i,n.h)}Fu.prototype.createWebChannel=Fu.prototype.g;Kt.prototype.send=Kt.prototype.u;Kt.prototype.open=Kt.prototype.m;Kt.prototype.close=Kt.prototype.close;Ku.NO_ERROR=0;Ku.TIMEOUT=8;Ku.HTTP_ERROR=6;gT.COMPLETE="complete";mT.EventType=dl;dl.OPEN="a";dl.CLOSE="b";dl.ERROR="c";dl.MESSAGE="d";tt.prototype.listen=tt.prototype.O;Fe.prototype.listenOnce=Fe.prototype.P;Fe.prototype.getLastError=Fe.prototype.Sa;Fe.prototype.getLastErrorCode=Fe.prototype.Ia;Fe.prototype.getStatus=Fe.prototype.da;Fe.prototype.getResponseJson=Fe.prototype.Wa;Fe.prototype.getResponseText=Fe.prototype.ja;Fe.prototype.send=Fe.prototype.ha;Fe.prototype.setWithCredentials=Fe.prototype.Oa;Sn.prototype.digest=Sn.prototype.l;Sn.prototype.reset=Sn.prototype.reset;Sn.prototype.update=Sn.prototype.j;he.prototype.add=he.prototype.add;he.prototype.multiply=he.prototype.R;he.prototype.modulo=he.prototype.gb;he.prototype.compare=he.prototype.X;he.prototype.toNumber=he.prototype.ea;he.prototype.toString=he.prototype.toString;he.prototype.getBits=he.prototype.D;he.fromNumber=Un;he.fromString=JT;var VH=wn.createWebChannelTransport=function(){return new Fu},qH=wn.getStatEventTarget=function(){return Hu()},UH=wn.ErrorCode=Ku,zH=wn.EventType=gT,jH=wn.Event=Ji,GH=wn.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},HH=wn.FetchXmlHttpFactory=pl,KH=wn.WebChannel=mT,WH=wn.XhrIo=Fe,ZT=wn.Md5=Sn,Zi=wn.Integer=he;var _s=yw(ID(),1),V1=yw(Oy(),1);var DD="@firebase/firestore",RD="4.4.0";var Xe=class{constructor(e){this.uid=e}isAuthenticated(){return this.uid!=null}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}};Xe.UNAUTHENTICATED=new Xe(null);Xe.GOOGLE_CREDENTIALS=new Xe("google-credentials-uid");Xe.FIRST_PARTY=new Xe("first-party-uid");Xe.MOCK_USER=new Xe("mock-user");var AU="10.7.0";var Ca=AU;function IU(n){Ca=n}function DU(n){return EU(n,{depth:100})}var Ii=new cu("@firebase/firestore");function Jo(){return Ii.logLevel}function q1(n){Ii.setLogLevel(n)}function D(n,...e){if(Ii.logLevel<=Ln.DEBUG){let t=e.map(u0);Ii.debug(`Firestore (${Ca}): ${n}`,...t)}}function Ne(n,...e){if(Ii.logLevel<=Ln.ERROR){let t=e.map(u0);Ii.error(`Firestore (${Ca}): ${n}`,...t)}}function gn(n,...e){if(Ii.logLevel<=Ln.WARN){let t=e.map(u0);Ii.warn(`Firestore (${Ca}): ${n}`,...t)}}function u0(n){if(typeof n=="string")return n;try{return DU(n)}catch{return n}}function L(n="Unexpected state"){let e=`FIRESTORE (${Ca}) INTERNAL ASSERTION FAILED: `+n;throw Ne(e),new Error(e)}function q(n,e){n||L()}function U1(n,e){n||L()}function P(n,e){return n}var v={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},T=class extends Hw{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}};var je=class{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}};var af=class{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${e}`)}},h_=class{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(Xe.UNAUTHENTICATED))}shutdown(){}},f_=class{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}},p_=class{constructor(e){this.authProvider=e,this.currentUser=Xe.UNAUTHENTICATED,this.tokenCounter=0,this.forceRefresh=!1,this.auth=null}start(e,t){let r=this.tokenCounter,i=l=>this.tokenCounter!==r?(r=this.tokenCounter,t(l)):Promise.resolve(),s=new je;this.tokenListener=()=>{this.tokenCounter++,this.currentUser=this.getUser(),s.resolve(),s=new je,e.enqueueRetryable(()=>i(this.currentUser))};let o=()=>{let l=s;e.enqueueRetryable(()=>g(this,null,function*(){yield l.promise,yield i(this.currentUser)}))},a=l=>{D("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=l,this.auth.addAuthTokenListener(this.tokenListener),o()};this.authProvider.onInit(l=>a(l)),setTimeout(()=>{if(!this.auth){let l=this.authProvider.getImmediate({optional:!0});l?a(l):(D("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new je)}},0),o()}getToken(){let e=this.tokenCounter,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(r=>this.tokenCounter!==e?(D("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):r?(q(typeof r.accessToken=="string"),new af(r.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.tokenListener)}getUser(){let e=this.auth&&this.auth.getUid();return q(e===null||typeof e=="string"),new Xe(e)}},g_=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r,this.type="FirstParty",this.user=Xe.FIRST_PARTY,this._headers=new Map}getAuthToken(){return this.authTokenFactory?this.authTokenFactory():null}get headers(){this._headers.set("X-Goog-AuthUser",this.sessionIndex);let e=this.getAuthToken();return e&&this._headers.set("Authorization",e),this.iamToken&&this._headers.set("X-Goog-Iam-Authorization-Token",this.iamToken),this._headers}},m_=class{constructor(e,t,r){this.sessionIndex=e,this.iamToken=t,this.authTokenFactory=r}getToken(){return Promise.resolve(new g_(this.sessionIndex,this.iamToken,this.authTokenFactory))}start(e,t){e.enqueueRetryable(()=>t(Xe.FIRST_PARTY))}shutdown(){}invalidateToken(){}},y_=class{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}},v_=class{constructor(e){this.appCheckProvider=e,this.forceRefresh=!1,this.appCheck=null,this.latestAppCheckToken=null}start(e,t){let r=s=>{s.error!=null&&D("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${s.error.message}`);let o=s.token!==this.latestAppCheckToken;return this.latestAppCheckToken=s.token,D("FirebaseAppCheckTokenProvider",`Received ${o?"new":"existing"} token.`),o?t(s.token):Promise.resolve()};this.tokenListener=s=>{e.enqueueRetryable(()=>r(s))};let i=s=>{D("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=s,this.appCheck.addTokenListener(this.tokenListener)};this.appCheckProvider.onInit(s=>i(s)),setTimeout(()=>{if(!this.appCheck){let s=this.appCheckProvider.getImmediate({optional:!0});s?i(s):D("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){let e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(t=>t?(q(typeof t.token=="string"),this.latestAppCheckToken=t.token,new y_(t.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.tokenListener)}};function RU(n){if(!n)return new h_;switch(n.type){case"firstParty":return new m_(n.sessionIndex||"0",n.iamToken||null,n.authTokenFactory||null);case"provider":return n.client;default:throw new T(v.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}function NU(n){return bU(n)}var lf=class{static newId(){let e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",t=Math.floor(256/e.length)*e.length,r="",i=20;for(;r.length<i;){let s=NU(40);for(let o=0;o<s.length;++o)r.length<i&&s[o]<t&&(r+=e.charAt(s[o]%e.length))}return r}};function X(n,e){return n<e?-1:n>e?1:0}function Ss(n,e,t){return n.length!==e.length?!1:n.every((r,i)=>t(r,e[i]))}function z1(n){return n+"\0"}var ND=-62135596800,kD=1e6,ke=class n{constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new T(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new T(v.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<ND)throw new T(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new T(v.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}static now(){return n.fromMillis(Date.now())}static fromDate(e){return n.fromMillis(e.getTime())}static fromMillis(e){let t=Math.floor(e/1e3),r=Math.floor((e-t*1e3)*kD);return new n(t,r)}toDate(){return new Date(this.toMillis())}toMillis(){return this.seconds*1e3+this.nanoseconds/kD}_compareTo(e){return this.seconds===e.seconds?X(this.nanoseconds,e.nanoseconds):X(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){let e=this.seconds-ND,t=String(e).padStart(12,"0"),r=String(this.nanoseconds).padStart(9,"0");return t+"."+r}};var j=class n{constructor(e){this.timestamp=e}static fromTimestamp(e){return new n(e)}static min(){return new n(new ke(0,0))}static max(){return new n(new ke(253402300799,1e9-1))}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return this.timestamp.seconds*1e6+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}};var MD="__name__",cf=class n{constructor(e,t,r){t===void 0?t=0:t>e.length&&L(),r===void 0?r=e.length-t:r>e.length-t&&L(),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return n.comparator(this,e)===0}child(e){let t=this.segments.slice(this.offset,this.limit());return e instanceof n?e.forEach(r=>{t.push(r)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=e===void 0?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return this.length===0}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){let r=Math.min(e.length,t.length);for(let i=0;i<r;i++){let s=e.get(i),o=t.get(i);if(s<o)return-1;if(s>o)return 1}return e.length<t.length?-1:e.length>t.length?1:0}},ue=class n extends cf{construct(e,t,r){return new n(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}static fromString(...e){let t=[];for(let r of e){if(r.indexOf("//")>=0)throw new T(v.INVALID_ARGUMENT,`Invalid segment (${r}). Paths must not contain // in them.`);t.push(...r.split("/").filter(i=>i.length>0))}return new n(t)}static emptyPath(){return new n([])}},kU=/^[_a-zA-Z][_a-zA-Z0-9]*$/,He=class n extends cf{construct(e,t,r){return new n(e,t,r)}static isValidIdentifier(e){return kU.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),n.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return this.length===1&&this.get(0)===MD}static keyField(){return new n([MD])}static fromServerFormat(e){let t=[],r="",i=0,s=()=>{if(r.length===0)throw new T(v.INVALID_ARGUMENT,`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);t.push(r),r=""},o=!1;for(;i<e.length;){let a=e[i];if(a==="\\"){if(i+1===e.length)throw new T(v.INVALID_ARGUMENT,"Path has trailing escape character: "+e);let l=e[i+1];if(!(l==="\\"||l==="."||l==="`"))throw new T(v.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=l,i+=2}else a==="`"?(o=!o,i++):a==="."&&!o?(s(),i++):(r+=a,i++)}if(s(),o)throw new T(v.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new n(t)}static emptyPath(){return new n([])}};var O=class n{constructor(e){this.path=e}static fromPath(e){return new n(ue.fromString(e))}static fromName(e){return new n(ue.fromString(e).popFirst(5))}static empty(){return new n(ue.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return e!==null&&ue.comparator(this.path,e.path)===0}toString(){return this.path.toString()}static comparator(e,t){return ue.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2===0}static fromSegments(e){return new n(new ue(e.slice()))}};var aa=-1,MU=0,__=(()=>{class n{constructor(t,r,i,s){this.indexId=t,this.collectionGroup=r,this.fields=i,this.indexState=s}}return n.UNKNOWN_ID=-1,n})();function d0(n){return n.fields.find(e=>e.kind===2)}function ws(n){return n.fields.filter(e=>e.kind!==2)}function OU(n){let e=ws(n);return e.length===0?0:e[e.length-1].kind}function xU(n){return`id=${n.indexId}|cg=${n.collectionGroup}|f=${n.fields.map(e=>`${e.fieldPath}:${e.kind}`).join(",")}`}var ia=class{constructor(e,t){this.fieldPath=e,this.kind=t}};var uc=class n{constructor(e,t){this.sequenceNumber=e,this.offset=t}static empty(){return new n(MU,mn.min())}};function j1(n,e){let t=n.toTimestamp().seconds,r=n.toTimestamp().nanoseconds+1,i=j.fromTimestamp(r===1e9?new ke(t+1,0):new ke(t,r));return new mn(i,O.empty(),e)}function G1(n){return new mn(n.readTime,n.key,aa)}var mn=class n{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new n(j.min(),O.empty(),aa)}static max(){return new n(j.max(),O.empty(),aa)}};function h0(n,e){let t=n.readTime.compareTo(e.readTime);return t!==0||(t=O.comparator(n.documentKey,e.documentKey),t!==0)?t:X(n.largestBatchId,e.largestBatchId)}var H1="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",uf=class{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}};function Vi(n){return g(this,null,function*(){if(n.code===v.FAILED_PRECONDITION&&n.message===H1)D("LocalStore","Unexpectedly lost primary lease");else throw n})}var m=class n{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)},t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&L(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new n((r,i)=>{this.nextCallback=s=>{this.wrapSuccess(e,s).next(r,i)},this.catchCallback=s=>{this.wrapFailure(t,s).next(r,i)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{let t=e();return t instanceof n?t:n.resolve(t)}catch(t){return n.reject(t)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):n.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):n.reject(t)}static resolve(e){return new n((t,r)=>{t(e)})}static reject(e){return new n((t,r)=>{r(e)})}static waitFor(e){return new n((t,r)=>{let i=0,s=0,o=!1;e.forEach(a=>{++i,a.next(()=>{++s,o&&s===i&&t()},l=>r(l))}),o=!0,s===i&&t()})}static or(e){let t=n.resolve(!1);for(let r of e)t=t.next(i=>i?n.resolve(i):r());return t}static forEach(e,t){let r=[];return e.forEach((i,s)=>{r.push(t.call(this,i,s))}),this.waitFor(r)}static mapArray(e,t){return new n((r,i)=>{let s=e.length,o=new Array(s),a=0;for(let l=0;l<s;l++){let c=l;t(e[c]).next(u=>{o[c]=u,++a,a===s&&r(o)},u=>i(u))}})}static doWhile(e,t){return new n((r,i)=>{let s=()=>{e()===!0?t().next(()=>{s()},i):r()};s()})}};var Yt="SimpleDb",PU=3,df=class n{constructor(e,t){this.action=e,this.transaction=t,this.aborted=!1,this.completionDeferred=new je,this.transaction.oncomplete=()=>{this.completionDeferred.resolve()},this.transaction.onabort=()=>{t.error?this.completionDeferred.reject(new vs(e,t.error)):this.completionDeferred.resolve()},this.transaction.onerror=r=>{let i=f0(r.target.error);this.completionDeferred.reject(new vs(e,i))}}static open(e,t,r,i){try{return new n(t,e.transaction(i,r))}catch(s){throw new vs(t,s)}}get completionPromise(){return this.completionDeferred.promise}abort(e){e&&this.completionDeferred.reject(e),this.aborted||(D(Yt,"Aborting transaction:",e?e.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}maybeCommit(){let e=this.transaction;!this.aborted&&typeof e.commit=="function"&&e.commit()}store(e){let t=this.transaction.objectStore(e);return new w_(t)}},Di=class n{constructor(e,t,r){this.name=e,this.version=t,this.schemaConverter=r,n.getIOSVersion(au())===12.2&&Ne("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(e){return D(Yt,"Removing database:",e),ds(window.indexedDB.deleteDatabase(e)).toPromise()}static isAvailable(){if(!lu())return!1;if(n.isMockPersistence())return!0;let e=au(),t=n.getIOSVersion(e),r=0<t&&t<10,i=n.getAndroidVersion(e),s=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||s)}static isMockPersistence(){var e;return typeof process<"u"&&((e=process.env)===null||e===void 0?void 0:e.USE_MOCK_PERSISTENCE)==="YES"}static getStore(e,t){return e.store(t)}static getIOSVersion(e){let t=e.match(/i(?:phone|pad|pod) os ([\d_]+)/i),r=t?t[1].split("_").slice(0,2).join("."):"-1";return Number(r)}static getAndroidVersion(e){let t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}ensureDb(e){return g(this,null,function*(){return this.db||(D(Yt,"Opening database:",this.name),this.db=yield new Promise((t,r)=>{let i=indexedDB.open(this.name,this.version);i.onsuccess=s=>{let o=s.target.result;t(o)},i.onblocked=()=>{r(new vs(e,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=s=>{let o=s.target.error;o.name==="VersionError"?r(new T(v.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o.name==="InvalidStateError"?r(new T(v.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+o)):r(new vs(e,o))},i.onupgradeneeded=s=>{D(Yt,'Database "'+this.name+'" requires upgrade from version:',s.oldVersion);let o=s.target.result;this.schemaConverter.createOrUpgrade(o,i.transaction,s.oldVersion,this.version).next(()=>{D(Yt,"Database upgrade to version "+this.version+" complete")})}})),this.versionchangelistener&&(this.db.onversionchange=t=>this.versionchangelistener(t)),this.db})}setVersionChangeListener(e){this.versionchangelistener=e,this.db&&(this.db.onversionchange=t=>e(t))}runTransaction(e,t,r,i){return g(this,null,function*(){let s=t==="readonly",o=0;for(;;){++o;try{this.db=yield this.ensureDb(e);let a=df.open(this.db,e,s?"readonly":"readwrite",r),l=i(a).next(c=>(a.maybeCommit(),c)).catch(c=>(a.abort(c),m.reject(c))).toPromise();return l.catch(()=>{}),yield a.completionPromise,l}catch(a){let l=a,c=l.name!=="FirebaseError"&&o<PU;if(D(Yt,"Transaction failed with error:",l.message,"Retrying:",c),this.close(),!c)return Promise.reject(l)}}})}close(){this.db&&this.db.close(),this.db=void 0}},S_=class{constructor(e){this.dbCursor=e,this.shouldStop=!1,this.nextKey=null}get isDone(){return this.shouldStop}get skipToKey(){return this.nextKey}set cursor(e){this.dbCursor=e}done(){this.shouldStop=!0}skip(e){this.nextKey=e}delete(){return ds(this.dbCursor.delete())}},vs=class extends T{constructor(e,t){super(v.UNAVAILABLE,`IndexedDB transaction '${e}' failed: ${t}`),this.name="IndexedDbTransactionError"}};function qi(n){return n.name==="IndexedDbTransactionError"}var w_=class{constructor(e){this.store=e}put(e,t){let r;return t!==void 0?(D(Yt,"PUT",this.store.name,e,t),r=this.store.put(t,e)):(D(Yt,"PUT",this.store.name,"<auto-key>",e),r=this.store.put(e)),ds(r)}add(e){D(Yt,"ADD",this.store.name,e,e);let t=this.store.add(e);return ds(t)}get(e){let t=this.store.get(e);return ds(t).next(r=>(r===void 0&&(r=null),D(Yt,"GET",this.store.name,e,r),r))}delete(e){D(Yt,"DELETE",this.store.name,e);let t=this.store.delete(e);return ds(t)}count(){D(Yt,"COUNT",this.store.name);let e=this.store.count();return ds(e)}loadAll(e,t){let r=this.options(e,t);if(!r.index&&typeof this.store.getAll=="function"){let i=this.store.getAll(r.range);return new m((s,o)=>{i.onerror=a=>{o(a.target.error)},i.onsuccess=a=>{s(a.target.result)}})}else{let i=this.cursor(r),s=[];return this.iterateCursor(i,(o,a)=>{s.push(a)}).next(()=>s)}}loadFirst(e,t){let r=this.store.getAll(e,t===null?void 0:t);return new m((i,s)=>{r.onerror=o=>{s(o.target.error)},r.onsuccess=o=>{i(o.target.result)}})}deleteAll(e,t){D(Yt,"DELETE ALL",this.store.name);let r=this.options(e,t);r.keysOnly=!1;let i=this.cursor(r);return this.iterateCursor(i,(s,o,a)=>a.delete())}iterate(e,t){let r;t?r=e:(r={},t=e);let i=this.cursor(r);return this.iterateCursor(i,t)}iterateSerial(e){let t=this.cursor({});return new m((r,i)=>{t.onerror=s=>{let o=f0(s.target.error);i(o)},t.onsuccess=s=>{let o=s.target.result;if(!o){r();return}e(o.primaryKey,o.value).next(a=>{a?o.continue():r()})}})}iterateCursor(e,t){let r=[];return new m((i,s)=>{e.onerror=o=>{s(o.target.error)},e.onsuccess=o=>{let a=o.target.result;if(!a){i();return}let l=new S_(a),c=t(a.primaryKey,a.value,l);if(c instanceof m){let u=c.catch(d=>(l.done(),m.reject(d)));r.push(u)}l.isDone?i():l.skipToKey===null?a.continue():a.continue(l.skipToKey)}}).next(()=>m.waitFor(r))}options(e,t){let r;return e!==void 0&&(typeof e=="string"?r=e:t=e),{index:r,range:t}}cursor(e){let t="next";if(e.reverse&&(t="prev"),e.index){let r=this.store.index(e.index);return e.keysOnly?r.openKeyCursor(e.range,t):r.openCursor(e.range,t)}else return this.store.openCursor(e.range,t)}};function ds(n){return new m((e,t)=>{n.onsuccess=r=>{let i=r.target.result;e(i)},n.onerror=r=>{let i=f0(r.target.error);t(i)}})}var OD=!1;function f0(n){let e=Di.getIOSVersion(au());if(e>=12.2&&e<13){let t="An internal error was encountered in the Indexed Database server";if(n.message.indexOf(t)>=0){let r=new T("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${t}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return OD||(OD=!0,setTimeout(()=>{throw r},0)),r}}return n}var ic="IndexBackiller",FU=15*1e3,LU=60*1e3,BU=50,E_=class{constructor(e,t){this.asyncQueue=e,this.backfiller=t,this.task=null}start(){this.schedule(FU)}stop(){this.task&&(this.task.cancel(),this.task=null)}get started(){return this.task!==null}schedule(e){D(ic,`Scheduled in ${e}ms`),this.task=this.asyncQueue.enqueueAfterDelay("index_backfill",e,()=>g(this,null,function*(){this.task=null;try{let t=yield this.backfiller.backfill();D(ic,`Documents written: ${t}`)}catch(t){qi(t)?D(ic,"Ignoring IndexedDB error during index backfill: ",t):yield Vi(t)}yield this.schedule(LU)}))}},T_=class{constructor(e,t){this.localStore=e,this.persistence=t}backfill(){return g(this,arguments,function*(e=BU){return this.persistence.runTransaction("Backfill Indexes","readwrite-primary",t=>this.writeIndexEntries(t,e))})}writeIndexEntries(e,t){let r=new Set,i=t,s=!0;return m.doWhile(()=>s===!0&&i>0,()=>this.localStore.indexManager.getNextCollectionGroupToUpdate(e).next(o=>{if(o===null||r.has(o))s=!1;else return D(ic,`Processing collection: ${o}`),this.writeEntriesForCollectionGroup(e,o,i).next(a=>{i-=a,r.add(o)})})).next(()=>t-i)}writeEntriesForCollectionGroup(e,t,r){return this.localStore.indexManager.getMinOffsetFromCollectionGroup(e,t).next(i=>this.localStore.localDocuments.getNextDocuments(e,t,i,r).next(s=>{let o=s.changes;return this.localStore.indexManager.updateIndexEntries(e,o).next(()=>this.getNewOffset(i,s)).next(a=>(D(ic,`Updating offset: ${a}`),this.localStore.indexManager.updateCollectionGroup(e,t,a))).next(()=>o.size)}))}getNewOffset(e,t){let r=e;return t.changes.forEach((i,s)=>{let o=G1(s);h0(o,r)>0&&(r=o)}),new mn(r.readTime,r.documentKey,Math.max(t.batchId,e.largestBatchId))}};var Xt=(()=>{class n{constructor(t,r){this.previousValue=t,r&&(r.sequenceNumberHandler=i=>this.setPreviousValue(i),this.writeNewSequenceNumber=i=>r.writeSequenceNumber(i))}setPreviousValue(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){let t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t}}n.INVALID=-1;return n})(),sa="",C_="",K1="",W1="";function Pt(n){let e="";for(let t=0;t<n.length;t++)e.length>0&&(e=xD(e)),e=VU(n.get(t),e);return xD(e)}function VU(n,e){let t=e,r=n.length;for(let i=0;i<r;i++){let s=n.charAt(i);switch(s){case"\0":t+=sa+K1;break;case sa:t+=sa+W1;break;default:t+=s}}return t}function xD(n){return n+sa+C_}function sr(n){let e=n.length;if(q(e>=2),e===2)return q(n.charAt(0)===sa&&n.charAt(1)===C_),ue.emptyPath();let t=e-2,r=[],i="";for(let s=0;s<e;){let o=n.indexOf(sa,s);switch((o<0||o>t)&&L(),n.charAt(o+1)){case C_:let l=n.substring(s,o),c;i.length===0?c=l:(i+=l,c=i,i=""),r.push(c);break;case K1:i+=n.substring(s,o),i+="\0";break;case W1:i+=n.substring(s,o+1);break;default:L()}s=o+2}return new ue(r)}var hs="remoteDocuments";var Fc="owner",Ho="owner",Lc="mutationQueues",qU="userId",Nn="mutations",$1="batchId",ms="userMutationsIndex",Q1=["userId","batchId"];function UU(n){return[n]}function ef(n,e){return[n,Pt(e)]}function Y1(n,e,t){return[n,Pt(e),t]}var zU={},ba="documentMutations",Zf="remoteDocumentsV14",jU=["prefixPath","collectionGroup","readTime","documentId"],tf="documentKeyIndex",GU=["prefixPath","collectionGroup","documentId"],X1="collectionGroupIndex",HU=["collectionGroup","readTime","prefixPath","documentId"],Bc="remoteDocumentGlobal",b_="remoteDocumentGlobalKey",Aa="targets",KU="targetId",J1="queryTargetsIndex",WU=["canonicalId","targetId"],Ia="targetDocuments",$U=["targetId","path"],p0="documentTargetsIndex",QU=["path","targetId"],hf="targetGlobalKey",xs="targetGlobal",dc="collectionParents",YU=["collectionId","parent"],la="clientMetadata",XU="clientId",ep="bundles",JU="bundleId",tp="namedQueries",ZU="name",g0="indexConfiguration",e3="indexId",A_="collectionGroupIndex",t3="collectionGroup",m0="indexState",n3=["indexId","uid"],Z1="sequenceNumberIndex",r3=["uid","sequenceNumber"],y0="indexEntries",i3=["indexId","uid","arrayValue","directionalValue","orderedDocumentKey","documentKey"],eR="documentKeyIndex",s3=["indexId","uid","orderedDocumentKey"],np="documentOverlays",o3=["userId","collectionPath","documentId"],I_="collectionPathOverlayIndex",a3=["userId","collectionPath","largestBatchId"],tR="collectionGroupOverlayIndex",l3=["userId","collectionGroup","largestBatchId"],c3=[Lc,Nn,ba,hs,Aa,Fc,xs,Ia],u3=c3,d3=[...u3,la],h3=[...d3,Bc],f3=[...h3,dc],nR=[...f3,ep,tp],p3=[...nR,np],rR=[Lc,Nn,ba,Zf,Aa,Fc,xs,Ia,la,Bc,dc,ep,tp,np],iR=rR,g3=[...iR,g0,m0,y0];function m3(n){if(n===15)return g3;if(n===14)return iR;if(n===13)return rR;if(n===12)return p3;if(n===11)return nR;L()}var hc=class extends uf{constructor(e,t){super(),this.simpleDbTransaction=e,this.currentSequenceNumber=t}};function lt(n,e){let t=P(n);return Di.getStore(t.simpleDbTransaction,e)}function PD(n){let e=0;for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e++;return e}function Ps(n,e){for(let t in n)Object.prototype.hasOwnProperty.call(n,t)&&e(t,n[t])}function sR(n){for(let e in n)if(Object.prototype.hasOwnProperty.call(n,e))return!1;return!0}var Ce=class n{constructor(e,t){this.comparator=e,this.root=t||sc.EMPTY}insert(e,t){return new n(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,sc.BLACK,null,null))}remove(e){return new n(this.comparator,this.root.remove(e,this.comparator).copy(null,null,sc.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){let r=this.comparator(e,t.key);if(r===0)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){let i=this.comparator(e,r.key);if(i===0)return t+r.left.size;i<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){let e=[];return this.inorderTraversal((t,r)=>(e.push(`${t}:${r}`),!1)),`{${e.join(", ")}}`}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new na(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new na(this.root,e,this.comparator,!1)}getReverseIterator(){return new na(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new na(this.root,e,this.comparator,!0)}},na=class{constructor(e,t,r,i){this.isReverse=i,this.nodeStack=[];let s=1;for(;!e.isEmpty();)if(s=t?r(e.key,t):1,t&&i&&(s*=-1),s<0)this.isReverse?e=e.left:e=e.right;else if(s===0){this.nodeStack.push(e);break}else this.nodeStack.push(e),this.isReverse?e=e.right:e=e.left}getNext(){let e=this.nodeStack.pop(),t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(this.nodeStack.length===0)return null;let e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}},sc=(()=>{class n{constructor(t,r,i,s,o){this.key=t,this.value=r,this.color=i??n.RED,this.left=s??n.EMPTY,this.right=o??n.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,r,i,s,o){return new n(t??this.key,r??this.value,i??this.color,s??this.left,o??this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,r,i){let s=this,o=i(t,s.key);return o<0?s=s.copy(null,null,null,s.left.insert(t,r,i),null):o===0?s=s.copy(null,r,null,null,null):s=s.copy(null,null,null,null,s.right.insert(t,r,i)),s.fixUp()}removeMin(){if(this.left.isEmpty())return n.EMPTY;let t=this;return!t.left.isRed()&&!t.left.left.isRed()&&(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,r){let i,s=this;if(r(t,s.key)<0)!s.left.isEmpty()&&!s.left.isRed()&&!s.left.left.isRed()&&(s=s.moveRedLeft()),s=s.copy(null,null,null,s.left.remove(t,r),null);else{if(s.left.isRed()&&(s=s.rotateRight()),!s.right.isEmpty()&&!s.right.isRed()&&!s.right.left.isRed()&&(s=s.moveRedRight()),r(t,s.key)===0){if(s.right.isEmpty())return n.EMPTY;i=s.right.min(),s=s.copy(i.key,i.value,null,null,s.right.removeMin())}s=s.copy(null,null,null,null,s.right.remove(t,r))}return s.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){let t=this.copy(null,null,n.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){let t=this.copy(null,null,n.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){let t=this.left.copy(null,null,!this.left.color,null,null),r=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,r)}checkMaxDepth(){let t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed()||this.right.isRed())throw L();let t=this.left.check();if(t!==this.right.check())throw L();return t+(this.isRed()?0:1)}}return n.EMPTY=null,n.RED=!0,n.BLACK=!1,n})(),D_=class{constructor(){this.size=0}get key(){throw L()}get value(){throw L()}get color(){throw L()}get left(){throw L()}get right(){throw L()}copy(e,t,r,i,s){return this}insert(e,t,r){return new sc(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};sc.EMPTY=new D_;var ye=class n{constructor(e){this.comparator=e,this.data=new Ce(this.comparator)}has(e){return this.data.get(e)!==null}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){let r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){let i=r.getNext();if(this.comparator(i.key,e[1])>=0)return;t(i.key)}}forEachWhile(e,t){let r;for(t!==void 0?r=this.data.getIteratorFrom(t):r=this.data.getIterator();r.hasNext();){let i=r.getNext();if(!e(i.key))return}}firstAfterOrEqual(e){let t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new ff(this.data.getIterator())}getIteratorFrom(e){return new ff(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(r=>{t=t.add(r)}),t}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(this.comparator(i,s)!==0)return!1}return!0}toArray(){let e=[];return this.forEach(t=>{e.push(t)}),e}toString(){let e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){let t=new n(this.comparator);return t.data=e,t}},ff=class{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}};function y3(n,e,t,r,i){let s=n.getIterator(),o=e.getIterator(),a=Ko(s),l=Ko(o);for(;a||l;){let c=!1,u=!1;if(a&&l){let d=t(a,l);d<0?u=!0:d>0&&(c=!0)}else a!=null?u=!0:c=!0;c?(r(l),l=Ko(o)):u?(i(a),a=Ko(s)):(a=Ko(s),l=Ko(o))}}function Ko(n){return n.hasNext()?n.getNext():void 0}var Jt=class n{constructor(e){this.fields=e,e.sort(He.comparator)}static empty(){return new n([])}unionWith(e){let t=new ye(He.comparator);for(let r of this.fields)t=t.add(r);for(let r of e)t=t.add(r);return new n(t.toArray())}covers(e){for(let t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Ss(this.fields,e.fields,(t,r)=>t.isEqual(r))}};function v3(n){return Buffer.from(n,"base64").toString("binary")}function _3(n){return Buffer.from(n,"binary").toString("base64")}function oR(){return!0}var at=class n{constructor(e){this.binaryString=e}static fromBase64String(e){let t=v3(e);return new n(t)}static fromUint8Array(e){let t=S3(e);return new n(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return _3(this.binaryString)}toUint8Array(){return w3(this.binaryString)}approximateByteSize(){return this.binaryString.length*2}compareTo(e){return X(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}};at.EMPTY_BYTE_STRING=new at("");function S3(n){let e="";for(let t=0;t<n.length;++t)e+=String.fromCharCode(n[t]);return e}function w3(n){let e=new Uint8Array(n.length);for(let t=0;t<n.length;t++)e[t]=n.charCodeAt(t);return e}var E3=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Ri(n){if(q(!!n),typeof n=="string"){let e=0,t=E3.exec(n);if(q(!!t),t[1]){let s=t[1];s=(s+"000000000").substr(0,9),e=Number(s)}let r=new Date(n);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}else{let e=Ve(n.seconds),t=Ve(n.nanos);return{seconds:e,nanos:t}}}function Ve(n){return typeof n=="number"?n:typeof n=="string"?Number(n):0}function Ni(n){return typeof n=="string"?at.fromBase64String(n):at.fromUint8Array(n)}var aR="server_timestamp",lR="__type__",cR="__previous_value__",uR="__local_write_time__";function rp(n){var e,t;return((t=(((e=n?.mapValue)===null||e===void 0?void 0:e.fields)||{})[lR])===null||t===void 0?void 0:t.stringValue)===aR}function T3(n,e){let t={fields:{[lR]:{stringValue:aR},[uR]:{timestampValue:{seconds:n.seconds,nanos:n.nanoseconds}}}};return e&&rp(e)&&(e=v0(e)),e&&(t.fields[cR]=e),{mapValue:t}}function v0(n){let e=n.mapValue.fields[cR];return rp(e)?v0(e):e}function fc(n){let e=Ri(n.mapValue.fields[uR].timestampValue);return new ke(e.seconds,e.nanos)}var R_=class{constructor(e,t,r,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=i,this.ssl=s,this.forceLongPolling=o,this.autoDetectLongPolling=a,this.longPollingOptions=l,this.useFetchStreams=c}},FD="(default)",ki=class n{constructor(e,t){this.projectId=e,this.database=t||FD}static empty(){return new n("","")}get isDefaultDatabase(){return this.database===FD}isEqual(e){return e instanceof n&&e.projectId===this.projectId&&e.database===this.database}};function C3(n,e){if(!Object.prototype.hasOwnProperty.apply(n.options,["projectId"]))throw new T(v.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new ki(n.options.projectId,e)}var Ai=-1;function Vc(n){return n==null}function pc(n){return n===0&&1/n===1/-0}function dR(n){return typeof n=="number"&&Number.isInteger(n)&&!pc(n)&&n<=Number.MAX_SAFE_INTEGER&&n>=Number.MIN_SAFE_INTEGER}var hR="__max__",Ci={mapValue:{fields:{__type__:{stringValue:hR}}}},nf={nullValue:"NULL_VALUE"};function Es(n){return"nullValue"in n?0:"booleanValue"in n?1:"integerValue"in n||"doubleValue"in n?2:"timestampValue"in n?3:"stringValue"in n?5:"bytesValue"in n?6:"referenceValue"in n?7:"geoPointValue"in n?8:"arrayValue"in n?9:"mapValue"in n?rp(n)?4:fR(n)?9007199254740991:10:L()}function kn(n,e){if(n===e)return!0;let t=Es(n),r=Es(e);if(t!==r)return!1;switch(t){case 0:return!0;case 1:return n.booleanValue===e.booleanValue;case 4:return fc(n).isEqual(fc(e));case 3:return b3(n,e);case 5:return n.stringValue===e.stringValue;case 6:return I3(n,e);case 7:return n.referenceValue===e.referenceValue;case 8:return A3(n,e);case 2:return D3(n,e);case 9:return Ss(n.arrayValue.values||[],e.arrayValue.values||[],kn);case 10:return R3(n,e);case 9007199254740991:return!0;default:return L()}}function b3(n,e){if(typeof n.timestampValue=="string"&&typeof e.timestampValue=="string"&&n.timestampValue.length===e.timestampValue.length)return n.timestampValue===e.timestampValue;let t=Ri(n.timestampValue),r=Ri(e.timestampValue);return t.seconds===r.seconds&&t.nanos===r.nanos}function A3(n,e){return Ve(n.geoPointValue.latitude)===Ve(e.geoPointValue.latitude)&&Ve(n.geoPointValue.longitude)===Ve(e.geoPointValue.longitude)}function I3(n,e){return Ni(n.bytesValue).isEqual(Ni(e.bytesValue))}function D3(n,e){if("integerValue"in n&&"integerValue"in e)return Ve(n.integerValue)===Ve(e.integerValue);if("doubleValue"in n&&"doubleValue"in e){let t=Ve(n.doubleValue),r=Ve(e.doubleValue);return t===r?pc(t)===pc(r):isNaN(t)&&isNaN(r)}return!1}function R3(n,e){let t=n.mapValue.fields||{},r=e.mapValue.fields||{};if(PD(t)!==PD(r))return!1;for(let i in t)if(t.hasOwnProperty(i)&&(r[i]===void 0||!kn(t[i],r[i])))return!1;return!0}function gc(n,e){return(n.values||[]).find(t=>kn(t,e))!==void 0}function Mi(n,e){if(n===e)return 0;let t=Es(n),r=Es(e);if(t!==r)return X(t,r);switch(t){case 0:case 9007199254740991:return 0;case 1:return X(n.booleanValue,e.booleanValue);case 2:return N3(n,e);case 3:return LD(n.timestampValue,e.timestampValue);case 4:return LD(fc(n),fc(e));case 5:return X(n.stringValue,e.stringValue);case 6:return O3(n.bytesValue,e.bytesValue);case 7:return k3(n.referenceValue,e.referenceValue);case 8:return M3(n.geoPointValue,e.geoPointValue);case 9:return x3(n.arrayValue,e.arrayValue);case 10:return P3(n.mapValue,e.mapValue);default:throw L()}}function N3(n,e){let t=Ve(n.integerValue||n.doubleValue),r=Ve(e.integerValue||e.doubleValue);return t<r?-1:t>r?1:t===r?0:isNaN(t)?isNaN(r)?0:-1:1}function LD(n,e){if(typeof n=="string"&&typeof e=="string"&&n.length===e.length)return X(n,e);let t=Ri(n),r=Ri(e),i=X(t.seconds,r.seconds);return i!==0?i:X(t.nanos,r.nanos)}function k3(n,e){let t=n.split("/"),r=e.split("/");for(let i=0;i<t.length&&i<r.length;i++){let s=X(t[i],r[i]);if(s!==0)return s}return X(t.length,r.length)}function M3(n,e){let t=X(Ve(n.latitude),Ve(e.latitude));return t!==0?t:X(Ve(n.longitude),Ve(e.longitude))}function O3(n,e){let t=Ni(n),r=Ni(e);return t.compareTo(r)}function x3(n,e){let t=n.values||[],r=e.values||[];for(let i=0;i<t.length&&i<r.length;++i){let s=Mi(t[i],r[i]);if(s)return s}return X(t.length,r.length)}function P3(n,e){if(n===Ci.mapValue&&e===Ci.mapValue)return 0;if(n===Ci.mapValue)return 1;if(e===Ci.mapValue)return-1;let t=n.fields||{},r=Object.keys(t),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let o=0;o<r.length&&o<s.length;++o){let a=X(r[o],s[o]);if(a!==0)return a;let l=Mi(t[r[o]],i[s[o]]);if(l!==0)return l}return X(r.length,s.length)}function ca(n){return _0(n)}function _0(n){return"nullValue"in n?"null":"booleanValue"in n?""+n.booleanValue:"integerValue"in n?""+n.integerValue:"doubleValue"in n?""+n.doubleValue:"timestampValue"in n?L3(n.timestampValue):"stringValue"in n?n.stringValue:"bytesValue"in n?F3(n.bytesValue):"referenceValue"in n?V3(n.referenceValue):"geoPointValue"in n?B3(n.geoPointValue):"arrayValue"in n?U3(n.arrayValue):"mapValue"in n?q3(n.mapValue):L()}function F3(n){return Ni(n).toBase64()}function L3(n){let e=Ri(n);return`time(${e.seconds},${e.nanos})`}function B3(n){return`geo(${n.latitude},${n.longitude})`}function V3(n){return O.fromName(n).toString()}function q3(n){let e=Object.keys(n.fields||{}).sort(),t="{",r=!0;for(let i of e)r?r=!1:t+=",",t+=`${i}:${_0(n.fields[i])}`;return t+"}"}function U3(n){let e="[",t=!0;for(let r of n.values||[])t?t=!1:e+=",",e+=_0(r);return e+"]"}function Ts(n,e){return{referenceValue:`projects/${n.projectId}/databases/${n.database}/documents/${e.path.canonicalString()}`}}function N_(n){return!!n&&"integerValue"in n}function z3(n){return!!n&&"doubleValue"in n}function j3(n){return N_(n)||z3(n)}function mc(n){return!!n&&"arrayValue"in n}function BD(n){return!!n&&"nullValue"in n}function VD(n){return!!n&&"doubleValue"in n&&isNaN(Number(n.doubleValue))}function rf(n){return!!n&&"mapValue"in n}function oc(n){if(n.geoPointValue)return{geoPointValue:Object.assign({},n.geoPointValue)};if(n.timestampValue&&typeof n.timestampValue=="object")return{timestampValue:Object.assign({},n.timestampValue)};if(n.mapValue){let e={mapValue:{fields:{}}};return Ps(n.mapValue.fields,(t,r)=>e.mapValue.fields[t]=oc(r)),e}else if(n.arrayValue){let e={arrayValue:{values:[]}};for(let t=0;t<(n.arrayValue.values||[]).length;++t)e.arrayValue.values[t]=oc(n.arrayValue.values[t]);return e}else return Object.assign({},n)}function fR(n){return(((n.mapValue||{}).fields||{}).__type__||{}).stringValue===hR}function G3(n){return"nullValue"in n?nf:"booleanValue"in n?{booleanValue:!1}:"integerValue"in n||"doubleValue"in n?{doubleValue:NaN}:"timestampValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"stringValue"in n?{stringValue:""}:"bytesValue"in n?{bytesValue:""}:"referenceValue"in n?Ts(ki.empty(),O.empty()):"geoPointValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"arrayValue"in n?{arrayValue:{}}:"mapValue"in n?{mapValue:{}}:L()}function H3(n){return"nullValue"in n?{booleanValue:!1}:"booleanValue"in n?{doubleValue:NaN}:"integerValue"in n||"doubleValue"in n?{timestampValue:{seconds:Number.MIN_SAFE_INTEGER}}:"timestampValue"in n?{stringValue:""}:"stringValue"in n?{bytesValue:""}:"bytesValue"in n?Ts(ki.empty(),O.empty()):"referenceValue"in n?{geoPointValue:{latitude:-90,longitude:-180}}:"geoPointValue"in n?{arrayValue:{}}:"arrayValue"in n?{mapValue:{}}:"mapValue"in n?Ci:L()}function qD(n,e){let t=Mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?-1:!n.inclusive&&e.inclusive?1:0}function UD(n,e){let t=Mi(n.value,e.value);return t!==0?t:n.inclusive&&!e.inclusive?1:!n.inclusive&&e.inclusive?-1:0}var At=class n{constructor(e){this.value=e}static empty(){return new n({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!rf(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){let r=this.getFieldsMap(e.popLast());r[e.lastSegment()]=oc(t)}setAll(e){let t=He.emptyPath(),r={},i=[];e.forEach((o,a)=>{if(!t.isImmediateParentOf(a)){let l=this.getFieldsMap(t);this.applyChanges(l,r,i),r={},i=[],t=a.popLast()}o?r[a.lastSegment()]=oc(o):i.push(a.lastSegment())});let s=this.getFieldsMap(t);this.applyChanges(s,r,i)}delete(e){let t=this.field(e.popLast());rf(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return kn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let i=t.mapValue.fields[e.get(r)];(!rf(i)||!i.mapValue.fields)&&(i={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=i),t=i}return t.mapValue.fields}applyChanges(e,t,r){Ps(t,(i,s)=>e[i]=s);for(let i of r)delete e[i]}clone(){return new n(oc(this.value))}};function pR(n){let e=[];return Ps(n.fields,(t,r)=>{let i=new He([t]);if(rf(r)){let o=pR(r.mapValue).fields;if(o.length===0)e.push(i);else for(let a of o)e.push(i.child(a))}else e.push(i)}),new Jt(e)}var Ye=class n{constructor(e,t,r,i,s,o,a){this.key=e,this.documentType=t,this.version=r,this.readTime=i,this.createTime=s,this.data=o,this.documentState=a}static newInvalidDocument(e){return new n(e,0,j.min(),j.min(),j.min(),At.empty(),0)}static newFoundDocument(e,t,r,i){return new n(e,1,t,j.min(),r,i,0)}static newNoDocument(e,t){return new n(e,2,t,j.min(),j.min(),At.empty(),0)}static newUnknownDocument(e,t){return new n(e,3,t,j.min(),j.min(),At.empty(),2)}convertToFoundDocument(e,t){return this.createTime.isEqual(j.min())&&(this.documentType===2||this.documentType===0)&&(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=At.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=At.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=j.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return this.documentState===1}get hasCommittedMutations(){return this.documentState===2}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return this.documentType!==0}isFoundDocument(){return this.documentType===1}isNoDocument(){return this.documentType===2}isUnknownDocument(){return this.documentType===3}isEqual(e){return e instanceof n&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new n(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}};function K3(n,e,t){let r=e.data.field(n),i=t.data.field(n);return r!==null&&i!==null?Mi(r,i):L()}var cr=class{constructor(e,t){this.position=e,this.inclusive=t}};function gR(n,e,t){let r=0;for(let i=0;i<n.position.length;i++){let s=e[i],o=n.position[i];if(s.field.isKeyField())r=O.comparator(O.fromName(o.referenceValue),t.key);else{let a=t.data.field(s.field);r=Mi(o,a)}if(s.dir==="desc"&&(r=r*-1),r!==0)break}return r}function W3(n,e,t){let r=gR(n,e,t);return n.inclusive?r>=0:r>0}function $3(n,e,t){let r=gR(n,e,t);return n.inclusive?r<=0:r<0}function zD(n,e){if(n===null)return e===null;if(e===null||n.inclusive!==e.inclusive||n.position.length!==e.position.length)return!1;for(let t=0;t<n.position.length;t++){let r=n.position[t],i=e.position[t];if(!kn(r,i))return!1}return!0}var Cs=class{constructor(e,t="asc"){this.field=e,this.dir=t}};function Q3(n){return n.field.canonicalString()+n.dir}function Y3(n){return`${n.field.canonicalString()} (${n.dir})`}function X3(n,e){return n.dir===e.dir&&n.field.isEqual(e.field)}var pf=class{},re=class n extends pf{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?t==="in"||t==="not-in"?this.createKeyFieldInFilter(e,t,r):new O_(e,t,r):t==="array-contains"?new F_(e,r):t==="in"?new gf(e,r):t==="not-in"?new L_(e,r):t==="array-contains-any"?new B_(e,r):new n(e,t,r)}static createKeyFieldInFilter(e,t,r){return t==="in"?new x_(e,r):new P_(e,r)}matches(e){let t=e.data.field(this.field);return this.op==="!="?t!==null&&this.matchesComparison(Mi(t,this.value)):t!==null&&Es(this.value)===Es(t)&&this.matchesComparison(Mi(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return e===0;case"!=":return e!==0;case">":return e>0;case">=":return e>=0;default:return L()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}},fe=class n extends pf{constructor(e,t){super(),this.filters=e,this.op=t,this.memoizedFlattenedFilters=null}static create(e,t){return new n(e,t)}matches(e){return ua(this)?this.filters.find(t=>!t.matches(e))===void 0:this.filters.find(t=>t.matches(e))!==void 0}getFlattenedFilters(){return this.memoizedFlattenedFilters!==null?this.memoizedFlattenedFilters:(this.memoizedFlattenedFilters=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[]),this.memoizedFlattenedFilters)}getFilters(){return Object.assign([],this.filters)}};function ua(n){return n.op==="and"}function k_(n){return n.op==="or"}function S0(n){return mR(n)&&ua(n)}function mR(n){for(let e of n.filters)if(e instanceof fe)return!1;return!0}function M_(n){if(n instanceof re)return n.field.canonicalString()+n.op.toString()+ca(n.value);if(S0(n))return n.filters.map(e=>M_(e)).join(",");{let e=n.filters.map(t=>M_(t)).join(",");return`${n.op}(${e})`}}function yR(n,e){if(n instanceof re)return J3(n,e);if(n instanceof fe)return Z3(n,e);L()}function J3(n,e){return e instanceof re&&n.op===e.op&&n.field.isEqual(e.field)&&kn(n.value,e.value)}function Z3(n,e){return e instanceof fe&&n.op===e.op&&n.filters.length===e.filters.length?n.filters.reduce((r,i,s)=>r&&yR(i,e.filters[s]),!0):!1}function vR(n,e){let t=n.filters.concat(e);return fe.create(t,n.op)}function _R(n){return n instanceof re?t4(n):n instanceof fe?e4(n):"Filter"}function e4(n){return n.op.toString()+" {"+n.getFilters().map(_R).join(" ,")+"}"}function t4(n){return`${n.field.canonicalString()} ${n.op} ${ca(n.value)}`}var O_=class extends re{constructor(e,t,r){super(e,t,r),this.key=O.fromName(r.referenceValue)}matches(e){let t=O.comparator(e.key,this.key);return this.matchesComparison(t)}},x_=class extends re{constructor(e,t){super(e,"in",t),this.keys=SR("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}},P_=class extends re{constructor(e,t){super(e,"not-in",t),this.keys=SR("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}};function SR(n,e){var t;return(((t=e.arrayValue)===null||t===void 0?void 0:t.values)||[]).map(r=>O.fromName(r.referenceValue))}var F_=class extends re{constructor(e,t){super(e,"array-contains",t)}matches(e){let t=e.data.field(this.field);return mc(t)&&gc(t.arrayValue,this.value)}},gf=class extends re{constructor(e,t){super(e,"in",t)}matches(e){let t=e.data.field(this.field);return t!==null&&gc(this.value.arrayValue,t)}},L_=class extends re{constructor(e,t){super(e,"not-in",t)}matches(e){if(gc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;let t=e.data.field(this.field);return t!==null&&!gc(this.value.arrayValue,t)}},B_=class extends re{constructor(e,t){super(e,"array-contains-any",t)}matches(e){let t=e.data.field(this.field);return!mc(t)||!t.arrayValue.values?!1:t.arrayValue.values.some(r=>gc(this.value.arrayValue,r))}};var V_=class{constructor(e,t=null,r=[],i=[],s=null,o=null,a=null){this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=i,this.limit=s,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null}};function q_(n,e=null,t=[],r=[],i=null,s=null,o=null){return new V_(n,e,t,r,i,s,o)}function bs(n){let e=P(n);if(e.memoizedCanonicalId===null){let t=e.path.canonicalString();e.collectionGroup!==null&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map(r=>M_(r)).join(","),t+="|ob:",t+=e.orderBy.map(r=>Q3(r)).join(","),Vc(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(r=>ca(r)).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(r=>ca(r)).join(",")),e.memoizedCanonicalId=t}return e.memoizedCanonicalId}function n4(n){let e=n.path.canonicalString();return n.collectionGroup!==null&&(e+=" collectionGroup="+n.collectionGroup),n.filters.length>0&&(e+=`, filters: [${n.filters.map(t=>_R(t)).join(", ")}]`),Vc(n.limit)||(e+=", limit: "+n.limit),n.orderBy.length>0&&(e+=`, orderBy: [${n.orderBy.map(t=>Y3(t)).join(", ")}]`),n.startAt&&(e+=", startAt: ",e+=n.startAt.inclusive?"b:":"a:",e+=n.startAt.position.map(t=>ca(t)).join(",")),n.endAt&&(e+=", endAt: ",e+=n.endAt.inclusive?"a:":"b:",e+=n.endAt.position.map(t=>ca(t)).join(",")),`Target(${e})`}function qc(n,e){if(n.limit!==e.limit||n.orderBy.length!==e.orderBy.length)return!1;for(let t=0;t<n.orderBy.length;t++)if(!X3(n.orderBy[t],e.orderBy[t]))return!1;if(n.filters.length!==e.filters.length)return!1;for(let t=0;t<n.filters.length;t++)if(!yR(n.filters[t],e.filters[t]))return!1;return n.collectionGroup!==e.collectionGroup||!n.path.isEqual(e.path)||!zD(n.startAt,e.startAt)?!1:zD(n.endAt,e.endAt)}function mf(n){return O.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function ip(n,e){return n.filters.filter(t=>t instanceof re&&t.field.isEqual(e))}function r4(n,e){let t=d0(e);if(t===void 0)return null;for(let r of ip(n,t.fieldPath))switch(r.op){case"array-contains-any":return r.value.arrayValue.values||[];case"array-contains":return[r.value]}return null}function i4(n,e){let t=new Map;for(let r of ws(e))for(let i of ip(n,r.fieldPath))switch(i.op){case"==":case"in":t.set(r.fieldPath.canonicalString(),i.value);break;case"not-in":case"!=":return t.set(r.fieldPath.canonicalString(),i.value),Array.from(t.values())}return null}function s4(n,e){let t=[],r=!0;for(let i of ws(e)){let s=i.kind===0?wR(n,i.fieldPath,n.startAt):ER(n,i.fieldPath,n.startAt);t.push(s.value),r&&(r=s.inclusive)}return new cr(t,r)}function o4(n,e){let t=[],r=!0;for(let i of ws(e)){let s=i.kind===0?ER(n,i.fieldPath,n.endAt):wR(n,i.fieldPath,n.endAt);t.push(s.value),r&&(r=s.inclusive)}return new cr(t,r)}function wR(n,e,t){let r=nf,i=!0;for(let s of ip(n,e)){let o=nf,a=!0;switch(s.op){case"<":case"<=":o=G3(s.value);break;case"==":case"in":case">=":o=s.value;break;case">":o=s.value,a=!1;break;case"!=":case"not-in":o=nf;break}qD({value:r,inclusive:i},{value:o,inclusive:a})<0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];qD({value:r,inclusive:i},{value:a,inclusive:t.inclusive})<0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function ER(n,e,t){let r=Ci,i=!0;for(let s of ip(n,e)){let o=Ci,a=!0;switch(s.op){case">=":case">":o=H3(s.value),a=!1;break;case"==":case"in":case"<=":o=s.value;break;case"<":o=s.value,a=!1;break;case"!=":case"not-in":o=Ci;break}UD({value:r,inclusive:i},{value:o,inclusive:a})>0&&(r=o,i=a)}if(t!==null){for(let s=0;s<n.orderBy.length;++s)if(n.orderBy[s].field.isEqual(e)){let a=t.position[s];UD({value:r,inclusive:i},{value:a,inclusive:t.inclusive})>0&&(r=a,i=t.inclusive);break}}return{value:r,inclusive:i}}function a4(n){let e=new ye(He.comparator),t=!1;for(let r of n.filters)for(let i of r.getFlattenedFilters())i.field.isKeyField()||(i.op==="array-contains"||i.op==="array-contains-any"?t=!0:e=e.add(i.field));for(let r of n.orderBy)r.field.isKeyField()||(e=e.add(r.field));return e.size+(t?1:0)}function l4(n){return n.limit!==null}var Mn=class{constructor(e,t=null,r=[],i=[],s=null,o="F",a=null,l=null){this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=i,this.limit=s,this.limitType=o,this.startAt=a,this.endAt=l,this.memoizedNormalizedOrderBy=null,this.memoizedTarget=null,this.memoizedAggregateTarget=null,this.startAt,this.endAt}};function TR(n,e,t,r,i,s,o,a){return new Mn(n,e,t,r,i,s,o,a)}function Da(n){return new Mn(n)}function c4(n,e){return new Mn(e,null,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function jD(n){return n.filters.length===0&&n.limit===null&&n.startAt==null&&n.endAt==null&&(n.explicitOrderBy.length===0||n.explicitOrderBy.length===1&&n.explicitOrderBy[0].field.isKeyField())}function u4(n){let e=new ye(He.comparator);return n.filters.forEach(t=>{t.getFlattenedFilters().forEach(i=>{i.isInequality()&&(e=e.add(i.field))})}),e}function d4(n){return new Mn(ue.emptyPath(),n)}function h4(n){return O.isDocumentKey(n.path)&&n.collectionGroup===null&&n.filters.length===0}function w0(n){return n.collectionGroup!==null}function da(n){let e=P(n);if(e.memoizedNormalizedOrderBy===null){e.memoizedNormalizedOrderBy=[];let t=new Set;for(let s of e.explicitOrderBy)e.memoizedNormalizedOrderBy.push(s),t.add(s.field.canonicalString());let r=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";u4(e).forEach(s=>{!t.has(s.canonicalString())&&!s.isKeyField()&&e.memoizedNormalizedOrderBy.push(new Cs(s,r))}),t.has(He.keyField().canonicalString())||e.memoizedNormalizedOrderBy.push(new Cs(He.keyField(),r))}return e.memoizedNormalizedOrderBy}function Ft(n){let e=P(n);return e.memoizedTarget||(e.memoizedTarget=f4(e,da(n))),e.memoizedTarget}function f4(n,e){if(n.limitType==="F")return q_(n.path,n.collectionGroup,e,n.filters,n.limit,n.startAt,n.endAt);{e=e.map(i=>{let s=i.dir==="desc"?"asc":"desc";return new Cs(i.field,s)});let t=n.endAt?new cr(n.endAt.position,n.endAt.inclusive):null,r=n.startAt?new cr(n.startAt.position,n.startAt.inclusive):null;return q_(n.path,n.collectionGroup,e,n.filters,n.limit,t,r)}}function E0(n,e){let t=n.filters.concat([e]);return new Mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),t,n.limit,n.limitType,n.startAt,n.endAt)}function p4(n,e){let t=n.explicitOrderBy.concat([e]);return new Mn(n.path,n.collectionGroup,t,n.filters.slice(),n.limit,n.limitType,n.startAt,n.endAt)}function yf(n,e,t){return new Mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),e,t,n.startAt,n.endAt)}function g4(n,e){return new Mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,e,n.endAt)}function m4(n,e){return new Mn(n.path,n.collectionGroup,n.explicitOrderBy.slice(),n.filters.slice(),n.limit,n.limitType,n.startAt,e)}function Uc(n,e){return qc(Ft(n),Ft(e))&&n.limitType===e.limitType}function CR(n){return`${bs(Ft(n))}|lt:${n.limitType}`}function Zo(n){return`Query(target=${n4(Ft(n))}; limitType=${n.limitType})`}function zc(n,e){return e.isFoundDocument()&&y4(n,e)&&v4(n,e)&&_4(n,e)&&S4(n,e)}function y4(n,e){let t=e.key.path;return n.collectionGroup!==null?e.key.hasCollectionId(n.collectionGroup)&&n.path.isPrefixOf(t):O.isDocumentKey(n.path)?n.path.isEqual(t):n.path.isImmediateParentOf(t)}function v4(n,e){for(let t of da(n))if(!t.field.isKeyField()&&e.data.field(t.field)===null)return!1;return!0}function _4(n,e){for(let t of n.filters)if(!t.matches(e))return!1;return!0}function S4(n,e){return!(n.startAt&&!$3(n.startAt,da(n),e)||n.endAt&&!W3(n.endAt,da(n),e))}function bR(n){return n.collectionGroup||(n.path.length%2===1?n.path.lastSegment():n.path.get(n.path.length-2))}function AR(n){return(e,t)=>{let r=!1;for(let i of da(n)){let s=w4(i,e,t);if(s!==0)return s;r=r||i.field.isKeyField()}return 0}}function w4(n,e,t){let r=n.field.isKeyField()?O.comparator(e.key,t.key):K3(n.field,e,t);switch(n.dir){case"asc":return r;case"desc":return-1*r;default:return L()}}var ur=class{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r!==void 0){for(let[i,s]of r)if(this.equalsFn(i,e))return s}}has(e){return this.get(e)!==void 0}set(e,t){let r=this.mapKeyFn(e),i=this.inner[r];if(i===void 0){this.inner[r]=[[e,t]],this.innerSize++;return}for(let s=0;s<i.length;s++)if(this.equalsFn(i[s][0],e)){i[s]=[e,t];return}i.push([e,t]),this.innerSize++}delete(e){let t=this.mapKeyFn(e),r=this.inner[t];if(r===void 0)return!1;for(let i=0;i<r.length;i++)if(this.equalsFn(r[i][0],e))return r.length===1?delete this.inner[t]:r.splice(i,1),this.innerSize--,!0;return!1}forEach(e){Ps(this.inner,(t,r)=>{for(let[i,s]of r)e(i,s)})}isEmpty(){return sR(this.inner)}size(){return this.innerSize}};var E4=new Ce(O.comparator);function Gt(){return E4}var IR=new Ce(O.comparator);function nc(...n){let e=IR;for(let t of n)e=e.insert(t.key,t);return e}function T4(){return yc()}function DR(n){let e=IR;return n.forEach((t,r)=>e=e.insert(t,r.overlayedDocument)),e}function or(){return yc()}function RR(){return yc()}function yc(){return new ur(n=>n.toString(),(n,e)=>n.isEqual(e))}var C4=new Ce(O.comparator);function b4(){return C4}var A4=new ye(O.comparator);function J(...n){let e=A4;for(let t of n)e=e.add(t);return e}var I4=new ye(X);function T0(){return I4}function NR(n,e){if(n.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:pc(e)?"-0":e}}function kR(n){return{integerValue:""+n}}function MR(n,e){return dR(e)?kR(e):NR(n,e)}var ha=class{constructor(){this._=void 0}};function D4(n,e,t){return n instanceof Oi?T3(t,e):n instanceof Rr?xR(n,e):n instanceof Nr?PR(n,e):k4(n,e)}function R4(n,e,t){return n instanceof Rr?xR(n,e):n instanceof Nr?PR(n,e):t}function OR(n,e){return n instanceof xi?j3(e)?e:{integerValue:0}:null}function N4(n,e){return n instanceof Rr&&e instanceof Rr||n instanceof Nr&&e instanceof Nr?Ss(n.elements,e.elements,kn):n instanceof xi&&e instanceof xi?kn(n.operand,e.operand):n instanceof Oi&&e instanceof Oi}var Oi=class extends ha{},Rr=class extends ha{constructor(e){super(),this.elements=e}};function xR(n,e){let t=FR(e);for(let r of n.elements)t.some(i=>kn(i,r))||t.push(r);return{arrayValue:{values:t}}}var Nr=class extends ha{constructor(e){super(),this.elements=e}};function PR(n,e){let t=FR(e);for(let r of n.elements)t=t.filter(i=>!kn(i,r));return{arrayValue:{values:t}}}var xi=class extends ha{constructor(e,t){super(),this.serializer=e,this.operand=t}};function k4(n,e){let t=OR(n,e),r=GD(t)+GD(n.operand);return N_(t)&&N_(n.operand)?kR(r):NR(n.serializer,r)}function GD(n){return Ve(n.integerValue||n.doubleValue)}function FR(n){return mc(n)&&n.arrayValue.values?n.arrayValue.values.slice():[]}var As=class{constructor(e,t){this.field=e,this.transform=t}};function M4(n,e){return n.field.isEqual(e.field)&&N4(n.transform,e.transform)}function O4(n,e){return n===void 0&&e===void 0?!0:n&&e?Ss(n,e,(t,r)=>M4(t,r)):!1}var U_=class{constructor(e,t){this.version=e,this.transformResults=t}},Be=class n{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new n}static exists(e){return new n(void 0,e)}static updateTime(e){return new n(e)}get isNone(){return this.updateTime===void 0&&this.exists===void 0}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}};function sp(n,e){return n.updateTime!==void 0?e.isFoundDocument()&&e.version.isEqual(n.updateTime):n.exists!==void 0?n.exists===e.isFoundDocument():!0}var fa=class{};function LR(n,e){if(!n.hasLocalMutations||e&&e.fields.length===0)return null;if(e===null)return n.isNoDocument()?new Fi(n.key,Be.none()):new Pi(n.key,n.data,Be.none());{let t=n.data,r=At.empty(),i=new ye(He.comparator);for(let s of e.fields)if(!i.has(s)){let o=t.field(s);o===null&&s.length>1&&(s=s.popLast(),o=t.field(s)),o===null?r.delete(s):r.set(s,o),i=i.add(s)}return new On(n.key,r,new Jt(i.toArray()),Be.none())}}function x4(n,e,t){n instanceof Pi?F4(n,e,t):n instanceof On?B4(n,e,t):q4(n,e,t)}function ac(n,e,t,r){return n instanceof Pi?L4(n,e,t,r):n instanceof On?V4(n,e,t,r):U4(n,e,t)}function P4(n,e){let t=null;for(let r of n.fieldTransforms){let i=e.data.field(r.field),s=OR(r.transform,i||null);s!=null&&(t===null&&(t=At.empty()),t.set(r.field,s))}return t||null}function HD(n,e){return n.type!==e.type||!n.key.isEqual(e.key)||!n.precondition.isEqual(e.precondition)||!O4(n.fieldTransforms,e.fieldTransforms)?!1:n.type===0?n.value.isEqual(e.value):n.type===1?n.data.isEqual(e.data)&&n.fieldMask.isEqual(e.fieldMask):!0}var Pi=class extends fa{constructor(e,t,r,i=[]){super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=i,this.type=0}getFieldMask(){return null}};function F4(n,e,t){let r=n.value.clone(),i=VR(n.fieldTransforms,e,t.transformResults);r.setAll(i),e.convertToFoundDocument(t.version,r).setHasCommittedMutations()}function L4(n,e,t,r){if(!sp(n.precondition,e))return t;let i=n.value.clone(),s=qR(n.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}var On=class extends fa{constructor(e,t,r,i,s=[]){super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=i,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}};function B4(n,e,t){if(!sp(n.precondition,e)){e.convertToUnknownDocument(t.version);return}let r=VR(n.fieldTransforms,e,t.transformResults),i=e.data;i.setAll(BR(n)),i.setAll(r),e.convertToFoundDocument(t.version,i).setHasCommittedMutations()}function V4(n,e,t,r){if(!sp(n.precondition,e))return t;let i=qR(n.fieldTransforms,r,e),s=e.data;return s.setAll(BR(n)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),t===null?null:t.unionWith(n.fieldMask.fields).unionWith(n.fieldTransforms.map(o=>o.field))}function BR(n){let e=new Map;return n.fieldMask.fields.forEach(t=>{if(!t.isEmpty()){let r=n.data.field(t);e.set(t,r)}}),e}function VR(n,e,t){let r=new Map;q(n.length===t.length);for(let i=0;i<t.length;i++){let s=n[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,R4(o,a,t[i]))}return r}function qR(n,e,t){let r=new Map;for(let i of n){let s=i.transform,o=t.data.field(i.field);r.set(i.field,D4(s,o,e))}return r}var Fi=class extends fa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}};function q4(n,e,t){e.convertToNoDocument(t.version).setHasCommittedMutations()}function U4(n,e,t){return sp(n.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):t}var vc=class extends fa{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}};var _c=class{constructor(e,t,r,i){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=i}applyToRemoteDocument(e,t){let r=t.mutationResults;for(let i=0;i<this.mutations.length;i++){let s=this.mutations[i];if(s.key.isEqual(e.key)){let o=r[i];x4(s,e,o)}}}applyToLocalView(e,t){for(let r of this.baseMutations)r.key.isEqual(e.key)&&(t=ac(r,e,t,this.localWriteTime));for(let r of this.mutations)r.key.isEqual(e.key)&&(t=ac(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){let r=RR();return this.mutations.forEach(i=>{let s=e.get(i.key),o=s.overlayedDocument,a=this.applyToLocalView(o,s.mutatedFields);a=t.has(i.key)?null:a;let l=LR(o,a);l!==null&&r.set(i.key,l),o.isValidDocument()||o.convertToNoDocument(j.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),J())}isEqual(e){return this.batchId===e.batchId&&Ss(this.mutations,e.mutations,(t,r)=>HD(t,r))&&Ss(this.baseMutations,e.baseMutations,(t,r)=>HD(t,r))}},z_=class n{constructor(e,t,r,i){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=i}static from(e,t,r){q(e.mutations.length===r.length);let i=b4(),s=e.mutations;for(let o=0;o<s.length;o++)i=i.insert(s[o].key,r[o].version);return new n(e,t,r,i)}};var Sc=class{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return e!==null&&this.mutation===e.mutation}toString(){return`Overlay{
      largestBatchId: ${this.largestBatchId},
      mutation: ${this.mutation.toString()}
    }`}};var j_=class{constructor(e,t){this.count=e,this.unchangedNames=t}};var ot=function(n){return n[n.OK=0]="OK",n[n.CANCELLED=1]="CANCELLED",n[n.UNKNOWN=2]="UNKNOWN",n[n.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",n[n.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",n[n.NOT_FOUND=5]="NOT_FOUND",n[n.ALREADY_EXISTS=6]="ALREADY_EXISTS",n[n.PERMISSION_DENIED=7]="PERMISSION_DENIED",n[n.UNAUTHENTICATED=16]="UNAUTHENTICATED",n[n.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",n[n.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",n[n.ABORTED=10]="ABORTED",n[n.OUT_OF_RANGE=11]="OUT_OF_RANGE",n[n.UNIMPLEMENTED=12]="UNIMPLEMENTED",n[n.INTERNAL=13]="INTERNAL",n[n.UNAVAILABLE=14]="UNAVAILABLE",n[n.DATA_LOSS=15]="DATA_LOSS",n}(ot||{});function UR(n){switch(n){case v.OK:return L();case v.CANCELLED:case v.UNKNOWN:case v.DEADLINE_EXCEEDED:case v.RESOURCE_EXHAUSTED:case v.INTERNAL:case v.UNAVAILABLE:case v.UNAUTHENTICATED:return!1;case v.INVALID_ARGUMENT:case v.NOT_FOUND:case v.ALREADY_EXISTS:case v.PERMISSION_DENIED:case v.FAILED_PRECONDITION:case v.ABORTED:case v.OUT_OF_RANGE:case v.UNIMPLEMENTED:case v.DATA_LOSS:return!0;default:return L()}}function z4(n){return UR(n)&&n!==v.ABORTED}function sf(n){if(n===void 0)return Ne("GRPC error has no .code"),v.UNKNOWN;switch(n){case ot.OK:return v.OK;case ot.CANCELLED:return v.CANCELLED;case ot.UNKNOWN:return v.UNKNOWN;case ot.DEADLINE_EXCEEDED:return v.DEADLINE_EXCEEDED;case ot.RESOURCE_EXHAUSTED:return v.RESOURCE_EXHAUSTED;case ot.INTERNAL:return v.INTERNAL;case ot.UNAVAILABLE:return v.UNAVAILABLE;case ot.UNAUTHENTICATED:return v.UNAUTHENTICATED;case ot.INVALID_ARGUMENT:return v.INVALID_ARGUMENT;case ot.NOT_FOUND:return v.NOT_FOUND;case ot.ALREADY_EXISTS:return v.ALREADY_EXISTS;case ot.PERMISSION_DENIED:return v.PERMISSION_DENIED;case ot.FAILED_PRECONDITION:return v.FAILED_PRECONDITION;case ot.ABORTED:return v.ABORTED;case ot.OUT_OF_RANGE:return v.OUT_OF_RANGE;case ot.UNIMPLEMENTED:return v.UNIMPLEMENTED;case ot.DATA_LOSS:return v.DATA_LOSS;default:return L()}}var G_=class extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}};var r_=null;function zR(){return new TU}function j4(){return new CU("utf-8")}var G4=new Zi([4294967295,4294967295],0);function KD(n){let e=zR().encode(n),t=new ZT;return t.update(e),new Uint8Array(t.digest())}function WD(n){let e=new DataView(n.buffer),t=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0),o=new Zi([t,r],0),a=new Zi([i,s],0);return[o,a]}var H_=class n{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new ys(`Invalid padding: ${t}`);if(r<0)throw new ys(`Invalid hash count: ${r}`);if(e.length>0&&this.hashCount===0)throw new ys(`Invalid hash count: ${r}`);if(e.length===0&&t!==0)throw new ys(`Invalid padding when bitmap length is 0: ${t}`);this.bitCount=e.length*8-t,this.bitCountInInteger=Zi.fromNumber(this.bitCount)}getBitIndex(e,t,r){let i=e.add(t.multiply(Zi.fromNumber(r)));return i.compare(G4)===1&&(i=new Zi([i.getBits(0),i.getBits(1)],0)),i.modulo(this.bitCountInInteger).toNumber()}isBitSet(e){let t=this.bitmap[Math.floor(e/8)],r=e%8;return(t&1<<r)!==0}mightContain(e){if(this.bitCount===0)return!1;let t=KD(e),[r,i]=WD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);if(!this.isBitSet(o))return!1}return!0}static create(e,t,r){let i=e%8===0?0:8-e%8,s=new Uint8Array(Math.ceil(e/8)),o=new n(s,i,t);return r.forEach(a=>o.insert(a)),o}insert(e){if(this.bitCount===0)return;let t=KD(e),[r,i]=WD(t);for(let s=0;s<this.hashCount;s++){let o=this.getBitIndex(r,i,s);this.setBit(o)}}setBit(e){let t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}},ys=class extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}};var wc=class n{constructor(e,t,r,i,s){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=i,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(e,t,r){let i=new Map;return i.set(e,Ec.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new n(j.min(),i,new Ce(X),Gt(),J())}},Ec=class n{constructor(e,t,r,i,s){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=i,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new n(r,t,J(),J(),J())}};var oa=class{constructor(e,t,r,i){this.updatedTargetIds=e,this.removedTargetIds=t,this.key=r,this.newDoc=i}},vf=class{constructor(e,t){this.targetId=e,this.existenceFilter=t}},_f=class{constructor(e,t,r=at.EMPTY_BYTE_STRING,i=null){this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=i}},Sf=class{constructor(){this.pendingResponses=0,this.documentChanges=QD(),this._resumeToken=at.EMPTY_BYTE_STRING,this._current=!1,this._hasPendingChanges=!0}get current(){return this._current}get resumeToken(){return this._resumeToken}get isPending(){return this.pendingResponses!==0}get hasPendingChanges(){return this._hasPendingChanges}updateResumeToken(e){e.approximateByteSize()>0&&(this._hasPendingChanges=!0,this._resumeToken=e)}toTargetChange(){let e=J(),t=J(),r=J();return this.documentChanges.forEach((i,s)=>{switch(s){case 0:e=e.add(i);break;case 2:t=t.add(i);break;case 1:r=r.add(i);break;default:L()}}),new Ec(this._resumeToken,this._current,e,t,r)}clearPendingChanges(){this._hasPendingChanges=!1,this.documentChanges=QD()}addDocumentChange(e,t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(e,t)}removeDocumentChange(e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(e)}recordPendingTargetRequest(){this.pendingResponses+=1}recordTargetResponse(){this.pendingResponses-=1,q(this.pendingResponses>=0)}markCurrent(){this._hasPendingChanges=!0,this._current=!0}},H4="WatchChangeAggregator",K_=class{constructor(e){this.metadataProvider=e,this.targetStates=new Map,this.pendingDocumentUpdates=Gt(),this.pendingDocumentTargetMapping=$D(),this.pendingTargetResets=new Ce(X)}handleDocumentChange(e){for(let t of e.updatedTargetIds)e.newDoc&&e.newDoc.isFoundDocument()?this.addDocumentToTarget(t,e.newDoc):this.removeDocumentFromTarget(t,e.key,e.newDoc);for(let t of e.removedTargetIds)this.removeDocumentFromTarget(t,e.key,e.newDoc)}handleTargetChange(e){this.forEachTarget(e,t=>{let r=this.ensureTargetState(t);switch(e.state){case 0:this.isActiveTarget(t)&&r.updateResumeToken(e.resumeToken);break;case 1:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(e.resumeToken);break;case 2:r.recordTargetResponse(),r.isPending||this.removeTarget(t);break;case 3:this.isActiveTarget(t)&&(r.markCurrent(),r.updateResumeToken(e.resumeToken));break;case 4:this.isActiveTarget(t)&&(this.resetTarget(t),r.updateResumeToken(e.resumeToken));break;default:L()}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.targetStates.forEach((r,i)=>{this.isActiveTarget(i)&&t(i)})}handleExistenceFilter(e){let t=e.targetId,r=e.existenceFilter.count,i=this.targetDataForActiveTarget(t);if(i){let s=i.target;if(mf(s))if(r===0){let o=new O(s.path);this.removeDocumentFromTarget(t,o,Ye.newNoDocument(o,j.min()))}else q(r===1);else{let o=this.getCurrentDocumentCountForTarget(t);if(o!==r){let a=this.parseBloomFilter(e),l=a?this.applyBloomFilter(a,e,o):1;if(l!==0){this.resetTarget(t);let c=l===2?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.pendingTargetResets=this.pendingTargetResets.insert(t,c)}r_?.notifyOnExistenceFilterMismatch(K4(o,e.existenceFilter,this.metadataProvider.getDatabaseId(),a,l))}}}}parseBloomFilter(e){let t=e.existenceFilter.unchangedNames;if(!t||!t.bits)return null;let{bits:{bitmap:r="",padding:i=0},hashCount:s=0}=t,o;try{o=Ni(r).toUint8Array()}catch(l){if(l instanceof G_)return gn("Decoding the base64 bloom filter in existence filter failed ("+l.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw l}let a;try{a=new H_(o,i,s)}catch(l){return l instanceof ys?gn("BloomFilter error: ",l):gn("Applying bloom filter failed: ",l),null}return a.bitCount===0?null:a}applyBloomFilter(e,t,r){let i=t.existenceFilter.count,s=this.filterRemovedDocuments(e,t.targetId);return i===r-s?0:2}filterRemovedDocuments(e,t){let r=this.metadataProvider.getRemoteKeysForTarget(t),i=0;return r.forEach(s=>{let o=this.metadataProvider.getDatabaseId(),a=`projects/${o.projectId}/databases/${o.database}/documents/${s.path.canonicalString()}`;e.mightContain(a)||(this.removeDocumentFromTarget(t,s,null),i++)}),i}createRemoteEvent(e){let t=new Map;this.targetStates.forEach((s,o)=>{let a=this.targetDataForActiveTarget(o);if(a){if(s.current&&mf(a.target)){let l=new O(a.target.path);this.pendingDocumentUpdates.get(l)===null&&!this.targetContainsDocument(o,l)&&this.removeDocumentFromTarget(o,l,Ye.newNoDocument(l,e))}s.hasPendingChanges&&(t.set(o,s.toTargetChange()),s.clearPendingChanges())}});let r=J();this.pendingDocumentTargetMapping.forEach((s,o)=>{let a=!0;o.forEachWhile(l=>{let c=this.targetDataForActiveTarget(l);return c&&c.purpose!=="TargetPurposeLimboResolution"?(a=!1,!1):!0}),a&&(r=r.add(s))}),this.pendingDocumentUpdates.forEach((s,o)=>o.setReadTime(e));let i=new wc(e,t,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=Gt(),this.pendingDocumentTargetMapping=$D(),this.pendingTargetResets=new Ce(X),i}addDocumentToTarget(e,t){if(!this.isActiveTarget(e))return;let r=this.targetContainsDocument(e,t.key)?2:0;this.ensureTargetState(e).addDocumentChange(t.key,r),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t.key,t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t.key,this.ensureDocumentTargetMapping(t.key).add(e))}removeDocumentFromTarget(e,t,r){if(!this.isActiveTarget(e))return;let i=this.ensureTargetState(e);this.targetContainsDocument(e,t)?i.addDocumentChange(t,1):i.removeDocumentChange(t),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,this.ensureDocumentTargetMapping(t).delete(e)),r&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(t,r))}removeTarget(e){this.targetStates.delete(e)}getCurrentDocumentCountForTarget(e){let r=this.ensureTargetState(e).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(e).size+r.addedDocuments.size-r.removedDocuments.size}recordPendingTargetRequest(e){this.ensureTargetState(e).recordPendingTargetRequest()}ensureTargetState(e){let t=this.targetStates.get(e);return t||(t=new Sf,this.targetStates.set(e,t)),t}ensureDocumentTargetMapping(e){let t=this.pendingDocumentTargetMapping.get(e);return t||(t=new ye(X),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,t)),t}isActiveTarget(e){let t=this.targetDataForActiveTarget(e)!==null;return t||D(H4,"Detected inactive target",e),t}targetDataForActiveTarget(e){let t=this.targetStates.get(e);return t&&t.isPending?null:this.metadataProvider.getTargetDataForTarget(e)}resetTarget(e){this.targetStates.set(e,new Sf),this.metadataProvider.getRemoteKeysForTarget(e).forEach(r=>{this.removeDocumentFromTarget(e,r,null)})}targetContainsDocument(e,t){return this.metadataProvider.getRemoteKeysForTarget(e).has(t)}};function $D(){return new Ce(O.comparator)}function QD(){return new Ce(O.comparator)}function K4(n,e,t,r,i){var s,o,a,l,c,u;let d={localCacheCount:n,existenceFilterCount:e.count,databaseId:t.database,projectId:t.projectId},h=e.unchangedNames;return h&&(d.bloomFilter={applied:i===0,hashCount:(s=h?.hashCount)!==null&&s!==void 0?s:0,bitmapLength:(l=(a=(o=h?.bits)===null||o===void 0?void 0:o.bitmap)===null||a===void 0?void 0:a.length)!==null&&l!==void 0?l:0,padding:(u=(c=h?.bits)===null||c===void 0?void 0:c.padding)!==null&&u!==void 0?u:0,mightContain:p=>{var y;return(y=r?.mightContain(p))!==null&&y!==void 0?y:!1}}),d}var W4=(()=>{let n={};return n.asc="ASCENDING",n.desc="DESCENDING",n})(),$4=(()=>{let n={};return n["<"]="LESS_THAN",n["<="]="LESS_THAN_OR_EQUAL",n[">"]="GREATER_THAN",n[">="]="GREATER_THAN_OR_EQUAL",n["=="]="EQUAL",n["!="]="NOT_EQUAL",n["array-contains"]="ARRAY_CONTAINS",n.in="IN",n["not-in"]="NOT_IN",n["array-contains-any"]="ARRAY_CONTAINS_ANY",n})(),Q4=(()=>{let n={};return n.and="AND",n.or="OR",n})();var W_=class{constructor(e,t){this.databaseId=e,this.useProto3Json=t}};function Y4(n){let e=n.code===void 0?v.UNKNOWN:sf(n.code);return new T(e,n.message||"")}function $_(n,e){return n.useProto3Json||Vc(e)?e:{value:e}}function X4(n){let e;return typeof n=="object"?e=n.value:e=n,Vc(e)?null:e}function pa(n,e){if(n.useProto3Json){let r=new Date(e.seconds*1e3).toISOString().replace(/\.\d*/,"").replace("Z",""),i=("000000000"+e.nanoseconds).slice(-9);return`${r}.${i}Z`}else return{seconds:""+e.seconds,nanos:e.nanoseconds}}function J4(n){let e=Ri(n);return new ke(e.seconds,e.nanos)}function jR(n,e){return n.useProto3Json?e.toBase64():e.toUint8Array()}function Z4(n,e){return n.useProto3Json?(q(e===void 0||typeof e=="string"),at.fromBase64String(e||"")):(q(e===void 0||e instanceof Uint8Array),at.fromUint8Array(e||new Uint8Array))}function ez(n,e){return pa(n,e.toTimestamp())}function Ge(n){return q(!!n),j.fromTimestamp(J4(n))}function C0(n,e){return tz(n).child("documents").child(e).canonicalString()}function GR(n){let e=ue.fromString(n);return q(ZR(e)),e}function Tc(n,e){return C0(n.databaseId,e.path)}function ar(n,e){let t=GR(e);if(t.get(1)!==n.databaseId.projectId)throw new T(v.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+t.get(1)+" vs "+n.databaseId.projectId);if(t.get(3)!==n.databaseId.database)throw new T(v.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+t.get(3)+" vs "+n.databaseId.database);return new O(KR(t))}function Q_(n,e){return C0(n.databaseId,e)}function HR(n){let e=GR(n);return e.length===4?ue.emptyPath():KR(e)}function Cc(n){return new ue(["projects",n.databaseId.projectId,"databases",n.databaseId.database]).canonicalString()}function tz(n){return new ue(["projects",n.projectId,"databases",n.database])}function KR(n){return q(n.length>4&&n.get(4)==="documents"),n.popFirst(5)}function YD(n,e,t){return{name:Tc(n,e),fields:t.value.mapValue.fields}}function nz(n,e){return{name:Tc(n,e.key),fields:e.data.value.mapValue.fields,updateTime:pa(n,e.version.toTimestamp()),createTime:pa(n,e.createTime.toTimestamp())}}function WR(n,e,t){let r=ar(n,e.name),i=Ge(e.updateTime),s=e.createTime?Ge(e.createTime):j.min(),o=new At({mapValue:{fields:e.fields}}),a=Ye.newFoundDocument(r,i,s,o);return t&&a.setHasCommittedMutations(),t?a.setHasCommittedMutations():a}function rz(n,e){q(!!e.found),e.found.name,e.found.updateTime;let t=ar(n,e.found.name),r=Ge(e.found.updateTime),i=e.found.createTime?Ge(e.found.createTime):j.min(),s=new At({mapValue:{fields:e.found.fields}});return Ye.newFoundDocument(t,r,i,s)}function iz(n,e){q(!!e.missing),q(!!e.readTime);let t=ar(n,e.missing),r=Ge(e.readTime);return Ye.newNoDocument(t,r)}function sz(n,e){return"found"in e?rz(n,e):"missing"in e?iz(n,e):L()}function oz(n,e){let t;if("targetChange"in e){e.targetChange;let r=az(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=Z4(n,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&Y4(o);t=new _f(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;let r=e.documentChange;r.document,r.document.name,r.document.updateTime;let i=ar(n,r.document.name),s=Ge(r.document.updateTime),o=r.document.createTime?Ge(r.document.createTime):j.min(),a=new At({mapValue:{fields:r.document.fields}}),l=Ye.newFoundDocument(i,s,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];t=new oa(c,u,l.key,l)}else if("documentDelete"in e){e.documentDelete;let r=e.documentDelete;r.document;let i=ar(n,r.document),s=r.readTime?Ge(r.readTime):j.min(),o=Ye.newNoDocument(i,s),a=r.removedTargetIds||[];t=new oa([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;let r=e.documentRemove;r.document;let i=ar(n,r.document),s=r.removedTargetIds||[];t=new oa([],s,i,null)}else if("filter"in e){e.filter;let r=e.filter;r.targetId;let{count:i=0,unchangedNames:s}=r,o=new j_(i,s),a=r.targetId;t=new vf(a,o)}else return L();return t}function az(n){return n==="NO_CHANGE"?0:n==="ADD"?1:n==="REMOVE"?2:n==="CURRENT"?3:n==="RESET"?4:L()}function lz(n){if(!("targetChange"in n))return j.min();let e=n.targetChange;return e.targetIds&&e.targetIds.length||!e.readTime?j.min():Ge(e.readTime)}function bc(n,e){let t;if(e instanceof Pi)t={update:YD(n,e.key,e.value)};else if(e instanceof Fi)t={delete:Tc(n,e.key)};else if(e instanceof On)t={update:YD(n,e.key,e.data),updateMask:Uz(e.fieldMask)};else if(e instanceof vc)t={verify:Tc(n,e.key)};else return L();return e.fieldTransforms.length>0&&(t.updateTransforms=e.fieldTransforms.map(r=>fz(n,r))),e.precondition.isNone||(t.currentDocument=cz(n,e.precondition)),t}function Y_(n,e){let t=e.currentDocument?uz(e.currentDocument):Be.none(),r=e.updateTransforms?e.updateTransforms.map(i=>pz(n,i)):[];if(e.update){e.update.name;let i=ar(n,e.update.name),s=new At({mapValue:{fields:e.update.fields}});if(e.updateMask){let o=zz(e.updateMask);return new On(i,s,o,t,r)}else return new Pi(i,s,t,r)}else if(e.delete){let i=ar(n,e.delete);return new Fi(i,t)}else if(e.verify){let i=ar(n,e.verify);return new vc(i,t)}else return L()}function cz(n,e){return e.updateTime!==void 0?{updateTime:ez(n,e.updateTime)}:e.exists!==void 0?{exists:e.exists}:L()}function uz(n){return n.updateTime!==void 0?Be.updateTime(Ge(n.updateTime)):n.exists!==void 0?Be.exists(n.exists):Be.none()}function dz(n,e){let t=n.updateTime?Ge(n.updateTime):Ge(e);return t.isEqual(j.min())&&(t=Ge(e)),new U_(t,n.transformResults||[])}function hz(n,e){return n&&n.length>0?(q(e!==void 0),n.map(t=>dz(t,e))):[]}function fz(n,e){let t=e.transform;if(t instanceof Oi)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(t instanceof Rr)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:t.elements}};if(t instanceof Nr)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:t.elements}};if(t instanceof xi)return{fieldPath:e.field.canonicalString(),increment:t.operand};throw L()}function pz(n,e){let t=null;if("setToServerValue"in e)q(e.setToServerValue==="REQUEST_TIME"),t=new Oi;else if("appendMissingElements"in e){let i=e.appendMissingElements.values||[];t=new Rr(i)}else if("removeAllFromArray"in e){let i=e.removeAllFromArray.values||[];t=new Nr(i)}else"increment"in e?t=new xi(n,e.increment):L();let r=He.fromServerFormat(e.fieldPath);return new As(r,t)}function $R(n,e){return{documents:[Q_(n,e.path)]}}function gz(n){let e=n.documents.length;q(e===1);let t=n.documents[0];return Ft(Da(HR(t)))}function QR(n,e){let t={structuredQuery:{}},r=e.path;e.collectionGroup!==null?(t.parent=Q_(n,r),t.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(t.parent=Q_(n,r.popLast()),t.structuredQuery.from=[{collectionId:r.lastSegment()}]);let i=Sz(e.filters);i&&(t.structuredQuery.where=i);let s=Ez(e.orderBy);s&&(t.structuredQuery.orderBy=s);let o=$_(n,e.limit);return o!==null&&(t.structuredQuery.limit=o),e.startAt&&(t.structuredQuery.startAt=Cz(e.startAt)),e.endAt&&(t.structuredQuery.endAt=bz(e.endAt)),t}function YR(n){let e=HR(n.parent),t=n.structuredQuery,r=t.from?t.from.length:0,i=null;if(r>0){q(r===1);let u=t.from[0];u.allDescendants?i=u.collectionId:e=e.child(u.collectionId)}let s=[];t.where&&(s=wz(t.where));let o=[];t.orderBy&&(o=Tz(t.orderBy));let a=null;t.limit&&(a=X4(t.limit));let l=null;t.startAt&&(l=Az(t.startAt));let c=null;return t.endAt&&(c=Iz(t.endAt)),TR(e,i,o,s,a,"F",l,c)}function mz(n){return Ft(YR(n))}function yz(n,e){let t=vz(e.purpose);return t==null?null:{"goog-listen-tags":t}}function vz(n){switch(n){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return L()}}function _z(n,e){let t,r=e.target;if(mf(r)?t={documents:$R(n,r)}:t={query:QR(n,r)},t.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){t.resumeToken=jR(n,e.resumeToken);let i=$_(n,e.expectedCount);i!==null&&(t.expectedCount=i)}else if(e.snapshotVersion.compareTo(j.min())>0){t.readTime=pa(n,e.snapshotVersion.toTimestamp());let i=$_(n,e.expectedCount);i!==null&&(t.expectedCount=i)}return t}function Sz(n){if(n.length!==0)return JR(fe.create(n,"and"))}function wz(n){let e=XR(n);return e instanceof fe&&S0(e)?e.getFilters():[e]}function XR(n){return n.unaryFilter!==void 0?Bz(n):n.fieldFilter!==void 0?Vz(n):n.compositeFilter!==void 0?qz(n):L()}function Ez(n){if(n.length!==0)return n.map(e=>xz(e))}function Tz(n){return n.map(e=>Pz(e))}function Cz(n){return{before:n.inclusive,values:n.position}}function bz(n){return{before:!n.inclusive,values:n.position}}function Az(n){let e=!!n.before,t=n.values||[];return new cr(t,e)}function Iz(n){let e=!n.before,t=n.values||[];return new cr(t,e)}function Dz(n){return W4[n]}function Rz(n){switch(n){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}function Nz(n){return $4[n]}function kz(n){return Q4[n]}function Mz(n){switch(n){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function Oz(n){switch(n){case"AND":return"and";case"OR":return"or";default:return L()}}function ea(n){return{fieldPath:n.canonicalString()}}function ra(n){return He.fromServerFormat(n.fieldPath)}function xz(n){return{field:ea(n.field),direction:Dz(n.dir)}}function Pz(n){return new Cs(ra(n.field),Rz(n.direction))}function JR(n){return n instanceof re?Lz(n):n instanceof fe?Fz(n):L()}function Fz(n){let e=n.getFilters().map(t=>JR(t));return e.length===1?e[0]:{compositeFilter:{op:kz(n.op),filters:e}}}function Lz(n){if(n.op==="=="){if(VD(n.value))return{unaryFilter:{field:ea(n.field),op:"IS_NAN"}};if(BD(n.value))return{unaryFilter:{field:ea(n.field),op:"IS_NULL"}}}else if(n.op==="!="){if(VD(n.value))return{unaryFilter:{field:ea(n.field),op:"IS_NOT_NAN"}};if(BD(n.value))return{unaryFilter:{field:ea(n.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:ea(n.field),op:Nz(n.op),value:n.value}}}function Bz(n){switch(n.unaryFilter.op){case"IS_NAN":let e=ra(n.unaryFilter.field);return re.create(e,"==",{doubleValue:NaN});case"IS_NULL":let t=ra(n.unaryFilter.field);return re.create(t,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":let r=ra(n.unaryFilter.field);return re.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":let i=ra(n.unaryFilter.field);return re.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return L();default:return L()}}function Vz(n){return re.create(ra(n.fieldFilter.field),Mz(n.fieldFilter.op),n.fieldFilter.value)}function qz(n){return fe.create(n.compositeFilter.filters.map(e=>XR(e)),Oz(n.compositeFilter.op))}function Uz(n){let e=[];return n.fields.forEach(t=>e.push(t.canonicalString())),{fieldPaths:e}}function zz(n){let e=n.fieldPaths||[];return new Jt(e.map(t=>He.fromServerFormat(t)))}function ZR(n){return n.length>=4&&n.get(0)==="projects"&&n.get(2)==="databases"}var ga=class n{constructor(e,t,r,i,s=j.min(),o=j.min(),a=at.EMPTY_BYTE_STRING,l=null){this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=i,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=a,this.expectedCount=l}withSequenceNumber(e){return new n(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new n(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}};var wf=class{constructor(e){this.remoteSerializer=e}};function jz(n,e){let t;if(e.document)t=WR(n.remoteSerializer,e.document,!!e.hasCommittedMutations);else if(e.noDocument){let r=O.fromSegments(e.noDocument.path),i=Ds(e.noDocument.readTime);t=Ye.newNoDocument(r,i),e.hasCommittedMutations&&t.setHasCommittedMutations()}else if(e.unknownDocument){let r=O.fromSegments(e.unknownDocument.path),i=Ds(e.unknownDocument.version);t=Ye.newUnknownDocument(r,i)}else return L();return e.readTime&&t.setReadTime(Gz(e.readTime)),t}function XD(n,e){let t=e.key,r={prefixPath:t.getCollectionPath().popLast().toArray(),collectionGroup:t.collectionGroup,documentId:t.path.lastSegment(),readTime:op(e.readTime),hasCommittedMutations:e.hasCommittedMutations};if(e.isFoundDocument())r.document=nz(n.remoteSerializer,e);else if(e.isNoDocument())r.noDocument={path:t.path.toArray(),readTime:Is(e.version)};else if(e.isUnknownDocument())r.unknownDocument={path:t.path.toArray(),version:Is(e.version)};else return L();return r}function op(n){let e=n.toTimestamp();return[e.seconds,e.nanoseconds]}function Gz(n){let e=new ke(n[0],n[1]);return j.fromTimestamp(e)}function Is(n){let e=n.toTimestamp();return{seconds:e.seconds,nanoseconds:e.nanoseconds}}function Ds(n){let e=new ke(n.seconds,n.nanoseconds);return j.fromTimestamp(e)}function Hz(n,e,t){let r=t.baseMutations.map(s=>bc(n.remoteSerializer,s)),i=t.mutations.map(s=>bc(n.remoteSerializer,s));return{userId:e,batchId:t.batchId,localWriteTimeMs:t.localWriteTime.toMillis(),baseMutations:r,mutations:i}}function fs(n,e){let t=(e.baseMutations||[]).map(s=>Y_(n.remoteSerializer,s));for(let s=0;s<e.mutations.length-1;++s){let o=e.mutations[s];if(s+1<e.mutations.length&&e.mutations[s+1].transform!==void 0){let l=e.mutations[s+1];o.updateTransforms=l.transform.fieldTransforms,e.mutations.splice(s+1,1),++s}}let r=e.mutations.map(s=>Y_(n.remoteSerializer,s)),i=ke.fromMillis(e.localWriteTimeMs);return new _c(e.batchId,i,t,r)}function rc(n){let e=Ds(n.readTime),t=n.lastLimboFreeSnapshotVersion!==void 0?Ds(n.lastLimboFreeSnapshotVersion):j.min(),r;return Kz(n.query)?r=gz(n.query):r=mz(n.query),new ga(r,n.targetId,"TargetPurposeListen",n.lastListenSequenceNumber,e,t,at.fromBase64String(n.resumeToken))}function eN(n,e){let t=Is(e.snapshotVersion),r=Is(e.lastLimboFreeSnapshotVersion),i;mf(e.target)?i=$R(n.remoteSerializer,e.target):i=QR(n.remoteSerializer,e.target);let s=e.resumeToken.toBase64();return{targetId:e.targetId,canonicalId:bs(e.target),readTime:t,resumeToken:s,lastListenSequenceNumber:e.sequenceNumber,lastLimboFreeSnapshotVersion:r,query:i}}function Kz(n){return n.documents!==void 0}function Wz(n){return{id:n.bundleId,createTime:Ds(n.createTime),version:n.version}}function $z(n){return{bundleId:n.id,createTime:Is(Ge(n.createTime)),version:n.version}}function Qz(n){return{name:n.name,query:b0(n.bundledQuery),readTime:Ds(n.readTime)}}function Yz(n){return{name:n.name,readTime:Is(Ge(n.readTime)),bundledQuery:n.bundledQuery}}function b0(n){let e=YR({parent:n.parent,structuredQuery:n.structuredQuery});return n.limitType==="LAST"?yf(e,e.limit,"L"):e}function Xz(n){return{name:n.name,query:b0(n.bundledQuery),readTime:Ge(n.readTime)}}function Jz(n){return{id:n.id,version:n.version,createTime:Ge(n.createTime)}}function i_(n,e){return new Sc(e.largestBatchId,Y_(n.remoteSerializer,e.overlayMutation))}function Zz(n,e,t){let[r,i,s]=tN(e,t.mutation.key);return{userId:e,collectionPath:i,documentId:s,collectionGroup:t.mutation.key.getCollectionGroup(),largestBatchId:t.largestBatchId,overlayMutation:bc(n.remoteSerializer,t.mutation)}}function tN(n,e){let t=e.path.lastSegment(),r=Pt(e.path.popLast());return[n,r,t]}function e6(n){return{indexId:n.indexId,collectionGroup:n.collectionGroup,fields:n.fields.map(e=>[e.fieldPath.canonicalString(),e.kind])}}function t6(n,e){let t=e?new uc(e.sequenceNumber,new mn(Ds(e.readTime),new O(sr(e.documentKey)),e.largestBatchId)):uc.empty(),r=n.fields.map(([i,s])=>new ia(He.fromServerFormat(i),s));return new __(n.indexId,n.collectionGroup,r,t)}function JD(n,e,t,r){return{indexId:n,uid:e.uid||"",sequenceNumber:t,readTime:Is(r.readTime),documentKey:Pt(r.documentKey.path),largestBatchId:r.largestBatchId}}var X_=class{getBundleMetadata(e,t){return ZD(e).get(t).next(r=>{if(r)return Wz(r)})}saveBundleMetadata(e,t){return ZD(e).put($z(t))}getNamedQuery(e,t){return e1(e).get(t).next(r=>{if(r)return Qz(r)})}saveNamedQuery(e,t){return e1(e).put(Yz(t))}};function ZD(n){return lt(n,ep)}function e1(n){return lt(n,tp)}var Ef=class n{constructor(e,t){this.serializer=e,this.userId=t}static forUser(e,t){let r=t.uid||"";return new n(e,r)}getOverlay(e,t){return Jl(e).get(tN(this.userId,t)).next(r=>r?i_(this.serializer,r):null)}getOverlays(e,t){let r=or();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){let i=[];return r.forEach((s,o)=>{let a=new Sc(t,o);i.push(this.saveOverlay(e,a))}),m.waitFor(i)}removeOverlaysForBatchId(e,t,r){let i=new Set;t.forEach(o=>i.add(Pt(o.getCollectionPath())));let s=[];return i.forEach(o=>{let a=IDBKeyRange.bound([this.userId,o,r],[this.userId,o,r+1],!1,!0);s.push(Jl(e).deleteAll(I_,a))}),m.waitFor(s)}getOverlaysForCollection(e,t,r){let i=or(),s=Pt(t),o=IDBKeyRange.bound([this.userId,s,r],[this.userId,s,Number.POSITIVE_INFINITY],!0);return Jl(e).loadAll(I_,o).next(a=>{for(let l of a){let c=i_(this.serializer,l);i.set(c.getKey(),c)}return i})}getOverlaysForCollectionGroup(e,t,r,i){let s=or(),o,a=IDBKeyRange.bound([this.userId,t,r],[this.userId,t,Number.POSITIVE_INFINITY],!0);return Jl(e).iterate({index:tR,range:a},(l,c,u)=>{let d=i_(this.serializer,c);s.size()<i||d.largestBatchId===o?(s.set(d.getKey(),d),o=d.largestBatchId):u.done()}).next(()=>s)}saveOverlay(e,t){return Jl(e).put(Zz(this.serializer,this.userId,t))}};function Jl(n){return lt(n,np)}var n6=5,r6=10,i6=13,t1=15,s6=20,o6=25,a6=30,l6=37,c6=45,u6=50,d6=55,h6=60,f6=2,Dr=class{constructor(){}writeIndexValue(e,t){this.writeIndexValueAux(e,t),t.writeInfinity()}writeIndexValueAux(e,t){if("nullValue"in e)this.writeValueTypeLabel(t,n6);else if("booleanValue"in e)this.writeValueTypeLabel(t,r6),t.writeNumber(e.booleanValue?1:0);else if("integerValue"in e)this.writeValueTypeLabel(t,t1),t.writeNumber(Ve(e.integerValue));else if("doubleValue"in e){let r=Ve(e.doubleValue);isNaN(r)?this.writeValueTypeLabel(t,i6):(this.writeValueTypeLabel(t,t1),pc(r)?t.writeNumber(0):t.writeNumber(r))}else if("timestampValue"in e){let r=e.timestampValue;this.writeValueTypeLabel(t,s6),typeof r=="string"?t.writeString(r):(t.writeString(`${r.seconds||""}`),t.writeNumber(r.nanos||0))}else if("stringValue"in e)this.writeIndexString(e.stringValue,t),this.writeTruncationMarker(t);else if("bytesValue"in e)this.writeValueTypeLabel(t,a6),t.writeBytes(Ni(e.bytesValue)),this.writeTruncationMarker(t);else if("referenceValue"in e)this.writeIndexEntityRef(e.referenceValue,t);else if("geoPointValue"in e){let r=e.geoPointValue;this.writeValueTypeLabel(t,c6),t.writeNumber(r.latitude||0),t.writeNumber(r.longitude||0)}else"mapValue"in e?fR(e)?this.writeValueTypeLabel(t,Number.MAX_SAFE_INTEGER):(this.writeIndexMap(e.mapValue,t),this.writeTruncationMarker(t)):"arrayValue"in e?(this.writeIndexArray(e.arrayValue,t),this.writeTruncationMarker(t)):L()}writeIndexString(e,t){this.writeValueTypeLabel(t,o6),this.writeUnlabeledIndexString(e,t)}writeUnlabeledIndexString(e,t){t.writeString(e)}writeIndexMap(e,t){let r=e.fields||{};this.writeValueTypeLabel(t,d6);for(let i of Object.keys(r))this.writeIndexString(i,t),this.writeIndexValueAux(r[i],t)}writeIndexArray(e,t){let r=e.values||[];this.writeValueTypeLabel(t,u6);for(let i of r)this.writeIndexValueAux(i,t)}writeIndexEntityRef(e,t){this.writeValueTypeLabel(t,l6),O.fromName(e).path.forEach(i=>{this.writeValueTypeLabel(t,h6),this.writeUnlabeledIndexString(i,t)})}writeValueTypeLabel(e,t){e.writeNumber(t)}writeTruncationMarker(e){e.writeNumber(f6)}};Dr.INSTANCE=new Dr;var n1="\uD800",r1="\uDBFF",Wo=0,i1=255,s1=1,$o=255,o1=255,a1=0,p6=64,g6=8,m6=1024;function y6(n){let e=new DataView(new ArrayBuffer(8));return e.setFloat64(0,n,!1),new Uint8Array(e.buffer)}function v6(n){if(n===0)return 8;let e=0;return n>>4||(e+=4,n=n<<4),n>>6||(e+=2,n=n<<2),n>>7||(e+=1),e}function _6(n){let e=0;for(let t=0;t<8;++t){let r=v6(n[t]&255);if(e+=r,r!==8)break}return e}function l1(n){let e=p6-_6(n);return Math.ceil(e/g6)}var J_=class{constructor(){this.buffer=new Uint8Array(m6),this.position=0}writeBytesAscending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteAscending(r.value),r=t.next();this.writeSeparatorAscending()}writeBytesDescending(e){let t=e[Symbol.iterator](),r=t.next();for(;!r.done;)this.writeByteDescending(r.value),r=t.next();this.writeSeparatorDescending()}writeUtf8Ascending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteAscending(r);else if(r<2048)this.writeByteAscending(960|r>>>6),this.writeByteAscending(128|63&r);else if(t<n1||r1<t)this.writeByteAscending(480|r>>>12),this.writeByteAscending(128|63&r>>>6),this.writeByteAscending(128|63&r);else{let i=t.codePointAt(0);this.writeByteAscending(240|i>>>18),this.writeByteAscending(128|63&i>>>12),this.writeByteAscending(128|63&i>>>6),this.writeByteAscending(128|63&i)}}this.writeSeparatorAscending()}writeUtf8Descending(e){for(let t of e){let r=t.charCodeAt(0);if(r<128)this.writeByteDescending(r);else if(r<2048)this.writeByteDescending(960|r>>>6),this.writeByteDescending(128|63&r);else if(t<n1||r1<t)this.writeByteDescending(480|r>>>12),this.writeByteDescending(128|63&r>>>6),this.writeByteDescending(128|63&r);else{let i=t.codePointAt(0);this.writeByteDescending(240|i>>>18),this.writeByteDescending(128|63&i>>>12),this.writeByteDescending(128|63&i>>>6),this.writeByteDescending(128|63&i)}}this.writeSeparatorDescending()}writeNumberAscending(e){let t=this.toOrderedBits(e),r=l1(t);this.ensureAvailable(1+r),this.buffer[this.position++]=r&255;for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=t[i]&255}writeNumberDescending(e){let t=this.toOrderedBits(e),r=l1(t);this.ensureAvailable(1+r),this.buffer[this.position++]=~(r&255);for(let i=t.length-r;i<t.length;++i)this.buffer[this.position++]=~(t[i]&255)}writeInfinityAscending(){this.writeEscapedByteAscending($o),this.writeEscapedByteAscending(o1)}writeInfinityDescending(){this.writeEscapedByteDescending($o),this.writeEscapedByteDescending(o1)}reset(){this.position=0}seed(e){this.ensureAvailable(e.length),this.buffer.set(e,this.position),this.position+=e.length}encodedBytes(){return this.buffer.slice(0,this.position)}toOrderedBits(e){let t=y6(e),r=(t[0]&128)!==0;t[0]^=r?255:128;for(let i=1;i<t.length;++i)t[i]^=r?255:0;return t}writeByteAscending(e){let t=e&255;t===Wo?(this.writeEscapedByteAscending(Wo),this.writeEscapedByteAscending(i1)):t===$o?(this.writeEscapedByteAscending($o),this.writeEscapedByteAscending(a1)):this.writeEscapedByteAscending(t)}writeByteDescending(e){let t=e&255;t===Wo?(this.writeEscapedByteDescending(Wo),this.writeEscapedByteDescending(i1)):t===$o?(this.writeEscapedByteDescending($o),this.writeEscapedByteDescending(a1)):this.writeEscapedByteDescending(e)}writeSeparatorAscending(){this.writeEscapedByteAscending(Wo),this.writeEscapedByteAscending(s1)}writeSeparatorDescending(){this.writeEscapedByteDescending(Wo),this.writeEscapedByteDescending(s1)}writeEscapedByteAscending(e){this.ensureAvailable(1),this.buffer[this.position++]=e}writeEscapedByteDescending(e){this.ensureAvailable(1),this.buffer[this.position++]=~e}ensureAvailable(e){let t=e+this.position;if(t<=this.buffer.length)return;let r=this.buffer.length*2;r<t&&(r=t);let i=new Uint8Array(r);i.set(this.buffer),this.buffer=i}},Z_=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesAscending(e)}writeString(e){this.orderedCode.writeUtf8Ascending(e)}writeNumber(e){this.orderedCode.writeNumberAscending(e)}writeInfinity(){this.orderedCode.writeInfinityAscending()}},eS=class{constructor(e){this.orderedCode=e}writeBytes(e){this.orderedCode.writeBytesDescending(e)}writeString(e){this.orderedCode.writeUtf8Descending(e)}writeNumber(e){this.orderedCode.writeNumberDescending(e)}writeInfinity(){this.orderedCode.writeInfinityDescending()}},ps=class{constructor(){this.orderedCode=new J_,this.ascending=new Z_(this.orderedCode),this.descending=new eS(this.orderedCode)}seed(e){this.orderedCode.seed(e)}forKind(e){return e===0?this.ascending:this.descending}encodedBytes(){return this.orderedCode.encodedBytes()}reset(){this.orderedCode.reset()}};var gs=class n{constructor(e,t,r,i){this.indexId=e,this.documentKey=t,this.arrayValue=r,this.directionalValue=i}successor(){let e=this.directionalValue.length,t=e===0||this.directionalValue[e-1]===255?e+1:e,r=new Uint8Array(t);return r.set(this.directionalValue,0),t!==e?r.set([0],this.directionalValue.length):++r[r.length-1],new n(this.indexId,this.documentKey,this.arrayValue,r)}};function Si(n,e){let t=n.indexId-e.indexId;return t!==0||(t=c1(n.arrayValue,e.arrayValue),t!==0)||(t=c1(n.directionalValue,e.directionalValue),t!==0)?t:O.comparator(n.documentKey,e.documentKey)}function c1(n,e){for(let t=0;t<n.length&&t<e.length;++t){let r=n[t]-e[t];if(r!==0)return r}return n.length-e.length}var Tf=class{constructor(e){this.inequalityFilters=new ye((t,r)=>He.comparator(t.field,r.field)),this.collectionId=e.collectionGroup!=null?e.collectionGroup:e.path.lastSegment(),this.orderBys=e.orderBy,this.equalityFilters=[];for(let t of e.filters){let r=t;r.isInequality()?this.inequalityFilters=this.inequalityFilters.add(r):this.equalityFilters.push(r)}}get hasMultipleInequality(){return this.inequalityFilters.size>1}servedByIndex(e){if(q(e.collectionGroup===this.collectionId),this.hasMultipleInequality)return!1;let t=d0(e);if(t!==void 0&&!this.hasMatchingEqualityFilter(t))return!1;let r=ws(e),i=new Set,s=0,o=0;for(;s<r.length&&this.hasMatchingEqualityFilter(r[s]);++s)i=i.add(r[s].fieldPath.canonicalString());if(s===r.length)return!0;if(this.inequalityFilters.size>0){let a=this.inequalityFilters.getIterator().getNext();if(!i.has(a.field.canonicalString())){let l=r[s];if(!this.matchesFilter(a,l)||!this.matchesOrderBy(this.orderBys[o++],l))return!1}++s}for(;s<r.length;++s){let a=r[s];if(o>=this.orderBys.length||!this.matchesOrderBy(this.orderBys[o++],a))return!1}return!0}buildTargetIndex(){if(this.hasMultipleInequality)return null;let e=new ye(He.comparator),t=[];for(let r of this.equalityFilters){if(r.field.isKeyField())continue;if(r.op==="array-contains"||r.op==="array-contains-any")t.push(new ia(r.field,2));else{if(e.has(r.field))continue;e=e.add(r.field),t.push(new ia(r.field,0))}}for(let r of this.orderBys)r.field.isKeyField()||e.has(r.field)||(e=e.add(r.field),t.push(new ia(r.field,r.dir==="asc"?0:1)));return new __(__.UNKNOWN_ID,this.collectionId,t,uc.empty())}hasMatchingEqualityFilter(e){for(let t of this.equalityFilters)if(this.matchesFilter(t,e))return!0;return!1}matchesFilter(e,t){if(e===void 0||!e.field.isEqual(t.fieldPath))return!1;let r=e.op==="array-contains"||e.op==="array-contains-any";return t.kind===2===r}matchesOrderBy(e,t){return e.field.isEqual(t.fieldPath)?t.kind===0&&e.dir==="asc"||t.kind===1&&e.dir==="desc":!1}};function nN(n){var e,t;if(q(n instanceof re||n instanceof fe),n instanceof re)if(n instanceof gf){let i=((t=(e=n.value.arrayValue)===null||e===void 0?void 0:e.values)===null||t===void 0?void 0:t.map(s=>re.create(n.field,"==",s)))||[];return fe.create(i,"or")}else return n;let r=n.filters.map(i=>nN(i));return fe.create(r,n.op)}function S6(n){if(n.getFilters().length===0)return[];let e=tS(nN(n));return q(rN(e)),A0(e)||I0(e)?[e]:e.getFilters()}function A0(n){return n instanceof re}function I0(n){return n instanceof fe&&S0(n)}function rN(n){return A0(n)||I0(n)||w6(n)}function w6(n){if(n instanceof fe&&k_(n)){for(let e of n.getFilters())if(!A0(e)&&!I0(e))return!1;return!0}return!1}function tS(n){if(q(n instanceof re||n instanceof fe),n instanceof re)return n;if(n.filters.length===1)return tS(n.filters[0]);let e=n.filters.map(r=>tS(r)),t=fe.create(e,n.op);return t=Cf(t),rN(t)?t:(q(t instanceof fe),q(ua(t)),q(t.filters.length>1),t.filters.reduce((r,i)=>D0(r,i)))}function D0(n,e){q(n instanceof re||n instanceof fe),q(e instanceof re||e instanceof fe);let t;return n instanceof re?e instanceof re?t=E6(n,e):t=u1(n,e):e instanceof re?t=u1(e,n):t=T6(n,e),Cf(t)}function E6(n,e){return fe.create([n,e],"and")}function T6(n,e){if(q(n.filters.length>0&&e.filters.length>0),ua(n)&&ua(e))return vR(n,e.getFilters());let t=k_(n)?n:e,r=k_(n)?e:n,i=t.filters.map(s=>D0(s,r));return fe.create(i,"or")}function u1(n,e){if(ua(e))return vR(e,n.getFilters());{let t=e.filters.map(r=>D0(n,r));return fe.create(t,"or")}}function Cf(n){if(q(n instanceof re||n instanceof fe),n instanceof re)return n;let e=n.getFilters();if(e.length===1)return Cf(e[0]);if(mR(n))return n;let t=e.map(i=>Cf(i)),r=[];return t.forEach(i=>{i instanceof re?r.push(i):i instanceof fe&&(i.op===n.op?r.push(...i.filters):r.push(i))}),r.length===1?r[0]:fe.create(r,n.op)}var nS=class{constructor(){this.collectionParentIndex=new Ac}addToCollectionParentIndex(e,t){return this.collectionParentIndex.add(t),m.resolve()}getCollectionParents(e,t){return m.resolve(this.collectionParentIndex.getEntries(t))}addFieldIndex(e,t){return m.resolve()}deleteFieldIndex(e,t){return m.resolve()}deleteAllFieldIndexes(e){return m.resolve()}createTargetIndexes(e,t){return m.resolve()}getDocumentsMatchingTarget(e,t){return m.resolve(null)}getIndexType(e,t){return m.resolve(0)}getFieldIndexes(e,t){return m.resolve([])}getNextCollectionGroupToUpdate(e){return m.resolve(null)}getMinOffset(e,t){return m.resolve(mn.min())}getMinOffsetFromCollectionGroup(e,t){return m.resolve(mn.min())}updateCollectionGroup(e,t,r){return m.resolve()}updateIndexEntries(e,t){return m.resolve()}},Ac=class{constructor(){this.index={}}add(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t]||new ye(ue.comparator),s=!i.has(r);return this.index[t]=i.add(r),s}has(e){let t=e.lastSegment(),r=e.popLast(),i=this.index[t];return i&&i.has(r)}getEntries(e){return(this.index[e]||new ye(ue.comparator)).toArray()}};var d1="IndexedDbIndexManager",Yh=new Uint8Array(0),rS=class{constructor(e,t){this.user=e,this.databaseId=t,this.collectionParentsCache=new Ac,this.targetToDnfSubTargets=new ur(r=>bs(r),(r,i)=>qc(r,i)),this.uid=e.uid||""}addToCollectionParentIndex(e,t){if(!this.collectionParentsCache.has(t)){let r=t.lastSegment(),i=t.popLast();e.addOnCommittedListener(()=>{this.collectionParentsCache.add(t)});let s={collectionId:r,parent:Pt(i)};return h1(e).put(s)}return m.resolve()}getCollectionParents(e,t){let r=[],i=IDBKeyRange.bound([t,""],[z1(t),""],!1,!0);return h1(e).loadAll(i).next(s=>{for(let o of s){if(o.collectionId!==t)break;r.push(sr(o.parent))}return r})}addFieldIndex(e,t){let r=Zl(e),i=e6(t);delete i.indexId;let s=r.add(i);if(t.indexState){let o=Yo(e);return s.next(a=>{o.put(JD(a,this.user,t.indexState.sequenceNumber,t.indexState.offset))})}else return s.next()}deleteFieldIndex(e,t){let r=Zl(e),i=Yo(e),s=Qo(e);return r.delete(t.indexId).next(()=>i.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0))).next(()=>s.delete(IDBKeyRange.bound([t.indexId],[t.indexId+1],!1,!0)))}deleteAllFieldIndexes(e){let t=Zl(e),r=Qo(e),i=Yo(e);return t.deleteAll().next(()=>r.deleteAll()).next(()=>i.deleteAll())}createTargetIndexes(e,t){return m.forEach(this.getSubTargets(t),r=>this.getIndexType(e,r).next(i=>{if(i===0||i===1){let o=new Tf(r).buildTargetIndex();if(o!=null)return this.addFieldIndex(e,o)}}))}getDocumentsMatchingTarget(e,t){let r=Qo(e),i=!0,s=new Map;return m.forEach(this.getSubTargets(t),o=>this.getFieldIndex(e,o).next(a=>{i&&(i=!!a),s.set(o,a)})).next(()=>{if(i){let o=J(),a=[];return m.forEach(s,(l,c)=>{D(d1,`Using index ${xU(l)} to execute ${bs(t)}`);let u=r4(c,l),d=i4(c,l),h=s4(c,l),p=o4(c,l),y=this.encodeBound(l,c,h),_=this.encodeBound(l,c,p),S=this.encodeValues(l,c,d),R=this.generateIndexRanges(l.indexId,u,y,h.inclusive,_,p.inclusive,S);return m.forEach(R,E=>r.loadFirst(E,t.limit).next(N=>{N.forEach(k=>{let V=O.fromSegments(k.documentKey);o.has(V)||(o=o.add(V),a.push(V))})}))}).next(()=>a)}else return m.resolve(null)})}getSubTargets(e){let t=this.targetToDnfSubTargets.get(e);return t||(e.filters.length===0?t=[e]:t=S6(fe.create(e.filters,"and")).map(i=>q_(e.path,e.collectionGroup,e.orderBy,i.getFilters(),e.limit,e.startAt,e.endAt)),this.targetToDnfSubTargets.set(e,t),t)}generateIndexRanges(e,t,r,i,s,o,a){let l=(t!=null?t.length:1)*Math.max(r.length,s.length),c=l/(t!=null?t.length:1),u=[];for(let d=0;d<l;++d){let h=t?this.encodeSingleElement(t[d/c]):Yh,p=this.generateLowerBound(e,h,r[d%c],i),y=this.generateUpperBound(e,h,s[d%c],o),_=a.map(S=>this.generateLowerBound(e,h,S,!0));u.push(...this.createRange(p,y,_))}return u}generateLowerBound(e,t,r,i){let s=new gs(e,O.empty(),t,r);return i?s:s.successor()}generateUpperBound(e,t,r,i){let s=new gs(e,O.empty(),t,r);return i?s.successor():s}getFieldIndex(e,t){let r=new Tf(t),i=t.collectionGroup!=null?t.collectionGroup:t.path.lastSegment();return this.getFieldIndexes(e,i).next(s=>{let o=null;for(let a of s)r.servedByIndex(a)&&(!o||a.fields.length>o.fields.length)&&(o=a);return o})}getIndexType(e,t){let r=2,i=this.getSubTargets(t);return m.forEach(i,s=>this.getFieldIndex(e,s).next(o=>{o?r!==0&&o.fields.length<a4(s)&&(r=1):r=0})).next(()=>l4(t)&&i.length>1&&r===2?1:r)}encodeDirectionalElements(e,t){let r=new ps;for(let i of ws(e)){let s=t.data.field(i.fieldPath);if(s==null)return null;let o=r.forKind(i.kind);Dr.INSTANCE.writeIndexValue(s,o)}return r.encodedBytes()}encodeSingleElement(e){let t=new ps;return Dr.INSTANCE.writeIndexValue(e,t.forKind(0)),t.encodedBytes()}encodeDirectionalKey(e,t){let r=new ps;return Dr.INSTANCE.writeIndexValue(Ts(this.databaseId,t),r.forKind(OU(e))),r.encodedBytes()}encodeValues(e,t,r){if(r===null)return[];let i=[];i.push(new ps);let s=0;for(let o of ws(e)){let a=r[s++];for(let l of i)if(this.isInFilter(t,o.fieldPath)&&mc(a))i=this.expandIndexValues(i,o,a);else{let c=l.forKind(o.kind);Dr.INSTANCE.writeIndexValue(a,c)}}return this.getEncodedBytes(i)}encodeBound(e,t,r){return this.encodeValues(e,t,r.position)}getEncodedBytes(e){let t=[];for(let r=0;r<e.length;++r)t[r]=e[r].encodedBytes();return t}expandIndexValues(e,t,r){let i=[...e],s=[];for(let o of r.arrayValue.values||[])for(let a of i){let l=new ps;l.seed(a.encodedBytes()),Dr.INSTANCE.writeIndexValue(o,l.forKind(t.kind)),s.push(l)}return s}isInFilter(e,t){return!!e.filters.find(r=>r instanceof re&&r.field.isEqual(t)&&(r.op==="in"||r.op==="not-in"))}getFieldIndexes(e,t){let r=Zl(e),i=Yo(e);return(t?r.loadAll(A_,IDBKeyRange.bound(t,t)):r.loadAll()).next(s=>{let o=[];return m.forEach(s,a=>i.get([a.indexId,this.uid]).next(l=>{o.push(t6(a,l))})).next(()=>o)})}getNextCollectionGroupToUpdate(e){return this.getFieldIndexes(e).next(t=>t.length===0?null:(t.sort((r,i)=>{let s=r.indexState.sequenceNumber-i.indexState.sequenceNumber;return s!==0?s:X(r.collectionGroup,i.collectionGroup)}),t[0].collectionGroup))}updateCollectionGroup(e,t,r){let i=Zl(e),s=Yo(e);return this.getNextSequenceNumber(e).next(o=>i.loadAll(A_,IDBKeyRange.bound(t,t)).next(a=>m.forEach(a,l=>s.put(JD(l.indexId,this.user,o,r)))))}updateIndexEntries(e,t){let r=new Map;return m.forEach(t,(i,s)=>{let o=r.get(i.collectionGroup);return(o?m.resolve(o):this.getFieldIndexes(e,i.collectionGroup)).next(l=>(r.set(i.collectionGroup,l),m.forEach(l,c=>this.getExistingIndexEntries(e,i,c).next(u=>{let d=this.computeIndexEntries(s,c);return u.isEqual(d)?m.resolve():this.updateEntries(e,s,c,u,d)}))))})}addIndexEntry(e,t,r,i){return Qo(e).put({indexId:i.indexId,uid:this.uid,arrayValue:i.arrayValue,directionalValue:i.directionalValue,orderedDocumentKey:this.encodeDirectionalKey(r,t.key),documentKey:t.key.path.toArray()})}deleteIndexEntry(e,t,r,i){return Qo(e).delete([i.indexId,this.uid,i.arrayValue,i.directionalValue,this.encodeDirectionalKey(r,t.key),t.key.path.toArray()])}getExistingIndexEntries(e,t,r){let i=Qo(e),s=new ye(Si);return i.iterate({index:eR,range:IDBKeyRange.only([r.indexId,this.uid,this.encodeDirectionalKey(r,t)])},(o,a)=>{s=s.add(new gs(r.indexId,t,a.arrayValue,a.directionalValue))}).next(()=>s)}computeIndexEntries(e,t){let r=new ye(Si),i=this.encodeDirectionalElements(t,e);if(i==null)return r;let s=d0(t);if(s!=null){let o=e.data.field(s.fieldPath);if(mc(o))for(let a of o.arrayValue.values||[])r=r.add(new gs(t.indexId,e.key,this.encodeSingleElement(a),i))}else r=r.add(new gs(t.indexId,e.key,Yh,i));return r}updateEntries(e,t,r,i,s){D(d1,"Updating index entries for document '%s'",t.key);let o=[];return y3(i,s,Si,a=>{o.push(this.addIndexEntry(e,t,r,a))},a=>{o.push(this.deleteIndexEntry(e,t,r,a))}),m.waitFor(o)}getNextSequenceNumber(e){let t=1;return Yo(e).iterate({index:Z1,reverse:!0,range:IDBKeyRange.upperBound([this.uid,Number.MAX_SAFE_INTEGER])},(i,s,o)=>{o.done(),t=s.sequenceNumber+1}).next(()=>t)}createRange(e,t,r){r=r.sort((o,a)=>Si(o,a)).filter((o,a,l)=>!a||Si(o,l[a-1])!==0);let i=[];i.push(e);for(let o of r){let a=Si(o,e),l=Si(o,t);if(a===0)i[0]=e.successor();else if(a>0&&l<0)i.push(o),i.push(o.successor());else if(l>0)break}i.push(t);let s=[];for(let o=0;o<i.length;o+=2){if(this.isRangeMatchable(i[o],i[o+1]))return[];let a=[i[o].indexId,this.uid,i[o].arrayValue,i[o].directionalValue,Yh,[]],l=[i[o+1].indexId,this.uid,i[o+1].arrayValue,i[o+1].directionalValue,Yh,[]];s.push(IDBKeyRange.bound(a,l))}return s}isRangeMatchable(e,t){return Si(e,t)>0}getMinOffsetFromCollectionGroup(e,t){return this.getFieldIndexes(e,t).next(f1)}getMinOffset(e,t){return m.mapArray(this.getSubTargets(t),r=>this.getFieldIndex(e,r).next(i=>i||L())).next(f1)}};function h1(n){return lt(n,dc)}function Qo(n){return lt(n,y0)}function Zl(n){return lt(n,g0)}function Yo(n){return lt(n,m0)}function f1(n){q(n.length!==0);let e=n[0].indexState.offset,t=e.largestBatchId;for(let r=1;r<n.length;r++){let i=n[r].indexState.offset;h0(i,e)<0&&(e=i),t<i.largestBatchId&&(t=i.largestBatchId)}return new mn(e.readTime,e.documentKey,t)}function iN(n,e,t){let r=n.store(Nn),i=n.store(ba),s=[],o=IDBKeyRange.only(t.batchId),a=0,l=r.iterate({range:o},(u,d,h)=>(a++,h.delete()));s.push(l.next(()=>{q(a===1)}));let c=[];for(let u of t.mutations){let d=Y1(e,u.key.path,t.batchId);s.push(i.delete(d)),c.push(u.key)}return m.waitFor(s).next(()=>c)}function bf(n){if(!n)return 0;let e;if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else if(n.noDocument)e=n.noDocument;else throw L();return JSON.stringify(e).length}var Af=class n{constructor(e,t,r,i){this.userId=e,this.serializer=t,this.indexManager=r,this.referenceDelegate=i,this.documentKeysByBatchId={}}static forUser(e,t,r,i){q(e.uid!=="");let s=e.isAuthenticated()?e.uid:"";return new n(s,t,r,i)}checkEmpty(e){let t=!0,r=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return wi(e).iterate({index:ms,range:r},(i,s,o)=>{t=!1,o.done()}).next(()=>t)}addMutationBatch(e,t,r,i){let s=ta(e),o=wi(e);return o.add({}).next(a=>{q(typeof a=="number");let l=new _c(a,t,r,i),c=Hz(this.serializer,this.userId,l),u=[],d=new ye((h,p)=>X(h.canonicalString(),p.canonicalString()));for(let h of i){let p=Y1(this.userId,h.key.path,a);d=d.add(h.key.path.popLast()),u.push(o.put(c)),u.push(s.put(p,zU))}return d.forEach(h=>{u.push(this.indexManager.addToCollectionParentIndex(e,h))}),e.addOnCommittedListener(()=>{this.documentKeysByBatchId[a]=l.keys()}),m.waitFor(u).next(()=>l)})}lookupMutationBatch(e,t){return wi(e).get(t).next(r=>r?(q(r.userId===this.userId),fs(this.serializer,r)):null)}lookupMutationKeys(e,t){return this.documentKeysByBatchId[t]?m.resolve(this.documentKeysByBatchId[t]):this.lookupMutationBatch(e,t).next(r=>{if(r){let i=r.keys();return this.documentKeysByBatchId[t]=i,i}else return null})}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=IDBKeyRange.lowerBound([this.userId,r]),s=null;return wi(e).iterate({index:ms,range:i},(o,a,l)=>{a.userId===this.userId&&(q(a.batchId>=r),s=fs(this.serializer,a)),l.done()}).next(()=>s)}getHighestUnacknowledgedBatchId(e){let t=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),r=Ai;return wi(e).iterate({index:ms,range:t,reverse:!0},(i,s,o)=>{r=s.batchId,o.done()}).next(()=>r)}getAllMutationBatches(e){let t=IDBKeyRange.bound([this.userId,Ai],[this.userId,Number.POSITIVE_INFINITY]);return wi(e).loadAll(ms,t).next(r=>r.map(i=>fs(this.serializer,i)))}getAllMutationBatchesAffectingDocumentKey(e,t){let r=ef(this.userId,t.path),i=IDBKeyRange.lowerBound(r),s=[];return ta(e).iterate({range:i},(o,a,l)=>{let[c,u,d]=o,h=sr(u);if(c!==this.userId||!t.path.isEqual(h)){l.done();return}return wi(e).get(d).next(p=>{if(!p)throw L();q(p.userId===this.userId),s.push(fs(this.serializer,p))})}).next(()=>s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ye(X),i=[];return t.forEach(s=>{let o=ef(this.userId,s.path),a=IDBKeyRange.lowerBound(o),l=ta(e).iterate({range:a},(c,u,d)=>{let[h,p,y]=c,_=sr(p);if(h!==this.userId||!s.path.isEqual(_)){d.done();return}r=r.add(y)});i.push(l)}),m.waitFor(i).next(()=>this.lookupMutationBatches(e,r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=ef(this.userId,r),o=IDBKeyRange.lowerBound(s),a=new ye(X);return ta(e).iterate({range:o},(l,c,u)=>{let[d,h,p]=l,y=sr(h);if(d!==this.userId||!r.isPrefixOf(y)){u.done();return}y.length===i&&(a=a.add(p))}).next(()=>this.lookupMutationBatches(e,a))}lookupMutationBatches(e,t){let r=[],i=[];return t.forEach(s=>{i.push(wi(e).get(s).next(o=>{if(o===null)throw L();q(o.userId===this.userId),r.push(fs(this.serializer,o))}))}),m.waitFor(i).next(()=>r)}removeMutationBatch(e,t){return iN(e.simpleDbTransaction,this.userId,t).next(r=>(e.addOnCommittedListener(()=>{this.removeCachedMutationKeys(t.batchId)}),m.forEach(r,i=>this.referenceDelegate.markPotentiallyOrphaned(e,i))))}removeCachedMutationKeys(e){delete this.documentKeysByBatchId[e]}performConsistencyCheck(e){return this.checkEmpty(e).next(t=>{if(!t)return m.resolve();let r=IDBKeyRange.lowerBound(UU(this.userId)),i=[];return ta(e).iterate({range:r},(s,o,a)=>{if(s[0]!==this.userId){a.done();return}else{let c=sr(s[1]);i.push(c)}}).next(()=>{q(i.length===0)})})}containsKey(e,t){return sN(e,this.userId,t)}getMutationQueueMetadata(e){return oN(e).get(this.userId).next(t=>t||{userId:this.userId,lastAcknowledgedBatchId:Ai,lastStreamToken:""})}};function sN(n,e,t){let r=ef(e,t.path),i=r[1],s=IDBKeyRange.lowerBound(r),o=!1;return ta(n).iterate({range:s,keysOnly:!0},(a,l,c)=>{let[u,d,h]=a;u===e&&d===i&&(o=!0),c.done()}).next(()=>o)}function C6(n,e){let t=!1;return oN(n).iterateSerial(r=>sN(n,r,e).next(i=>(i&&(t=!0),m.resolve(!i)))).next(()=>t)}function wi(n){return lt(n,Nn)}function ta(n){return lt(n,ba)}function oN(n){return lt(n,Lc)}var s_=2,ma=class n{constructor(e){this.lastId=e}next(){return this.lastId+=s_,this.lastId}static forTargetCache(){return new n(2-s_)}static forSyncEngine(){return new n(1-s_)}};var iS=class{constructor(e,t){this.referenceDelegate=e,this.serializer=t}allocateTargetId(e){return this.retrieveMetadata(e).next(t=>{let r=new ma(t.highestTargetId);return t.highestTargetId=r.next(),this.saveMetadata(e,t).next(()=>t.highestTargetId)})}getLastRemoteSnapshotVersion(e){return this.retrieveMetadata(e).next(t=>j.fromTimestamp(new ke(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds)))}getHighestSequenceNumber(e){return this.retrieveMetadata(e).next(t=>t.highestListenSequenceNumber)}setTargetsMetadata(e,t,r){return this.retrieveMetadata(e).next(i=>(i.highestListenSequenceNumber=t,r&&(i.lastRemoteSnapshotVersion=r.toTimestamp()),t>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=t),this.saveMetadata(e,i)))}addTargetData(e,t){return this.saveTargetData(e,t).next(()=>this.retrieveMetadata(e).next(r=>(r.targetCount+=1,this.updateMetadataFromTargetData(t,r),this.saveMetadata(e,r))))}updateTargetData(e,t){return this.saveTargetData(e,t)}removeTargetData(e,t){return this.removeMatchingKeysForTargetId(e,t.targetId).next(()=>Xo(e).delete(t.targetId)).next(()=>this.retrieveMetadata(e)).next(r=>(q(r.targetCount>0),r.targetCount-=1,this.saveMetadata(e,r)))}removeTargets(e,t,r){let i=0,s=[];return Xo(e).iterate((o,a)=>{let l=rc(a);l.sequenceNumber<=t&&r.get(l.targetId)===null&&(i++,s.push(this.removeTargetData(e,l)))}).next(()=>m.waitFor(s)).next(()=>i)}forEachTarget(e,t){return Xo(e).iterate((r,i)=>{let s=rc(i);t(s)})}retrieveMetadata(e){return p1(e).get(hf).next(t=>(q(t!==null),t))}saveMetadata(e,t){return p1(e).put(hf,t)}saveTargetData(e,t){return Xo(e).put(eN(this.serializer,t))}updateMetadataFromTargetData(e,t){let r=!1;return e.targetId>t.highestTargetId&&(t.highestTargetId=e.targetId,r=!0),e.sequenceNumber>t.highestListenSequenceNumber&&(t.highestListenSequenceNumber=e.sequenceNumber,r=!0),r}getTargetCount(e){return this.retrieveMetadata(e).next(t=>t.targetCount)}getTargetData(e,t){let r=bs(t),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),s=null;return Xo(e).iterate({range:i,index:J1},(o,a,l)=>{let c=rc(a);qc(t,c.target)&&(s=c,l.done())}).next(()=>s)}addMatchingKeys(e,t,r){let i=[],s=Ti(e);return t.forEach(o=>{let a=Pt(o.path);i.push(s.put({targetId:r,path:a})),i.push(this.referenceDelegate.addReference(e,r,o))}),m.waitFor(i)}removeMatchingKeys(e,t,r){let i=Ti(e);return m.forEach(t,s=>{let o=Pt(s.path);return m.waitFor([i.delete([r,o]),this.referenceDelegate.removeReference(e,r,s)])})}removeMatchingKeysForTargetId(e,t){let r=Ti(e),i=IDBKeyRange.bound([t],[t+1],!1,!0);return r.delete(i)}getMatchingKeysForTargetId(e,t){let r=IDBKeyRange.bound([t],[t+1],!1,!0),i=Ti(e),s=J();return i.iterate({range:r,keysOnly:!0},(o,a,l)=>{let c=sr(o[1]),u=new O(c);s=s.add(u)}).next(()=>s)}containsKey(e,t){let r=Pt(t.path),i=IDBKeyRange.bound([r],[z1(r)],!1,!0),s=0;return Ti(e).iterate({index:p0,keysOnly:!0,range:i},([o,a],l,c)=>{o!==0&&(s++,c.done())}).next(()=>s>0)}getTargetDataForTarget(e,t){return Xo(e).get(t).next(r=>r?rc(r):null)}};function Xo(n){return lt(n,Aa)}function p1(n){return lt(n,xs)}function Ti(n){return lt(n,Ia)}var g1={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},jc=-1,aN=40*1024*1024,pn=class n{constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}static withCacheSize(e){return new n(e,n.DEFAULT_COLLECTION_PERCENTILE,n.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}};pn.DEFAULT_COLLECTION_PERCENTILE=10;pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3;pn.DEFAULT=new pn(aN,pn.DEFAULT_COLLECTION_PERCENTILE,pn.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT);pn.DISABLED=new pn(jc,0,0);var m1="LruGarbageCollector",y1=1*1024*1024,b6=1*60*1e3,A6=5*60*1e3;function v1([n,e],[t,r]){let i=X(n,t);return i===0?X(e,r):i}var sS=class{constructor(e){this.maxElements=e,this.buffer=new ye(v1),this.previousIndex=0}nextIndex(){return++this.previousIndex}addElement(e){let t=[e,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(t);else{let r=this.buffer.last();v1(t,r)<0&&(this.buffer=this.buffer.delete(r).add(t))}}get maxValue(){return this.buffer.last()[0]}},oS=class{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.gcTask=null}start(){this.garbageCollector.params.cacheSizeCollectionThreshold!==jc&&this.scheduleGC(b6)}stop(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)}get started(){return this.gcTask!==null}scheduleGC(e){D(m1,`Garbage collection scheduled in ${e}ms`),this.gcTask=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,()=>g(this,null,function*(){this.gcTask=null;try{yield this.localStore.collectGarbage(this.garbageCollector)}catch(t){qi(t)?D(m1,"Ignoring IndexedDB error during garbage collection: ",t):yield Vi(t)}yield this.scheduleGC(A6)}))}},aS=class{constructor(e,t){this.delegate=e,this.params=t}calculateTargetCount(e,t){return this.delegate.getSequenceNumberCount(e).next(r=>Math.floor(t/100*r))}nthSequenceNumber(e,t){if(t===0)return m.resolve(Xt.INVALID);let r=new sS(t);return this.delegate.forEachTarget(e,i=>r.addElement(i.sequenceNumber)).next(()=>this.delegate.forEachOrphanedDocumentSequenceNumber(e,i=>r.addElement(i))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.delegate.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.delegate.removeOrphanedDocuments(e,t)}collect(e,t){return this.params.cacheSizeCollectionThreshold===jc?(D("LruGarbageCollector","Garbage collection skipped; disabled"),m.resolve(g1)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(D("LruGarbageCollector",`Garbage collection skipped; Cache size ${r} is lower than threshold ${this.params.cacheSizeCollectionThreshold}`),g1):this.runGarbageCollection(e,t))}getCacheSize(e){return this.delegate.getCacheSize(e)}runGarbageCollection(e,t){let r,i,s,o,a,l,c,u=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(d=>(d>this.params.maximumSequenceNumbersToCollect?(D("LruGarbageCollector",`Capping sequence numbers to collect down to the maximum of ${this.params.maximumSequenceNumbersToCollect} from ${d}`),i=this.params.maximumSequenceNumbersToCollect):i=d,o=Date.now(),this.nthSequenceNumber(e,i))).next(d=>(r=d,a=Date.now(),this.removeTargets(e,r,t))).next(d=>(s=d,l=Date.now(),this.removeOrphanedDocuments(e,r))).next(d=>{if(c=Date.now(),Jo()<=Ln.DEBUG){let h=`LRU Garbage Collection
	Counted targets in ${o-u}ms
	Determined least recently used ${i} in ${a-o}ms
	Removed ${s} targets in ${l-a}ms
	Removed ${d} documents in ${c-l}ms
Total Duration: ${c-u}ms`;D("LruGarbageCollector",h)}return m.resolve({didRun:!0,sequenceNumbersCollected:i,targetsRemoved:s,documentsRemoved:d})})}};function I6(n,e){return new aS(n,e)}var lS=class{constructor(e,t){this.db=e,this.garbageCollector=I6(this,t)}getSequenceNumberCount(e){let t=this.orphanedDocumentCount(e);return this.db.getTargetCache().getTargetCount(e).next(i=>t.next(s=>i+s))}orphanedDocumentCount(e){let t=0;return this.forEachOrphanedDocumentSequenceNumber(e,r=>{t++}).next(()=>t)}forEachTarget(e,t){return this.db.getTargetCache().forEachTarget(e,t)}forEachOrphanedDocumentSequenceNumber(e,t){return this.forEachOrphanedDocument(e,(r,i)=>t(i))}addReference(e,t,r){return Xh(e,r)}removeReference(e,t,r){return Xh(e,r)}removeTargets(e,t,r){return this.db.getTargetCache().removeTargets(e,t,r)}markPotentiallyOrphaned(e,t){return Xh(e,t)}isPinned(e,t){return C6(e,t)}removeOrphanedDocuments(e,t){let i=this.db.getRemoteDocumentCache().newChangeBuffer(),s=[],o=0;return this.forEachOrphanedDocument(e,(l,c)=>{if(c<=t){let u=this.isPinned(e,l).next(d=>{if(!d)return o++,i.getEntry(e,l).next(()=>(i.removeEntry(l,j.min()),Ti(e).delete(D6(l))))});s.push(u)}}).next(()=>m.waitFor(s)).next(()=>i.apply(e)).next(()=>o)}removeTarget(e,t){let r=t.withSequenceNumber(e.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(e,r)}updateLimboDocument(e,t){return Xh(e,t)}forEachOrphanedDocument(e,t){let r=Ti(e),i=Xt.INVALID,s;return r.iterate({index:p0},([o,a],{path:l,sequenceNumber:c})=>{o===0?(i!==Xt.INVALID&&t(new O(sr(s)),i),i=c,s=l):i=Xt.INVALID}).next(()=>{i!==Xt.INVALID&&t(new O(sr(s)),i)})}getCacheSize(e){return this.db.getRemoteDocumentCache().getSize(e)}};function D6(n){return[0,Pt(n.path)]}function R6(n,e){return{targetId:0,path:Pt(n.path),sequenceNumber:e}}function Xh(n,e){return Ti(n).put(R6(e,n.currentSequenceNumber))}var If=class{constructor(){this.changes=new ur(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,Ye.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();let r=this.changes.get(t);return r!==void 0?m.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}};var cS=class{constructor(e){this.serializer=e}setIndexManager(e){this.indexManager=e}addEntry(e,t,r){return us(e).put(r)}removeEntry(e,t,r){return us(e).delete(N6(t,r))}updateMetadata(e,t){return this.getMetadata(e).next(r=>(r.byteSize+=t,this.setMetadata(e,r)))}getEntry(e,t){let r=Ye.newInvalidDocument(t);return us(e).iterate({index:tf,range:IDBKeyRange.only(ec(t))},(i,s)=>{r=this.maybeDecodeDocument(t,s)}).next(()=>r)}getSizedEntry(e,t){let r={size:0,document:Ye.newInvalidDocument(t)};return us(e).iterate({index:tf,range:IDBKeyRange.only(ec(t))},(i,s)=>{r={document:this.maybeDecodeDocument(t,s),size:bf(s)}}).next(()=>r)}getEntries(e,t){let r=Gt();return this.forEachDbEntry(e,t,(i,s)=>{let o=this.maybeDecodeDocument(i,s);r=r.insert(i,o)}).next(()=>r)}getSizedEntries(e,t){let r=Gt(),i=new Ce(O.comparator);return this.forEachDbEntry(e,t,(s,o)=>{let a=this.maybeDecodeDocument(s,o);r=r.insert(s,a),i=i.insert(s,bf(o))}).next(()=>({documents:r,sizeMap:i}))}forEachDbEntry(e,t,r){if(t.isEmpty())return m.resolve();let i=new ye(w1);t.forEach(l=>i=i.add(l));let s=IDBKeyRange.bound(ec(i.first()),ec(i.last())),o=i.getIterator(),a=o.getNext();return us(e).iterate({index:tf,range:s},(l,c,u)=>{let d=O.fromSegments([...c.prefixPath,c.collectionGroup,c.documentId]);for(;a&&w1(a,d)<0;)r(a,null),a=o.getNext();a&&a.isEqual(d)&&(r(a,c),a=o.hasNext()?o.getNext():null),a?u.skip(ec(a)):u.done()}).next(()=>{for(;a;)r(a,null),a=o.hasNext()?o.getNext():null})}getDocumentsMatchingQuery(e,t,r,i,s){let o=t.path,a=[o.popLast().toArray(),o.lastSegment(),op(r.readTime),r.documentKey.path.isEmpty()?"":r.documentKey.path.lastSegment()],l=[o.popLast().toArray(),o.lastSegment(),[Number.MAX_SAFE_INTEGER,Number.MAX_SAFE_INTEGER],""];return us(e).loadAll(IDBKeyRange.bound(a,l,!0)).next(c=>{s?.incrementDocumentReadCount(c.length);let u=Gt();for(let d of c){let h=this.maybeDecodeDocument(O.fromSegments(d.prefixPath.concat(d.collectionGroup,d.documentId)),d);h.isFoundDocument()&&(zc(t,h)||i.has(h.key))&&(u=u.insert(h.key,h))}return u})}getAllFromCollectionGroup(e,t,r,i){let s=Gt(),o=S1(t,r),a=S1(t,mn.max());return us(e).iterate({index:X1,range:IDBKeyRange.bound(o,a,!0)},(l,c,u)=>{let d=this.maybeDecodeDocument(O.fromSegments(c.prefixPath.concat(c.collectionGroup,c.documentId)),c);s=s.insert(d.key,d),s.size===i&&u.done()}).next(()=>s)}newChangeBuffer(e){return new uS(this,!!e&&e.trackRemovals)}getSize(e){return this.getMetadata(e).next(t=>t.byteSize)}getMetadata(e){return _1(e).get(b_).next(t=>(q(!!t),t))}setMetadata(e,t){return _1(e).put(b_,t)}maybeDecodeDocument(e,t){if(t){let r=jz(this.serializer,t);if(!(r.isNoDocument()&&r.version.isEqual(j.min())))return r}return Ye.newInvalidDocument(e)}};function lN(n){return new cS(n)}var uS=class extends If{constructor(e,t){super(),this.documentCache=e,this.trackRemovals=t,this.documentStates=new ur(r=>r.toString(),(r,i)=>r.isEqual(i))}applyChanges(e){let t=[],r=0,i=new ye((s,o)=>X(s.canonicalString(),o.canonicalString()));return this.changes.forEach((s,o)=>{let a=this.documentStates.get(s);if(t.push(this.documentCache.removeEntry(e,s,a.readTime)),o.isValidDocument()){let l=XD(this.documentCache.serializer,o);i=i.add(s.path.popLast());let c=bf(l);r+=c-a.size,t.push(this.documentCache.addEntry(e,s,l))}else if(r-=a.size,this.trackRemovals){let l=XD(this.documentCache.serializer,o.convertToNoDocument(j.min()));t.push(this.documentCache.addEntry(e,s,l))}}),i.forEach(s=>{t.push(this.documentCache.indexManager.addToCollectionParentIndex(e,s))}),t.push(this.documentCache.updateMetadata(e,r)),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getSizedEntry(e,t).next(r=>(this.documentStates.set(t,{size:r.size,readTime:r.document.readTime}),r.document))}getAllFromCache(e,t){return this.documentCache.getSizedEntries(e,t).next(({documents:r,sizeMap:i})=>(i.forEach((s,o)=>{this.documentStates.set(s,{size:o,readTime:r.get(s).readTime})}),r))}};function _1(n){return lt(n,Bc)}function us(n){return lt(n,Zf)}function ec(n){let e=n.path.toArray();return[e.slice(0,e.length-2),e[e.length-2],e[e.length-1]]}function N6(n,e){let t=n.path.toArray();return[t.slice(0,t.length-2),t[t.length-2],op(e),t[t.length-1]]}function S1(n,e){let t=e.documentKey.path.toArray();return[n,op(e.readTime),t.slice(0,t.length-2),t.length>0?t[t.length-1]:""]}function w1(n,e){let t=n.path.toArray(),r=e.path.toArray(),i=0;for(let s=0;s<t.length-2&&s<r.length-2;++s)if(i=X(t[s],r[s]),i)return i;return i=X(t.length,r.length),i||(i=X(t[t.length-2],r[r.length-2]),i)?i:X(t[t.length-1],r[r.length-1])}var k6=15;var dS=class{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}};var Df=class{constructor(e,t,r,i){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=i}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(i=>(r=i,this.remoteDocumentCache.getEntry(e,t))).next(i=>(r!==null&&ac(r.mutation,i,Jt.empty(),ke.now()),i))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.getLocalViewOfDocuments(e,r,J()).next(()=>r))}getLocalViewOfDocuments(e,t,r=J()){let i=or();return this.populateOverlays(e,i,t).next(()=>this.computeViews(e,t,i,r).next(s=>{let o=nc();return s.forEach((a,l)=>{o=o.insert(a,l.overlayedDocument)}),o}))}getOverlayedDocuments(e,t){let r=or();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,J()))}populateOverlays(e,t,r){let i=[];return r.forEach(s=>{t.has(s)||i.push(s)}),this.documentOverlayCache.getOverlays(e,i).next(s=>{s.forEach((o,a)=>{t.set(o,a)})})}computeViews(e,t,r,i){let s=Gt(),o=yc(),a=T4();return t.forEach((l,c)=>{let u=r.get(c.key);i.has(c.key)&&(u===void 0||u.mutation instanceof On)?s=s.insert(c.key,c):u!==void 0?(o.set(c.key,u.mutation.getFieldMask()),ac(u.mutation,c,u.mutation.getFieldMask(),ke.now())):o.set(c.key,Jt.empty())}),this.recalculateAndSaveOverlays(e,s).next(l=>(l.forEach((c,u)=>o.set(c,u)),t.forEach((c,u)=>{var d;return a.set(c,new dS(u,(d=o.get(c))!==null&&d!==void 0?d:null))}),a))}recalculateAndSaveOverlays(e,t){let r=yc(),i=new Ce((o,a)=>o-a),s=J();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(o=>{for(let a of o)a.keys().forEach(l=>{let c=t.get(l);if(c===null)return;let u=r.get(l)||Jt.empty();u=a.applyToLocalView(c,u),r.set(l,u);let d=(i.get(a.batchId)||J()).add(l);i=i.insert(a.batchId,d)})}).next(()=>{let o=[],a=i.getReverseIterator();for(;a.hasNext();){let l=a.getNext(),c=l.key,u=l.value,d=RR();u.forEach(h=>{if(!s.has(h)){let p=LR(t.get(h),r.get(h));p!==null&&d.set(h,p),s=s.add(h)}}),o.push(this.documentOverlayCache.saveOverlays(e,c,d))}return m.waitFor(o)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(r=>this.recalculateAndSaveOverlays(e,r))}getDocumentsMatchingQuery(e,t,r,i){return h4(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):w0(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,i):this.getDocumentsMatchingCollectionQuery(e,t,r,i)}getNextDocuments(e,t,r,i){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,i).next(s=>{let o=i-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,i-s.size):m.resolve(or()),a=aa,l=s;return o.next(c=>m.forEach(c,(u,d)=>(a<d.largestBatchId&&(a=d.largestBatchId),s.get(u)?m.resolve():this.remoteDocumentCache.getEntry(e,u).next(h=>{l=l.insert(u,h)}))).next(()=>this.populateOverlays(e,c,s)).next(()=>this.computeViews(e,l,c,J())).next(u=>({batchId:a,changes:DR(u)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new O(t)).next(r=>{let i=nc();return r.isFoundDocument()&&(i=i.insert(r.key,r)),i})}getDocumentsMatchingCollectionGroupQuery(e,t,r,i){let s=t.collectionGroup,o=nc();return this.indexManager.getCollectionParents(e,s).next(a=>m.forEach(a,l=>{let c=c4(t,l.child(s));return this.getDocumentsMatchingCollectionQuery(e,c,r,i).next(u=>{u.forEach((d,h)=>{o=o.insert(d,h)})})}).next(()=>o))}getDocumentsMatchingCollectionQuery(e,t,r,i){let s;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(o=>(s=o,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,s,i))).next(o=>{s.forEach((l,c)=>{let u=c.getKey();o.get(u)===null&&(o=o.insert(u,Ye.newInvalidDocument(u)))});let a=nc();return o.forEach((l,c)=>{let u=s.get(l);u!==void 0&&ac(u.mutation,c,Jt.empty(),ke.now()),zc(t,c)&&(a=a.insert(l,c))}),a})}};var hS=class{constructor(e){this.serializer=e,this.bundles=new Map,this.namedQueries=new Map}getBundleMetadata(e,t){return m.resolve(this.bundles.get(t))}saveBundleMetadata(e,t){return this.bundles.set(t.id,Jz(t)),m.resolve()}getNamedQuery(e,t){return m.resolve(this.namedQueries.get(t))}saveNamedQuery(e,t){return this.namedQueries.set(t.name,Xz(t)),m.resolve()}};var fS=class{constructor(){this.overlays=new Ce(O.comparator),this.overlayByBatchId=new Map}getOverlay(e,t){return m.resolve(this.overlays.get(t))}getOverlays(e,t){let r=or();return m.forEach(t,i=>this.getOverlay(e,i).next(s=>{s!==null&&r.set(i,s)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((i,s)=>{this.saveOverlay(e,t,s)}),m.resolve()}removeOverlaysForBatchId(e,t,r){let i=this.overlayByBatchId.get(r);return i!==void 0&&(i.forEach(s=>this.overlays=this.overlays.remove(s)),this.overlayByBatchId.delete(r)),m.resolve()}getOverlaysForCollection(e,t,r){let i=or(),s=t.length+1,o=new O(t.child("")),a=this.overlays.getIteratorFrom(o);for(;a.hasNext();){let c=a.getNext().value,u=c.getKey();if(!t.isPrefixOf(u.path))break;u.path.length===s&&c.largestBatchId>r&&i.set(c.getKey(),c)}return m.resolve(i)}getOverlaysForCollectionGroup(e,t,r,i){let s=new Ce((c,u)=>c-u),o=this.overlays.getIterator();for(;o.hasNext();){let u=o.getNext().value;if(u.getKey().getCollectionGroup()===t&&u.largestBatchId>r){let h=s.get(u.largestBatchId);h===null&&(h=or(),s=s.insert(u.largestBatchId,h)),h.set(u.getKey(),u)}}let a=or(),l=s.getIterator();for(;l.hasNext()&&(l.getNext().value.forEach((d,h)=>a.set(d,h)),!(a.size()>=i)););return m.resolve(a)}saveOverlay(e,t,r){let i=this.overlays.get(r.key);if(i!==null){let o=this.overlayByBatchId.get(i.largestBatchId).delete(r.key);this.overlayByBatchId.set(i.largestBatchId,o)}this.overlays=this.overlays.insert(r.key,new Sc(t,r));let s=this.overlayByBatchId.get(t);s===void 0&&(s=J(),this.overlayByBatchId.set(t,s)),this.overlayByBatchId.set(t,s.add(r.key))}};var Ic=class{constructor(){this.refsByKey=new ye(Qe.compareByKey),this.refsByTarget=new ye(Qe.compareByTargetId)}isEmpty(){return this.refsByKey.isEmpty()}addReference(e,t){let r=new Qe(e,t);this.refsByKey=this.refsByKey.add(r),this.refsByTarget=this.refsByTarget.add(r)}addReferences(e,t){e.forEach(r=>this.addReference(r,t))}removeReference(e,t){this.removeRef(new Qe(e,t))}removeReferences(e,t){e.forEach(r=>this.removeReference(r,t))}removeReferencesForId(e){let t=new O(new ue([])),r=new Qe(t,e),i=new Qe(t,e+1),s=[];return this.refsByTarget.forEachInRange([r,i],o=>{this.removeRef(o),s.push(o.key)}),s}removeAllReferences(){this.refsByKey.forEach(e=>this.removeRef(e))}removeRef(e){this.refsByKey=this.refsByKey.delete(e),this.refsByTarget=this.refsByTarget.delete(e)}referencesForId(e){let t=new O(new ue([])),r=new Qe(t,e),i=new Qe(t,e+1),s=J();return this.refsByTarget.forEachInRange([r,i],o=>{s=s.add(o.key)}),s}containsKey(e){let t=new Qe(e,0),r=this.refsByKey.firstAfterOrEqual(t);return r!==null&&e.isEqual(r.key)}},Qe=class{constructor(e,t){this.key=e,this.targetOrBatchId=t}static compareByKey(e,t){return O.comparator(e.key,t.key)||X(e.targetOrBatchId,t.targetOrBatchId)}static compareByTargetId(e,t){return X(e.targetOrBatchId,t.targetOrBatchId)||O.comparator(e.key,t.key)}};var pS=class{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.nextBatchId=1,this.batchesByDocumentKey=new ye(Qe.compareByKey)}checkEmpty(e){return m.resolve(this.mutationQueue.length===0)}addMutationBatch(e,t,r,i){let s=this.nextBatchId;this.nextBatchId++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];let o=new _c(s,t,r,i);this.mutationQueue.push(o);for(let a of i)this.batchesByDocumentKey=this.batchesByDocumentKey.add(new Qe(a.key,s)),this.indexManager.addToCollectionParentIndex(e,a.key.path.popLast());return m.resolve(o)}lookupMutationBatch(e,t){return m.resolve(this.findMutationBatch(t))}getNextMutationBatchAfterBatchId(e,t){let r=t+1,i=this.indexOfBatchId(r),s=i<0?0:i;return m.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return m.resolve(this.mutationQueue.length===0?Ai:this.nextBatchId-1)}getAllMutationBatches(e){return m.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){let r=new Qe(t,0),i=new Qe(t,Number.POSITIVE_INFINITY),s=[];return this.batchesByDocumentKey.forEachInRange([r,i],o=>{let a=this.findMutationBatch(o.targetOrBatchId);s.push(a)}),m.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new ye(X);return t.forEach(i=>{let s=new Qe(i,0),o=new Qe(i,Number.POSITIVE_INFINITY);this.batchesByDocumentKey.forEachInRange([s,o],a=>{r=r.add(a.targetOrBatchId)})}),m.resolve(this.findMutationBatches(r))}getAllMutationBatchesAffectingQuery(e,t){let r=t.path,i=r.length+1,s=r;O.isDocumentKey(s)||(s=s.child(""));let o=new Qe(new O(s),0),a=new ye(X);return this.batchesByDocumentKey.forEachWhile(l=>{let c=l.key.path;return r.isPrefixOf(c)?(c.length===i&&(a=a.add(l.targetOrBatchId)),!0):!1},o),m.resolve(this.findMutationBatches(a))}findMutationBatches(e){let t=[];return e.forEach(r=>{let i=this.findMutationBatch(r);i!==null&&t.push(i)}),t}removeMutationBatch(e,t){let r=this.indexOfExistingBatchId(t.batchId,"removed");q(r===0),this.mutationQueue.shift();let i=this.batchesByDocumentKey;return m.forEach(t.mutations,s=>{let o=new Qe(s.key,t.batchId);return i=i.delete(o),this.referenceDelegate.markPotentiallyOrphaned(e,s.key)}).next(()=>{this.batchesByDocumentKey=i})}removeCachedMutationKeys(e){}containsKey(e,t){let r=new Qe(t,0),i=this.batchesByDocumentKey.firstAfterOrEqual(r);return m.resolve(t.isEqual(i&&i.key))}performConsistencyCheck(e){return this.mutationQueue.length,m.resolve()}indexOfExistingBatchId(e,t){return this.indexOfBatchId(e)}indexOfBatchId(e){if(this.mutationQueue.length===0)return 0;let t=this.mutationQueue[0].batchId;return e-t}findMutationBatch(e){let t=this.indexOfBatchId(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}};function M6(){return new Ce(O.comparator)}var gS=class{constructor(e){this.sizer=e,this.docs=M6(),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){let r=t.key,i=this.docs.get(r),s=i?i.size:0,o=this.sizer(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:o}),this.size+=o-s,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){let t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){let r=this.docs.get(t);return m.resolve(r?r.document.mutableCopy():Ye.newInvalidDocument(t))}getEntries(e,t){let r=Gt();return t.forEach(i=>{let s=this.docs.get(i);r=r.insert(i,s?s.document.mutableCopy():Ye.newInvalidDocument(i))}),m.resolve(r)}getDocumentsMatchingQuery(e,t,r,i){let s=Gt(),o=t.path,a=new O(o.child("")),l=this.docs.getIteratorFrom(a);for(;l.hasNext();){let{key:c,value:{document:u}}=l.getNext();if(!o.isPrefixOf(c.path))break;c.path.length>o.length+1||h0(G1(u),r)<=0||!i.has(u.key)&&!zc(t,u)||(s=s.insert(u.key,u.mutableCopy()))}return m.resolve(s)}getAllFromCollectionGroup(e,t,r,i){L()}forEachDocumentKey(e,t){return m.forEach(this.docs,r=>t(r))}newChangeBuffer(e){return new mS(this)}getSize(e){return m.resolve(this.size)}};function O6(n){return new gS(n)}var mS=class extends If{constructor(e){super(),this.documentCache=e}applyChanges(e){let t=[];return this.changes.forEach((r,i)=>{i.isValidDocument()?t.push(this.documentCache.addEntry(e,i)):this.documentCache.removeEntry(r)}),m.waitFor(t)}getFromCache(e,t){return this.documentCache.getEntry(e,t)}getAllFromCache(e,t){return this.documentCache.getEntries(e,t)}};var yS=class{constructor(e){this.persistence=e,this.targets=new ur(t=>bs(t),qc),this.lastRemoteSnapshotVersion=j.min(),this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new Ic,this.targetCount=0,this.targetIdGenerator=ma.forTargetCache()}forEachTarget(e,t){return this.targets.forEach((r,i)=>t(i)),m.resolve()}getLastRemoteSnapshotVersion(e){return m.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return m.resolve(this.highestSequenceNumber)}allocateTargetId(e){return this.highestTargetId=this.targetIdGenerator.next(),m.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.highestSequenceNumber&&(this.highestSequenceNumber=t),m.resolve()}saveTargetData(e){this.targets.set(e.target,e);let t=e.targetId;t>this.highestTargetId&&(this.targetIdGenerator=new ma(t),this.highestTargetId=t),e.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=e.sequenceNumber)}addTargetData(e,t){return this.saveTargetData(t),this.targetCount+=1,m.resolve()}updateTargetData(e,t){return this.saveTargetData(t),m.resolve()}removeTargetData(e,t){return this.targets.delete(t.target),this.references.removeReferencesForId(t.targetId),this.targetCount-=1,m.resolve()}removeTargets(e,t,r){let i=0,s=[];return this.targets.forEach((o,a)=>{a.sequenceNumber<=t&&r.get(a.targetId)===null&&(this.targets.delete(o),s.push(this.removeMatchingKeysForTargetId(e,a.targetId)),i++)}),m.waitFor(s).next(()=>i)}getTargetCount(e){return m.resolve(this.targetCount)}getTargetData(e,t){let r=this.targets.get(t)||null;return m.resolve(r)}addMatchingKeys(e,t,r){return this.references.addReferences(t,r),m.resolve()}removeMatchingKeys(e,t,r){this.references.removeReferences(t,r);let i=this.persistence.referenceDelegate,s=[];return i&&t.forEach(o=>{s.push(i.markPotentiallyOrphaned(e,o))}),m.waitFor(s)}removeMatchingKeysForTargetId(e,t){return this.references.removeReferencesForId(t),m.resolve()}getMatchingKeysForTargetId(e,t){let r=this.references.referencesForId(t);return m.resolve(r)}containsKey(e,t){return m.resolve(this.references.containsKey(t))}};var x6="MemoryPersistence",Rf=class{constructor(e,t){this.mutationQueues={},this.overlays={},this.listenSequence=new Xt(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.targetCache=new yS(this);let r=i=>this.referenceDelegate.documentSize(i);this.indexManager=new nS,this.remoteDocumentCache=O6(r),this.serializer=new wf(t),this.bundleCache=new hS(this.serializer)}start(){return Promise.resolve()}shutdown(){return this._started=!1,Promise.resolve()}get started(){return this._started}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new fS,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.mutationQueues[e.toKey()];return r||(r=new pS(t,this.referenceDelegate),this.mutationQueues[e.toKey()]=r),r}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){D(x6,"Starting transaction:",e);let i=new vS(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),r(i).next(s=>this.referenceDelegate.onTransactionCommitted(i).next(()=>s)).toPromise().then(s=>(i.raiseOnCommittedEvent(),s))}mutationQueuesContainKey(e,t){return m.or(Object.values(this.mutationQueues).map(r=>()=>r.containsKey(e,t)))}},vS=class extends uf{constructor(e){super(),this.currentSequenceNumber=e}},Nf=class n{constructor(e){this.persistence=e,this.localViewReferences=new Ic,this._orphanedDocuments=null}static factory(e){return new n(e)}get orphanedDocuments(){if(this._orphanedDocuments)return this._orphanedDocuments;throw L()}addReference(e,t,r){return this.localViewReferences.addReference(r,t),this.orphanedDocuments.delete(r.toString()),m.resolve()}removeReference(e,t,r){return this.localViewReferences.removeReference(r,t),this.orphanedDocuments.add(r.toString()),m.resolve()}markPotentiallyOrphaned(e,t){return this.orphanedDocuments.add(t.toString()),m.resolve()}removeTarget(e,t){this.localViewReferences.removeReferencesForId(t.targetId).forEach(s=>this.orphanedDocuments.add(s.toString()));let i=this.persistence.getTargetCache();return i.getMatchingKeysForTargetId(e,t.targetId).next(s=>{s.forEach(o=>this.orphanedDocuments.add(o.toString()))}).next(()=>i.removeTargetData(e,t))}onTransactionStarted(){this._orphanedDocuments=new Set}onTransactionCommitted(e){let r=this.persistence.getRemoteDocumentCache().newChangeBuffer();return m.forEach(this.orphanedDocuments,i=>{let s=O.fromPath(i);return this.isReferenced(e,s).next(o=>{o||r.removeEntry(s,j.min())})}).next(()=>(this._orphanedDocuments=null,r.apply(e)))}updateLimboDocument(e,t){return this.isReferenced(e,t).next(r=>{r?this.orphanedDocuments.delete(t.toString()):this.orphanedDocuments.add(t.toString())})}documentSize(e){return 0}isReferenced(e,t){return m.or([()=>m.resolve(this.localViewReferences.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.mutationQueuesContainKey(e,t)])}};var _S=class{constructor(e){this.serializer=e}createOrUpgrade(e,t,r,i){let s=new df("createOrUpgrade",t);r<1&&i>=1&&(F6(e),L6(e),E1(e),V6(e));let o=m.resolve();return r<3&&i>=3&&(r!==0&&(z6(e),E1(e)),o=o.next(()=>G6(s))),r<4&&i>=4&&(r!==0&&(o=o.next(()=>B6(e,s))),o=o.next(()=>{H6(e)})),r<5&&i>=5&&(o=o.next(()=>this.removeAcknowledgedMutations(s))),r<6&&i>=6&&(o=o.next(()=>(U6(e),this.addDocumentGlobal(s)))),r<7&&i>=7&&(o=o.next(()=>this.ensureSequenceNumbers(s))),r<8&&i>=8&&(o=o.next(()=>this.createCollectionParentIndex(e,s))),r<9&&i>=9&&(o=o.next(()=>{j6(e)})),r<10&&i>=10&&(o=o.next(()=>this.rewriteCanonicalIds(s))),r<11&&i>=11&&(o=o.next(()=>{K6(e),W6(e)})),r<12&&i>=12&&(o=o.next(()=>{Q6(e)})),r<13&&i>=13&&(o=o.next(()=>q6(e)).next(()=>this.rewriteRemoteDocumentCache(e,s)).next(()=>e.deleteObjectStore(hs))),r<14&&i>=14&&(o=o.next(()=>this.runOverlayMigration(e,s))),r<15&&i>=15&&(o=o.next(()=>$6(e))),o}addDocumentGlobal(e){let t=0;return e.store(hs).iterate((r,i)=>{t+=bf(i)}).next(()=>{let r={byteSize:t};return e.store(Bc).put(b_,r)})}removeAcknowledgedMutations(e){let t=e.store(Lc),r=e.store(Nn);return t.loadAll().next(i=>m.forEach(i,s=>{let o=IDBKeyRange.bound([s.userId,Ai],[s.userId,s.lastAcknowledgedBatchId]);return r.loadAll(ms,o).next(a=>m.forEach(a,l=>{q(l.userId===s.userId);let c=fs(this.serializer,l);return iN(e,s.userId,c).next(()=>{})}))}))}ensureSequenceNumbers(e){let t=e.store(Ia),r=e.store(hs);return e.store(xs).get(hf).next(s=>{let o=l=>t.put({targetId:0,path:Pt(l),sequenceNumber:s.highestListenSequenceNumber}),a=[];return r.iterate((l,c)=>{let u=new ue(l),d=P6(u);a.push(t.get(d).next(h=>h?m.resolve():o(u)))}).next(()=>m.waitFor(a))})}createCollectionParentIndex(e,t){e.createObjectStore(dc,{keyPath:YU});let r=t.store(dc),i=new Ac,s=o=>{if(i.add(o)){let a=o.lastSegment(),l=o.popLast();return r.put({collectionId:a,parent:Pt(l)})}};return t.store(hs).iterate({keysOnly:!0},(o,a)=>{let l=new ue(o);return s(l.popLast())}).next(()=>t.store(ba).iterate({keysOnly:!0},([o,a,l],c)=>{let u=sr(a);return s(u.popLast())}))}rewriteCanonicalIds(e){let t=e.store(Aa);return t.iterate((r,i)=>{let s=rc(i),o=eN(this.serializer,s);return t.put(o)})}rewriteRemoteDocumentCache(e,t){let r=t.store(hs),i=[];return r.iterate((s,o)=>{let a=t.store(Zf),l=Y6(o).path.toArray(),c={prefixPath:l.slice(0,l.length-2),collectionGroup:l[l.length-2],documentId:l[l.length-1],readTime:o.readTime||[0,0],unknownDocument:o.unknownDocument,noDocument:o.noDocument,document:o.document,hasCommittedMutations:!!o.hasCommittedMutations};i.push(a.put(c))}).next(()=>m.waitFor(i))}runOverlayMigration(e,t){let r=t.store(Nn),i=lN(this.serializer),s=new Rf(Nf.factory,this.serializer.remoteSerializer);return r.loadAll().next(o=>{let a=new Map;return o.forEach(l=>{var c;let u=(c=a.get(l.userId))!==null&&c!==void 0?c:J();fs(this.serializer,l).keys().forEach(h=>u=u.add(h)),a.set(l.userId,u)}),m.forEach(a,(l,c)=>{let u=new Xe(c),d=Ef.forUser(this.serializer,u),h=s.getIndexManager(u),p=Af.forUser(u,this.serializer,h,s.referenceDelegate);return new Df(i,p,d,h).recalculateAndSaveOverlaysForDocumentKeys(new hc(t,Xt.INVALID),l).next()})})}};function P6(n){return[0,Pt(n)]}function F6(n){n.createObjectStore(Fc)}function L6(n){n.createObjectStore(Lc,{keyPath:qU}),n.createObjectStore(Nn,{keyPath:$1,autoIncrement:!0}).createIndex(ms,Q1,{unique:!0}),n.createObjectStore(ba)}function B6(n,e){return e.store(Nn).loadAll().next(r=>{n.deleteObjectStore(Nn),n.createObjectStore(Nn,{keyPath:$1,autoIncrement:!0}).createIndex(ms,Q1,{unique:!0});let s=e.store(Nn),o=r.map(a=>s.put(a));return m.waitFor(o)})}function V6(n){n.createObjectStore(hs)}function q6(n){let e=n.createObjectStore(Zf,{keyPath:jU});e.createIndex(tf,GU),e.createIndex(X1,HU)}function U6(n){n.createObjectStore(Bc)}function E1(n){n.createObjectStore(Ia,{keyPath:$U}).createIndex(p0,QU,{unique:!0}),n.createObjectStore(Aa,{keyPath:KU}).createIndex(J1,WU,{unique:!0}),n.createObjectStore(xs)}function z6(n){n.deleteObjectStore(Ia),n.deleteObjectStore(Aa),n.deleteObjectStore(xs)}function j6(n){n.objectStoreNames.contains("remoteDocumentChanges")&&n.deleteObjectStore("remoteDocumentChanges")}function G6(n){let e=n.store(xs),t={highestTargetId:0,highestListenSequenceNumber:0,lastRemoteSnapshotVersion:j.min().toTimestamp(),targetCount:0};return e.put(hf,t)}function H6(n){n.createObjectStore(la,{keyPath:XU})}function K6(n){n.createObjectStore(ep,{keyPath:JU})}function W6(n){n.createObjectStore(tp,{keyPath:ZU})}function $6(n){n.createObjectStore(g0,{keyPath:e3,autoIncrement:!0}).createIndex(A_,t3,{unique:!1}),n.createObjectStore(m0,{keyPath:n3}).createIndex(Z1,r3,{unique:!1}),n.createObjectStore(y0,{keyPath:i3}).createIndex(eR,s3,{unique:!1})}function Q6(n){let e=n.createObjectStore(np,{keyPath:o3});e.createIndex(I_,a3,{unique:!1}),e.createIndex(tR,l3,{unique:!1})}function Y6(n){return n.document?new O(ue.fromString(n.document.name).popFirst(5)):n.noDocument?O.fromSegments(n.noDocument.path):n.unknownDocument?O.fromSegments(n.unknownDocument.path):L()}var Ei="IndexedDbPersistence",o_=30*60*1e3,a_=5e3,X6=4e3,l_="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",J6="This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.",Z6="firestore_zombie",cN="main",SS=class n{constructor(e,t,r,i,s,o,a,l,c,u,d=k6){if(this.allowTabSynchronization=e,this.persistenceKey=t,this.clientId=r,this.queue=s,this.window=o,this.document=a,this.sequenceNumberSyncer=c,this.forceOwningTab=u,this.schemaVersion=d,this.listenSequence=null,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=h=>Promise.resolve(),!n.isAvailable())throw new T(v.UNIMPLEMENTED,J6);this.referenceDelegate=new lS(this,i),this.dbName=t+cN,this.serializer=new wf(l),this.simpleDb=new Di(this.dbName,this.schemaVersion,new _S(this.serializer)),this.targetCache=new iS(this.referenceDelegate,this.serializer),this.remoteDocumentCache=lN(this.serializer),this.bundleCache=new X_,this.window&&this.window.localStorage?this.webStorage=this.window.localStorage:(this.webStorage=null,u===!1&&Ne(Ei,"LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}start(){return this.updateClientMetadataAndTryBecomePrimary().then(()=>{if(!this.isPrimary&&!this.allowTabSynchronization)throw new T(v.FAILED_PRECONDITION,l_);return this.attachVisibilityHandler(),this.attachWindowUnloadHook(),this.scheduleClientMetadataAndPrimaryLeaseRefreshes(),this.runTransaction("getHighestListenSequenceNumber","readonly",e=>this.targetCache.getHighestSequenceNumber(e))}).then(e=>{this.listenSequence=new Xt(e,this.sequenceNumberSyncer)}).then(()=>{this._started=!0}).catch(e=>(this.simpleDb&&this.simpleDb.close(),Promise.reject(e)))}setPrimaryStateListener(e){return this.primaryStateListener=t=>g(this,null,function*(){if(this.started)return e(t)}),e(this.isPrimary)}setDatabaseDeletedListener(e){this.simpleDb.setVersionChangeListener(t=>g(this,null,function*(){t.newVersion===null&&(yield e())}))}setNetworkEnabled(e){this.networkEnabled!==e&&(this.networkEnabled=e,this.queue.enqueueAndForget(()=>g(this,null,function*(){this.started&&(yield this.updateClientMetadataAndTryBecomePrimary())})))}updateClientMetadataAndTryBecomePrimary(){return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",e=>Jh(e).put({clientId:this.clientId,updateTimeMs:Date.now(),networkEnabled:this.networkEnabled,inForeground:this.inForeground}).next(()=>{if(this.isPrimary)return this.verifyPrimaryLease(e).next(r=>{r||(this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)))})}).next(()=>this.canActAsPrimary(e)).next(r=>this.isPrimary&&!r?this.releasePrimaryLeaseIfHeld(e).next(()=>!1):r?this.acquireOrExtendPrimaryLease(e).next(()=>!0):!1)).catch(e=>{if(qi(e))return D(Ei,"Failed to extend owner lease: ",e),this.isPrimary;if(!this.allowTabSynchronization)throw e;return D(Ei,"Releasing owner lease after error during lease refresh",e),!1}).then(e=>{this.isPrimary!==e&&this.queue.enqueueRetryable(()=>this.primaryStateListener(e)),this.isPrimary=e})}verifyPrimaryLease(e){return tc(e).get(Ho).next(r=>m.resolve(this.isLocalClient(r)))}removeClientMetadata(e){return Jh(e).delete(this.clientId)}maybeGarbageCollectMultiClientState(){return g(this,null,function*(){if(this.isPrimary&&!this.isWithinAge(this.lastGarbageCollectionTime,o_)){this.lastGarbageCollectionTime=Date.now();let e=yield this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",t=>{let r=lt(t,la);return r.loadAll().next(i=>{let s=this.filterActiveClients(i,o_),o=i.filter(a=>s.indexOf(a)===-1);return m.forEach(o,a=>r.delete(a.clientId)).next(()=>o)})}).catch(()=>[]);if(this.webStorage)for(let t of e)this.webStorage.removeItem(this.zombiedClientLocalStorageKey(t.clientId))}})}scheduleClientMetadataAndPrimaryLeaseRefreshes(){this.clientMetadataRefresher=this.queue.enqueueAfterDelay("client_metadata_refresh",X6,()=>this.updateClientMetadataAndTryBecomePrimary().then(()=>this.maybeGarbageCollectMultiClientState()).then(()=>this.scheduleClientMetadataAndPrimaryLeaseRefreshes()))}isLocalClient(e){return e?e.ownerId===this.clientId:!1}canActAsPrimary(e){return this.forceOwningTab?m.resolve(!0):tc(e).get(Ho).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,a_)&&!this.isClientZombied(r.ownerId)){if(this.isLocalClient(r)&&this.networkEnabled)return!0;if(!this.isLocalClient(r)){if(!r.allowTabSynchronization)throw new T(v.FAILED_PRECONDITION,l_);return!1}}return this.networkEnabled&&this.inForeground?!0:Jh(e).loadAll().next(s=>this.filterActiveClients(s,a_).find(a=>{if(this.clientId!==a.clientId){let l=!this.networkEnabled&&a.networkEnabled,c=!this.inForeground&&a.inForeground,u=this.networkEnabled===a.networkEnabled;if(l||c&&u)return!0}return!1})===void 0)}).next(r=>(this.isPrimary!==r&&D(Ei,`Client ${r?"is":"is not"} eligible for a primary lease.`),r))}shutdown(){return g(this,null,function*(){this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),yield this.simpleDb.runTransaction("shutdown","readwrite",[Fc,la],e=>{let t=new hc(e,Xt.INVALID);return this.releasePrimaryLeaseIfHeld(t).next(()=>this.removeClientMetadata(t))}),this.simpleDb.close(),this.removeClientZombiedEntry()})}filterActiveClients(e,t){return e.filter(r=>this.isWithinAge(r.updateTimeMs,t)&&!this.isClientZombied(r.clientId))}getActiveClients(){return this.runTransaction("getActiveClients","readonly",e=>Jh(e).loadAll().next(t=>this.filterActiveClients(t,o_).map(r=>r.clientId)))}get started(){return this._started}getMutationQueue(e,t){return Af.forUser(e,this.serializer,t,this.referenceDelegate)}getTargetCache(){return this.targetCache}getRemoteDocumentCache(){return this.remoteDocumentCache}getIndexManager(e){return new rS(e,this.serializer.remoteSerializer.databaseId)}getDocumentOverlayCache(e){return Ef.forUser(this.serializer,e)}getBundleCache(){return this.bundleCache}runTransaction(e,t,r){D(Ei,"Starting transaction:",e);let i=t==="readonly"?"readonly":"readwrite",s=m3(this.schemaVersion),o;return this.simpleDb.runTransaction(e,i,s,a=>(o=new hc(a,this.listenSequence?this.listenSequence.next():Xt.INVALID),t==="readwrite-primary"?this.verifyPrimaryLease(o).next(l=>l?!0:this.canActAsPrimary(o)).next(l=>{if(!l)throw Ne(`Failed to obtain primary lease for action '${e}'.`),this.isPrimary=!1,this.queue.enqueueRetryable(()=>this.primaryStateListener(!1)),new T(v.FAILED_PRECONDITION,H1);return r(o)}).next(l=>this.acquireOrExtendPrimaryLease(o).next(()=>l)):this.verifyAllowTabSynchronization(o).next(()=>r(o)))).then(a=>(o.raiseOnCommittedEvent(),a))}verifyAllowTabSynchronization(e){return tc(e).get(Ho).next(r=>{if(r!==null&&this.isWithinAge(r.leaseTimestampMs,a_)&&!this.isClientZombied(r.ownerId)&&!this.isLocalClient(r)&&!this.forceOwningTab&&(!this.allowTabSynchronization||!r.allowTabSynchronization))throw new T(v.FAILED_PRECONDITION,l_)})}acquireOrExtendPrimaryLease(e){let t={ownerId:this.clientId,allowTabSynchronization:this.allowTabSynchronization,leaseTimestampMs:Date.now()};return tc(e).put(Ho,t)}static isAvailable(){return Di.isAvailable()}releasePrimaryLeaseIfHeld(e){let t=tc(e);return t.get(Ho).next(r=>this.isLocalClient(r)?(D(Ei,"Releasing primary lease."),t.delete(Ho)):m.resolve())}isWithinAge(e,t){let r=Date.now(),i=r-t,s=r;return e<i?!1:e>s?(Ne(`Detected an update time that is in the future: ${e} > ${s}`),!1):!0}attachVisibilityHandler(){this.document!==null&&typeof this.document.addEventListener=="function"&&(this.documentVisibilityHandler=()=>{this.queue.enqueueAndForget(()=>(this.inForeground=this.document.visibilityState==="visible",this.updateClientMetadataAndTryBecomePrimary()))},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground=this.document.visibilityState==="visible")}detachVisibilityHandler(){this.documentVisibilityHandler&&(this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)}attachWindowUnloadHook(){var e;typeof((e=this.window)===null||e===void 0?void 0:e.addEventListener)=="function"&&(this.windowUnloadHandler=()=>{this.markClientZombied();let t=/(?:Version|Mobile)\/1[456]/;Gw()&&(navigator.appVersion.match(t)||navigator.userAgent.match(t))&&this.queue.enterRestrictedMode(!0),this.queue.enqueueAndForget(()=>this.shutdown())},this.window.addEventListener("pagehide",this.windowUnloadHandler))}detachWindowUnloadHook(){this.windowUnloadHandler&&(this.window.removeEventListener("pagehide",this.windowUnloadHandler),this.windowUnloadHandler=null)}isClientZombied(e){var t;try{let r=((t=this.webStorage)===null||t===void 0?void 0:t.getItem(this.zombiedClientLocalStorageKey(e)))!==null;return D(Ei,`Client '${e}' ${r?"is":"is not"} zombied in LocalStorage`),r}catch(r){return Ne(Ei,"Failed to get zombied client id.",r),!1}}markClientZombied(){if(this.webStorage)try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(e){Ne("Failed to set zombie client id.",e)}}removeClientZombiedEntry(){if(this.webStorage)try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch{}}zombiedClientLocalStorageKey(e){return`${Z6}_${this.persistenceKey}_${e}`}};function tc(n){return lt(n,Fc)}function Jh(n){return lt(n,la)}function R0(n,e){let t=n.projectId;return n.isDefaultDatabase||(t+="."+n.database),"firestore/"+e+"/"+t+"/"}function ej(n){return g(this,null,function*(){if(!Di.isAvailable())return Promise.resolve();let e=n+cN;yield Di.delete(e)})}var N0="LocalStore",tj=5*60*1e6,Dc=class{constructor(e,t,r,i){this.persistence=e,this.queryEngine=t,this.serializer=i,this.targetDataByTarget=new Ce(X),this.targetIdByTarget=new ur(s=>bs(s),qc),this.collectionGroupReadTime=new Map,this.remoteDocuments=e.getRemoteDocumentCache(),this.targetCache=e.getTargetCache(),this.bundleCache=e.getBundleCache(),this.initializeUserComponents(r)}initializeUserComponents(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new Df(this.remoteDocuments,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.remoteDocuments.setIndexManager(this.indexManager),this.queryEngine.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.targetDataByTarget))}};function uN(n,e,t,r){return new Dc(n,e,t,r)}function dN(n,e){return g(this,null,function*(){let t=P(n);return yield t.persistence.runTransaction("Handle user change","readonly",i=>{let s;return t.mutationQueue.getAllMutationBatches(i).next(o=>(s=o,t.initializeUserComponents(e),t.mutationQueue.getAllMutationBatches(i))).next(o=>{let a=[],l=[],c=J();for(let u of s){a.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}for(let u of o){l.push(u.batchId);for(let d of u.mutations)c=c.add(d.key)}return t.localDocuments.getDocuments(i,c).next(u=>({affectedDocuments:u,removedBatchIds:a,addedBatchIds:l}))})})})}function nj(n,e){let t=P(n),r=ke.now(),i=e.reduce((a,l)=>a.add(l.key),J()),s,o;return t.persistence.runTransaction("Locally write mutations","readwrite",a=>{let l=Gt(),c=J();return t.remoteDocuments.getEntries(a,i).next(u=>{l=u,l.forEach((d,h)=>{h.isValidDocument()||(c=c.add(d))})}).next(()=>t.localDocuments.getOverlayedDocuments(a,l)).next(u=>{s=u;let d=[];for(let h of e){let p=P4(h,s.get(h.key).overlayedDocument);p!=null&&d.push(new On(h.key,p,pR(p.value.mapValue),Be.exists(!0)))}return t.mutationQueue.addMutationBatch(a,r,d,e)}).next(u=>{o=u;let d=u.applyToLocalDocumentSet(s,c);return t.documentOverlayCache.saveOverlays(a,u.batchId,d)})}).then(()=>({batchId:o.batchId,changes:DR(s)}))}function rj(n,e){let t=P(n);return t.persistence.runTransaction("Acknowledge batch","readwrite-primary",r=>{let i=e.batch.keys(),s=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});return fj(t,r,e,s).next(()=>s.apply(r)).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e.batch.batchId)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,ij(e))).next(()=>t.localDocuments.getDocuments(r,i))})}function ij(n){let e=J();for(let t=0;t<n.mutationResults.length;++t)n.mutationResults[t].transformResults.length>0&&(e=e.add(n.batch.mutations[t].key));return e}function sj(n,e){let t=P(n);return t.persistence.runTransaction("Reject batch","readwrite-primary",r=>{let i;return t.mutationQueue.lookupMutationBatch(r,e).next(s=>(q(s!==null),i=s.keys(),t.mutationQueue.removeMutationBatch(r,s))).next(()=>t.mutationQueue.performConsistencyCheck(r)).next(()=>t.documentOverlayCache.removeOverlaysForBatchId(r,i,e)).next(()=>t.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(r,i)).next(()=>t.localDocuments.getDocuments(r,i))})}function oj(n){let e=P(n);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",t=>e.mutationQueue.getHighestUnacknowledgedBatchId(t))}function hN(n){let e=P(n);return e.persistence.runTransaction("Get last remote snapshot version","readonly",t=>e.targetCache.getLastRemoteSnapshotVersion(t))}function aj(n,e){let t=P(n),r=e.snapshotVersion,i=t.targetDataByTarget;return t.persistence.runTransaction("Apply remote event","readwrite-primary",s=>{let o=t.remoteDocuments.newChangeBuffer({trackRemovals:!0});i=t.targetDataByTarget;let a=[];e.targetChanges.forEach((u,d)=>{let h=i.get(d);if(!h)return;a.push(t.targetCache.removeMatchingKeys(s,u.removedDocuments,d).next(()=>t.targetCache.addMatchingKeys(s,u.addedDocuments,d)));let p=h.withSequenceNumber(s.currentSequenceNumber);e.targetMismatches.get(d)!==null?p=p.withResumeToken(at.EMPTY_BYTE_STRING,j.min()).withLastLimboFreeSnapshotVersion(j.min()):u.resumeToken.approximateByteSize()>0&&(p=p.withResumeToken(u.resumeToken,r)),i=i.insert(d,p),lj(h,p,u)&&a.push(t.targetCache.updateTargetData(s,p))});let l=Gt(),c=J();if(e.documentUpdates.forEach(u=>{e.resolvedLimboDocuments.has(u)&&a.push(t.persistence.referenceDelegate.updateLimboDocument(s,u))}),a.push(fN(s,o,e.documentUpdates).next(u=>{l=u.changedDocuments,c=u.existenceChangedKeys})),!r.isEqual(j.min())){let u=t.targetCache.getLastRemoteSnapshotVersion(s).next(d=>t.targetCache.setTargetsMetadata(s,s.currentSequenceNumber,r));a.push(u)}return m.waitFor(a).next(()=>o.apply(s)).next(()=>t.localDocuments.getLocalViewOfDocuments(s,l,c)).next(()=>l)}).then(s=>(t.targetDataByTarget=i,s))}function fN(n,e,t){let r=J(),i=J();return t.forEach(s=>r=r.add(s)),e.getEntries(n,r).next(s=>{let o=Gt();return t.forEach((a,l)=>{let c=s.get(a);l.isFoundDocument()!==c.isFoundDocument()&&(i=i.add(a)),l.isNoDocument()&&l.version.isEqual(j.min())?(e.removeEntry(a,l.readTime),o=o.insert(a,l)):!c.isValidDocument()||l.version.compareTo(c.version)>0||l.version.compareTo(c.version)===0&&c.hasPendingWrites?(e.addEntry(l),o=o.insert(a,l)):D(N0,"Ignoring outdated watch update for ",a,". Current version:",c.version," Watch version:",l.version)}),{changedDocuments:o,existenceChangedKeys:i}})}function lj(n,e,t){return n.resumeToken.approximateByteSize()===0||e.snapshotVersion.toMicroseconds()-n.snapshotVersion.toMicroseconds()>=tj?!0:t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size>0}function cj(n,e){return g(this,null,function*(){let t=P(n);try{yield t.persistence.runTransaction("notifyLocalViewChanges","readwrite",r=>m.forEach(e,i=>m.forEach(i.addedKeys,s=>t.persistence.referenceDelegate.addReference(r,i.targetId,s)).next(()=>m.forEach(i.removedKeys,s=>t.persistence.referenceDelegate.removeReference(r,i.targetId,s)))))}catch(r){if(qi(r))D(N0,"Failed to update sequence numbers: "+r);else throw r}for(let r of e){let i=r.targetId;if(!r.fromCache){let s=t.targetDataByTarget.get(i),o=s.snapshotVersion,a=s.withLastLimboFreeSnapshotVersion(o);t.targetDataByTarget=t.targetDataByTarget.insert(i,a)}}})}function uj(n,e){let t=P(n);return t.persistence.runTransaction("Get next mutation batch","readonly",r=>(e===void 0&&(e=Ai),t.mutationQueue.getNextMutationBatchAfterBatchId(r,e)))}function dj(n,e){let t=P(n);return t.persistence.runTransaction("read document","readonly",r=>t.localDocuments.getDocument(r,e))}function ya(n,e){let t=P(n);return t.persistence.runTransaction("Allocate target","readwrite",r=>{let i;return t.targetCache.getTargetData(r,e).next(s=>s?(i=s,m.resolve(i)):t.targetCache.allocateTargetId(r).next(o=>(i=new ga(e,o,"TargetPurposeListen",r.currentSequenceNumber),t.targetCache.addTargetData(r,i).next(()=>i))))}).then(r=>{let i=t.targetDataByTarget.get(r.targetId);return(i===null||r.snapshotVersion.compareTo(i.snapshotVersion)>0)&&(t.targetDataByTarget=t.targetDataByTarget.insert(r.targetId,r),t.targetIdByTarget.set(e,r.targetId)),r})}function hj(n,e,t){let r=P(n),i=r.targetIdByTarget.get(t);return i!==void 0?m.resolve(r.targetDataByTarget.get(i)):r.targetCache.getTargetData(e,t)}function va(n,e,t){return g(this,null,function*(){let r=P(n),i=r.targetDataByTarget.get(e),s=t?"readwrite":"readwrite-primary";try{t||(yield r.persistence.runTransaction("Release target",s,o=>r.persistence.referenceDelegate.removeTarget(o,i)))}catch(o){if(qi(o))D(N0,`Failed to update sequence numbers for target ${e}: ${o}`);else throw o}r.targetDataByTarget=r.targetDataByTarget.remove(e),r.targetIdByTarget.delete(i.target)})}function ap(n,e,t){let r=P(n),i=j.min(),s=J();return r.persistence.runTransaction("Execute query","readwrite",o=>hj(r,o,Ft(e)).next(a=>{if(a)return i=a.lastLimboFreeSnapshotVersion,r.targetCache.getMatchingKeysForTargetId(o,a.targetId).next(l=>{s=l})}).next(()=>r.queryEngine.getDocumentsMatchingQuery(o,e,t?i:j.min(),t?s:J())).next(a=>(mN(r,bR(e),a),{documents:a,remoteKeys:s})))}function fj(n,e,t,r){let i=t.batch,s=i.keys(),o=m.resolve();return s.forEach(a=>{o=o.next(()=>r.getEntry(e,a)).next(l=>{let c=t.docVersions.get(a);q(c!==null),l.version.compareTo(c)<0&&(i.applyToRemoteDocument(l,t),l.isValidDocument()&&(l.setReadTime(t.commitVersion),r.addEntry(l)))})}),o.next(()=>n.mutationQueue.removeMutationBatch(e,i))}function pj(n,e){let t=P(n),r=P(t.mutationQueue);return t.persistence.runTransaction("Lookup mutation documents","readonly",i=>r.lookupMutationKeys(i,e).next(s=>s?t.localDocuments.getDocuments(i,s):m.resolve(null)))}function gj(n,e){P(P(n,Dc).mutationQueue).removeCachedMutationKeys(e)}function mj(n){return P(P(n,Dc).persistence).getActiveClients()}function pN(n,e){let t=P(n),r=P(t.targetCache),i=t.targetDataByTarget.get(e);return i?Promise.resolve(i.target):t.persistence.runTransaction("Get target data","readonly",s=>r.getTargetDataForTarget(s,e).next(o=>o?o.target:null))}function gN(n,e){let t=P(n),r=t.collectionGroupReadTime.get(e)||j.min();return t.persistence.runTransaction("Get new document changes","readonly",i=>t.remoteDocuments.getAllFromCollectionGroup(i,e,j1(r,aa),Number.MAX_SAFE_INTEGER)).then(i=>(mN(t,e,i),i))}function mN(n,e,t){let r=n.collectionGroupReadTime.get(e)||j.min();t.forEach((i,s)=>{s.readTime.compareTo(r)>0&&(r=s.readTime)}),n.collectionGroupReadTime.set(e,r)}function yj(n){return Ft(Da(ue.fromString(`__bundle__/docs/${n}`)))}function vj(n,e,t,r){return g(this,null,function*(){let i=P(n),s=J(),o=Gt();for(let c of t){let u=e.toDocumentKey(c.metadata.name);c.document&&(s=s.add(u));let d=e.toMutableDocument(c);d.setReadTime(e.toSnapshotVersion(c.metadata.readTime)),o=o.insert(u,d)}let a=i.remoteDocuments.newChangeBuffer({trackRemovals:!0}),l=yield ya(i,yj(r));return i.persistence.runTransaction("Apply bundle documents","readwrite",c=>fN(c,a,o).next(u=>(a.apply(c),u)).next(u=>i.targetCache.removeMatchingKeysForTargetId(c,l.targetId).next(()=>i.targetCache.addMatchingKeys(c,s,l.targetId)).next(()=>i.localDocuments.getLocalViewOfDocuments(c,u.changedDocuments,u.existenceChangedKeys)).next(()=>u.changedDocuments)))})}function _j(n,e){let t=P(n),r=Ge(e.createTime);return t.persistence.runTransaction("hasNewerBundle","readonly",i=>t.bundleCache.getBundleMetadata(i,e.id)).then(i=>!!i&&i.createTime.compareTo(r)>=0)}function Sj(n,e){let t=P(n);return t.persistence.runTransaction("Save bundle","readwrite",r=>t.bundleCache.saveBundleMetadata(r,e))}function wj(n,e){let t=P(n);return t.persistence.runTransaction("Get named query","readonly",r=>t.bundleCache.getNamedQuery(r,e))}function Ej(r,i){return g(this,arguments,function*(n,e,t=J()){let s=yield ya(n,Ft(b0(e.bundledQuery))),o=P(n);return o.persistence.runTransaction("Save named query","readwrite",a=>{let l=Ge(e.readTime);if(s.snapshotVersion.compareTo(l)>=0)return o.bundleCache.saveNamedQuery(a,e);let c=s.withResumeToken(at.EMPTY_BYTE_STRING,l);return o.targetDataByTarget=o.targetDataByTarget.insert(c.targetId,c),o.targetCache.updateTargetData(a,c).next(()=>o.targetCache.removeMatchingKeysForTargetId(a,s.targetId)).next(()=>o.targetCache.addMatchingKeys(a,t,s.targetId)).next(()=>o.bundleCache.saveNamedQuery(a,e))})})}var wS=class{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}};var Tj=100,Cj=8,kf=class{constructor(){this.initialized=!1,this.indexAutoCreationEnabled=!1,this.indexAutoCreationMinCollectionSize=Tj,this.relativeIndexReadCostPerDocument=Cj}initialize(e,t){this.localDocumentsView=e,this.indexManager=t,this.initialized=!0}getDocumentsMatchingQuery(e,t,r,i){let s={result:null};return this.performQueryUsingIndex(e,t).next(o=>{s.result=o}).next(()=>{if(!s.result)return this.performQueryUsingRemoteKeys(e,t,i,r).next(o=>{s.result=o})}).next(()=>{if(s.result)return;let o=new wS;return this.executeFullCollectionScan(e,t,o).next(a=>{if(s.result=a,this.indexAutoCreationEnabled)return this.createCacheIndexes(e,t,o,a.size)})}).next(()=>s.result)}createCacheIndexes(e,t,r,i){return r.documentReadCount<this.indexAutoCreationMinCollectionSize?(Jo()<=Ln.DEBUG&&D("QueryEngine","SDK will not create cache indexes for query:",Zo(t),"since it only creates cache indexes for collection contains","more than or equal to",this.indexAutoCreationMinCollectionSize,"documents"),m.resolve()):(Jo()<=Ln.DEBUG&&D("QueryEngine","Query:",Zo(t),"scans",r.documentReadCount,"local documents and returns",i,"documents as results."),r.documentReadCount>this.relativeIndexReadCostPerDocument*i?(Jo()<=Ln.DEBUG&&D("QueryEngine","The SDK decides to create cache indexes for query:",Zo(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Ft(t))):m.resolve())}performQueryUsingIndex(e,t){if(jD(t))return m.resolve(null);let r=Ft(t);return this.indexManager.getIndexType(e,r).next(i=>i===0?null:(t.limit!==null&&i===1&&(t=yf(t,null,"F"),r=Ft(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(s=>{let o=J(...s);return this.localDocumentsView.getDocuments(e,o).next(a=>this.indexManager.getMinOffset(e,r).next(l=>{let c=this.applyQuery(t,a);return this.needsRefill(t,c,o,l.readTime)?this.performQueryUsingIndex(e,yf(t,null,"F")):this.appendRemainingResults(e,c,t,l)}))})))}performQueryUsingRemoteKeys(e,t,r,i){return jD(t)||i.isEqual(j.min())?m.resolve(null):this.localDocumentsView.getDocuments(e,r).next(s=>{let o=this.applyQuery(t,s);return this.needsRefill(t,o,r,i)?m.resolve(null):(Jo()<=Ln.DEBUG&&D("QueryEngine","Re-using previous result from %s to execute query: %s",i.toString(),Zo(t)),this.appendRemainingResults(e,o,t,j1(i,aa)).next(a=>a))})}applyQuery(e,t){let r=new ye(AR(e));return t.forEach((i,s)=>{zc(e,s)&&(r=r.add(s))}),r}needsRefill(e,t,r,i){if(e.limit===null)return!1;if(r.size!==t.size)return!0;let s=e.limitType==="F"?t.last():t.first();return s?s.hasPendingWrites||s.version.compareTo(i)>0:!1}executeFullCollectionScan(e,t,r){return Jo()<=Ln.DEBUG&&D("QueryEngine","Using full collection scan to execute query:",Zo(t)),this.localDocumentsView.getDocumentsMatchingQuery(e,t,mn.min(),r)}appendRemainingResults(e,t,r,i){return this.localDocumentsView.getDocumentsMatchingQuery(e,r,i).next(s=>(t.forEach(o=>{s=s.insert(o.key,o)}),s))}};var yN="firestore_clients";function T1(n,e){return`${yN}_${n}_${e}`}var vN="firestore_mutations";function C1(n,e,t){let r=`${vN}_${n}_${t}`;return e.isAuthenticated()&&(r+=`_${e.uid}`),r}var _N="firestore_targets";function c_(n,e){return`${_N}_${n}_${e}`}var bj="firestore_online_state";function Aj(n){return`${bj}_${n}`}var Ij="firestore_bundle_loaded_v2";function Dj(n){return`${Ij}_${n}`}var Rj="firestore_sequence_number";function Nj(n){return`${Rj}_${n}`}var ir="SharedClientState",Mf=class n{constructor(e,t,r,i){this.user=e,this.batchId=t,this.state=r,this.error=i}static fromWebStorageEntry(e,t,r){let i=JSON.parse(r),s=typeof i=="object"&&["pending","acknowledged","rejected"].indexOf(i.state)!==-1&&(i.error===void 0||typeof i.error=="object"),o;return s&&i.error&&(s=typeof i.error.message=="string"&&typeof i.error.code=="string",s&&(o=new T(i.error.code,i.error.message))),s?new n(e,t,i.state,o):(Ne(ir,`Failed to parse mutation state for ID '${t}': ${r}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},lc=class n{constructor(e,t,r){this.targetId=e,this.state=t,this.error=r}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&["not-current","current","rejected"].indexOf(r.state)!==-1&&(r.error===void 0||typeof r.error=="object"),s;return i&&r.error&&(i=typeof r.error.message=="string"&&typeof r.error.code=="string",i&&(s=new T(r.error.code,r.error.message))),i?new n(e,r.state,s):(Ne(ir,`Failed to parse target state for ID '${e}': ${t}`),null)}toWebStorageJSON(){let e={state:this.state,updateTimeMs:Date.now()};return this.error&&(e.error={code:this.error.code,message:this.error.message}),JSON.stringify(e)}},Of=class n{constructor(e,t){this.clientId=e,this.activeTargetIds=t}static fromWebStorageEntry(e,t){let r=JSON.parse(t),i=typeof r=="object"&&r.activeTargetIds instanceof Array,s=T0();for(let o=0;i&&o<r.activeTargetIds.length;++o)i=dR(r.activeTargetIds[o]),s=s.add(r.activeTargetIds[o]);return i?new n(e,s):(Ne(ir,`Failed to parse client data for instance '${e}': ${t}`),null)}},ES=class n{constructor(e,t){this.clientId=e,this.onlineState=t}static fromWebStorageEntry(e){let t=JSON.parse(e);return typeof t=="object"&&["Unknown","Online","Offline"].indexOf(t.onlineState)!==-1&&typeof t.clientId=="string"?new n(t.clientId,t.onlineState):(Ne(ir,`Failed to parse online state: ${e}`),null)}},Rc=class{constructor(){this.activeTargetIds=T0()}addQueryTarget(e){this.activeTargetIds=this.activeTargetIds.add(e)}removeQueryTarget(e){this.activeTargetIds=this.activeTargetIds.delete(e)}toWebStorageJSON(){let e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}},cc=class{constructor(e,t,r,i,s){this.window=e,this.queue=t,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.storageListener=this.handleWebStorageEvent.bind(this),this.activeClients=new Ce(X),this.started=!1,this.earlyEvents=[];let o=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=s,this.localClientStorageKey=T1(this.persistenceKey,this.localClientId),this.sequenceNumberKey=Nj(this.persistenceKey),this.activeClients=this.activeClients.insert(this.localClientId,new Rc),this.clientStateKeyRe=new RegExp(`^${yN}_${o}_([^_]*)$`),this.mutationBatchKeyRe=new RegExp(`^${vN}_${o}_(\\d+)(?:_(.*))?$`),this.queryTargetKeyRe=new RegExp(`^${_N}_${o}_(\\d+)$`),this.onlineStateKey=Aj(this.persistenceKey),this.bundleLoadedKey=Dj(this.persistenceKey),this.window.addEventListener("storage",this.storageListener)}static isAvailable(e){return!!(e&&e.localStorage)}start(){return g(this,null,function*(){let e=yield this.syncEngine.getActiveClients();for(let r of e){if(r===this.localClientId)continue;let i=this.getItem(T1(this.persistenceKey,r));if(i){let s=Of.fromWebStorageEntry(r,i);s&&(this.activeClients=this.activeClients.insert(s.clientId,s))}}this.persistClientState();let t=this.storage.getItem(this.onlineStateKey);if(t){let r=this.fromWebStorageOnlineState(t);r&&this.handleOnlineStateEvent(r)}for(let r of this.earlyEvents)this.handleWebStorageEvent(r);this.earlyEvents=[],this.window.addEventListener("pagehide",()=>this.shutdown()),this.started=!0})}writeSequenceNumber(e){this.setItem(this.sequenceNumberKey,JSON.stringify(e))}getAllActiveQueryTargets(){return this.extractActiveQueryTargets(this.activeClients)}isActiveQueryTarget(e){let t=!1;return this.activeClients.forEach((r,i)=>{i.activeTargetIds.has(e)&&(t=!0)}),t}addPendingMutation(e){this.persistMutationState(e,"pending")}updateMutationState(e,t,r){this.persistMutationState(e,t,r),this.removeMutationState(e)}addLocalQueryTarget(e){let t="not-current";if(this.isActiveQueryTarget(e)){let r=this.storage.getItem(c_(this.persistenceKey,e));if(r){let i=lc.fromWebStorageEntry(e,r);i&&(t=i.state)}}return this.localClientState.addQueryTarget(e),this.persistClientState(),t}removeLocalQueryTarget(e){this.localClientState.removeQueryTarget(e),this.persistClientState()}isLocalQueryTarget(e){return this.localClientState.activeTargetIds.has(e)}clearQueryState(e){this.removeItem(c_(this.persistenceKey,e))}updateQueryState(e,t,r){this.persistQueryTargetState(e,t,r)}handleUserChange(e,t,r){t.forEach(i=>{this.removeMutationState(i)}),this.currentUser=e,r.forEach(i=>{this.addPendingMutation(i)})}setOnlineState(e){this.persistOnlineState(e)}notifyBundleLoaded(e){this.persistBundleLoadedState(e)}shutdown(){this.started&&(this.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)}getItem(e){let t=this.storage.getItem(e);return D(ir,"READ",e,t),t}setItem(e,t){D(ir,"SET",e,t),this.storage.setItem(e,t)}removeItem(e){D(ir,"REMOVE",e),this.storage.removeItem(e)}handleWebStorageEvent(e){let t=e;if(t.storageArea===this.storage){if(D(ir,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey){Ne("Received WebStorage notification for local change. Another client might have garbage-collected our state");return}this.queue.enqueueRetryable(()=>g(this,null,function*(){if(!this.started){this.earlyEvents.push(t);return}if(t.key!==null){if(this.clientStateKeyRe.test(t.key))if(t.newValue!=null){let r=this.fromWebStorageClientState(t.key,t.newValue);if(r)return this.handleClientStateEvent(r.clientId,r)}else{let r=this.fromWebStorageClientStateKey(t.key);return this.handleClientStateEvent(r,null)}else if(this.mutationBatchKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageMutationMetadata(t.key,t.newValue);if(r)return this.handleMutationBatchEvent(r)}}else if(this.queryTargetKeyRe.test(t.key)){if(t.newValue!==null){let r=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue);if(r)return this.handleQueryTargetEvent(r)}}else if(t.key===this.onlineStateKey){if(t.newValue!==null){let r=this.fromWebStorageOnlineState(t.newValue);if(r)return this.handleOnlineStateEvent(r)}}else if(t.key===this.sequenceNumberKey){let r=kj(t.newValue);r!==Xt.INVALID&&this.sequenceNumberHandler(r)}else if(t.key===this.bundleLoadedKey){let r=this.fromWebStoreBundleLoadedState(t.newValue);yield Promise.all(r.map(i=>this.syncEngine.synchronizeWithChangedDocuments(i)))}}}))}}get localClientState(){return this.activeClients.get(this.localClientId)}persistClientState(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())}persistMutationState(e,t,r){let i=new Mf(this.currentUser,e,t,r),s=C1(this.persistenceKey,this.currentUser,e);this.setItem(s,i.toWebStorageJSON())}removeMutationState(e){let t=C1(this.persistenceKey,this.currentUser,e);this.removeItem(t)}persistOnlineState(e){let t={clientId:this.localClientId,onlineState:e};this.storage.setItem(this.onlineStateKey,JSON.stringify(t))}persistQueryTargetState(e,t,r){let i=c_(this.persistenceKey,e),s=new lc(e,t,r);this.setItem(i,s.toWebStorageJSON())}persistBundleLoadedState(e){let t=JSON.stringify(Array.from(e));this.setItem(this.bundleLoadedKey,t)}fromWebStorageClientStateKey(e){let t=this.clientStateKeyRe.exec(e);return t?t[1]:null}fromWebStorageClientState(e,t){let r=this.fromWebStorageClientStateKey(e);return Of.fromWebStorageEntry(r,t)}fromWebStorageMutationMetadata(e,t){let r=this.mutationBatchKeyRe.exec(e),i=Number(r[1]),s=r[2]!==void 0?r[2]:null;return Mf.fromWebStorageEntry(new Xe(s),i,t)}fromWebStorageQueryTargetMetadata(e,t){let r=this.queryTargetKeyRe.exec(e),i=Number(r[1]);return lc.fromWebStorageEntry(i,t)}fromWebStorageOnlineState(e){return ES.fromWebStorageEntry(e)}fromWebStoreBundleLoadedState(e){return JSON.parse(e)}handleMutationBatchEvent(e){return g(this,null,function*(){if(e.user.uid!==this.currentUser.uid){D(ir,`Ignoring mutation for non-active user ${e.user.uid}`);return}return this.syncEngine.applyBatchState(e.batchId,e.state,e.error)})}handleQueryTargetEvent(e){return this.syncEngine.applyTargetState(e.targetId,e.state,e.error)}handleClientStateEvent(e,t){let r=t?this.activeClients.insert(e,t):this.activeClients.remove(e),i=this.extractActiveQueryTargets(this.activeClients),s=this.extractActiveQueryTargets(r),o=[],a=[];return s.forEach(l=>{i.has(l)||o.push(l)}),i.forEach(l=>{s.has(l)||a.push(l)}),this.syncEngine.applyActiveTargetsChange(o,a).then(()=>{this.activeClients=r})}handleOnlineStateEvent(e){this.activeClients.get(e.clientId)&&this.onlineStateHandler(e.onlineState)}extractActiveQueryTargets(e){let t=T0();return e.forEach((r,i)=>{t=t.unionWith(i.activeTargetIds)}),t}};function kj(n){let e=Xt.INVALID;if(n!=null)try{let t=JSON.parse(n);q(typeof t=="number"),e=t}catch(t){Ne(ir,"Failed to read sequence number from WebStorage",t)}return e}var xf=class{constructor(){this.localState=new Rc,this.queryState={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return this.localState.addQueryTarget(e),this.queryState[e]||"not-current"}updateQueryState(e,t,r){this.queryState[e]=t}removeLocalQueryTarget(e){this.localState.removeQueryTarget(e)}isLocalQueryTarget(e){return this.localState.activeTargetIds.has(e)}clearQueryState(e){delete this.queryState[e]}getAllActiveQueryTargets(){return this.localState.activeTargetIds}isActiveQueryTarget(e){return this.localState.activeTargetIds.has(e)}start(){return this.localState=new Rc,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}};var TS=class{addCallback(e){}shutdown(){}};var CS=class{constructor(e){this.sendFn=e.sendFn,this.closeFn=e.closeFn}onOpen(e){this.wrappedOnOpen=e}onClose(e){this.wrappedOnClose=e}onMessage(e){this.wrappedOnMessage=e}close(){this.closeFn()}send(e){this.sendFn(e)}callOnOpen(){this.wrappedOnOpen()}callOnClose(e){this.wrappedOnClose(e)}callOnMessage(e){this.wrappedOnMessage(e)}};var Zh=null;function Mj(){return 268435456+Math.round(2147483648*Math.random())}function u_(){return Zh===null?Zh=Mj():Zh++,"0x"+Zh.toString(16)}function Oj(n){return new Promise((e,t)=>{n((r,i)=>{r?t(r):e(i)})})}var xj="1.9.1",xt="GrpcConnection",Pj=`gl-node/${process.versions.node} fire/${Ca} grpc/${xj}`;function d_(n,e,t,r){q(e===null||e.type==="OAuth");let i=new _s.Metadata;return e&&e.headers.forEach((s,o)=>i.set(o,s)),t&&t.headers.forEach((s,o)=>i.set(o,s)),r&&i.set("X-Firebase-GMPID",r),i.set("X-Goog-Api-Client",Pj),i.set("Google-Cloud-Resource-Prefix",n),i.set("x-goog-request-params",n),i}var bS=class{constructor(e,t){this.databaseInfo=t,this.cachedStub=null,this.firestore=e.google.firestore.v1,this.databasePath=`projects/${t.databaseId.projectId}/databases/${t.databaseId.database}`}get shouldResourcePathBeIncludedInRequest(){return!0}ensureActiveStub(){if(!this.cachedStub){D(xt,"Creating Firestore stub.");let e=this.databaseInfo.ssl?_s.credentials.createSsl():_s.credentials.createInsecure();this.cachedStub=new this.firestore.Firestore(this.databaseInfo.host,e)}return this.cachedStub}invokeRPC(e,t,r,i,s){let o=u_(),a=this.ensureActiveStub(),l=d_(this.databasePath,i,s,this.databaseInfo.appId),c=Object.assign({database:this.databasePath},r);return Oj(u=>(D(xt,`RPC '${e}' ${o} invoked with request:`,r),a[e](c,l,(d,h)=>{d?(D(xt,`RPC '${e}' ${o} failed with error:`,d),u(new T(sf(d.code),d.message))):(D(xt,`RPC '${e}' ${o} completed with response:`,h),u(void 0,h))})))}invokeStreamingRPC(e,t,r,i,s,o){let a=u_(),l=[],c=new je;D(xt,`RPC '${e}' ${a} invoked (streaming) with request:`,r);let u=this.ensureActiveStub(),d=d_(this.databasePath,i,s,this.databaseInfo.appId),h=Object.assign(Object.assign({},r),{database:this.databasePath}),p=u[e](h,d),y=!1;return p.on("data",_=>{D(xt,`RPC ${e} ${a} received result:`,_),l.push(_),o!==void 0&&l.length===o&&(y=!0,c.resolve(l))}),p.on("end",()=>{D(xt,`RPC '${e}' ${a} completed.`),y||(y=!0,c.resolve(l))}),p.on("error",_=>{D(xt,`RPC '${e}' ${a} failed with error:`,_);let S=sf(_.code);c.reject(new T(S,_.message))}),c.promise}openStream(e,t,r){let i=u_(),s=this.ensureActiveStub(),o=d_(this.databasePath,t,r,this.databaseInfo.appId),a=s[e](o),l=!1,c=d=>{l||(l=!0,u.callOnClose(d),a.end())},u=new CS({sendFn:d=>{if(l)D(xt,`RPC '${e}' stream ${i} not sending because gRPC stream is closed:`,d);else{D(xt,`RPC '${e}' stream ${i} sending:`,d);try{a.write(d)}catch(h){throw Ne("Failure sending:",d),Ne("Error:",h),h}}},closeFn:()=>{D(xt,`RPC '${e}' stream ${i} closed locally via close().`),c()}});return a.on("data",d=>{l||(D(xt,`RPC '${e}' stream ${i} received:`,d),u.callOnMessage(d))}),a.on("end",()=>{D(xt,`RPC '${e}' stream ${i} ended.`),c()}),a.on("error",d=>{if(!l){gn(xt,`RPC '${e}' stream ${i} error. Code:`,d.code,"Message:",d.message);let h=sf(d.code);c(new T(h,d.message))}}),D(xt,`Opening RPC '${e}' stream ${i} to ${this.databaseInfo.host}`),setTimeout(()=>{u.callOnOpen()},0),u}},SN={google:{nested:{protobuf:{options:{csharp_namespace:"Google.Protobuf.WellKnownTypes",go_package:"github.com/golang/protobuf/ptypes/wrappers",java_package:"com.google.protobuf",java_outer_classname:"WrappersProto",java_multiple_files:!0,objc_class_prefix:"GPB",cc_enable_arenas:!0,optimize_for:"SPEED"},nested:{Timestamp:{fields:{seconds:{type:"int64",id:1},nanos:{type:"int32",id:2}}},FileDescriptorSet:{fields:{file:{rule:"repeated",type:"FileDescriptorProto",id:1}}},FileDescriptorProto:{fields:{name:{type:"string",id:1},package:{type:"string",id:2},dependency:{rule:"repeated",type:"string",id:3},publicDependency:{rule:"repeated",type:"int32",id:10,options:{packed:!1}},weakDependency:{rule:"repeated",type:"int32",id:11,options:{packed:!1}},messageType:{rule:"repeated",type:"DescriptorProto",id:4},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:5},service:{rule:"repeated",type:"ServiceDescriptorProto",id:6},extension:{rule:"repeated",type:"FieldDescriptorProto",id:7},options:{type:"FileOptions",id:8},sourceCodeInfo:{type:"SourceCodeInfo",id:9},syntax:{type:"string",id:12}}},DescriptorProto:{fields:{name:{type:"string",id:1},field:{rule:"repeated",type:"FieldDescriptorProto",id:2},extension:{rule:"repeated",type:"FieldDescriptorProto",id:6},nestedType:{rule:"repeated",type:"DescriptorProto",id:3},enumType:{rule:"repeated",type:"EnumDescriptorProto",id:4},extensionRange:{rule:"repeated",type:"ExtensionRange",id:5},oneofDecl:{rule:"repeated",type:"OneofDescriptorProto",id:8},options:{type:"MessageOptions",id:7},reservedRange:{rule:"repeated",type:"ReservedRange",id:9},reservedName:{rule:"repeated",type:"string",id:10}},nested:{ExtensionRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}},ReservedRange:{fields:{start:{type:"int32",id:1},end:{type:"int32",id:2}}}}},FieldDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:3},label:{type:"Label",id:4},type:{type:"Type",id:5},typeName:{type:"string",id:6},extendee:{type:"string",id:2},defaultValue:{type:"string",id:7},oneofIndex:{type:"int32",id:9},jsonName:{type:"string",id:10},options:{type:"FieldOptions",id:8}},nested:{Type:{values:{TYPE_DOUBLE:1,TYPE_FLOAT:2,TYPE_INT64:3,TYPE_UINT64:4,TYPE_INT32:5,TYPE_FIXED64:6,TYPE_FIXED32:7,TYPE_BOOL:8,TYPE_STRING:9,TYPE_GROUP:10,TYPE_MESSAGE:11,TYPE_BYTES:12,TYPE_UINT32:13,TYPE_ENUM:14,TYPE_SFIXED32:15,TYPE_SFIXED64:16,TYPE_SINT32:17,TYPE_SINT64:18}},Label:{values:{LABEL_OPTIONAL:1,LABEL_REQUIRED:2,LABEL_REPEATED:3}}}},OneofDescriptorProto:{fields:{name:{type:"string",id:1},options:{type:"OneofOptions",id:2}}},EnumDescriptorProto:{fields:{name:{type:"string",id:1},value:{rule:"repeated",type:"EnumValueDescriptorProto",id:2},options:{type:"EnumOptions",id:3}}},EnumValueDescriptorProto:{fields:{name:{type:"string",id:1},number:{type:"int32",id:2},options:{type:"EnumValueOptions",id:3}}},ServiceDescriptorProto:{fields:{name:{type:"string",id:1},method:{rule:"repeated",type:"MethodDescriptorProto",id:2},options:{type:"ServiceOptions",id:3}}},MethodDescriptorProto:{fields:{name:{type:"string",id:1},inputType:{type:"string",id:2},outputType:{type:"string",id:3},options:{type:"MethodOptions",id:4},clientStreaming:{type:"bool",id:5},serverStreaming:{type:"bool",id:6}}},FileOptions:{fields:{javaPackage:{type:"string",id:1},javaOuterClassname:{type:"string",id:8},javaMultipleFiles:{type:"bool",id:10},javaGenerateEqualsAndHash:{type:"bool",id:20,options:{deprecated:!0}},javaStringCheckUtf8:{type:"bool",id:27},optimizeFor:{type:"OptimizeMode",id:9,options:{default:"SPEED"}},goPackage:{type:"string",id:11},ccGenericServices:{type:"bool",id:16},javaGenericServices:{type:"bool",id:17},pyGenericServices:{type:"bool",id:18},deprecated:{type:"bool",id:23},ccEnableArenas:{type:"bool",id:31},objcClassPrefix:{type:"string",id:36},csharpNamespace:{type:"string",id:37},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[38,38]],nested:{OptimizeMode:{values:{SPEED:1,CODE_SIZE:2,LITE_RUNTIME:3}}}},MessageOptions:{fields:{messageSetWireFormat:{type:"bool",id:1},noStandardDescriptorAccessor:{type:"bool",id:2},deprecated:{type:"bool",id:3},mapEntry:{type:"bool",id:7},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[8,8]]},FieldOptions:{fields:{ctype:{type:"CType",id:1,options:{default:"STRING"}},packed:{type:"bool",id:2},jstype:{type:"JSType",id:6,options:{default:"JS_NORMAL"}},lazy:{type:"bool",id:5},deprecated:{type:"bool",id:3},weak:{type:"bool",id:10},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]],reserved:[[4,4]],nested:{CType:{values:{STRING:0,CORD:1,STRING_PIECE:2}},JSType:{values:{JS_NORMAL:0,JS_STRING:1,JS_NUMBER:2}}}},OneofOptions:{fields:{uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumOptions:{fields:{allowAlias:{type:"bool",id:2},deprecated:{type:"bool",id:3},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},EnumValueOptions:{fields:{deprecated:{type:"bool",id:1},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},ServiceOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},MethodOptions:{fields:{deprecated:{type:"bool",id:33},uninterpretedOption:{rule:"repeated",type:"UninterpretedOption",id:999}},extensions:[[1e3,536870911]]},UninterpretedOption:{fields:{name:{rule:"repeated",type:"NamePart",id:2},identifierValue:{type:"string",id:3},positiveIntValue:{type:"uint64",id:4},negativeIntValue:{type:"int64",id:5},doubleValue:{type:"double",id:6},stringValue:{type:"bytes",id:7},aggregateValue:{type:"string",id:8}},nested:{NamePart:{fields:{namePart:{rule:"required",type:"string",id:1},isExtension:{rule:"required",type:"bool",id:2}}}}},SourceCodeInfo:{fields:{location:{rule:"repeated",type:"Location",id:1}},nested:{Location:{fields:{path:{rule:"repeated",type:"int32",id:1},span:{rule:"repeated",type:"int32",id:2},leadingComments:{type:"string",id:3},trailingComments:{type:"string",id:4},leadingDetachedComments:{rule:"repeated",type:"string",id:6}}}}},GeneratedCodeInfo:{fields:{annotation:{rule:"repeated",type:"Annotation",id:1}},nested:{Annotation:{fields:{path:{rule:"repeated",type:"int32",id:1},sourceFile:{type:"string",id:2},begin:{type:"int32",id:3},end:{type:"int32",id:4}}}}},Struct:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Value:{oneofs:{kind:{oneof:["nullValue","numberValue","stringValue","boolValue","structValue","listValue"]}},fields:{nullValue:{type:"NullValue",id:1},numberValue:{type:"double",id:2},stringValue:{type:"string",id:3},boolValue:{type:"bool",id:4},structValue:{type:"Struct",id:5},listValue:{type:"ListValue",id:6}}},NullValue:{values:{NULL_VALUE:0}},ListValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},Empty:{fields:{}},DoubleValue:{fields:{value:{type:"double",id:1}}},FloatValue:{fields:{value:{type:"float",id:1}}},Int64Value:{fields:{value:{type:"int64",id:1}}},UInt64Value:{fields:{value:{type:"uint64",id:1}}},Int32Value:{fields:{value:{type:"int32",id:1}}},UInt32Value:{fields:{value:{type:"uint32",id:1}}},BoolValue:{fields:{value:{type:"bool",id:1}}},StringValue:{fields:{value:{type:"string",id:1}}},BytesValue:{fields:{value:{type:"bytes",id:1}}},Any:{fields:{typeUrl:{type:"string",id:1},value:{type:"bytes",id:2}}}}},firestore:{nested:{v1:{options:{csharp_namespace:"Google.Cloud.Firestore.V1",go_package:"google.golang.org/genproto/googleapis/firestore/v1;firestore",java_multiple_files:!0,java_outer_classname:"WriteProto",java_package:"com.google.firestore.v1",objc_class_prefix:"GCFS",php_namespace:"Google\\Cloud\\Firestore\\V1",ruby_package:"Google::Cloud::Firestore::V1"},nested:{AggregationResult:{fields:{aggregateFields:{keyType:"string",type:"Value",id:2}}},BitSequence:{fields:{bitmap:{type:"bytes",id:1},padding:{type:"int32",id:2}}},BloomFilter:{fields:{bits:{type:"BitSequence",id:1},hashCount:{type:"int32",id:2}}},DocumentMask:{fields:{fieldPaths:{rule:"repeated",type:"string",id:1}}},Precondition:{oneofs:{conditionType:{oneof:["exists","updateTime"]}},fields:{exists:{type:"bool",id:1},updateTime:{type:"google.protobuf.Timestamp",id:2}}},TransactionOptions:{oneofs:{mode:{oneof:["readOnly","readWrite"]}},fields:{readOnly:{type:"ReadOnly",id:2},readWrite:{type:"ReadWrite",id:3}},nested:{ReadWrite:{fields:{retryTransaction:{type:"bytes",id:1}}},ReadOnly:{oneofs:{consistencySelector:{oneof:["readTime"]}},fields:{readTime:{type:"google.protobuf.Timestamp",id:2}}}}},Document:{fields:{name:{type:"string",id:1},fields:{keyType:"string",type:"Value",id:2},createTime:{type:"google.protobuf.Timestamp",id:3},updateTime:{type:"google.protobuf.Timestamp",id:4}}},Value:{oneofs:{valueType:{oneof:["nullValue","booleanValue","integerValue","doubleValue","timestampValue","stringValue","bytesValue","referenceValue","geoPointValue","arrayValue","mapValue"]}},fields:{nullValue:{type:"google.protobuf.NullValue",id:11},booleanValue:{type:"bool",id:1},integerValue:{type:"int64",id:2},doubleValue:{type:"double",id:3},timestampValue:{type:"google.protobuf.Timestamp",id:10},stringValue:{type:"string",id:17},bytesValue:{type:"bytes",id:18},referenceValue:{type:"string",id:5},geoPointValue:{type:"google.type.LatLng",id:8},arrayValue:{type:"ArrayValue",id:9},mapValue:{type:"MapValue",id:6}}},ArrayValue:{fields:{values:{rule:"repeated",type:"Value",id:1}}},MapValue:{fields:{fields:{keyType:"string",type:"Value",id:1}}},Firestore:{options:{"(google.api.default_host)":"firestore.googleapis.com","(google.api.oauth_scopes)":"https://www.googleapis.com/auth/cloud-platform,https://www.googleapis.com/auth/datastore"},methods:{GetDocument:{requestType:"GetDocumentRequest",responseType:"Document",options:{"(google.api.http).get":"/v1/{name=projects/*/databases/*/documents/*/**}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{name=projects/*/databases/*/documents/*/**}"}}]},ListDocuments:{requestType:"ListDocumentsRequest",responseType:"ListDocumentsResponse",options:{"(google.api.http).get":"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"},parsedOptions:[{"(google.api.http)":{get:"/v1/{parent=projects/*/databases/*/documents/*/**}/{collection_id}"}}]},UpdateDocument:{requestType:"UpdateDocumentRequest",responseType:"Document",options:{"(google.api.http).patch":"/v1/{document.name=projects/*/databases/*/documents/*/**}","(google.api.http).body":"document","(google.api.method_signature)":"document,update_mask"},parsedOptions:[{"(google.api.http)":{patch:"/v1/{document.name=projects/*/databases/*/documents/*/**}",body:"document"}},{"(google.api.method_signature)":"document,update_mask"}]},DeleteDocument:{requestType:"DeleteDocumentRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).delete":"/v1/{name=projects/*/databases/*/documents/*/**}","(google.api.method_signature)":"name"},parsedOptions:[{"(google.api.http)":{delete:"/v1/{name=projects/*/databases/*/documents/*/**}"}},{"(google.api.method_signature)":"name"}]},BatchGetDocuments:{requestType:"BatchGetDocumentsRequest",responseType:"BatchGetDocumentsResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchGet","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchGet",body:"*"}}]},BeginTransaction:{requestType:"BeginTransactionRequest",responseType:"BeginTransactionResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:beginTransaction","(google.api.http).body":"*","(google.api.method_signature)":"database"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:beginTransaction",body:"*"}},{"(google.api.method_signature)":"database"}]},Commit:{requestType:"CommitRequest",responseType:"CommitResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:commit","(google.api.http).body":"*","(google.api.method_signature)":"database,writes"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:commit",body:"*"}},{"(google.api.method_signature)":"database,writes"}]},Rollback:{requestType:"RollbackRequest",responseType:"google.protobuf.Empty",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:rollback","(google.api.http).body":"*","(google.api.method_signature)":"database,transaction"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:rollback",body:"*"}},{"(google.api.method_signature)":"database,transaction"}]},RunQuery:{requestType:"RunQueryRequest",responseType:"RunQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runQuery",body:"*"}}}]},RunAggregationQuery:{requestType:"RunAggregationQueryRequest",responseType:"RunAggregationQueryResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:runAggregationQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:runAggregationQuery",body:"*"}}}]},PartitionQuery:{requestType:"PartitionQueryRequest",responseType:"PartitionQueryResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:partitionQuery","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery","(google.api.http).additional_bindings.body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:partitionQuery",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:partitionQuery",body:"*"}}}]},Write:{requestType:"WriteRequest",requestStream:!0,responseType:"WriteResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:write","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:write",body:"*"}}]},Listen:{requestType:"ListenRequest",requestStream:!0,responseType:"ListenResponse",responseStream:!0,options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:listen","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:listen",body:"*"}}]},ListCollectionIds:{requestType:"ListCollectionIdsRequest",responseType:"ListCollectionIdsResponse",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds","(google.api.http).body":"*","(google.api.http).additional_bindings.post":"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds","(google.api.http).additional_bindings.body":"*","(google.api.method_signature)":"parent"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents}:listCollectionIds",body:"*",additional_bindings:{post:"/v1/{parent=projects/*/databases/*/documents/*/**}:listCollectionIds",body:"*"}}},{"(google.api.method_signature)":"parent"}]},BatchWrite:{requestType:"BatchWriteRequest",responseType:"BatchWriteResponse",options:{"(google.api.http).post":"/v1/{database=projects/*/databases/*}/documents:batchWrite","(google.api.http).body":"*"},parsedOptions:[{"(google.api.http)":{post:"/v1/{database=projects/*/databases/*}/documents:batchWrite",body:"*"}}]},CreateDocument:{requestType:"CreateDocumentRequest",responseType:"Document",options:{"(google.api.http).post":"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}","(google.api.http).body":"document"},parsedOptions:[{"(google.api.http)":{post:"/v1/{parent=projects/*/databases/*/documents/**}/{collection_id}",body:"document"}}]}}},GetDocumentRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:5}}},ListDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:3},pageToken:{type:"string",id:4},orderBy:{type:"string",id:6},mask:{type:"DocumentMask",id:7},transaction:{type:"bytes",id:8},readTime:{type:"google.protobuf.Timestamp",id:10},showMissing:{type:"bool",id:12}}},ListDocumentsResponse:{fields:{documents:{rule:"repeated",type:"Document",id:1},nextPageToken:{type:"string",id:2}}},CreateDocumentRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},collectionId:{type:"string",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}},documentId:{type:"string",id:3},document:{type:"Document",id:4,options:{"(google.api.field_behavior)":"REQUIRED"}},mask:{type:"DocumentMask",id:5}}},UpdateDocumentRequest:{fields:{document:{type:"Document",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},updateMask:{type:"DocumentMask",id:2},mask:{type:"DocumentMask",id:3},currentDocument:{type:"Precondition",id:4}}},DeleteDocumentRequest:{fields:{name:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},currentDocument:{type:"Precondition",id:2}}},BatchGetDocumentsRequest:{oneofs:{consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},documents:{rule:"repeated",type:"string",id:2},mask:{type:"DocumentMask",id:3},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:7}}},BatchGetDocumentsResponse:{oneofs:{result:{oneof:["found","missing"]}},fields:{found:{type:"Document",id:1},missing:{type:"string",id:2},transaction:{type:"bytes",id:3},readTime:{type:"google.protobuf.Timestamp",id:4}}},BeginTransactionRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},options:{type:"TransactionOptions",id:2}}},BeginTransactionResponse:{fields:{transaction:{type:"bytes",id:1}}},CommitRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},transaction:{type:"bytes",id:3}}},CommitResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},commitTime:{type:"google.protobuf.Timestamp",id:2}}},RollbackRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},transaction:{type:"bytes",id:2,options:{"(google.api.field_behavior)":"REQUIRED"}}}},RunQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},transaction:{type:"bytes",id:5},newTransaction:{type:"TransactionOptions",id:6},readTime:{type:"google.protobuf.Timestamp",id:7}}},RunQueryResponse:{fields:{transaction:{type:"bytes",id:2},document:{type:"Document",id:1},readTime:{type:"google.protobuf.Timestamp",id:3},skippedResults:{type:"int32",id:4}}},RunAggregationQueryRequest:{oneofs:{queryType:{oneof:["structuredAggregationQuery"]},consistencySelector:{oneof:["transaction","newTransaction","readTime"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredAggregationQuery:{type:"StructuredAggregationQuery",id:2},transaction:{type:"bytes",id:4},newTransaction:{type:"TransactionOptions",id:5},readTime:{type:"google.protobuf.Timestamp",id:6}}},RunAggregationQueryResponse:{fields:{result:{type:"AggregationResult",id:1},transaction:{type:"bytes",id:2},readTime:{type:"google.protobuf.Timestamp",id:3}}},PartitionQueryRequest:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},structuredQuery:{type:"StructuredQuery",id:2},partitionCount:{type:"int64",id:3},pageToken:{type:"string",id:4},pageSize:{type:"int32",id:5}}},PartitionQueryResponse:{fields:{partitions:{rule:"repeated",type:"Cursor",id:1},nextPageToken:{type:"string",id:2}}},WriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},streamId:{type:"string",id:2},writes:{rule:"repeated",type:"Write",id:3},streamToken:{type:"bytes",id:4},labels:{keyType:"string",type:"string",id:5}}},WriteResponse:{fields:{streamId:{type:"string",id:1},streamToken:{type:"bytes",id:2},writeResults:{rule:"repeated",type:"WriteResult",id:3},commitTime:{type:"google.protobuf.Timestamp",id:4}}},ListenRequest:{oneofs:{targetChange:{oneof:["addTarget","removeTarget"]}},fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},addTarget:{type:"Target",id:2},removeTarget:{type:"int32",id:3},labels:{keyType:"string",type:"string",id:4}}},ListenResponse:{oneofs:{responseType:{oneof:["targetChange","documentChange","documentDelete","documentRemove","filter"]}},fields:{targetChange:{type:"TargetChange",id:2},documentChange:{type:"DocumentChange",id:3},documentDelete:{type:"DocumentDelete",id:4},documentRemove:{type:"DocumentRemove",id:6},filter:{type:"ExistenceFilter",id:5}}},Target:{oneofs:{targetType:{oneof:["query","documents"]},resumeType:{oneof:["resumeToken","readTime"]}},fields:{query:{type:"QueryTarget",id:2},documents:{type:"DocumentsTarget",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:11},targetId:{type:"int32",id:5},once:{type:"bool",id:6},expectedCount:{type:"google.protobuf.Int32Value",id:12}},nested:{DocumentsTarget:{fields:{documents:{rule:"repeated",type:"string",id:2}}},QueryTarget:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{parent:{type:"string",id:1},structuredQuery:{type:"StructuredQuery",id:2}}}}},TargetChange:{fields:{targetChangeType:{type:"TargetChangeType",id:1},targetIds:{rule:"repeated",type:"int32",id:2},cause:{type:"google.rpc.Status",id:3},resumeToken:{type:"bytes",id:4},readTime:{type:"google.protobuf.Timestamp",id:6}},nested:{TargetChangeType:{values:{NO_CHANGE:0,ADD:1,REMOVE:2,CURRENT:3,RESET:4}}}},ListCollectionIdsRequest:{fields:{parent:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},pageSize:{type:"int32",id:2},pageToken:{type:"string",id:3}}},ListCollectionIdsResponse:{fields:{collectionIds:{rule:"repeated",type:"string",id:1},nextPageToken:{type:"string",id:2}}},BatchWriteRequest:{fields:{database:{type:"string",id:1,options:{"(google.api.field_behavior)":"REQUIRED"}},writes:{rule:"repeated",type:"Write",id:2},labels:{keyType:"string",type:"string",id:3}}},BatchWriteResponse:{fields:{writeResults:{rule:"repeated",type:"WriteResult",id:1},status:{rule:"repeated",type:"google.rpc.Status",id:2}}},StructuredQuery:{fields:{select:{type:"Projection",id:1},from:{rule:"repeated",type:"CollectionSelector",id:2},where:{type:"Filter",id:3},orderBy:{rule:"repeated",type:"Order",id:4},startAt:{type:"Cursor",id:7},endAt:{type:"Cursor",id:8},offset:{type:"int32",id:6},limit:{type:"google.protobuf.Int32Value",id:5}},nested:{CollectionSelector:{fields:{collectionId:{type:"string",id:2},allDescendants:{type:"bool",id:3}}},Filter:{oneofs:{filterType:{oneof:["compositeFilter","fieldFilter","unaryFilter"]}},fields:{compositeFilter:{type:"CompositeFilter",id:1},fieldFilter:{type:"FieldFilter",id:2},unaryFilter:{type:"UnaryFilter",id:3}}},CompositeFilter:{fields:{op:{type:"Operator",id:1},filters:{rule:"repeated",type:"Filter",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,AND:1,OR:2}}}},FieldFilter:{fields:{field:{type:"FieldReference",id:1},op:{type:"Operator",id:2},value:{type:"Value",id:3}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,LESS_THAN:1,LESS_THAN_OR_EQUAL:2,GREATER_THAN:3,GREATER_THAN_OR_EQUAL:4,EQUAL:5,NOT_EQUAL:6,ARRAY_CONTAINS:7,IN:8,ARRAY_CONTAINS_ANY:9,NOT_IN:10}}}},UnaryFilter:{oneofs:{operandType:{oneof:["field"]}},fields:{op:{type:"Operator",id:1},field:{type:"FieldReference",id:2}},nested:{Operator:{values:{OPERATOR_UNSPECIFIED:0,IS_NAN:2,IS_NULL:3,IS_NOT_NAN:4,IS_NOT_NULL:5}}}},Order:{fields:{field:{type:"FieldReference",id:1},direction:{type:"Direction",id:2}}},FieldReference:{fields:{fieldPath:{type:"string",id:2}}},Projection:{fields:{fields:{rule:"repeated",type:"FieldReference",id:2}}},Direction:{values:{DIRECTION_UNSPECIFIED:0,ASCENDING:1,DESCENDING:2}}}},StructuredAggregationQuery:{oneofs:{queryType:{oneof:["structuredQuery"]}},fields:{structuredQuery:{type:"StructuredQuery",id:1},aggregations:{rule:"repeated",type:"Aggregation",id:3}},nested:{Aggregation:{oneofs:{operator:{oneof:["count","sum","avg"]}},fields:{count:{type:"Count",id:1},sum:{type:"Sum",id:2},avg:{type:"Avg",id:3},alias:{type:"string",id:7}},nested:{Count:{fields:{upTo:{type:"google.protobuf.Int64Value",id:1}}},Sum:{fields:{field:{type:"FieldReference",id:1}}},Avg:{fields:{field:{type:"FieldReference",id:1}}}}}}},Cursor:{fields:{values:{rule:"repeated",type:"Value",id:1},before:{type:"bool",id:2}}},Write:{oneofs:{operation:{oneof:["update","delete","verify","transform"]}},fields:{update:{type:"Document",id:1},delete:{type:"string",id:2},verify:{type:"string",id:5},transform:{type:"DocumentTransform",id:6},updateMask:{type:"DocumentMask",id:3},updateTransforms:{rule:"repeated",type:"DocumentTransform.FieldTransform",id:7},currentDocument:{type:"Precondition",id:4}}},DocumentTransform:{fields:{document:{type:"string",id:1},fieldTransforms:{rule:"repeated",type:"FieldTransform",id:2}},nested:{FieldTransform:{oneofs:{transformType:{oneof:["setToServerValue","increment","maximum","minimum","appendMissingElements","removeAllFromArray"]}},fields:{fieldPath:{type:"string",id:1},setToServerValue:{type:"ServerValue",id:2},increment:{type:"Value",id:3},maximum:{type:"Value",id:4},minimum:{type:"Value",id:5},appendMissingElements:{type:"ArrayValue",id:6},removeAllFromArray:{type:"ArrayValue",id:7}},nested:{ServerValue:{values:{SERVER_VALUE_UNSPECIFIED:0,REQUEST_TIME:1}}}}}},WriteResult:{fields:{updateTime:{type:"google.protobuf.Timestamp",id:1},transformResults:{rule:"repeated",type:"Value",id:2}}},DocumentChange:{fields:{document:{type:"Document",id:1},targetIds:{rule:"repeated",type:"int32",id:5},removedTargetIds:{rule:"repeated",type:"int32",id:6}}},DocumentDelete:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:6},readTime:{type:"google.protobuf.Timestamp",id:4}}},DocumentRemove:{fields:{document:{type:"string",id:1},removedTargetIds:{rule:"repeated",type:"int32",id:2},readTime:{type:"google.protobuf.Timestamp",id:4}}},ExistenceFilter:{fields:{targetId:{type:"int32",id:1},count:{type:"int32",id:2},unchangedNames:{type:"BloomFilter",id:3}}}}}}},api:{options:{go_package:"google.golang.org/genproto/googleapis/api/annotations;annotations",java_multiple_files:!0,java_outer_classname:"HttpProto",java_package:"com.google.api",objc_class_prefix:"GAPI",cc_enable_arenas:!0},nested:{http:{type:"HttpRule",id:72295728,extend:"google.protobuf.MethodOptions"},Http:{fields:{rules:{rule:"repeated",type:"HttpRule",id:1}}},HttpRule:{oneofs:{pattern:{oneof:["get","put","post","delete","patch","custom"]}},fields:{get:{type:"string",id:2},put:{type:"string",id:3},post:{type:"string",id:4},delete:{type:"string",id:5},patch:{type:"string",id:6},custom:{type:"CustomHttpPattern",id:8},selector:{type:"string",id:1},body:{type:"string",id:7},additionalBindings:{rule:"repeated",type:"HttpRule",id:11}}},CustomHttpPattern:{fields:{kind:{type:"string",id:1},path:{type:"string",id:2}}},methodSignature:{rule:"repeated",type:"string",id:1051,extend:"google.protobuf.MethodOptions"},defaultHost:{type:"string",id:1049,extend:"google.protobuf.ServiceOptions"},oauthScopes:{type:"string",id:1050,extend:"google.protobuf.ServiceOptions"},fieldBehavior:{rule:"repeated",type:"google.api.FieldBehavior",id:1052,extend:"google.protobuf.FieldOptions"},FieldBehavior:{values:{FIELD_BEHAVIOR_UNSPECIFIED:0,OPTIONAL:1,REQUIRED:2,OUTPUT_ONLY:3,INPUT_ONLY:4,IMMUTABLE:5,UNORDERED_LIST:6,NON_EMPTY_DEFAULT:7}}}},type:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/type/latlng;latlng",java_multiple_files:!0,java_outer_classname:"LatLngProto",java_package:"com.google.type",objc_class_prefix:"GTP"},nested:{LatLng:{fields:{latitude:{type:"double",id:1},longitude:{type:"double",id:2}}}}},rpc:{options:{cc_enable_arenas:!0,go_package:"google.golang.org/genproto/googleapis/rpc/status;status",java_multiple_files:!0,java_outer_classname:"StatusProto",java_package:"com.google.rpc",objc_class_prefix:"RPC"},nested:{Status:{fields:{code:{type:"int32",id:1},message:{type:"string",id:2},details:{rule:"repeated",type:"google.protobuf.Any",id:3}}}}}}}},Fj={nested:SN},Lj=Object.freeze({__proto__:null,nested:SN,default:Fj});var Bj={longs:String,enums:String,defaults:!0,oneofs:!1};function Vj(){let n=V1.fromJSON(Lj,Bj);return _s.loadPackageDefinition(n)}function qj(n){let e=Vj();return new bS(e,n)}function Uj(){return new TS}function wN(){return process.env.USE_MOCK_PERSISTENCE==="YES"?window:null}function zj(){return null}function Gc(n){return new W_(n,!1)}var jj="ExponentialBackoff",Gj=1e3,Hj=1.5,Kj=60*1e3,Nc=class{constructor(e,t,r=Gj,i=Hj,s=Kj){this.queue=e,this.timerId=t,this.initialDelayMs=r,this.backoffFactor=i,this.maxDelayMs=s,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}reset(){this.currentBaseMs=0}resetToMax(){this.currentBaseMs=this.maxDelayMs}backoffAndRun(e){this.cancel();let t=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,t-r);i>0&&D(jj,`Backing off for ${i} ms (base delay: ${this.currentBaseMs} ms, delay with jitter: ${t} ms, last attempt: ${r} ms ago)`),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,()=>(this.lastAttemptTime=Date.now(),e())),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)}skipBackoff(){this.timerPromise!==null&&(this.timerPromise.skipDelay(),this.timerPromise=null)}cancel(){this.timerPromise!==null&&(this.timerPromise.cancel(),this.timerPromise=null)}jitterDelayMs(){return(Math.random()-.5)*this.currentBaseMs}};var b1="PersistentStream",Wj=60*1e3,$j=10*1e3,Pf=class{constructor(e,t,r,i,s,o,a,l){this.queue=e,this.idleTimerId=r,this.healthTimerId=i,this.connection=s,this.authCredentialsProvider=o,this.appCheckCredentialsProvider=a,this.listener=l,this.state=0,this.closeCount=0,this.idleTimer=null,this.healthCheck=null,this.stream=null,this.backoff=new Nc(e,t)}isStarted(){return this.state===1||this.state===5||this.isOpen()}isOpen(){return this.state===2||this.state===3}start(){if(this.state===4){this.performBackoff();return}this.auth()}stop(){return g(this,null,function*(){this.isStarted()&&(yield this.close(0))})}inhibitBackoff(){this.state=0,this.backoff.reset()}markIdle(){this.isOpen()&&this.idleTimer===null&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,Wj,()=>this.handleIdleCloseTimer()))}sendRequest(e){this.cancelIdleCheck(),this.stream.send(e)}handleIdleCloseTimer(){return g(this,null,function*(){if(this.isOpen())return this.close(0)})}cancelIdleCheck(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)}cancelHealthCheck(){this.healthCheck&&(this.healthCheck.cancel(),this.healthCheck=null)}close(e,t){return g(this,null,function*(){this.cancelIdleCheck(),this.cancelHealthCheck(),this.backoff.cancel(),this.closeCount++,e!==4?this.backoff.reset():t&&t.code===v.RESOURCE_EXHAUSTED?(Ne(t.toString()),Ne("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):t&&t.code===v.UNAUTHENTICATED&&this.state!==3&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),this.stream!==null&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=e,yield this.listener.onClose(t)})}tearDown(){}auth(){this.state=1;let e=this.getCloseGuardedDispatcher(this.closeCount),t=this.closeCount;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(([r,i])=>{this.closeCount===t&&this.startStream(r,i)},r=>{e(()=>{let i=new T(v.UNKNOWN,"Fetching auth token failed: "+r.message);return this.handleStreamClose(i)})})}startStream(e,t){let r=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(e,t),this.stream.onOpen(()=>{r(()=>(this.state=2,this.healthCheck=this.queue.enqueueAfterDelay(this.healthTimerId,$j,()=>(this.isOpen()&&(this.state=3),Promise.resolve())),this.listener.onOpen()))}),this.stream.onClose(i=>{r(()=>this.handleStreamClose(i))}),this.stream.onMessage(i=>{r(()=>this.onMessage(i))})}performBackoff(){this.state=5,this.backoff.backoffAndRun(()=>g(this,null,function*(){this.state=0,this.start()}))}handleStreamClose(e){return D(b1,`close with error: ${e}`),this.stream=null,this.close(4,e)}getCloseGuardedDispatcher(e){return t=>{this.queue.enqueueAndForget(()=>this.closeCount===e?t():(D(b1,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}},AS=class extends Pf{constructor(e,t,r,i,s,o){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s}startRpc(e,t){return this.connection.openStream("Listen",e,t)}onMessage(e){this.backoff.reset();let t=oz(this.serializer,e),r=lz(e);return this.listener.onWatchChange(t,r)}watch(e){let t={};t.database=Cc(this.serializer),t.addTarget=_z(this.serializer,e);let r=yz(this.serializer,e);r&&(t.labels=r),this.sendRequest(t)}unwatch(e){let t={};t.database=Cc(this.serializer),t.removeTarget=e,this.sendRequest(t)}},IS=class extends Pf{constructor(e,t,r,i,s,o){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,i,o),this.serializer=s,this.handshakeComplete_=!1}get handshakeComplete(){return this.handshakeComplete_}start(){this.handshakeComplete_=!1,this.lastStreamToken=void 0,super.start()}tearDown(){this.handshakeComplete_&&this.writeMutations([])}startRpc(e,t){return this.connection.openStream("Write",e,t)}onMessage(e){if(q(!!e.streamToken),this.lastStreamToken=e.streamToken,this.handshakeComplete_){this.backoff.reset();let t=hz(e.writeResults,e.commitTime),r=Ge(e.commitTime);return this.listener.onMutationResult(r,t)}else return q(!e.writeResults||e.writeResults.length===0),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()}writeHandshake(){let e={};e.database=Cc(this.serializer),this.sendRequest(e)}writeMutations(e){let t={streamToken:this.lastStreamToken,writes:e.map(r=>bc(this.serializer,r))};this.sendRequest(t)}};var DS=class{},RS=class extends DS{constructor(e,t,r,i){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=i,this.terminated=!1}verifyInitialized(){if(this.terminated)throw new T(v.FAILED_PRECONDITION,"The client has already been terminated.")}invokeRPC(e,t,r){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([i,s])=>this.connection.invokeRPC(e,t,r,i,s)).catch(i=>{throw i.name==="FirebaseError"?(i.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),i):new T(v.UNKNOWN,i.toString())})}invokeStreamingRPC(e,t,r,i){return this.verifyInitialized(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(([s,o])=>this.connection.invokeStreamingRPC(e,t,r,s,o,i)).catch(s=>{throw s.name==="FirebaseError"?(s.code===v.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),s):new T(v.UNKNOWN,s.toString())})}terminate(){this.terminated=!0}};function Qj(n,e,t,r){return new RS(n,e,t,r)}function Yj(n,e){return g(this,null,function*(){let t=P(n),r=Cc(t.serializer)+"/documents",i={writes:e.map(s=>bc(t.serializer,s))};yield t.invokeRPC("Commit",r,i)})}function Xj(n,e){return g(this,null,function*(){let t=P(n),r=Cc(t.serializer)+"/documents",i={documents:e.map(l=>Tc(t.serializer,l))},s=yield t.invokeStreamingRPC("BatchGetDocuments",r,i,e.length),o=new Map;s.forEach(l=>{let c=sz(t.serializer,l);o.set(c.key.toString(),c)});let a=[];return e.forEach(l=>{let c=o.get(l.toString());q(!!c),a.push(c)}),a})}function Jj(n,e,t){let r=P(n);return r.verifyInitialized(),new IS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}function Zj(n,e,t){let r=P(n);return r.verifyInitialized(),new AS(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,t)}var eG="OnlineStateTracker",A1=1,I1=10*1e3,NS=class{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}handleWatchStreamStart(){this.watchStreamFailures===0&&(this.setAndBroadcast("Unknown"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay("online_state_timeout",I1,()=>(this.onlineStateTimer=null,this.logClientOfflineWarningIfNecessary(`Backend didn't respond within ${I1/1e3} seconds.`),this.setAndBroadcast("Offline"),Promise.resolve())))}handleWatchStreamFailure(e){this.state==="Online"?this.setAndBroadcast("Unknown"):(this.watchStreamFailures++,this.watchStreamFailures>=A1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary(`Connection failed ${A1} times. Most recent error: ${e.toString()}`),this.setAndBroadcast("Offline")))}set(e){this.clearOnlineStateTimer(),this.watchStreamFailures=0,e==="Online"&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(e)}setAndBroadcast(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}logClientOfflineWarningIfNecessary(e){let t=`Could not reach Cloud Firestore backend. ${e}
This typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.shouldWarnClientIsOffline?(Ne(t),this.shouldWarnClientIsOffline=!1):D(eG,t)}clearOnlineStateTimer(){this.onlineStateTimer!==null&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)}};var Rs="RemoteStore",tG=10,kS=class{constructor(e,t,r,i,s){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.writePipeline=[],this.listenTargets=new Map,this.offlineCauses=new Set,this.onNetworkStatusChange=[],this.connectivityMonitor=s,this.connectivityMonitor.addCallback(o=>{r.enqueueAndForget(()=>g(this,null,function*(){Ui(this)&&(D(Rs,"Restarting streams for network reachability change."),yield vG(this))}))}),this.onlineStateTracker=new NS(r,i)}};function nG(n,e,t,r,i){return new kS(n,e,t,r,i)}function rG(n){let e=P(n);return e.offlineCauses.delete(0),Hc(e)}function Hc(n){return g(this,null,function*(){if(Ui(n))for(let e of n.onNetworkStatusChange)yield e(!0)})}function iG(n){return g(this,null,function*(){let e=P(n);e.offlineCauses.add(0),yield Ra(e),e.onlineStateTracker.set("Offline")})}function Ra(n){return g(this,null,function*(){for(let e of n.onNetworkStatusChange)yield e(!1)})}function sG(n){return g(this,null,function*(){let e=P(n);D(Rs,"RemoteStore shutting down."),e.offlineCauses.add(5),yield Ra(e),e.connectivityMonitor.shutdown(),e.onlineStateTracker.set("Unknown")})}function lp(n,e){let t=P(n);t.listenTargets.has(e.targetId)||(t.listenTargets.set(e.targetId,e),O0(t)?M0(t):ka(t).isOpen()&&k0(t,e))}function Kc(n,e){let t=P(n),r=ka(t);t.listenTargets.delete(e),r.isOpen()&&EN(t,e),t.listenTargets.size===0&&(r.isOpen()?r.markIdle():Ui(t)&&t.onlineStateTracker.set("Unknown"))}function k0(n,e){if(n.watchChangeAggregator.recordPendingTargetRequest(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(j.min())>0){let t=n.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(t)}ka(n).watch(e)}function EN(n,e){n.watchChangeAggregator.recordPendingTargetRequest(e),ka(n).unwatch(e)}function M0(n){n.watchChangeAggregator=new K_({getRemoteKeysForTarget:e=>n.remoteSyncer.getRemoteKeysForTarget(e),getTargetDataForTarget:e=>n.listenTargets.get(e)||null,getDatabaseId:()=>n.datastore.serializer.databaseId}),ka(n).start(),n.onlineStateTracker.handleWatchStreamStart()}function O0(n){return Ui(n)&&!ka(n).isStarted()&&n.listenTargets.size>0}function Ui(n){return P(n).offlineCauses.size===0}function TN(n){n.watchChangeAggregator=void 0}function oG(n){return g(this,null,function*(){n.listenTargets.forEach((e,t)=>{k0(n,e)})})}function aG(n,e){return g(this,null,function*(){TN(n),O0(n)?(n.onlineStateTracker.handleWatchStreamFailure(e),M0(n)):n.onlineStateTracker.set("Unknown")})}function lG(n,e,t){return g(this,null,function*(){if(n.onlineStateTracker.set("Online"),e instanceof _f&&e.state===2&&e.cause){try{yield uG(n,e)}catch(r){D(Rs,"Failed to remove targets %s: %s ",e.targetIds.join(","),r),yield Ff(n,r)}return}if(e instanceof oa?n.watchChangeAggregator.handleDocumentChange(e):e instanceof vf?n.watchChangeAggregator.handleExistenceFilter(e):n.watchChangeAggregator.handleTargetChange(e),!t.isEqual(j.min()))try{let r=yield hN(n.localStore);t.compareTo(r)>=0&&(yield cG(n,t))}catch(r){D(Rs,"Failed to raise snapshot:",r),yield Ff(n,r)}})}function Ff(n,e,t){return g(this,null,function*(){if(qi(e))n.offlineCauses.add(1),yield Ra(n),n.onlineStateTracker.set("Offline"),t||(t=()=>hN(n.localStore)),n.asyncQueue.enqueueRetryable(()=>g(this,null,function*(){D(Rs,"Retrying IndexedDB access"),yield t(),n.offlineCauses.delete(1),yield Hc(n)}));else throw e})}function CN(n,e){return e().catch(t=>Ff(n,t,e))}function cG(n,e){let t=n.watchChangeAggregator.createRemoteEvent(e);return t.targetChanges.forEach((r,i)=>{if(r.resumeToken.approximateByteSize()>0){let s=n.listenTargets.get(i);s&&n.listenTargets.set(i,s.withResumeToken(r.resumeToken,e))}}),t.targetMismatches.forEach((r,i)=>{let s=n.listenTargets.get(r);if(!s)return;n.listenTargets.set(r,s.withResumeToken(at.EMPTY_BYTE_STRING,s.snapshotVersion)),EN(n,r);let o=new ga(s.target,r,i,s.sequenceNumber);k0(n,o)}),n.remoteSyncer.applyRemoteEvent(t)}function uG(n,e){return g(this,null,function*(){let t=e.cause;for(let r of e.targetIds)n.listenTargets.has(r)&&(yield n.remoteSyncer.rejectListen(r,t),n.listenTargets.delete(r),n.watchChangeAggregator.removeTarget(r))})}function Na(n){return g(this,null,function*(){let e=P(n),t=zi(e),r=e.writePipeline.length>0?e.writePipeline[e.writePipeline.length-1].batchId:Ai;for(;dG(e);)try{let i=yield uj(e.localStore,r);if(i===null){e.writePipeline.length===0&&t.markIdle();break}else r=i.batchId,hG(e,i)}catch(i){yield Ff(e,i)}bN(e)&&AN(e)})}function dG(n){return Ui(n)&&n.writePipeline.length<tG}function hG(n,e){n.writePipeline.push(e);let t=zi(n);t.isOpen()&&t.handshakeComplete&&t.writeMutations(e.mutations)}function bN(n){return Ui(n)&&!zi(n).isStarted()&&n.writePipeline.length>0}function AN(n){zi(n).start()}function fG(n){return g(this,null,function*(){zi(n).writeHandshake()})}function pG(n){return g(this,null,function*(){let e=zi(n);for(let t of n.writePipeline)e.writeMutations(t.mutations)})}function gG(n,e,t){return g(this,null,function*(){let r=n.writePipeline.shift(),i=z_.from(r,e,t);yield CN(n,()=>n.remoteSyncer.applySuccessfulWrite(i)),yield Na(n)})}function mG(n,e){return g(this,null,function*(){e&&zi(n).handshakeComplete&&(yield yG(n,e)),bN(n)&&AN(n)})}function yG(n,e){return g(this,null,function*(){if(z4(e.code)){let t=n.writePipeline.shift();zi(n).inhibitBackoff(),yield CN(n,()=>n.remoteSyncer.rejectFailedWrite(t.batchId,e)),yield Na(n)}})}function vG(n){return g(this,null,function*(){let e=P(n);e.offlineCauses.add(4),yield Ra(e),e.onlineStateTracker.set("Unknown"),e.offlineCauses.delete(4),yield Hc(e)})}function D1(n,e){return g(this,null,function*(){let t=P(n);t.asyncQueue.verifyOperationInProgress(),D(Rs,"RemoteStore received new credentials");let r=Ui(t);t.offlineCauses.add(3),yield Ra(t),r&&t.onlineStateTracker.set("Unknown"),yield t.remoteSyncer.handleCredentialChange(e),t.offlineCauses.delete(3),yield Hc(t)})}function MS(n,e){return g(this,null,function*(){let t=P(n);e?(t.offlineCauses.delete(2),yield Hc(t)):e||(t.offlineCauses.add(2),yield Ra(t),t.onlineStateTracker.set("Unknown"))})}function ka(n){return n.watchStream||(n.watchStream=Zj(n.datastore,n.asyncQueue,{onOpen:oG.bind(null,n),onClose:aG.bind(null,n),onWatchChange:lG.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.watchStream.inhibitBackoff(),O0(n)?M0(n):n.onlineStateTracker.set("Unknown")):(yield n.watchStream.stop(),TN(n))}))),n.watchStream}function zi(n){return n.writeStream||(n.writeStream=Jj(n.datastore,n.asyncQueue,{onOpen:fG.bind(null,n),onClose:mG.bind(null,n),onHandshakeComplete:pG.bind(null,n),onMutationResult:gG.bind(null,n)}),n.onNetworkStatusChange.push(e=>g(this,null,function*(){e?(n.writeStream.inhibitBackoff(),yield Na(n)):(yield n.writeStream.stop(),n.writePipeline.length>0&&(D(Rs,`Stopping write stream with ${n.writePipeline.length} pending writes`),n.writePipeline=[]))}))),n.writeStream}var _G="AsyncQueue",OS=class n{constructor(e,t,r,i,s){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=i,this.removalCallback=s,this.deferred=new je,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(o=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,i,s){let o=Date.now()+r,a=new n(e,t,o,i,s);return a.start(r),a}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){this.timerHandle!==null&&(this.clearTimeout(),this.deferred.reject(new T(v.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>this.timerHandle!==null?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){this.timerHandle!==null&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}};function Ma(n,e){if(Ne(_G,`${e}: ${n}`),qi(n))return new T(v.UNAVAILABLE,`${e}: ${n}`);throw n}var Lf=class n{constructor(e){e?this.comparator=(t,r)=>e(t,r)||O.comparator(t.key,r.key):this.comparator=(t,r)=>O.comparator(t.key,r.key),this.keyedMap=nc(),this.sortedSet=new Ce(this.comparator)}static emptySet(e){return new n(e.comparator)}has(e){return this.keyedMap.get(e)!=null}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){let t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){let t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){let t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof n)||this.size!==e.size)return!1;let t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){let i=t.getNext().key,s=r.getNext().key;if(!i.isEqual(s))return!1}return!0}toString(){let e=[];return this.forEach(t=>{e.push(t.toString())}),e.length===0?"DocumentSet ()":`DocumentSet (
  `+e.join(`  
`)+`
)`}copy(e,t){let r=new n;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}};var Bf=class{constructor(){this.changeMap=new Ce(O.comparator)}track(e){let t=e.doc.key,r=this.changeMap.get(t);if(!r){this.changeMap=this.changeMap.insert(t,e);return}e.type!==0&&r.type===3?this.changeMap=this.changeMap.insert(t,e):e.type===3&&r.type!==1?this.changeMap=this.changeMap.insert(t,{type:r.type,doc:e.doc}):e.type===2&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):e.type===2&&r.type===0?this.changeMap=this.changeMap.insert(t,{type:0,doc:e.doc}):e.type===1&&r.type===0?this.changeMap=this.changeMap.remove(t):e.type===1&&r.type===2?this.changeMap=this.changeMap.insert(t,{type:1,doc:r.doc}):e.type===0&&r.type===1?this.changeMap=this.changeMap.insert(t,{type:2,doc:e.doc}):L()}getChanges(){let e=[];return this.changeMap.inorderTraversal((t,r)=>{e.push(r)}),e}},_a=class n{constructor(e,t,r,i,s,o,a,l,c){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=i,this.mutatedKeys=s,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=l,this.hasCachedResults=c}static fromInitialDocuments(e,t,r,i,s){let o=[];return t.forEach(a=>{o.push({type:0,doc:a})}),new n(e,t,Lf.emptySet(t),o,r,i,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(this.fromCache!==e.fromCache||this.hasCachedResults!==e.hasCachedResults||this.syncStateChanged!==e.syncStateChanged||!this.mutatedKeys.isEqual(e.mutatedKeys)||!Uc(this.query,e.query)||!this.docs.isEqual(e.docs)||!this.oldDocs.isEqual(e.oldDocs))return!1;let t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let i=0;i<t.length;i++)if(t[i].type!==r[i].type||!t[i].doc.isEqual(r[i].doc))return!1;return!0}};var xS=class{constructor(){this.viewSnap=void 0,this.listeners=[]}};function SG(){return new PS}var PS=class{constructor(){this.queries=new ur(e=>CR(e),Uc),this.onlineState="Unknown",this.snapshotsInSyncListeners=new Set}};function x0(n,e){return g(this,null,function*(){let t=P(n),r=e.query,i=!1,s=t.queries.get(r);if(s||(i=!0,s=new xS),i)try{s.viewSnap=yield t.onListen(r)}catch(o){let a=Ma(o,`Initialization of query '${Zo(e.query)}' failed`);e.onError(a);return}t.queries.set(r,s),s.listeners.push(e),e.applyOnlineStateChange(t.onlineState),s.viewSnap&&e.onViewSnapshot(s.viewSnap)&&F0(t)})}function P0(n,e){return g(this,null,function*(){let t=P(n),r=e.query,i=!1,s=t.queries.get(r);if(s){let o=s.listeners.indexOf(e);o>=0&&(s.listeners.splice(o,1),i=s.listeners.length===0)}if(i)return t.queries.delete(r),t.onUnlisten(r)})}function wG(n,e){let t=P(n),r=!1;for(let i of e){let s=i.query,o=t.queries.get(s);if(o){for(let a of o.listeners)a.onViewSnapshot(i)&&(r=!0);o.viewSnap=i}}r&&F0(t)}function EG(n,e,t){let r=P(n),i=r.queries.get(e);if(i)for(let s of i.listeners)s.onError(t);r.queries.delete(e)}function TG(n,e){let t=P(n);t.onlineState=e;let r=!1;t.queries.forEach((i,s)=>{for(let o of s.listeners)o.applyOnlineStateChange(e)&&(r=!0)}),r&&F0(t)}function CG(n,e){P(n).snapshotsInSyncListeners.add(e),e.next()}function bG(n,e){P(n).snapshotsInSyncListeners.delete(e)}function F0(n){n.snapshotsInSyncListeners.forEach(e=>{e.next()})}var kc=class{constructor(e,t,r){this.query=e,this.queryObserver=t,this.raisedInitialEvent=!1,this.snap=null,this.onlineState="Unknown",this.options=r||{}}onViewSnapshot(e){if(!this.options.includeMetadataChanges){let r=[];for(let i of e.docChanges)i.type!==3&&r.push(i);e=new _a(e.query,e.docs,e.oldDocs,r,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(e)&&(this.queryObserver.next(e),t=!0):this.shouldRaiseInitialEvent(e,this.onlineState)&&(this.raiseInitialEvent(e),t=!0),this.snap=e,t}onError(e){this.queryObserver.error(e)}applyOnlineStateChange(e){this.onlineState=e;let t=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,e)&&(this.raiseInitialEvent(this.snap),t=!0),t}shouldRaiseInitialEvent(e,t){if(!e.fromCache)return!0;let r=t!=="Offline";return this.options.waitForSyncWhenOnline&&r?!1:!e.docs.isEmpty()||e.hasCachedResults||t==="Offline"}shouldRaiseEvent(e){if(e.docChanges.length>0)return!0;let t=this.snap&&this.snap.hasPendingWrites!==e.hasPendingWrites;return e.syncStateChanged||t?this.options.includeMetadataChanges===!0:!1}raiseInitialEvent(e){e=_a.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.raisedInitialEvent=!0,this.queryObserver.next(e)}};var FS=class n{constructor(e,t,r,i){this.targetId=e,this.fromCache=t,this.addedKeys=r,this.removedKeys=i}static fromSnapshot(e,t){let r=J(),i=J();for(let s of t.docChanges)switch(s.type){case 0:r=r.add(s.doc.key);break;case 1:i=i.add(s.doc.key);break}return new n(e,t.fromCache,r,i)}};var Vf=class{constructor(e){this.serializer=e}toDocumentKey(e){return ar(this.serializer,e)}toMutableDocument(e){return e.metadata.exists?WR(this.serializer,e.document,!1):Ye.newNoDocument(this.toDocumentKey(e.metadata.name),this.toSnapshotVersion(e.metadata.readTime))}toSnapshotVersion(e){return Ge(e)}},LS=class{constructor(e,t,r){this.bundleMetadata=e,this.localStore=t,this.serializer=r,this.queries=[],this.documents=[],this.collectionGroups=new Set,this.progress=IN(e)}addSizedElement(e){this.progress.bytesLoaded+=e.byteLength;let t=this.progress.documentsLoaded;if(e.payload.namedQuery)this.queries.push(e.payload.namedQuery);else if(e.payload.documentMetadata){this.documents.push({metadata:e.payload.documentMetadata}),e.payload.documentMetadata.exists||++t;let r=ue.fromString(e.payload.documentMetadata.name);this.collectionGroups.add(r.get(r.length-2))}else e.payload.document&&(this.documents[this.documents.length-1].document=e.payload.document,++t);return t!==this.progress.documentsLoaded?(this.progress.documentsLoaded=t,Object.assign({},this.progress)):null}getQueryDocumentMapping(e){let t=new Map,r=new Vf(this.serializer);for(let i of e)if(i.metadata.queries){let s=r.toDocumentKey(i.metadata.name);for(let o of i.metadata.queries){let a=(t.get(o)||J()).add(s);t.set(o,a)}}return t}complete(){return g(this,null,function*(){let e=yield vj(this.localStore,new Vf(this.serializer),this.documents,this.bundleMetadata.id),t=this.getQueryDocumentMapping(this.documents);for(let r of this.queries)yield Ej(this.localStore,r,t.get(r.name));return this.progress.taskState="Success",{progress:this.progress,changedCollectionGroups:this.collectionGroups,changedDocs:e}})}};function IN(n){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}function AG(n){return{taskState:"Success",documentsLoaded:n.totalDocuments,bytesLoaded:n.totalBytes,totalDocuments:n.totalDocuments,totalBytes:n.totalBytes}}var qf=class{constructor(e){this.key=e}},Uf=class{constructor(e){this.key=e}},zf=class{constructor(e,t){this.query=e,this._syncedDocuments=t,this.syncState=null,this.hasCachedResults=!1,this.current=!1,this.limboDocuments=J(),this.mutatedKeys=J(),this.docComparator=AR(e),this.documentSet=new Lf(this.docComparator)}get syncedDocuments(){return this._syncedDocuments}computeDocChanges(e,t){let r=t?t.changeSet:new Bf,i=t?t.documentSet:this.documentSet,s=t?t.mutatedKeys:this.mutatedKeys,o=i,a=!1,l=this.query.limitType==="F"&&i.size===this.query.limit?i.last():null,c=this.query.limitType==="L"&&i.size===this.query.limit?i.first():null;if(e.inorderTraversal((u,d)=>{let h=i.get(u),p=zc(this.query,d)?d:null,y=h?this.mutatedKeys.has(h.key):!1,_=p?p.hasLocalMutations||this.mutatedKeys.has(p.key)&&p.hasCommittedMutations:!1,S=!1;h&&p?h.data.isEqual(p.data)?y!==_&&(r.track({type:3,doc:p}),S=!0):this.shouldWaitForSyncedDocument(h,p)||(r.track({type:2,doc:p}),S=!0,(l&&this.docComparator(p,l)>0||c&&this.docComparator(p,c)<0)&&(a=!0)):!h&&p?(r.track({type:0,doc:p}),S=!0):h&&!p&&(r.track({type:1,doc:h}),S=!0,(l||c)&&(a=!0)),S&&(p?(o=o.add(p),_?s=s.add(u):s=s.delete(u)):(o=o.delete(u),s=s.delete(u)))}),this.query.limit!==null)for(;o.size>this.query.limit;){let u=this.query.limitType==="F"?o.last():o.first();o=o.delete(u.key),s=s.delete(u.key),r.track({type:1,doc:u})}return{documentSet:o,changeSet:r,needsRefill:a,mutatedKeys:s}}shouldWaitForSyncedDocument(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,i){let s=this.documentSet;this.documentSet=e.documentSet,this.mutatedKeys=e.mutatedKeys;let o=e.changeSet.getChanges();o.sort((d,h)=>IG(d.type,h.type)||this.docComparator(d.doc,h.doc)),this.applyTargetChange(r),i=i??!1;let a=t&&!i?this.updateLimboDocuments():[],c=this.limboDocuments.size===0&&this.current&&!i?1:0,u=c!==this.syncState;return this.syncState=c,o.length===0&&!u?{limboChanges:a}:{snapshot:new _a(this.query,e.documentSet,s,o,e.mutatedKeys,c===0,u,!1,r?r.resumeToken.approximateByteSize()>0:!1),limboChanges:a}}applyOnlineStateChange(e){return this.current&&e==="Offline"?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Bf,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}}shouldBeInLimbo(e){return!(this._syncedDocuments.has(e)||!this.documentSet.has(e)||this.documentSet.get(e).hasLocalMutations)}applyTargetChange(e){e&&(e.addedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.add(t)),e.modifiedDocuments.forEach(t=>{}),e.removedDocuments.forEach(t=>this._syncedDocuments=this._syncedDocuments.delete(t)),this.current=e.current)}updateLimboDocuments(){if(!this.current)return[];let e=this.limboDocuments;this.limboDocuments=J(),this.documentSet.forEach(r=>{this.shouldBeInLimbo(r.key)&&(this.limboDocuments=this.limboDocuments.add(r.key))});let t=[];return e.forEach(r=>{this.limboDocuments.has(r)||t.push(new Uf(r))}),this.limboDocuments.forEach(r=>{e.has(r)||t.push(new qf(r))}),t}synchronizeWithPersistedState(e){this._syncedDocuments=e.remoteKeys,this.limboDocuments=J();let t=this.computeDocChanges(e.documents);return this.applyChanges(t,!0)}computeInitialSnapshot(){return _a.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===0,this.hasCachedResults)}};function IG(n,e){let t=r=>{switch(r){case 0:return 1;case 2:return 2;case 3:return 2;case 1:return 0;default:return L()}};return t(n)-t(e)}var ji="SyncEngine",BS=class{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}},VS=class{constructor(e){this.key=e,this.receivedDocument=!1}},qS=class{constructor(e,t,r,i,s,o){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=i,this.currentUser=s,this.maxConcurrentLimboResolutions=o,this.syncEngineListener={},this.queryViewsByQuery=new ur(a=>CR(a),Uc),this.queriesByTarget=new Map,this.enqueuedLimboResolutions=new Set,this.activeLimboTargetsByKey=new Ce(O.comparator),this.activeLimboResolutionsByTarget=new Map,this.limboDocumentRefs=new Ic,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=ma.forSyncEngine(),this.onlineState="Unknown",this._isPrimaryClient=void 0}get isPrimaryClient(){return this._isPrimaryClient===!0}};function DG(n,e,t,r,i,s,o){let a=new qS(n,e,t,r,i,s);return o&&(a._isPrimaryClient=!0),a}function RG(n,e){return g(this,null,function*(){let t=z0(n),r,i,s=t.queryViewsByQuery.get(e);if(s)r=s.targetId,t.sharedClientState.addLocalQueryTarget(r),i=s.view.computeInitialSnapshot();else{let o=yield ya(t.localStore,Ft(e)),a=t.sharedClientState.addLocalQueryTarget(o.targetId);r=o.targetId,i=yield L0(t,e,r,a==="current",o.resumeToken),t.isPrimaryClient&&lp(t.remoteStore,o)}return i})}function L0(n,e,t,r,i){return g(this,null,function*(){n.applyDocChanges=(d,h,p)=>VG(n,d,h,p);let s=yield ap(n.localStore,e,!0),o=new zf(e,s.remoteKeys),a=o.computeDocChanges(s.documents),l=Ec.createSynthesizedTargetChangeForCurrentChange(t,r&&n.onlineState!=="Offline",i),c=o.applyChanges(a,n.isPrimaryClient,l);q0(n,t,c.limboChanges);let u=new BS(e,t,o);return n.queryViewsByQuery.set(e,u),n.queriesByTarget.has(t)?n.queriesByTarget.get(t).push(e):n.queriesByTarget.set(t,[e]),c.snapshot})}function NG(n,e){return g(this,null,function*(){let t=P(n),r=t.queryViewsByQuery.get(e),i=t.queriesByTarget.get(r.targetId);if(i.length>1){t.queriesByTarget.set(r.targetId,i.filter(s=>!Uc(s,e))),t.queryViewsByQuery.delete(e);return}t.isPrimaryClient?(t.sharedClientState.removeLocalQueryTarget(r.targetId),t.sharedClientState.isActiveQueryTarget(r.targetId)||(yield va(t.localStore,r.targetId,!1).then(()=>{t.sharedClientState.clearQueryState(r.targetId),Kc(t.remoteStore,r.targetId),Sa(t,r.targetId)}).catch(Vi))):(Sa(t,r.targetId),yield va(t.localStore,r.targetId,!0))})}function kG(n,e,t){return g(this,null,function*(){let r=j0(n);try{let i=yield nj(r.localStore,e);r.sharedClientState.addPendingMutation(i.batchId),LG(r,i.batchId,t),yield xr(r,i.changes),yield Na(r.remoteStore)}catch(i){let s=Ma(i,"Failed to persist write");t.reject(s)}})}function DN(n,e){return g(this,null,function*(){let t=P(n);try{let r=yield aj(t.localStore,e);e.targetChanges.forEach((i,s)=>{let o=t.activeLimboResolutionsByTarget.get(s);o&&(q(i.addedDocuments.size+i.modifiedDocuments.size+i.removedDocuments.size<=1),i.addedDocuments.size>0?o.receivedDocument=!0:i.modifiedDocuments.size>0?q(o.receivedDocument):i.removedDocuments.size>0&&(q(o.receivedDocument),o.receivedDocument=!1))}),yield xr(t,r,e)}catch(r){yield Vi(r)}})}function R1(n,e,t){let r=P(n);if(r.isPrimaryClient&&t===0||!r.isPrimaryClient&&t===1){let i=[];r.queryViewsByQuery.forEach((s,o)=>{let a=o.view.applyOnlineStateChange(e);a.snapshot&&i.push(a.snapshot)}),TG(r.eventManager,e),i.length&&r.syncEngineListener.onWatchChange(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function MG(n,e,t){return g(this,null,function*(){let r=P(n);r.sharedClientState.updateQueryState(e,"rejected",t);let i=r.activeLimboResolutionsByTarget.get(e),s=i&&i.key;if(s){let o=new Ce(O.comparator);o=o.insert(s,Ye.newNoDocument(s,j.min()));let a=J().add(s),l=new wc(j.min(),new Map,new Ce(X),o,a);yield DN(r,l),r.activeLimboTargetsByKey=r.activeLimboTargetsByKey.remove(s),r.activeLimboResolutionsByTarget.delete(e),U0(r)}else yield va(r.localStore,e,!1).then(()=>Sa(r,e,t)).catch(Vi)})}function OG(n,e){return g(this,null,function*(){let t=P(n),r=e.batch.batchId;try{let i=yield rj(t.localStore,e);V0(t,r,null),B0(t,r),t.sharedClientState.updateMutationState(r,"acknowledged"),yield xr(t,i)}catch(i){yield Vi(i)}})}function xG(n,e,t){return g(this,null,function*(){let r=P(n);try{let i=yield sj(r.localStore,e);V0(r,e,t),B0(r,e),r.sharedClientState.updateMutationState(e,"rejected",t),yield xr(r,i)}catch(i){yield Vi(i)}})}function PG(n,e){return g(this,null,function*(){let t=P(n);Ui(t.remoteStore)||D(ji,"The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled.");try{let r=yield oj(t.localStore);if(r===Ai){e.resolve();return}let i=t.pendingWritesCallbacks.get(r)||[];i.push(e),t.pendingWritesCallbacks.set(r,i)}catch(r){let i=Ma(r,"Initialization of waitForPendingWrites() operation failed");e.reject(i)}})}function B0(n,e){(n.pendingWritesCallbacks.get(e)||[]).forEach(t=>{t.resolve()}),n.pendingWritesCallbacks.delete(e)}function FG(n,e){n.pendingWritesCallbacks.forEach(t=>{t.forEach(r=>{r.reject(new T(v.CANCELLED,e))})}),n.pendingWritesCallbacks.clear()}function LG(n,e,t){let r=n.mutationUserCallbacks[n.currentUser.toKey()];r||(r=new Ce(X)),r=r.insert(e,t),n.mutationUserCallbacks[n.currentUser.toKey()]=r}function V0(n,e,t){let r=P(n),i=r.mutationUserCallbacks[r.currentUser.toKey()];if(i){let s=i.get(e);s&&(t?s.reject(t):s.resolve(),i=i.remove(e)),r.mutationUserCallbacks[r.currentUser.toKey()]=i}}function Sa(n,e,t=null){n.sharedClientState.removeLocalQueryTarget(e);for(let r of n.queriesByTarget.get(e))n.queryViewsByQuery.delete(r),t&&n.syncEngineListener.onWatchError(r,t);n.queriesByTarget.delete(e),n.isPrimaryClient&&n.limboDocumentRefs.removeReferencesForId(e).forEach(i=>{n.limboDocumentRefs.containsKey(i)||RN(n,i)})}function RN(n,e){n.enqueuedLimboResolutions.delete(e.path.canonicalString());let t=n.activeLimboTargetsByKey.get(e);t!==null&&(Kc(n.remoteStore,t),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.remove(e),n.activeLimboResolutionsByTarget.delete(t),U0(n))}function q0(n,e,t){for(let r of t)r instanceof qf?(n.limboDocumentRefs.addReference(r.key,e),BG(n,r)):r instanceof Uf?(D(ji,"Document no longer in limbo: "+r.key),n.limboDocumentRefs.removeReference(r.key,e),n.limboDocumentRefs.containsKey(r.key)||RN(n,r.key)):L()}function BG(n,e){let t=e.key,r=t.path.canonicalString();!n.activeLimboTargetsByKey.get(t)&&!n.enqueuedLimboResolutions.has(r)&&(D(ji,"New document in limbo: "+t),n.enqueuedLimboResolutions.add(r),U0(n))}function U0(n){for(;n.enqueuedLimboResolutions.size>0&&n.activeLimboTargetsByKey.size<n.maxConcurrentLimboResolutions;){let e=n.enqueuedLimboResolutions.values().next().value;n.enqueuedLimboResolutions.delete(e);let t=new O(ue.fromString(e)),r=n.limboTargetIdGenerator.next();n.activeLimboResolutionsByTarget.set(r,new VS(t)),n.activeLimboTargetsByKey=n.activeLimboTargetsByKey.insert(t,r),lp(n.remoteStore,new ga(Ft(Da(t.path)),r,"TargetPurposeLimboResolution",Xt.INVALID))}}function xr(n,e,t){return g(this,null,function*(){let r=P(n),i=[],s=[],o=[];r.queryViewsByQuery.isEmpty()||(r.queryViewsByQuery.forEach((a,l)=>{o.push(r.applyDocChanges(l,e,t).then(c=>{if((c||t)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(l.targetId,c?.fromCache?"not-current":"current"),c){i.push(c);let u=FS.fromSnapshot(l.targetId,c);s.push(u)}}))}),yield Promise.all(o),r.syncEngineListener.onWatchChange(i),yield cj(r.localStore,s))})}function VG(n,e,t,r){return g(this,null,function*(){let i=e.view.computeDocChanges(t);i.needsRefill&&(i=yield ap(n.localStore,e.query,!1).then(({documents:l})=>e.view.computeDocChanges(l,i)));let s=r&&r.targetChanges.get(e.targetId),o=r&&r.targetMismatches.get(e.targetId)!=null,a=e.view.applyChanges(i,n.isPrimaryClient,s,o);return q0(n,e.targetId,a.limboChanges),a.snapshot})}function qG(n,e){return g(this,null,function*(){let t=P(n);if(!t.currentUser.isEqual(e)){D(ji,"User change. New user:",e.toKey());let i=yield dN(t.localStore,e);t.currentUser=e,FG(t,"'waitForPendingWrites' promise is rejected due to a user change."),t.sharedClientState.handleUserChange(e,i.removedBatchIds,i.addedBatchIds),yield xr(t,i.affectedDocuments)}})}function UG(n,e){let t=P(n),r=t.activeLimboResolutionsByTarget.get(e);if(r&&r.receivedDocument)return J().add(r.key);{let i=J(),s=t.queriesByTarget.get(e);if(!s)return i;for(let o of s){let a=t.queryViewsByQuery.get(o);i=i.unionWith(a.view.syncedDocuments)}return i}}function zG(n,e){return g(this,null,function*(){let t=P(n),r=yield ap(t.localStore,e.query,!0),i=e.view.synchronizeWithPersistedState(r);return t.isPrimaryClient&&q0(t,e.targetId,i.limboChanges),i})}function jG(n,e){return g(this,null,function*(){let t=P(n);return gN(t.localStore,e).then(r=>xr(t,r))})}function GG(n,e,t,r){return g(this,null,function*(){let i=P(n),s=yield pj(i.localStore,e);if(s===null){D(ji,"Cannot apply mutation batch with id: "+e);return}t==="pending"?yield Na(i.remoteStore):t==="acknowledged"||t==="rejected"?(V0(i,e,r||null),B0(i,e),gj(i.localStore,e)):L(),yield xr(i,s)})}function HG(n,e){return g(this,null,function*(){let t=P(n);if(z0(t),j0(t),e===!0&&t._isPrimaryClient!==!0){let r=t.sharedClientState.getAllActiveQueryTargets(),i=yield N1(t,r.toArray());t._isPrimaryClient=!0,yield MS(t.remoteStore,!0);for(let s of i)lp(t.remoteStore,s)}else if(e===!1&&t._isPrimaryClient!==!1){let r=[],i=Promise.resolve();t.queriesByTarget.forEach((s,o)=>{t.sharedClientState.isLocalQueryTarget(o)?r.push(o):i=i.then(()=>(Sa(t,o),va(t.localStore,o,!0))),Kc(t.remoteStore,o)}),yield i,yield N1(t,r),KG(t),t._isPrimaryClient=!1,yield MS(t.remoteStore,!1)}})}function KG(n){let e=P(n);e.activeLimboResolutionsByTarget.forEach((t,r)=>{Kc(e.remoteStore,r)}),e.limboDocumentRefs.removeAllReferences(),e.activeLimboResolutionsByTarget=new Map,e.activeLimboTargetsByKey=new Ce(O.comparator)}function N1(n,e,t){return g(this,null,function*(){let r=P(n),i=[],s=[];for(let o of e){let a,l=r.queriesByTarget.get(o);if(l&&l.length!==0){a=yield ya(r.localStore,Ft(l[0]));for(let c of l){let u=r.queryViewsByQuery.get(c),d=yield zG(r,u);d.snapshot&&s.push(d.snapshot)}}else{let c=yield pN(r.localStore,o);a=yield ya(r.localStore,c),yield L0(r,NN(c),o,!1,a.resumeToken)}i.push(a)}return r.syncEngineListener.onWatchChange(s),i})}function NN(n){return TR(n.path,n.collectionGroup,n.orderBy,n.filters,n.limit,"F",n.startAt,n.endAt)}function WG(n){let e=P(n);return mj(e.localStore)}function $G(n,e,t,r){return g(this,null,function*(){let i=P(n);if(i._isPrimaryClient){D(ji,"Ignoring unexpected query state notification.");return}let s=i.queriesByTarget.get(e);if(s&&s.length>0)switch(t){case"current":case"not-current":{let o=yield gN(i.localStore,bR(s[0])),a=wc.createSynthesizedRemoteEventForCurrentChange(e,t==="current",at.EMPTY_BYTE_STRING);yield xr(i,o,a);break}case"rejected":{yield va(i.localStore,e,!0),Sa(i,e,r);break}default:L()}})}function QG(n,e,t){return g(this,null,function*(){let r=z0(n);if(r._isPrimaryClient){for(let i of e){if(r.queriesByTarget.has(i)){D(ji,"Adding an already active target "+i);continue}let s=yield pN(r.localStore,i),o=yield ya(r.localStore,s);yield L0(r,NN(s),o.targetId,!1,o.resumeToken),lp(r.remoteStore,o)}for(let i of t)r.queriesByTarget.has(i)&&(yield va(r.localStore,i,!1).then(()=>{Kc(r.remoteStore,i),Sa(r,i)}).catch(Vi))}})}function z0(n){let e=P(n);return e.remoteStore.remoteSyncer.applyRemoteEvent=DN.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=UG.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=MG.bind(null,e),e.syncEngineListener.onWatchChange=wG.bind(null,e.eventManager),e.syncEngineListener.onWatchError=EG.bind(null,e.eventManager),e}function j0(n){let e=P(n);return e.remoteStore.remoteSyncer.applySuccessfulWrite=OG.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=xG.bind(null,e),e}function YG(n,e,t){let r=P(n);XG(r,e,t).then(i=>{r.sharedClientState.notifyBundleLoaded(i)})}function XG(n,e,t){return g(this,null,function*(){try{let r=yield e.getMetadata();if(yield _j(n.localStore,r))return yield e.close(),t._completeWith(AG(r)),Promise.resolve(new Set);t._updateProgress(IN(r));let s=new LS(r,n.localStore,e.serializer),o=yield e.nextElement();for(;o;){let l=yield s.addSizedElement(o);l&&t._updateProgress(l),o=yield e.nextElement()}let a=yield s.complete();return yield xr(n,a.changedDocs,void 0),yield Sj(n.localStore,r),t._completeWith(a.progress),Promise.resolve(a.changedCollectionGroups)}catch(r){return gn(ji,`Loading bundle failed with ${r}`),t._failWith(r),Promise.resolve(new Set)}})}var Mc=class{constructor(){this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){this.serializer=Gc(e.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(e),this.persistence=this.createPersistence(e),yield this.persistence.start(),this.localStore=this.createLocalStore(e),this.gcScheduler=this.createGarbageCollectionScheduler(e,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(e,this.localStore)})}createGarbageCollectionScheduler(e,t){return null}createIndexBackfillerScheduler(e,t){return null}createLocalStore(e){return uN(this.persistence,new kf,e.initialUser,this.serializer)}createPersistence(e){return new Rf(Nf.factory,this.serializer)}createSharedClientState(e){return new xf}terminate(){return g(this,null,function*(){this.gcScheduler&&this.gcScheduler.stop(),yield this.sharedClientState.shutdown(),yield this.persistence.shutdown()})}};var jf=class n extends Mc{constructor(e,t,r){super(),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.forceOwnership=r,this.synchronizeTabs=!1}initialize(e){return g(this,null,function*(){yield Ep(n.prototype,this,"initialize").call(this,e),yield this.onlineComponentProvider.initialize(this,e),yield j0(this.onlineComponentProvider.syncEngine),yield Na(this.onlineComponentProvider.remoteStore),yield this.persistence.setPrimaryStateListener(()=>(this.gcScheduler&&!this.gcScheduler.started&&this.gcScheduler.start(),this.indexBackfillerScheduler&&!this.indexBackfillerScheduler.started&&this.indexBackfillerScheduler.start(),Promise.resolve()))})}createLocalStore(e){return uN(this.persistence,new kf,e.initialUser,this.serializer)}createGarbageCollectionScheduler(e,t){let r=this.persistence.referenceDelegate.garbageCollector;return new oS(r,e.asyncQueue,t)}createIndexBackfillerScheduler(e,t){let r=new T_(t,this.persistence);return new E_(e.asyncQueue,r)}createPersistence(e){let t=R0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey),r=this.cacheSizeBytes!==void 0?pn.withCacheSize(this.cacheSizeBytes):pn.DEFAULT;return new SS(this.synchronizeTabs,t,e.clientId,r,e.asyncQueue,wN(),zj(),this.serializer,this.sharedClientState,!!this.forceOwnership)}createSharedClientState(e){return new xf}},US=class n extends jf{constructor(e,t){super(e,t,!1),this.onlineComponentProvider=e,this.cacheSizeBytes=t,this.synchronizeTabs=!0}initialize(e){return g(this,null,function*(){yield Ep(n.prototype,this,"initialize").call(this,e);let t=this.onlineComponentProvider.syncEngine;this.sharedClientState instanceof cc&&(this.sharedClientState.syncEngine={applyBatchState:GG.bind(null,t),applyTargetState:$G.bind(null,t),applyActiveTargetsChange:QG.bind(null,t),getActiveClients:WG.bind(null,t),synchronizeWithChangedDocuments:jG.bind(null,t)},yield this.sharedClientState.start()),yield this.persistence.setPrimaryStateListener(r=>g(this,null,function*(){yield HG(this.onlineComponentProvider.syncEngine,r),this.gcScheduler&&(r&&!this.gcScheduler.started?this.gcScheduler.start():r||this.gcScheduler.stop()),this.indexBackfillerScheduler&&(r&&!this.indexBackfillerScheduler.started?this.indexBackfillerScheduler.start():r||this.indexBackfillerScheduler.stop())}))})}createSharedClientState(e){let t=wN();if(!cc.isAvailable(t))throw new T(v.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");let r=R0(e.databaseInfo.databaseId,e.databaseInfo.persistenceKey);return new cc(t,e.asyncQueue,r,e.clientId,e.initialUser)}},Oc=class{initialize(e,t){return g(this,null,function*(){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=r=>R1(this.syncEngine,r,1),this.remoteStore.remoteSyncer.handleCredentialChange=qG.bind(null,this.syncEngine),yield MS(this.remoteStore,this.syncEngine.isPrimaryClient))})}createEventManager(e){return SG()}createDatastore(e){let t=Gc(e.databaseInfo.databaseId),r=qj(e.databaseInfo);return Qj(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return nG(this.localStore,this.datastore,e.asyncQueue,t=>R1(this.syncEngine,t,0),Uj())}createSyncEngine(e,t){return DG(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}terminate(){return sG(this.remoteStore)}};var JG=10240;function ZG(n,e=JG){let t=0;return{read(){return g(this,null,function*(){if(t<n.byteLength){let s={value:n.slice(t,t+e),done:!1};return t+=e,s}return{done:!0}})},cancel(){return g(this,null,function*(){})},releaseLock(){},closed:Promise.resolve()}}function G0(n,e,t){if(!t)throw new T(v.INVALID_ARGUMENT,`Function ${n}() cannot be called with an empty ${e}.`)}function H0(n,e,t,r){if(e===!0&&r===!0)throw new T(v.INVALID_ARGUMENT,`${n} and ${t} cannot be used together.`)}function k1(n){if(!O.isDocumentKey(n))throw new T(v.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${n} has ${n.length}.`)}function M1(n){if(O.isDocumentKey(n))throw new T(v.INVALID_ARGUMENT,`Invalid collection reference. Collection references must have an odd number of segments, but ${n} has ${n.length}.`)}function e9(n){return typeof n=="object"&&n!==null&&(Object.getPrototypeOf(n)===Object.prototype||Object.getPrototypeOf(n)===null)}function Wc(n){if(n===void 0)return"undefined";if(n===null)return"null";if(typeof n=="string")return n.length>20&&(n=`${n.substring(0,20)}...`),JSON.stringify(n);if(typeof n=="number"||typeof n=="boolean")return""+n;if(typeof n=="object"){if(n instanceof Array)return"an array";{let e=t9(n);return e?`a custom ${e} object`:"an object"}}else return typeof n=="function"?"a function":L()}function t9(n){return n.constructor?n.constructor.name:null}function se(n,e){if("_delegate"in n&&(n=n._delegate),!(n instanceof e)){if(e.name===n.constructor.name)throw new T(v.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{let t=Wc(n);throw new T(v.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${t}`)}}return n}function kN(n,e){if(e<=0)throw new T(v.INVALID_ARGUMENT,`Function ${n}() requires a positive number, but it was: ${e}.`)}function n9(n,e){if(!(n instanceof Uint8Array))throw new T(v.INVALID_ARGUMENT,`NodePlatform.toByteStreamReader expects source to be Uint8Array, got ${Wc(n)}`);return ZG(n,e)}var wa=class{constructor(e){this.observer=e,this.muted=!1}next(e){this.observer.next&&this.scheduleEvent(this.observer.next,e)}error(e){this.observer.error?this.scheduleEvent(this.observer.error,e):Ne("Uncaught Error in snapshot listener:",e.toString())}mute(){this.muted=!0}scheduleEvent(e,t){this.muted||setTimeout(()=>{this.muted||e(t)},0)}};var zS=class{constructor(e,t){this.payload=e,this.byteLength=t}isBundleMetadata(){return"metadata"in this.payload}};var jS=class{constructor(e,t){this.reader=e,this.serializer=t,this.metadata=new je,this.buffer=new Uint8Array,this.textDecoder=j4(),this.nextElementImpl().then(r=>{r&&r.isBundleMetadata()?this.metadata.resolve(r.payload.metadata):this.metadata.reject(new Error(`The first element of the bundle is not a metadata, it is
             ${JSON.stringify(r?.payload)}`))},r=>this.metadata.reject(r))}close(){return this.reader.cancel()}getMetadata(){return g(this,null,function*(){return this.metadata.promise})}nextElement(){return g(this,null,function*(){return yield this.getMetadata(),this.nextElementImpl()})}nextElementImpl(){return g(this,null,function*(){let e=yield this.readLength();if(e===null)return null;let t=this.textDecoder.decode(e),r=Number(t);isNaN(r)&&this.raiseError(`length string (${t}) is not valid number`);let i=yield this.readJsonString(r);return new zS(JSON.parse(i),e.length+r)})}indexOfOpenBracket(){return this.buffer.findIndex(e=>e==="{".charCodeAt(0))}readLength(){return g(this,null,function*(){for(;this.indexOfOpenBracket()<0&&!(yield this.pullMoreDataToBuffer()););if(this.buffer.length===0)return null;let e=this.indexOfOpenBracket();e<0&&this.raiseError("Reached the end of bundle when a length string is expected.");let t=this.buffer.slice(0,e);return this.buffer=this.buffer.slice(e),t})}readJsonString(e){return g(this,null,function*(){for(;this.buffer.length<e;)(yield this.pullMoreDataToBuffer())&&this.raiseError("Reached the end of bundle when more is expected.");let t=this.textDecoder.decode(this.buffer.slice(0,e));return this.buffer=this.buffer.slice(e),t})}raiseError(e){throw this.reader.cancel(),new Error(`Invalid bundle format: ${e}`)}pullMoreDataToBuffer(){return g(this,null,function*(){let e=yield this.reader.read();if(!e.done){let t=new Uint8Array(this.buffer.length+e.value.length);t.set(this.buffer),t.set(e.value,this.buffer.length),this.buffer=t}return e.done})}};function r9(n,e){return new jS(n,e)}var GS=class{constructor(e){this.datastore=e,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}lookup(e){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new T(v.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");let t=yield Xj(this.datastore,e);return t.forEach(r=>this.recordVersion(r)),t})}set(e,t){this.write(t.toMutation(e,this.precondition(e))),this.writtenDocs.add(e.toString())}update(e,t){try{this.write(t.toMutation(e,this.preconditionForUpdate(e)))}catch(r){this.lastWriteError=r}this.writtenDocs.add(e.toString())}delete(e){this.write(new Fi(e,this.precondition(e))),this.writtenDocs.add(e.toString())}commit(){return g(this,null,function*(){if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;let e=this.readVersions;this.mutations.forEach(t=>{e.delete(t.key.toString())}),e.forEach((t,r)=>{let i=O.fromPath(r);this.mutations.push(new vc(i,this.precondition(i)))}),yield Yj(this.datastore,this.mutations),this.committed=!0})}recordVersion(e){let t;if(e.isFoundDocument())t=e.version;else if(e.isNoDocument())t=j.min();else throw L();let r=this.readVersions.get(e.key.toString());if(r){if(!t.isEqual(r))throw new T(v.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(e.key.toString(),t)}precondition(e){let t=this.readVersions.get(e.toString());return!this.writtenDocs.has(e.toString())&&t?t.isEqual(j.min())?Be.exists(!1):Be.updateTime(t):Be.none()}preconditionForUpdate(e){let t=this.readVersions.get(e.toString());if(!this.writtenDocs.has(e.toString())&&t){if(t.isEqual(j.min()))throw new T(v.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return Be.updateTime(t)}else return Be.exists(!0)}write(e){this.ensureCommitNotCalled(),this.mutations.push(e)}ensureCommitNotCalled(){}};var HS=class{constructor(e,t,r,i,s){this.asyncQueue=e,this.datastore=t,this.options=r,this.updateFunction=i,this.deferred=s,this.attemptsRemaining=r.maxAttempts,this.backoff=new Nc(this.asyncQueue,"transaction_retry")}run(){this.attemptsRemaining-=1,this.runWithBackOff()}runWithBackOff(){this.backoff.backoffAndRun(()=>g(this,null,function*(){let e=new GS(this.datastore),t=this.tryRunUpdateFunction(e);t&&t.then(r=>{this.asyncQueue.enqueueAndForget(()=>e.commit().then(()=>{this.deferred.resolve(r)}).catch(i=>{this.handleTransactionError(i)}))}).catch(r=>{this.handleTransactionError(r)})}))}tryRunUpdateFunction(e){try{let t=this.updateFunction(e);return Vc(t)||!t.catch||!t.then?(this.deferred.reject(Error("Transaction callback must return a Promise")),null):t}catch(t){return this.deferred.reject(t),null}}handleTransactionError(e){this.attemptsRemaining>0&&this.isRetryableTransactionError(e)?(this.attemptsRemaining-=1,this.asyncQueue.enqueueAndForget(()=>(this.runWithBackOff(),Promise.resolve()))):this.deferred.reject(e)}isRetryableTransactionError(e){if(e.name==="FirebaseError"){let t=e.code;return t==="aborted"||t==="failed-precondition"||t==="already-exists"||!UR(t)}return!1}};var Li="FirestoreClient",i9=100,s9=11,o9=20,a9=22,KS=class{constructor(e,t,r,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=i,this.user=Xe.UNAUTHENTICATED,this.clientId=lf.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(r,s=>g(this,null,function*(){D(Li,"Received user=",s.uid),yield this.authCredentialListener(s),this.user=s})),this.appCheckCredentials.start(r,s=>(D(Li,"Received new app check token=",s),this.appCheckCredentialListener(s,this.user)))}getConfiguration(){return g(this,null,function*(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:i9}})}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new T(v.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();let e=new je;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{this._onlineComponents&&(yield this._onlineComponents.terminate()),this._offlineComponents&&(yield this._offlineComponents.terminate()),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){let r=Ma(t,"Failed to shutdown persistence");e.reject(r)}})),e.promise}};function of(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress(),D(Li,"Initializing OfflineComponentProvider");let t=yield n.getConfiguration();yield e.initialize(t);let r=t.initialUser;n.setCredentialChangeListener(i=>g(this,null,function*(){r.isEqual(i)||(yield dN(e.localStore,i),r=i)})),e.persistence.setDatabaseDeletedListener(()=>n.terminate()),n._offlineComponents=e})}function WS(n,e){return g(this,null,function*(){n.asyncQueue.verifyOperationInProgress();let t=yield K0(n);D(Li,"Initializing OnlineComponentProvider");let r=yield n.getConfiguration();yield e.initialize(t,r),n.setCredentialChangeListener(i=>D1(e.remoteStore,i)),n.setAppCheckTokenChangeListener((i,s)=>D1(e.remoteStore,s)),n._onlineComponents=e})}function MN(n){return n.name==="FirebaseError"?n.code===v.FAILED_PRECONDITION||n.code===v.UNIMPLEMENTED:typeof DOMException<"u"&&n instanceof DOMException?n.code===a9||n.code===o9||n.code===s9:!0}function K0(n){return g(this,null,function*(){if(!n._offlineComponents)if(n._uninitializedComponentsProvider){D(Li,"Using user provided OfflineComponentProvider");try{yield of(n,n._uninitializedComponentsProvider._offline)}catch(e){let t=e;if(!MN(t))throw t;gn("Error using user provided cache. Falling back to memory cache: "+t),yield of(n,new Mc)}}else D(Li,"Using default OfflineComponentProvider"),yield of(n,new Mc);return n._offlineComponents})}function cp(n){return g(this,null,function*(){return n._onlineComponents||(n._uninitializedComponentsProvider?(D(Li,"Using user provided OnlineComponentProvider"),yield WS(n,n._uninitializedComponentsProvider._online)):(D(Li,"Using default OnlineComponentProvider"),yield WS(n,new Oc))),n._onlineComponents})}function ON(n){return K0(n).then(e=>e.persistence)}function W0(n){return K0(n).then(e=>e.localStore)}function xN(n){return cp(n).then(e=>e.remoteStore)}function $0(n){return cp(n).then(e=>e.syncEngine)}function l9(n){return cp(n).then(e=>e.datastore)}function Ea(n){return g(this,null,function*(){let e=yield cp(n),t=e.eventManager;return t.onListen=RG.bind(null,e.syncEngine),t.onUnlisten=NG.bind(null,e.syncEngine),t})}function c9(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield ON(n),t=yield xN(n);return e.setNetworkEnabled(!0),rG(t)}))}function u9(n){return n.asyncQueue.enqueue(()=>g(this,null,function*(){let e=yield ON(n),t=yield xN(n);return e.setNetworkEnabled(!1),iG(t)}))}function d9(n){let e=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let t=yield $0(n);return PG(t,e)})),e.promise}function h9(n,e,t,r){let i=new wa(r),s=new kc(e,i,t);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield Ea(n);return x0(o,s)})),()=>{i.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let o=yield Ea(n);return P0(o,s)}))}}function f9(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield W0(n);return v9(r,e,t)})),t.promise}function PN(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield Ea(n);return _9(i,n.asyncQueue,e,t,r)})),r.promise}function p9(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield W0(n);return S9(r,e,t)})),t.promise}function FN(n,e,t={}){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield Ea(n);return w9(i,n.asyncQueue,e,t,r)})),r.promise}function g9(n,e){let t=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield $0(n);return kG(r,e,t)})),t.promise}function m9(n,e){let t=new wa(e);return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield Ea(n);return CG(r,t)})),()=>{t.mute(),n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let r=yield Ea(n);return bG(r,t)}))}}function y9(n,e,t){let r=new je;return n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){let i=yield l9(n);new HS(n.asyncQueue,i,t,e,r).run()})),r.promise}function v9(n,e,t){return g(this,null,function*(){try{let r=yield dj(n,e);r.isFoundDocument()?t.resolve(r):r.isNoDocument()?t.resolve(null):t.reject(new T(v.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)"))}catch(r){let i=Ma(r,`Failed to get document '${e} from cache`);t.reject(i)}})}function _9(n,e,t,r,i){let s=new wa({next:a=>{e.enqueueAndForget(()=>P0(n,o));let l=a.docs.has(t);!l&&a.fromCache?i.reject(new T(v.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&r&&r.source==="server"?i.reject(new T(v.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new kc(Da(t.path),s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return x0(n,o)}function S9(n,e,t){return g(this,null,function*(){try{let r=yield ap(n,e,!0),i=new zf(e,r.remoteKeys),s=i.computeDocChanges(r.documents),o=i.applyChanges(s,!1);t.resolve(o.snapshot)}catch(r){let i=Ma(r,`Failed to execute query '${e} against cache`);t.reject(i)}})}function w9(n,e,t,r,i){let s=new wa({next:a=>{e.enqueueAndForget(()=>P0(n,o)),a.fromCache&&r.source==="server"?i.reject(new T(v.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(a)},error:a=>i.reject(a)}),o=new kc(t,s,{includeMetadataChanges:!0,waitForSyncWhenOnline:!0});return x0(n,o)}function E9(n,e,t,r){let i=C9(t,Gc(e));n.asyncQueue.enqueueAndForget(()=>g(this,null,function*(){YG(yield $0(n),i,r)}))}function T9(n,e){return n.asyncQueue.enqueue(()=>g(this,null,function*(){return wj(yield W0(n),e)}))}function C9(n,e){let t;return typeof n=="string"?t=zR().encode(n):t=n,r9(n9(t),e)}function b9(n,e){return n.timeoutSeconds===e.timeoutSeconds}function LN(n){let e={};return n.timeoutSeconds!==void 0&&(e.timeoutSeconds=n.timeoutSeconds),e}var A9="ComponentProvider",O1=new Map;function I9(n){let e=O1.get(n);e&&(D(A9,"Removing Datastore"),O1.delete(n),e.terminate())}function D9(n,e,t,r){return new R_(n,e,t,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,LN(r.experimentalLongPollingOptions),r.useFetchStreams)}var BN="firestore.googleapis.com",x1=!0,P1=5,F1=30,R9=!0,Gf=class{constructor(e){var t,r;if(e.host===void 0){if(e.ssl!==void 0)throw new T(v.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=BN,this.ssl=x1}else this.host=e.host,this.ssl=(t=e.ssl)!==null&&t!==void 0?t:x1;if(this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,e.cacheSizeBytes===void 0)this.cacheSizeBytes=aN;else{if(e.cacheSizeBytes!==jc&&e.cacheSizeBytes<y1)throw new T(v.INVALID_ARGUMENT,`cacheSizeBytes must be at least ${y1}`);this.cacheSizeBytes=e.cacheSizeBytes}H0("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:e.experimentalAutoDetectLongPolling===void 0?this.experimentalAutoDetectLongPolling=R9:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=LN((r=e.experimentalLongPollingOptions)!==null&&r!==void 0?r:{}),N9(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&b9(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}};function N9(n){if(n.timeoutSeconds!==void 0){if(isNaN(n.timeoutSeconds))throw new T(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (must not be NaN)`);if(n.timeoutSeconds<P1)throw new T(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (minimum allowed value is ${P1})`);if(n.timeoutSeconds>F1)throw new T(v.INVALID_ARGUMENT,`invalid long polling timeout: ${n.timeoutSeconds} (maximum allowed value is ${F1})`)}}var Ns=class{constructor(e,t,r,i){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=i,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Gf({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new T(v.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return this._terminateTask!==void 0}_setSettings(e){if(this._settingsFrozen)throw new T(v.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Gf(e),e.credentials!==void 0&&(this._authCredentials=RU(e.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return I9(this),Promise.resolve()}};function VN(n,e,t,r={}){var i;n=se(n,Ns);let s=n._getSettings(),o=`${e}:${t}`;if(s.host!==BN&&s.host!==o&&gn("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),n._setSettings(Object.assign(Object.assign({},s),{host:o,ssl:!1})),r.mockUserToken){let a,l;if(typeof r.mockUserToken=="string")a=r.mockUserToken,l=Xe.MOCK_USER;else{a=jw(r.mockUserToken,(i=n._app)===null||i===void 0?void 0:i.options.projectId);let c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new T(v.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");l=new Xe(c)}n._authCredentials=new f_(new af(a,l))}}var ft=class n{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new n(this.firestore,e,this._query)}},we=class n{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new lr(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new n(this.firestore,e,this._key)}},lr=class n extends ft{constructor(e,t,r){super(e,t,Da(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){let e=this._path.popLast();return e.isEmpty()?null:new we(this.firestore,null,new O(e))}withConverter(e){return new n(this.firestore,e,this._path)}};function Q0(n,e,...t){if(n=Re(n),G0("collection","path",e),n instanceof Ns){let r=ue.fromString(e,...t);return M1(r),new lr(n,null,r)}else{if(!(n instanceof we)&&!(n instanceof lr))throw new T(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ue.fromString(e,...t));return M1(r),new lr(n.firestore,null,r)}}function qN(n,e){if(n=se(n,Ns),G0("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new T(v.INVALID_ARGUMENT,`Invalid collection ID '${e}' passed to function collectionGroup(). Collection IDs must not contain '/'.`);return new ft(n,null,d4(e))}function $c(n,e,...t){if(n=Re(n),arguments.length===1&&(e=lf.newId()),G0("doc","path",e),n instanceof Ns){let r=ue.fromString(e,...t);return k1(r),new we(n,null,new O(r))}else{if(!(n instanceof we)&&!(n instanceof lr))throw new T(v.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");let r=n._path.child(ue.fromString(e,...t));return k1(r),new we(n.firestore,n instanceof lr?n.converter:null,new O(r))}}function Y0(n,e){return n=Re(n),e=Re(e),(n instanceof we||n instanceof lr)&&(e instanceof we||e instanceof lr)?n.firestore===e.firestore&&n.path===e.path&&n.converter===e.converter:!1}function X0(n,e){return n=Re(n),e=Re(e),n instanceof ft&&e instanceof ft?n.firestore===e.firestore&&Uc(n._query,e._query)&&n.converter===e.converter:!1}var k9="AsyncQueue",$S=class{constructor(){this.tail=Promise.resolve(),this.retryableOps=[],this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.skipNonRestrictedTasks=!1,this.timerIdsToSkip=[],this.backoff=new Nc(this,"async_queue_retry"),this.visibilityHandler=()=>{this.backoff.skipBackoff()}}get isShuttingDown(){return this._isShuttingDown}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.verifyNotFailed(),this.enqueueInternal(e)}enterRestrictedMode(e){this._isShuttingDown||(this._isShuttingDown=!0,this.skipNonRestrictedTasks=e||!1)}enqueue(e){if(this.verifyNotFailed(),this._isShuttingDown)return new Promise(()=>{});let t=new je;return this.enqueueInternal(()=>this._isShuttingDown&&this.skipNonRestrictedTasks?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.retryableOps.push(e),this.retryNextOp()))}retryNextOp(){return g(this,null,function*(){if(this.retryableOps.length!==0){try{yield this.retryableOps[0](),this.retryableOps.shift(),this.backoff.reset()}catch(e){if(qi(e))D(k9,"Operation failed with retryable error: "+e);else throw e}this.retryableOps.length>0&&this.backoff.backoffAndRun(()=>this.retryNextOp())}})}enqueueInternal(e){let t=this.tail.then(()=>(this.operationInProgress=!0,e().catch(r=>{this.failure=r,this.operationInProgress=!1;let i=O9(r);throw Ne("INTERNAL UNHANDLED ERROR: ",i),r}).then(r=>(this.operationInProgress=!1,r))));return this.tail=t,t}enqueueAfterDelay(e,t,r){this.verifyNotFailed(),this.timerIdsToSkip.indexOf(e)>-1&&(t=0);let i=OS.createAndSchedule(this,e,t,r,s=>this.removeDelayedOperation(s));return this.delayedOperations.push(i),i}verifyNotFailed(){this.failure&&L()}verifyOperationInProgress(){}drain(){return g(this,null,function*(){let e;do e=this.tail,yield e;while(e!==this.tail)})}containsDelayedOperation(e){for(let t of this.delayedOperations)if(t.timerId===e)return!0;return!1}runAllDelayedOperationsUntil(e){return this.drain().then(()=>{this.delayedOperations.sort((t,r)=>t.targetTimeMs-r.targetTimeMs);for(let t of this.delayedOperations)if(t.skipDelay(),e!=="all"&&t.timerId===e)break;return this.drain()})}skipDelaysForTimerId(e){this.timerIdsToSkip.push(e)}removeDelayedOperation(e){let t=this.delayedOperations.indexOf(e);this.delayedOperations.splice(t,1)}};function M9(){return new $S}function O9(n){let e=n.message||"";return n.stack&&(n.stack.includes(n.message)?e=n.stack:e=n.message+`
`+n.stack),e}var QS=class{constructor(){this._progressObserver={},this._taskCompletionResolver=new je,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}onProgress(e,t,r){this._progressObserver={next:e,error:t,complete:r}}catch(e){return this._taskCompletionResolver.promise.catch(e)}then(e,t){return this._taskCompletionResolver.promise.then(e,t)}_completeWith(e){this._updateProgress(e),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(e)}_failWith(e){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(e),this._taskCompletionResolver.reject(e)}_updateProgress(e){this._lastProgress=e,this._progressObserver.next&&this._progressObserver.next(e)}};var UN=jc,De=class extends Ns{constructor(e,t,r,i){super(e,t,r,i),this.type="firestore",this._queue=M9(),this._persistenceKey=i?.name||"[DEFAULT]"}_terminate(){return this._firestoreClient||zN(this),this._firestoreClient.terminate()}};function Ze(n){return n._firestoreClient||zN(n),n._firestoreClient.verifyNotTerminated(),n._firestoreClient}function zN(n){var e,t,r;let i=n._freezeSettings(),s=D9(n._databaseId,((e=n._app)===null||e===void 0?void 0:e.options.appId)||"",n._persistenceKey,i);n._firestoreClient=new KS(n._authCredentials,n._appCheckCredentials,n._queue,s),!((t=i.localCache)===null||t===void 0)&&t._offlineComponentProvider&&(!((r=i.localCache)===null||r===void 0)&&r._onlineComponentProvider)&&(n._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}function jN(n,e){n=se(n,De),JN(n);let t=Ze(n);if(t._uninitializedComponentsProvider)throw new T(v.FAILED_PRECONDITION,"SDK cache is already specified.");gn("enableIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let r=n._freezeSettings(),i=new Oc,s=new jf(i,r.cacheSizeBytes,e?.forceOwnership);return HN(t,i,s)}function GN(n){n=se(n,De),JN(n);let e=Ze(n);if(e._uninitializedComponentsProvider)throw new T(v.FAILED_PRECONDITION,"SDK cache is already specified.");gn("enableMultiTabIndexedDbPersistence() will be deprecated in the future, you can use `FirestoreSettings.cache` instead.");let t=n._freezeSettings(),r=new Oc,i=new US(r,t.cacheSizeBytes);return HN(e,r,i)}function HN(n,e,t){let r=new je;return n.asyncQueue.enqueue(()=>g(this,null,function*(){try{yield of(n,t),yield WS(n,e),r.resolve()}catch(i){let s=i;if(!MN(s))throw s;gn("Error enabling indexeddb cache. Falling back to memory cache: "+s),r.reject(s)}})).then(()=>r.promise)}function KN(n){if(n._initialized&&!n._terminated)throw new T(v.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");let e=new je;return n._queue.enqueueAndForgetEvenWhileRestricted(()=>g(this,null,function*(){try{yield ej(R0(n._databaseId,n._persistenceKey)),e.resolve()}catch(t){e.reject(t)}})),e.promise}function WN(n){n=se(n,De);let e=Ze(n);return d9(e)}function $N(n){n=se(n,De);let e=Ze(n);return c9(e)}function QN(n){n=se(n,De);let e=Ze(n);return u9(e)}function YN(n,e){n=se(n,De);let t=Ze(n),r=new QS;return E9(t,n._databaseId,e,r),r}function XN(n,e){n=se(n,De);let t=Ze(n);return T9(t,e).then(r=>r?new ft(n,null,r.query):null)}function JN(n){if(n._initialized||n._terminated)throw new T(v.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}function x9(n,e=!0){IU(Ww),Ua(new Wi("firestore",(t,{instanceIdentifier:r,options:i})=>{let s=t.getProvider("app").getImmediate(),o=new De(new p_(t.getProvider("auth-internal")),new v_(t.getProvider("app-check-internal")),C3(s,r),s);return i=Object.assign({useFetchStreams:e},i),o._setSettings(i),o},"PUBLIC").setMultipleInstances(!0)),Vr(DD,RD,n),Vr(DD,RD,"esm2017")}var dr=class n{constructor(e){this._byteString=e}static fromBase64String(e){try{return new n(at.fromBase64String(e))}catch(t){throw new T(v.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(e){return new n(at.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}};var xn=class{constructor(...e){for(let t=0;t<e.length;++t)if(e[t].length===0)throw new T(v.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new He(e)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}};var kr=class{constructor(e){this._methodName=e}};var ks=class{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new T(v.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new T(v.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(e){return X(this._lat,e._lat)||X(this._long,e._long)}};var P9=/^__.*__$/,YS=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return this.fieldMask!==null?new On(e,this.data,this.fieldMask,t,this.fieldTransforms):new Pi(e,this.data,t,this.fieldTransforms)}},Hf=class{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new On(e,this.data,this.fieldMask,t,this.fieldTransforms)}};function ZN(n){switch(n){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw L()}}var Kf=class n{constructor(e,t,r,i,s,o){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=i,s===void 0&&this.validatePath(),this.fieldTransforms=s||[],this.fieldMask=o||[]}get path(){return this.settings.path}get dataSource(){return this.settings.dataSource}contextWith(e){return new n(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}childContextForField(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePathSegment(e),i}childContextForFieldPath(e){var t;let r=(t=this.path)===null||t===void 0?void 0:t.child(e),i=this.contextWith({path:r,arrayElement:!1});return i.validatePath(),i}childContextForArray(e){return this.contextWith({path:void 0,arrayElement:!0})}createError(e){return Wf(e,this.settings.methodName,this.settings.hasConverter||!1,this.path,this.settings.targetDoc)}contains(e){return this.fieldMask.find(t=>e.isPrefixOf(t))!==void 0||this.fieldTransforms.find(t=>e.isPrefixOf(t.field))!==void 0}validatePath(){if(this.path)for(let e=0;e<this.path.length;e++)this.validatePathSegment(this.path.get(e))}validatePathSegment(e){if(e.length===0)throw this.createError("Document fields must not be empty");if(ZN(this.dataSource)&&P9.test(e))throw this.createError('Document fields cannot begin and end with "__"')}},XS=class{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Gc(e)}createContext(e,t,r,i=!1){return new Kf({dataSource:e,methodName:t,targetDoc:r,path:He.emptyPath(),arrayElement:!1,hasConverter:i},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}};function Fs(n){let e=n._freezeSettings(),t=Gc(n._databaseId);return new XS(n._databaseId,!!e.ignoreUndefinedProperties,t)}function up(n,e,t,r,i,s={}){let o=n.createContext(s.merge||s.mergeFields?2:0,e,t,i);ew("Data must be an object, but it was:",o,r);let a=nk(r,o),l,c;if(s.merge)l=new Jt(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){let u=[];for(let d of s.mergeFields){let h=n0(e,d,t);if(!o.contains(h))throw new T(v.INVALID_ARGUMENT,`Field '${h}' is specified in your field mask but missing from your input data.`);ik(u,h)||u.push(h)}l=new Jt(u),c=o.fieldTransforms.filter(d=>l.covers(d.field))}else l=null,c=o.fieldTransforms;return new YS(new At(a),l,c)}var xc=class n extends kr{_toFieldTransform(e){if(e.dataSource===2)e.fieldMask.push(e.path);else throw e.dataSource===1?e.createError(`${this._methodName}() can only appear at the top level of your update data`):e.createError(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return null}isEqual(e){return e instanceof n}};function ek(n,e,t){return new Kf({dataSource:3,targetDoc:e.settings.targetDoc,methodName:n._methodName,arrayElement:t},e.databaseId,e.serializer,e.ignoreUndefinedProperties)}var JS=class n extends kr{_toFieldTransform(e){return new As(e.path,new Oi)}isEqual(e){return e instanceof n}},ZS=class extends kr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=ek(this,e,!0),r=this._elements.map(s=>Ls(s,t)),i=new Rr(r);return new As(e.path,i)}isEqual(e){return this===e}},e0=class extends kr{constructor(e,t){super(e),this._elements=t}_toFieldTransform(e){let t=ek(this,e,!0),r=this._elements.map(s=>Ls(s,t)),i=new Nr(r);return new As(e.path,i)}isEqual(e){return this===e}},t0=class extends kr{constructor(e,t){super(e),this._operand=t}_toFieldTransform(e){let t=new xi(e.serializer,MR(e.serializer,this._operand));return new As(e.path,t)}isEqual(e){return this===e}};function J0(n,e,t,r){let i=n.createContext(1,e,t);ew("Data must be an object, but it was:",i,r);let s=[],o=At.empty();Ps(r,(l,c)=>{let u=tw(e,l,t);c=Re(c);let d=i.childContextForFieldPath(u);if(c instanceof xc)s.push(u);else{let h=Ls(c,d);h!=null&&(s.push(u),o.set(u,h))}});let a=new Jt(s);return new Hf(o,a,i.fieldTransforms)}function Z0(n,e,t,r,i,s){let o=n.createContext(1,e,t),a=[n0(e,r,t)],l=[i];if(s.length%2!==0)throw new T(v.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let h=0;h<s.length;h+=2)a.push(n0(e,s[h])),l.push(s[h+1]);let c=[],u=At.empty();for(let h=a.length-1;h>=0;--h)if(!ik(c,a[h])){let p=a[h],y=l[h];y=Re(y);let _=o.childContextForFieldPath(p);if(y instanceof xc)c.push(p);else{let S=Ls(y,_);S!=null&&(c.push(p),u.set(p,S))}}let d=new Jt(c);return new Hf(u,d,o.fieldTransforms)}function tk(n,e,t,r=!1){let i=n.createContext(r?4:3,e);return Ls(t,i)}function Ls(n,e){if(n=Re(n),rk(n))return ew("Unsupported field value:",e,n),nk(n,e);if(n instanceof kr)return L9(n,e),null;if(n===void 0&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),n instanceof Array){if(e.settings.arrayElement&&e.dataSource!==4)throw e.createError("Nested arrays are not supported");return F9(n,e)}else return B9(n,e)}function nk(n,e){let t={};return sR(n)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ps(n,(r,i)=>{let s=Ls(i,e.childContextForField(r));s!=null&&(t[r]=s)}),{mapValue:{fields:t}}}function F9(n,e){let t=[],r=0;for(let i of n){let s=Ls(i,e.childContextForArray(r));s==null&&(s={nullValue:"NULL_VALUE"}),t.push(s),r++}return{arrayValue:{values:t}}}function L9(n,e){if(!ZN(e.dataSource))throw e.createError(`${n._methodName}() can only be used with update() and set()`);if(!e.path)throw e.createError(`${n._methodName}() is not currently supported inside arrays`);let t=n._toFieldTransform(e);t&&e.fieldTransforms.push(t)}function B9(n,e){if(n=Re(n),n===null)return{nullValue:"NULL_VALUE"};if(typeof n=="number")return MR(e.serializer,n);if(typeof n=="boolean")return{booleanValue:n};if(typeof n=="string")return{stringValue:n};if(n instanceof Date){let t=ke.fromDate(n);return{timestampValue:pa(e.serializer,t)}}else if(n instanceof ke){let t=new ke(n.seconds,Math.floor(n.nanoseconds/1e3)*1e3);return{timestampValue:pa(e.serializer,t)}}else{if(n instanceof ks)return{geoPointValue:{latitude:n.latitude,longitude:n.longitude}};if(n instanceof dr)return{bytesValue:jR(e.serializer,n._byteString)};if(n instanceof we){let t=e.databaseId,r=n.firestore._databaseId;if(!r.isEqual(t))throw e.createError(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${t.projectId}/${t.database}`);return{referenceValue:C0(n.firestore._databaseId||e.databaseId,n._key.path)}}else throw e.createError(`Unsupported field value: ${Wc(n)}`)}}function rk(n){return typeof n=="object"&&n!==null&&!(n instanceof Array)&&!(n instanceof Date)&&!(n instanceof ke)&&!(n instanceof ks)&&!(n instanceof dr)&&!(n instanceof we)&&!(n instanceof kr)}function ew(n,e,t){if(!rk(t)||!e9(t)){let r=Wc(t);throw r==="an object"?e.createError(n+" a custom object"):e.createError(n+" "+r)}}function n0(n,e,t){if(e=Re(e),e instanceof xn)return e._internalPath;if(typeof e=="string")return tw(n,e);throw Wf("Field path arguments must be of type string or ",n,!1,void 0,t)}var V9=new RegExp("[~\\*/\\[\\]]");function tw(n,e,t){if(e.search(V9)>=0)throw Wf(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,n,!1,void 0,t);try{return new xn(...e.split("."))._internalPath}catch{throw Wf(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,n,!1,void 0,t)}}function Wf(n,e,t,r,i){let s=r&&!r.isEmpty(),o=i!==void 0,a=`Function ${e}() called with invalid data`;t&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=` in field ${r}`),o&&(l+=` in document ${i}`),l+=")"),new T(v.INVALID_ARGUMENT,a+n+l)}function ik(n,e){return n.some(t=>t.isEqual(e))}var Ms=class{constructor(e,t,r,i,s){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=i,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new we(this._firestore,this._converter,this._key)}exists(){return this._document!==null}data(){if(this._document)if(this._converter){let e=new r0(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}else return this._userDataWriter.convertValue(this._document.data.value);else return}get(e){if(this._document){let t=this._document.data.field(dp("DocumentSnapshot.get",e));if(t!==null)return this._userDataWriter.convertValue(t)}}},r0=class extends Ms{data(){return super.data()}};function dp(n,e){return typeof e=="string"?tw(n,e):e instanceof xn?e._internalPath:e._delegate._internalPath}function sk(n){if(n.limitType==="L"&&n.explicitOrderBy.length===0)throw new T(v.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var Pc=class{},Os=class extends Pc{};function Pr(n,e,...t){let r=[];e instanceof Pc&&r.push(e),r=r.concat(t),W9(r);for(let i of r)n=i._apply(n);return n}var $f=class n extends Os{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=this._parse(e);return gk(e._query,t),new ft(e.firestore,e.converter,E0(e._query,t))}_parse(e){let t=Fs(e.firestore);return q9(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value)}};function ok(n,e,t){let r=e,i=dp("where",n);return $f._create(i,r,t)}var i0=class n extends Pc{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new n(e,t)}_parse(e){let t=this._queryConstraints.map(r=>r._parse(e)).filter(r=>r.getFilters().length>0);return t.length===1?t[0]:fe.create(t,this._getOperator())}_apply(e){let t=this._parse(e);return t.getFilters().length===0?e:(H9(e._query,t),new ft(e.firestore,e.converter,E0(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return this.type==="and"?"and":"or"}};var s0=class n extends Os{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new n(e,t)}_apply(e){let t=U9(e._query,this._field,this._direction);return new ft(e.firestore,e.converter,p4(e._query,t))}};function ak(n,e="asc"){let t=e,r=dp("orderBy",n);return s0._create(r,t)}var Qf=class n extends Os{constructor(e,t,r){super(),this.type=e,this._limit=t,this._limitType=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){return new ft(e.firestore,e.converter,yf(e._query,this._limit,this._limitType))}};function lk(n){return kN("limit",n),Qf._create("limit",n,"F")}function ck(n){return kN("limitToLast",n),Qf._create("limitToLast",n,"L")}var Yf=class n extends Os{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=pk(e,this.type,this._docOrFields,this._inclusive);return new ft(e.firestore,e.converter,g4(e._query,t))}};function uk(...n){return Yf._create("startAt",n,!0)}function dk(...n){return Yf._create("startAfter",n,!1)}var Xf=class n extends Os{constructor(e,t,r){super(),this.type=e,this._docOrFields=t,this._inclusive=r}static _create(e,t,r){return new n(e,t,r)}_apply(e){let t=pk(e,this.type,this._docOrFields,this._inclusive);return new ft(e.firestore,e.converter,m4(e._query,t))}};function hk(...n){return Xf._create("endBefore",n,!1)}function fk(...n){return Xf._create("endAt",n,!0)}function pk(n,e,t,r){if(t[0]=Re(t[0]),t[0]instanceof Ms)return z9(n._query,n.firestore._databaseId,e,t[0]._document,r);{let i=Fs(n.firestore);return j9(n._query,n.firestore._databaseId,i,e,t,r)}}function q9(n,e,t,r,i,s,o){let a;if(i.isKeyField()){if(s==="array-contains"||s==="array-contains-any")throw new T(v.INVALID_ARGUMENT,`Invalid Query. You can't perform '${s}' queries on documentId().`);if(s==="in"||s==="not-in"){B1(o,s);let c=[];for(let u of o)c.push(L1(r,n,u));a={arrayValue:{values:c}}}else a=L1(r,n,o)}else(s==="in"||s==="not-in"||s==="array-contains-any")&&B1(o,s),a=tk(t,e,o,s==="in"||s==="not-in");return re.create(i,s,a)}function U9(n,e,t){if(n.startAt!==null)throw new T(v.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(n.endAt!==null)throw new T(v.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new Cs(e,t)}function z9(n,e,t,r,i){if(!r)throw new T(v.NOT_FOUND,`Can't use a DocumentSnapshot that doesn't exist for ${t}().`);let s=[];for(let o of da(n))if(o.field.isKeyField())s.push(Ts(e,r.key));else{let a=r.data.field(o.field);if(rp(a))throw new T(v.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+o.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(a!==null)s.push(a);else{let l=o.field.canonicalString();throw new T(v.INVALID_ARGUMENT,`Invalid query. You are trying to start or end a query using a document for which the field '${l}' (used as the orderBy) does not exist.`)}}return new cr(s,i)}function j9(n,e,t,r,i,s){let o=n.explicitOrderBy;if(i.length>o.length)throw new T(v.INVALID_ARGUMENT,`Too many arguments provided to ${r}(). The number of arguments must be less than or equal to the number of orderBy() clauses`);let a=[];for(let l=0;l<i.length;l++){let c=i[l];if(o[l].field.isKeyField()){if(typeof c!="string")throw new T(v.INVALID_ARGUMENT,`Invalid query. Expected a string for document ID in ${r}(), but got a ${typeof c}`);if(!w0(n)&&c.indexOf("/")!==-1)throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection and ordering by documentId(), the value passed to ${r}() must be a plain document ID, but '${c}' contains a slash.`);let d=n.path.child(ue.fromString(c));if(!O.isDocumentKey(d))throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group and ordering by documentId(), the value passed to ${r}() must result in a valid document path, but '${d}' is not because it contains an odd number of segments.`);let h=new O(d);a.push(Ts(e,h))}else{let d=tk(t,r,c);a.push(d)}}return new cr(a,s)}function L1(n,e,t){if(t=Re(t),typeof t=="string"){if(t==="")throw new T(v.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!w0(e)&&t.indexOf("/")!==-1)throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '${t}' contains a '/' character.`);let r=e.path.child(ue.fromString(t));if(!O.isDocumentKey(r))throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '${r}' is not because it has an odd number of segments (${r.length}).`);return Ts(n,new O(r))}else{if(t instanceof we)return Ts(n,t._key);throw new T(v.INVALID_ARGUMENT,`Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ${Wc(t)}.`)}}function B1(n,e){if(!Array.isArray(n)||n.length===0)throw new T(v.INVALID_ARGUMENT,`Invalid Query. A non-empty array is required for '${e.toString()}' filters.`)}function G9(n){switch(n){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}function gk(n,e){let t=K9(n.filters,G9(e.op));if(t!==null)throw t===e.op?new T(v.INVALID_ARGUMENT,`Invalid query. You cannot use more than one '${e.op.toString()}' filter.`):new T(v.INVALID_ARGUMENT,`Invalid query. You cannot use '${e.op.toString()}' filters with '${t.toString()}' filters.`)}function H9(n,e){let t=n,r=e.getFlattenedFilters();for(let i of r)gk(t,i),t=E0(t,i)}function K9(n,e){for(let t of n)for(let r of t.getFlattenedFilters())if(e.indexOf(r.op)>=0)return r.op;return null}function W9(n){let e=n.filter(r=>r instanceof i0).length,t=n.filter(r=>r instanceof $f).length;if(e>1||e>0&&t>0)throw new T(v.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}var Ta=class{convertValue(e,t="none"){switch(Es(e)){case 0:return null;case 1:return e.booleanValue;case 2:return Ve(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(Ni(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 10:return this.convertObject(e.mapValue,t);default:throw L()}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e,t="none"){let r={};return Ps(e,(i,s)=>{r[i]=this.convertValue(s,t)}),r}convertGeoPoint(e){return new ks(Ve(e.latitude),Ve(e.longitude))}convertArray(e,t){return(e.values||[]).map(r=>this.convertValue(r,t))}convertServerTimestamp(e,t){switch(t){case"previous":let r=v0(e);return r==null?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(fc(e));default:return null}}convertTimestamp(e){let t=Ri(e);return new ke(t.seconds,t.nanos)}convertDocumentKey(e,t){let r=ue.fromString(e);q(ZR(r));let i=new ki(r.get(1),r.get(3)),s=new O(r.popFirst(5));return i.isEqual(t)||Ne(`Document ${s} contains a document reference within a different database (${i.projectId}/${i.database}) which is not supported. It will be treated as a reference in the current database (${t.projectId}/${t.database}) instead.`),s}};function hp(n,e,t){let r;return n?t&&(t.merge||t.mergeFields)?r=n.toFirestore(e,t):r=n.toFirestore(e):r=e,r}var o0=class extends Ta{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new we(this.firestore,null,t)}};function a0(n){return $9(n,["next","error","complete"])}function $9(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var Mr=class{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}},yn=class extends Ms{constructor(e,t,r,i,s,o){super(e,t,r,i,o),this._firestore=e,this._firestoreImpl=e,this.metadata=s}exists(){return super.exists()}data(e={}){if(this._document)if(this._converter){let t=new Bi(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}else return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps);else return}get(e,t={}){if(this._document){let r=this._document.data.field(dp("DocumentSnapshot.get",e));if(r!==null)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}},Bi=class extends yn{data(e={}){return super.data(e)}},Pn=class{constructor(e,t,r,i){this._firestore=e,this._userDataWriter=t,this._snapshot=i,this.metadata=new Mr(i.hasPendingWrites,i.fromCache),this.query=r}get docs(){let e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return this.size===0}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Bi(this._firestore,this._userDataWriter,r.key,r,new Mr(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(e={}){let t=!!e.includeMetadataChanges;if(t&&this._snapshot.excludesMetadataChanges)throw new T(v.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return(!this._cachedChanges||this._cachedChangesIncludeMetadataChanges!==t)&&(this._cachedChanges=Q9(this,t),this._cachedChangesIncludeMetadataChanges=t),this._cachedChanges}};function Q9(n,e){if(n._snapshot.oldDocs.isEmpty()){let t=0;return n._snapshot.docChanges.map(r=>{let i=new Bi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Mr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter);return r.doc,{type:"added",doc:i,oldIndex:-1,newIndex:t++}})}else{let t=n._snapshot.oldDocs;return n._snapshot.docChanges.filter(r=>e||r.type!==3).map(r=>{let i=new Bi(n._firestore,n._userDataWriter,r.doc.key,r.doc,new Mr(n._snapshot.mutatedKeys.has(r.doc.key),n._snapshot.fromCache),n.query.converter),s=-1,o=-1;return r.type!==0&&(s=t.indexOf(r.doc.key),t=t.delete(r.doc.key)),r.type!==1&&(t=t.add(r.doc),o=t.indexOf(r.doc.key)),{type:Y9(r.type),doc:i,oldIndex:s,newIndex:o}})}}function Y9(n){switch(n){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return L()}}function nw(n,e){return n instanceof yn&&e instanceof yn?n._firestore===e._firestore&&n._key.isEqual(e._key)&&(n._document===null?e._document===null:n._document.isEqual(e._document))&&n._converter===e._converter:n instanceof Pn&&e instanceof Pn?n._firestore===e._firestore&&X0(n.query,e.query)&&n.metadata.isEqual(e.metadata)&&n._snapshot.isEqual(e._snapshot):!1}function mk(n){n=se(n,we);let e=se(n.firestore,De),t=Ze(e);return PN(t,n._key).then(r=>ow(e,n,r))}var Or=class extends Ta{constructor(e){super(),this.firestore=e}convertBytes(e){return new dr(e)}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return new we(this.firestore,null,t)}};function yk(n){n=se(n,we);let e=se(n.firestore,De),t=Ze(e),r=new Or(e);return f9(t,n._key).then(i=>new yn(e,r,n._key,i,new Mr(i!==null&&i.hasLocalMutations,!0),n.converter))}function vk(n){n=se(n,we);let e=se(n.firestore,De),t=Ze(e);return PN(t,n._key,{source:"server"}).then(r=>ow(e,n,r))}function _k(n){n=se(n,ft);let e=se(n.firestore,De),t=Ze(e),r=new Or(e);return sk(n._query),FN(t,n._query).then(i=>new Pn(e,r,n,i))}function Sk(n){n=se(n,ft);let e=se(n.firestore,De),t=Ze(e),r=new Or(e);return p9(t,n._query).then(i=>new Pn(e,r,n,i))}function wk(n){n=se(n,ft);let e=se(n.firestore,De),t=Ze(e),r=new Or(e);return FN(t,n._query,{source:"server"}).then(i=>new Pn(e,r,n,i))}function rw(n,e,t){n=se(n,we);let r=se(n.firestore,De),i=hp(n.converter,e,t),s=Fs(r),a=up(s,"setDoc",n._key,i,n.converter!==null,t).toMutation(n._key,Be.none());return Oa(r,[a])}function iw(n,e,t,...r){n=se(n,we);let i=se(n.firestore,De),s=Fs(i);e=Re(e);let o;typeof e=="string"||e instanceof xn?o=Z0(s,"updateDoc",n._key,e,t,r):o=J0(s,"updateDoc",n._key,e);let a=o.toMutation(n._key,Be.exists(!0));return Oa(i,[a])}function Ek(n){let e=se(n.firestore,De),t=[new Fi(n._key,Be.none())];return Oa(e,t)}function Tk(n,e){let t=se(n.firestore,De),r=$c(n),i=hp(n.converter,e),s=Fs(n.firestore),a=up(s,"addDoc",r._key,i,n.converter!==null,{}).toMutation(r._key,Be.exists(!1));return Oa(t,[a]).then(()=>r)}function sw(n,...e){var t,r,i;n=Re(n);let s={includeMetadataChanges:!1},o=0;typeof e[o]=="object"&&!a0(e[o])&&(s=e[o],o++);let a={includeMetadataChanges:s.includeMetadataChanges};if(a0(e[o])){let h=e[o];e[o]=(t=h.next)===null||t===void 0?void 0:t.bind(h),e[o+1]=(r=h.error)===null||r===void 0?void 0:r.bind(h),e[o+2]=(i=h.complete)===null||i===void 0?void 0:i.bind(h)}let l,c,u;if(n instanceof we)c=se(n.firestore,De),u=Da(n._key.path),l={next:h=>{e[o]&&e[o](ow(c,n,h))},error:e[o+1],complete:e[o+2]};else{let h=se(n,ft);c=se(h.firestore,De),u=h._query;let p=new Or(c);l={next:y=>{e[o]&&e[o](new Pn(c,p,h,y))},error:e[o+1],complete:e[o+2]},sk(n._query)}let d=Ze(c);return h9(d,u,a,l)}function Ck(n,e){n=se(n,De);let t=Ze(n),r=a0(e)?e:{next:e};return m9(t,r)}function Oa(n,e){let t=Ze(n);return g9(t,e)}function ow(n,e,t){let r=t.docs.get(e._key),i=new Or(n);return new yn(n,i,e._key,r,new Mr(t.hasPendingWrites,t.fromCache),e.converter)}var X9={maxAttempts:5};function J9(n){if(n.maxAttempts<1)throw new T(v.INVALID_ARGUMENT,"Max attempts must be at least 1")}var Jf=class{constructor(e,t){this._firestore=e,this._commitHandler=t,this._mutations=[],this._committed=!1,this._dataReader=Fs(e)}set(e,t,r){this._verifyNotCommitted();let i=bi(e,this._firestore),s=hp(i.converter,t,r),o=up(this._dataReader,"WriteBatch.set",i._key,s,i.converter!==null,r);return this._mutations.push(o.toMutation(i._key,Be.none())),this}update(e,t,r,...i){this._verifyNotCommitted();let s=bi(e,this._firestore);t=Re(t);let o;return typeof t=="string"||t instanceof xn?o=Z0(this._dataReader,"WriteBatch.update",s._key,t,r,i):o=J0(this._dataReader,"WriteBatch.update",s._key,t),this._mutations.push(o.toMutation(s._key,Be.exists(!0))),this}delete(e){this._verifyNotCommitted();let t=bi(e,this._firestore);return this._mutations=this._mutations.concat(new Fi(t._key,Be.none())),this}commit(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()}_verifyNotCommitted(){if(this._committed)throw new T(v.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")}};function bi(n,e){if(n=Re(n),n.firestore!==e)throw new T(v.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return n}var l0=class{constructor(e,t){this._firestore=e,this._transaction=t,this._dataReader=Fs(e)}get(e){let t=bi(e,this._firestore),r=new o0(this._firestore);return this._transaction.lookup([t._key]).then(i=>{if(!i||i.length!==1)return L();let s=i[0];if(s.isFoundDocument())return new Ms(this._firestore,r,s.key,s,t.converter);if(s.isNoDocument())return new Ms(this._firestore,r,t._key,null,t.converter);throw L()})}set(e,t,r){let i=bi(e,this._firestore),s=hp(i.converter,t,r),o=up(this._dataReader,"Transaction.set",i._key,s,i.converter!==null,r);return this._transaction.set(i._key,o),this}update(e,t,r,...i){let s=bi(e,this._firestore);t=Re(t);let o;return typeof t=="string"||t instanceof xn?o=Z0(this._dataReader,"Transaction.update",s._key,t,r,i):o=J0(this._dataReader,"Transaction.update",s._key,t),this._transaction.update(s._key,o),this}delete(e){let t=bi(e,this._firestore);return this._transaction.delete(t._key),this}};var c0=class extends l0{constructor(e,t){super(e,t),this._firestore=e}get(e){let t=bi(e,this._firestore),r=new Or(this._firestore);return super.get(e).then(i=>new yn(this._firestore,r,t._key,i._document,new Mr(!1,!1),t.converter))}};function bk(n,e,t){n=se(n,De);let r=Object.assign(Object.assign({},X9),t);J9(r);let i=Ze(n);return y9(i,s=>e(new c0(n,s)),r)}function Ak(){return new xc("deleteField")}function Ik(){return new JS("serverTimestamp")}function Dk(...n){return new ZS("arrayUnion",n)}function Rk(...n){return new e0("arrayRemove",n)}function Nk(n){return new t0("increment",n)}x9("node");var Z9="@firebase/firestore-compat",e5="0.3.23";function hw(n,e){if(e===void 0)return{merge:!1};if(e.mergeFields!==void 0&&e.merge!==void 0)throw new T("invalid-argument",`Invalid options passed to function ${n}(): You cannot specify both "merge" and "mergeFields".`);return e}function kk(){if(typeof Uint8Array>"u")throw new T("unimplemented","Uint8Arrays are not available in this environment.")}function Mk(){if(!oR())throw new T("unimplemented","Blobs are unavailable in Firestore in this environment.")}var fp=class n{constructor(e){this._delegate=e}static fromBase64String(e){return Mk(),new n(dr.fromBase64String(e))}static fromUint8Array(e){return kk(),new n(dr.fromUint8Array(e))}toBase64(){return Mk(),this._delegate.toBase64()}toUint8Array(){return kk(),this._delegate.toUint8Array()}isEqual(e){return this._delegate.isEqual(e._delegate)}toString(){return"Blob(base64: "+this.toBase64()+")"}};function aw(n){return t5(n,["next","error","complete"])}function t5(n,e){if(typeof n!="object"||n===null)return!1;let t=n;for(let r of e)if(r in t&&typeof t[r]=="function")return!0;return!1}var lw=class{enableIndexedDbPersistence(e,t){return jN(e._delegate,{forceOwnership:t})}enableMultiTabIndexedDbPersistence(e){return GN(e._delegate)}clearIndexedDbPersistence(e){return KN(e._delegate)}},pp=class{constructor(e,t,r){this._delegate=t,this._persistenceProvider=r,this.INTERNAL={delete:()=>this.terminate()},e instanceof ki||(this._appCompat=e)}get _databaseId(){return this._delegate._databaseId}settings(e){let t=this._delegate._getSettings();!e.merge&&t.host!==e.host&&gn("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),e.merge&&(e=Object.assign(Object.assign({},t),e),delete e.merge),this._delegate._setSettings(e)}useEmulator(e,t,r={}){VN(this._delegate,e,t,r)}enableNetwork(){return $N(this._delegate)}disableNetwork(){return QN(this._delegate)}enablePersistence(e){let t=!1,r=!1;return e&&(t=!!e.synchronizeTabs,r=!!e.experimentalForceOwningTab,H0("synchronizeTabs",t,"experimentalForceOwningTab",r)),t?this._persistenceProvider.enableMultiTabIndexedDbPersistence(this):this._persistenceProvider.enableIndexedDbPersistence(this,r)}clearPersistence(){return this._persistenceProvider.clearIndexedDbPersistence(this)}terminate(){return this._appCompat&&(this._appCompat._removeServiceInstance("firestore-compat"),this._appCompat._removeServiceInstance("firestore")),this._delegate._delete()}waitForPendingWrites(){return WN(this._delegate)}onSnapshotsInSync(e){return Ck(this._delegate,e)}get app(){if(!this._appCompat)throw new T("failed-precondition","Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._appCompat}collection(e){try{return new Fa(this,Q0(this._delegate,e))}catch(t){throw Lt(t,"collection()","Firestore.collection()")}}doc(e){try{return new hr(this,$c(this._delegate,e))}catch(t){throw Lt(t,"doc()","Firestore.doc()")}}collectionGroup(e){try{return new Us(this,qN(this._delegate,e))}catch(t){throw Lt(t,"collectionGroup()","Firestore.collectionGroup()")}}runTransaction(e){return bk(this._delegate,t=>e(new gp(this,t)))}batch(){return Ze(this._delegate),new mp(new Jf(this._delegate,e=>Oa(this._delegate,e)))}loadBundle(e){return YN(this._delegate,e)}namedQuery(e){return XN(this._delegate,e).then(t=>t?new Us(this,t):null)}},xa=class extends Ta{constructor(e){super(),this.firestore=e}convertBytes(e){return new fp(new dr(e))}convertReference(e){let t=this.convertDocumentKey(e,this.firestore._databaseId);return hr.forKey(t,this.firestore,null)}};function n5(n){q1(n)}var gp=class{constructor(e,t){this._firestore=e,this._delegate=t,this._userDataWriter=new xa(e)}get(e){let t=Bs(e);return this._delegate.get(t).then(r=>new Vs(this._firestore,new yn(this._firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,t.converter)))}set(e,t,r){let i=Bs(e);return r?(hw("Transaction.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Bs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Bs(e);return this._delegate.delete(t),this}},mp=class{constructor(e){this._delegate=e}set(e,t,r){let i=Bs(e);return r?(hw("WriteBatch.set",r),this._delegate.set(i,t,r)):this._delegate.set(i,t),this}update(e,t,r,...i){let s=Bs(e);return arguments.length===2?this._delegate.update(s,t):this._delegate.update(s,t,r,...i),this}delete(e){let t=Bs(e);return this._delegate.delete(t),this}commit(){return this._delegate.commit()}},Pa=class n{constructor(e,t,r){this._firestore=e,this._userDataWriter=t,this._delegate=r}fromFirestore(e,t){let r=new Bi(this._firestore._delegate,this._userDataWriter,e._key,e._document,e.metadata,null);return this._delegate.fromFirestore(new qs(this._firestore,r),t??{})}toFirestore(e,t){return t?this._delegate.toFirestore(e,t):this._delegate.toFirestore(e)}static getInstance(e,t){let r=n.INSTANCES,i=r.get(e);i||(i=new WeakMap,r.set(e,i));let s=i.get(t);return s||(s=new n(e,new xa(e),t),i.set(t,s)),s}};Pa.INSTANCES=new WeakMap;var hr=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new xa(e)}static forPath(e,t,r){if(e.length%2!==0)throw new T("invalid-argument",`Invalid document reference. Document references must have an even number of segments, but ${e.canonicalString()} has ${e.length}`);return new n(t,new we(t._delegate,r,new O(e)))}static forKey(e,t,r){return new n(t,new we(t._delegate,r,e))}get id(){return this._delegate.id}get parent(){return new Fa(this.firestore,this._delegate.parent)}get path(){return this._delegate.path}collection(e){try{return new Fa(this.firestore,Q0(this._delegate,e))}catch(t){throw Lt(t,"collection()","DocumentReference.collection()")}}isEqual(e){return e=Re(e),e instanceof we?Y0(this._delegate,e):!1}set(e,t){t=hw("DocumentReference.set",t);try{return t?rw(this._delegate,e,t):rw(this._delegate,e)}catch(r){throw Lt(r,"setDoc()","DocumentReference.set()")}}update(e,t,...r){try{return arguments.length===1?iw(this._delegate,e):iw(this._delegate,e,t,...r)}catch(i){throw Lt(i,"updateDoc()","DocumentReference.update()")}}delete(){return Ek(this._delegate)}onSnapshot(...e){let t=Ok(e),r=xk(e,i=>new Vs(this.firestore,new yn(this.firestore._delegate,this._userDataWriter,i._key,i._document,i.metadata,this._delegate.converter)));return sw(this._delegate,t,r)}get(e){let t;return e?.source==="cache"?t=yk(this._delegate):e?.source==="server"?t=vk(this._delegate):t=mk(this._delegate),t.then(r=>new Vs(this.firestore,new yn(this.firestore._delegate,this._userDataWriter,r._key,r._document,r.metadata,this._delegate.converter)))}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Pa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Lt(n,e,t){return n.message=n.message.replace(e,t),n}function Ok(n){for(let e of n)if(typeof e=="object"&&!aw(e))return e;return{}}function xk(n,e){var t,r;let i;return aw(n[0])?i=n[0]:aw(n[1])?i=n[1]:typeof n[0]=="function"?i={next:n[0],error:n[1],complete:n[2]}:i={next:n[1],error:n[2],complete:n[3]},{next:s=>{i.next&&i.next(e(s))},error:(t=i.error)===null||t===void 0?void 0:t.bind(i),complete:(r=i.complete)===null||r===void 0?void 0:r.bind(i)}}var Vs=class{constructor(e,t){this._firestore=e,this._delegate=t}get ref(){return new hr(this._firestore,this._delegate.ref)}get id(){return this._delegate.id}get metadata(){return this._delegate.metadata}get exists(){return this._delegate.exists()}data(e){return this._delegate.data(e)}get(e,t){return this._delegate.get(e,t)}isEqual(e){return nw(this._delegate,e._delegate)}},qs=class extends Vs{data(e){let t=this._delegate.data(e);return this._delegate._converter||U1(t!==void 0,"Document in a QueryDocumentSnapshot should exist"),t}},Us=class n{constructor(e,t){this.firestore=e,this._delegate=t,this._userDataWriter=new xa(e)}where(e,t,r){try{return new n(this.firestore,Pr(this._delegate,ok(e,t,r)))}catch(i){throw Lt(i,/(orderBy|where)\(\)/,"Query.$1()")}}orderBy(e,t){try{return new n(this.firestore,Pr(this._delegate,ak(e,t)))}catch(r){throw Lt(r,/(orderBy|where)\(\)/,"Query.$1()")}}limit(e){try{return new n(this.firestore,Pr(this._delegate,lk(e)))}catch(t){throw Lt(t,"limit()","Query.limit()")}}limitToLast(e){try{return new n(this.firestore,Pr(this._delegate,ck(e)))}catch(t){throw Lt(t,"limitToLast()","Query.limitToLast()")}}startAt(...e){try{return new n(this.firestore,Pr(this._delegate,uk(...e)))}catch(t){throw Lt(t,"startAt()","Query.startAt()")}}startAfter(...e){try{return new n(this.firestore,Pr(this._delegate,dk(...e)))}catch(t){throw Lt(t,"startAfter()","Query.startAfter()")}}endBefore(...e){try{return new n(this.firestore,Pr(this._delegate,hk(...e)))}catch(t){throw Lt(t,"endBefore()","Query.endBefore()")}}endAt(...e){try{return new n(this.firestore,Pr(this._delegate,fk(...e)))}catch(t){throw Lt(t,"endAt()","Query.endAt()")}}isEqual(e){return X0(this._delegate,e._delegate)}get(e){let t;return e?.source==="cache"?t=Sk(this._delegate):e?.source==="server"?t=wk(this._delegate):t=_k(this._delegate),t.then(r=>new Qc(this.firestore,new Pn(this.firestore._delegate,this._userDataWriter,this._delegate,r._snapshot)))}onSnapshot(...e){let t=Ok(e),r=xk(e,i=>new Qc(this.firestore,new Pn(this.firestore._delegate,this._userDataWriter,this._delegate,i._snapshot)));return sw(this._delegate,t,r)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Pa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}},cw=class{constructor(e,t){this._firestore=e,this._delegate=t}get type(){return this._delegate.type}get doc(){return new qs(this._firestore,this._delegate.doc)}get oldIndex(){return this._delegate.oldIndex}get newIndex(){return this._delegate.newIndex}},Qc=class{constructor(e,t){this._firestore=e,this._delegate=t}get query(){return new Us(this._firestore,this._delegate.query)}get metadata(){return this._delegate.metadata}get size(){return this._delegate.size}get empty(){return this._delegate.empty}get docs(){return this._delegate.docs.map(e=>new qs(this._firestore,e))}docChanges(e){return this._delegate.docChanges(e).map(t=>new cw(this._firestore,t))}forEach(e,t){this._delegate.forEach(r=>{e.call(t,new qs(this._firestore,r))})}isEqual(e){return nw(this._delegate,e._delegate)}},Fa=class n extends Us{constructor(e,t){super(e,t),this.firestore=e,this._delegate=t}get id(){return this._delegate.id}get path(){return this._delegate.path}get parent(){let e=this._delegate.parent;return e?new hr(this.firestore,e):null}doc(e){try{return e===void 0?new hr(this.firestore,$c(this._delegate)):new hr(this.firestore,$c(this._delegate,e))}catch(t){throw Lt(t,"doc()","CollectionReference.doc()")}}add(e){return Tk(this._delegate,e).then(t=>new hr(this.firestore,t))}isEqual(e){return Y0(this._delegate,e._delegate)}withConverter(e){return new n(this.firestore,e?this._delegate.withConverter(Pa.getInstance(this.firestore,e)):this._delegate.withConverter(null))}};function Bs(n){return se(n,we)}var uw=class n{constructor(...e){this._delegate=new xn(...e)}static documentId(){return new n(He.keyField().canonicalString())}isEqual(e){return e=Re(e),e instanceof xn?this._delegate._internalPath.isEqual(e._internalPath):!1}};var dw=class n{constructor(e){this._delegate=e}static serverTimestamp(){let e=Ik();return e._methodName="FieldValue.serverTimestamp",new n(e)}static delete(){let e=Ak();return e._methodName="FieldValue.delete",new n(e)}static arrayUnion(...e){let t=Dk(...e);return t._methodName="FieldValue.arrayUnion",new n(t)}static arrayRemove(...e){let t=Rk(...e);return t._methodName="FieldValue.arrayRemove",new n(t)}static increment(e){let t=Nk(e);return t._methodName="FieldValue.increment",new n(t)}isEqual(e){return this._delegate.isEqual(e._delegate)}};var r5={Firestore:pp,GeoPoint:ks,Timestamp:ke,Blob:fp,Transaction:gp,WriteBatch:mp,DocumentReference:hr,DocumentSnapshot:Vs,Query:Us,QueryDocumentSnapshot:qs,QuerySnapshot:Qc,CollectionReference:Fa,FieldPath:uw,FieldValue:dw,setLogLevel:n5,CACHE_SIZE_UNLIMITED:UN};function i5(n,e){n.INTERNAL.registerComponent(new Wi("firestore-compat",t=>{let r=t.getProvider("app-compat").getImmediate(),i=t.getProvider("firestore").getImmediate();return e(r,i)},"PUBLIC").setServiceProps(Object.assign({},r5)))}function s5(n){i5(n,(e,t)=>new pp(e,t,new lw)),n.registerVersion(Z9,e5,"node")}s5(Vt);function o5(n,e=Xc){return new js(t=>{let r;return e!=null?e.schedule(()=>{r=n.onSnapshot({includeMetadataChanges:!0},t)}):r=n.onSnapshot({includeMetadataChanges:!0},t),()=>{r?.()}})}function Pk(n,e){return o5(n,e)}function a5(n,e){return Pk(n,e).pipe(eu(void 0),Jc(),ut(t=>{let[r,i]=t;return i.exists?r?.exists?{payload:i,type:"modified"}:{payload:i,type:"added"}:{payload:i,type:"removed"}}))}function gw(n,e){return Pk(n,e).pipe(ut(t=>({payload:t,type:"query"})))}var yp=class{ref;afs;constructor(e,t){this.ref=e,this.afs=t}set(e,t){return this.ref.set(e,t)}update(e){return this.ref.update(e)}delete(){return this.ref.delete()}collection(e,t){let r=this.ref.collection(e),{ref:i,query:s}=qk(r,t);return new _p(i,s,this.afs)}snapshotChanges(){return a5(this.ref,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return this.snapshotChanges().pipe(ut(({payload:t})=>e.idField?fr(Zt({},t.data()),{[e.idField]:t.id}):t.data()))}get(e){return Fn(this.ref.get(e)).pipe(qt)}};function vp(n,e){return gw(n,e).pipe(eu(void 0),Jc(),ut(t=>{let[r,i]=t,s=i.payload.docChanges(),o=s.map(a=>({type:a.type,payload:a}));return r&&JSON.stringify(r.payload.metadata)!==JSON.stringify(i.payload.metadata)&&i.payload.docs.forEach((a,l)=>{let c=s.find(d=>d.doc.ref.isEqual(a.ref)),u=r?.payload.docs.find(d=>d.ref.isEqual(a.ref));c&&JSON.stringify(c.doc.metadata)===JSON.stringify(a.metadata)||!c&&u&&JSON.stringify(u.metadata)===JSON.stringify(a.metadata)||o.push({type:"modified",payload:{oldIndex:l,newIndex:l,type:"modified",doc:a}})}),o}))}function Fk(n,e,t){return vp(n,t).pipe(Zc((r,i)=>l5(r,i.map(s=>s.payload),e),[]),Ew(),ut(r=>r.map(i=>({type:i.type,payload:i}))))}function l5(n,e,t){return e.forEach(r=>{t.indexOf(r.type)>-1&&(n=c5(n,r))}),n}function fw(n,e,t,...r){let i=n.slice();return i.splice(e,t,...r),i}function c5(n,e){switch(e.type){case"added":if(!(n[e.newIndex]&&n[e.newIndex].doc.ref.isEqual(e.doc.ref)))return fw(n,e.newIndex,0,e);break;case"modified":if(n[e.oldIndex]==null||n[e.oldIndex].doc.ref.isEqual(e.doc.ref))if(e.oldIndex!==e.newIndex){let t=n.slice();return t.splice(e.oldIndex,1),t.splice(e.newIndex,0,e),t}else return fw(n,e.newIndex,1,e);break;case"removed":if(n[e.oldIndex]&&n[e.oldIndex].doc.ref.isEqual(e.doc.ref))return fw(n,e.oldIndex,1);break}return n}function Lk(n){return(!n||n.length===0)&&(n=["added","removed","modified"]),n}var _p=class{ref;query;afs;constructor(e,t,r){this.ref=e,this.query=t,this.afs=r}stateChanges(e){let t=vp(this.query,this.afs.schedulers.outsideAngular);return e&&e.length>0&&(t=t.pipe(ut(r=>r.filter(i=>e.indexOf(i.type)>-1)))),t.pipe(eu(void 0),Jc(),La(([r,i])=>i.length>0||!r),ut(([,r])=>r),qt)}auditTrail(e){return this.stateChanges(e).pipe(Zc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Lk(e);return Fk(this.query,t,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return gw(this.query,this.afs.schedulers.outsideAngular).pipe(ut(t=>t.payload.docs.map(r=>e.idField?fr(Zt({},r.data()),{[e.idField]:r.id}):r.data())),qt)}get(e){return Fn(this.query.get(e)).pipe(qt)}add(e){return this.ref.add(e)}doc(e){return new yp(this.ref.doc(e),this.afs)}},pw=class{query;afs;constructor(e,t){this.query=e,this.afs=t}stateChanges(e){return!e||e.length===0?vp(this.query,this.afs.schedulers.outsideAngular).pipe(qt):vp(this.query,this.afs.schedulers.outsideAngular).pipe(ut(t=>t.filter(r=>e.indexOf(r.type)>-1)),La(t=>t.length>0),qt)}auditTrail(e){return this.stateChanges(e).pipe(Zc((t,r)=>[...t,...r],[]))}snapshotChanges(e){let t=Lk(e);return Fk(this.query,t,this.afs.schedulers.outsideAngular).pipe(qt)}valueChanges(e={}){return gw(this.query,this.afs.schedulers.outsideAngular).pipe(ut(r=>r.payload.docs.map(i=>e.idField?Zt({[e.idField]:i.id},i.data()):i.data())),qt)}get(e){return Fn(this.query.get(e)).pipe(qt)}},Bk=new xe("angularfire2.enableFirestorePersistence"),Vk=new xe("angularfire2.firestore.persistenceSettings"),u5=new xe("angularfire2.firestore.settings"),d5=new xe("angularfire2.firestore.use-emulator");function qk(n,e=t=>t){return{query:e(n),ref:n}}var mw=(()=>{class n{schedulers;firestore;persistenceEnabled$;constructor(t,r,i,s,o,a,l,c,u,d,h,p,y,_,S,R,E){this.schedulers=l;let N=ja(t,a,r),k=u;d&&Kp(N,a,h,y,_,S,p,R),[this.firestore,this.persistenceEnabled$]=pu(`${N.name}.firestore`,"AngularFirestore",N.name,()=>{let V=a.runOutsideAngular(()=>N.firestore());if(s&&V.settings(s),k&&V.useEmulator(...k),i&&!su(o)){let W=()=>{try{return Fn(V.enablePersistence(c||void 0).then(()=>!0,()=>!1))}catch(te){return typeof console<"u"&&console.warn(te),Lr(!1)}};return[V,a.runOutsideAngular(W)]}else return[V,Lr(!1)]},[s,k,i])}collection(t,r){let i;typeof t=="string"?i=this.firestore.collection(t):i=t;let{ref:s,query:o}=qk(i,r),a=this.schedulers.ngZone.run(()=>s);return new _p(a,o,this)}collectionGroup(t,r){let i=r||(o=>o),s=this.firestore.collectionGroup(t);return new pw(i(s),this)}doc(t){let r;typeof t=="string"?r=this.firestore.doc(t):r=t;let i=this.schedulers.ngZone.run(()=>r);return new yp(i,this)}createId(){return this.firestore.collection("_").doc().id}static \u0275fac=function(r){return new(r||n)(Z(Ws),Z($s,8),Z(Bk,8),Z(u5,8),Z(Hs),Z(Br),Z(du),Z(Vk,8),Z(d5,8),Z(gu,8),Z(qp,8),Z(Up,8),Z(zp,8),Z(jp,8),Z(Gp,8),Z(Hp,8),Z($i,8))};static \u0275prov=vn({token:n,factory:n.\u0275fac,providedIn:"any"})}return n})(),Uk=(()=>{class n{constructor(){Vt.registerVersion("angularfire",Ks.full,"fst-compat")}static enablePersistence(t){return{ngModule:n,providers:[{provide:Bk,useValue:!0},{provide:Vk,useValue:t}]}}static \u0275fac=function(r){return new(r||n)};static \u0275mod=vt({type:n});static \u0275inj=yt({providers:[mw]})}return n})();var zk=(()=>{let e=class e{constructor(r){this.afs=r}addStudent(r){return r.id=this.afs.createId(),this.afs.collection("/Students").add(r)}getAllStudents(){return this.afs.collection("/Students").snapshotChanges()}deleteStudent(r){return this.afs.doc("/Students/"+r.id).delete()}updateStudent(r){this.deleteStudent(r),this.addStudent(r)}};e.\u0275fac=function(i){return new(i||e)(Z(mw))},e.\u0275prov=vn({token:e,factory:e.\u0275fac,providedIn:"root"});let n=e;return n})();function p5(n,e){if(n&1){let t=Mw();H(0,"tr")(1,"td"),Y(2),K(),H(3,"td"),Y(4),K(),H(5,"td"),Y(6),K(),H(7,"td"),Y(8),K(),H(9,"td")(10,"button",24),Pe("click",function(){let s=Aw(t).$implicit,o=xw();return Iw(o.deleteStudent(s))}),Y(11,"Delete"),K()()()}if(n&2){let t=e.$implicit;et(2),Va(t.first_name),et(2),Va(t.last_name),et(2),Va(t.email),et(2),Va(t.mobile)}}var jk=(()=>{let e=class e{constructor(r,i,s){this.auth=r,this.data=i,this.router=s,this.stuedntList=[],this.studentObj={id:"",first_name:"",last_name:"",email:"",mobile:""},this.id="",this.first_name="",this.last_name="",this.email="",this.mobile=""}register(){this.auth.logout()}ngOnInit(){this.getAllStudents()}getAllStudents(){this.data.getAllStudents().subscribe(r=>{this.stuedntList=r.map(i=>{let s=i.payload.doc.data();return s.id=i.payload.doc.id,s})},r=>{alert("Error while feetching the data")})}resetForm(){this.id="",this.first_name="",this.last_name="",this.email="",this.mobile=""}addStudent(){if(this.first_name==""||this.last_name==""||this.email==""||this.mobile==""){alert("Fill all input fields");return}this.studentObj.id="",this.studentObj.email=this.email,this.studentObj.first_name=this.first_name,this.studentObj.last_name=this.last_name,this.studentObj.mobile=this.mobile,this.data.addStudent(this.studentObj),this.resetForm()}updateStudent(){}deleteStudent(r){window.confirm("Are you sure you want to delete "+r.first_name+" "+r.last_name+" ?")&&this.data.deleteStudent(r)}};e.\u0275fac=function(i){return new(i||e)(ge(Ur),ge(zk),ge(ou))},e.\u0275cmp=en({type:e,selectors:[["app-dashboard"]],decls:48,vars:5,consts:[[1,"container-fluid"],[1,"row"],[1,"col-md-4","mt-5"],[1,"card","border-0","shadow","p-3"],[1,"form-floating","mb-3","text-center"],[1,"text-center","text-warning"],[1,"form-floating","mb-3"],["type","text","id","firstname","name","firstname",1,"form-control",3,"ngModel","ngModelChange"],["for","firstname"],["type","text","id","lastname","name","lastname",1,"form-control",3,"ngModel","ngModelChange"],["for","floatingPassword"],["type","email","id","email","name","email",1,"form-control",3,"ngModel","ngModelChange"],["for","email"],["type","text","id","mobile","name","mobile",1,"form-control",3,"ngModel","ngModelChange"],["for","mobile"],["type","button",1,"btn","btn-outline-success",3,"click"],[1,"col-md-8","mt-2"],[1,"text-danger"],[1,"card","p-3","shadow"],[1,"card-body"],[1,"table","table-hover"],["scope","col"],[4,"ngFor","ngForOf"],["type","button",1,"btn","btn-warning","text-center",3,"click"],[1,"btn","btn-outline-danger",3,"click"]],template:function(i,s){i&1&&(H(0,"div",0),ru(1,"div",1),H(2,"div",1)(3,"div",2)(4,"div",3)(5,"div",4)(6,"h5",5),Y(7,"Add Student"),K()(),H(8,"div",6)(9,"input",7),Pe("ngModelChange",function(a){return s.first_name=a}),K(),H(10,"label",8),Y(11,"First name"),K()(),H(12,"div",6)(13,"input",9),Pe("ngModelChange",function(a){return s.last_name=a}),K(),H(14,"label",10),Y(15,"Last name"),K()(),H(16,"div",6)(17,"input",11),Pe("ngModelChange",function(a){return s.email=a}),K(),H(18,"label",12),Y(19,"Email address"),K()(),H(20,"div",6)(21,"input",13),Pe("ngModelChange",function(a){return s.mobile=a}),K(),H(22,"label",14),Y(23,"Mobile"),K()(),H(24,"button",15),Pe("click",function(){return s.addStudent()}),Y(25,"Add Student"),K()()(),H(26,"div",16)(27,"h5",17),Y(28,"Student List"),K(),H(29,"div",18)(30,"div",19)(31,"table",20)(32,"thead")(33,"tr")(34,"th",21),Y(35,"First Name"),K(),H(36,"th",21),Y(37,"Last Name"),K(),H(38,"th",21),Y(39,"Email"),K(),H(40,"th",21),Y(41,"Mobile"),K(),H(42,"th",21),Y(43,"Action"),K()()(),H(44,"tbody"),kw(45,p5,12,4,"tr",22),K()(),H(46,"button",23),Pe("click",function(){return s.register()}),Y(47,"Logout"),K()()()()()()),i&2&&(et(9),Bt("ngModel",s.first_name),et(4),Bt("ngModel",s.last_name),et(4),Bt("ngModel",s.email),et(4),Bt("ngModel",s.mobile),et(24),Bt("ngForOf",s.stuedntList))},dependencies:[Lw,Bn,zr,mr]});let n=e;return n})();var Gk=(()=>{let e=class e{constructor(r){this.auth=r,this.email="",this.password=""}register(){if(this.email==""){alert("Please enter the email");return}if(this.password==""){alert("Please enter the password ");return}this.auth.register(this.email,this.password),this.email="",this.password=""}};e.\u0275fac=function(i){return new(i||e)(ge(Ur))},e.\u0275cmp=en({type:e,selectors:[["app-register"]],decls:26,vars:2,consts:[[1,"container-fluid"],[1,"row","mt-5"],[1,"col"],[1,"col-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[1,"text-dark","text-muted"],["for","exampleInputEmail1",1,"form-label"],["type","email","name","email",1,"form-control",3,"ngModel","ngModelChange"],["for","exampleInputPassword1",1,"form-label"],["type","password","name","password",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-info",3,"click"],[1,"row"],[1,"col","md-6"],["href","/login",2,"text-decoration","none"],[1,"text-danger"]],template:function(i,s){i&1&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"form")(7,"div",6)(8,"h4",7),Y(9,"Register"),K()(),H(10,"div",6)(11,"label",8),Y(12,"Email address"),K(),H(13,"input",9),Pe("ngModelChange",function(a){return s.email=a}),K()(),H(14,"div",6)(15,"label",10),Y(16,"Password"),K(),H(17,"input",11),Pe("ngModelChange",function(a){return s.password=a}),K()(),H(18,"button",12),Pe("click",function(){return s.register()}),Y(19,"Register"),K(),H(20,"div",13)(21,"div",14)(22,"a",15),Y(23,"Have an account ? "),H(24,"span",16),Y(25,"Login"),K()()()()()()()()()()()),i&2&&(et(13),Bt("ngModel",s.email),et(4),Bt("ngModel",s.password))},dependencies:[Gr,Bn,zr,jr,mr,gr]});let n=e;return n})();var Hk=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=en({type:e,selectors:[["app-verify-email"]],decls:13,vars:0,consts:[[1,"container-fluid"],[1,"row","mt-5"],[1,"col"],[1,"col-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[1,"text-danger","text-muted"],[1,"text-muted"]],template:function(i,s){i&1&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"form")(7,"div",6)(8,"h4",7),Y(9,"Welcome"),K()(),H(10,"div",6)(11,"p",8),Y(12,"Link has sent on your registered email. Please verify it."),K()()()()()()()()())},dependencies:[Gr,jr,gr]});let n=e;return n})();var Kk=(()=>{let e=class e{constructor(r){this.auth=r,this.email=""}forgotpassword(){this.auth.forgotpassword(this.email),this.email=""}};e.\u0275fac=function(i){return new(i||e)(ge(Ur))},e.\u0275cmp=en({type:e,selectors:[["app-forgot-password"]],decls:22,vars:1,consts:[[1,"container-fluid"],[1,"row","mt-5"],[1,"col"],[1,"col-4"],[1,"card"],[1,"card-body"],[1,"mb-3"],[1,"text-dark","text-muted"],["for","exampleInputEmail1",1,"form-label"],["type","email","name","email",1,"form-control",3,"ngModel","ngModelChange"],["type","button",1,"btn","btn-info",3,"click"],[1,"row"],[1,"col","md-6"],["href","/register",2,"text-decoration","none"],[1,"text-danger"]],template:function(i,s){i&1&&(H(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3)(4,"div",4)(5,"div",5)(6,"form")(7,"div",6)(8,"h4",7),Y(9,"Forgot Password"),K()(),H(10,"div",6)(11,"label",8),Y(12,"Email "),K(),H(13,"input",9),Pe("ngModelChange",function(a){return s.email=a}),K()(),H(14,"button",10),Pe("click",function(){return s.forgotpassword()}),Y(15,"Send link"),K(),H(16,"div",11)(17,"div",12)(18,"a",13),Y(19,"Back to "),H(20,"span",14),Y(21,"Login"),K()()()()()()()()()()()),i&2&&(et(13),Bt("ngModel",s.email))},dependencies:[Gr,Bn,zr,jr,mr,gr]});let n=e;return n})();var g5=[{path:"",redirectTo:"login",pathMatch:"full"},{path:"login",component:LE},{path:"dashboard",component:jk},{path:"register",component:Gk},{path:"verify-email",component:Hk},{path:"forgot-password",component:Kk}],Wk=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e}),e.\u0275inj=yt({imports:[qa.forRoot(g5),qa]});let n=e;return n})();var Sp=(()=>{let e=class e{constructor(){this.title="Angular_app2"}};e.\u0275fac=function(i){return new(i||e)},e.\u0275cmp=en({type:e,selectors:[["app-root"]],decls:1,vars:0,template:function(i,s){i&1&&ru(0,"router-outlet")},dependencies:[Uw]});let n=e;return n})();var $k={production:!1,firebase:{apiKey:"AIzaSyBsp-YvA8WdsLCdViG3zykIyjCVSxnfqww",authDomain:"student-management-syste-fe884.firebaseapp.com",projectId:"student-management-syste-fe884",storageBucket:"student-management-syste-fe884.appspot.com",messagingSenderId:"523036578785",appId:"1:523036578785:web:187f9732e31ecce9c578a0"}};var Qk=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e,bootstrap:[Sp]}),e.\u0275inj=yt({providers:[Vw()],imports:[Bw,Wk,uE.initializeApp($k.firebase),qa,PE,FE,Uk]});let n=e;return n})();var m5=(()=>{let e=class e{};e.\u0275fac=function(i){return new(i||e)},e.\u0275mod=vt({type:e,bootstrap:[Sp]}),e.\u0275inj=yt({imports:[Qk,qw]});let n=e;return n})();export{m5 as a};
